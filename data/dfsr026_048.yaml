- en: Contribute a community pipeline
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: è´¡çŒ®ä¸€ä¸ªç¤¾åŒºæµæ°´çº¿
- en: 'Original text: [https://huggingface.co/docs/diffusers/using-diffusers/contribute_pipeline](https://huggingface.co/docs/diffusers/using-diffusers/contribute_pipeline)'
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡é“¾æ¥ï¼š[https://huggingface.co/docs/diffusers/using-diffusers/contribute_pipeline](https://huggingface.co/docs/diffusers/using-diffusers/contribute_pipeline)
- en: null
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: ğŸ’¡ Take a look at GitHub Issue [#841](https://github.com/huggingface/diffusers/issues/841)
    for more context about why weâ€™re adding community pipelines to help everyone easily
    share their work without being slowed down.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ’¡ æŸ¥çœ‹ GitHub Issue [#841](https://github.com/huggingface/diffusers/issues/841)
    ä»¥è·å–æœ‰å…³ä¸ºä»€ä¹ˆæˆ‘ä»¬æ­£åœ¨æ·»åŠ ç¤¾åŒºæµæ°´çº¿ä»¥å¸®åŠ©æ¯ä¸ªäººè½»æ¾å…±äº«å·¥ä½œè€Œä¸å—é˜»ç¢çš„æ›´å¤šèƒŒæ™¯ä¿¡æ¯ã€‚
- en: Community pipelines allow you to add any additional features youâ€™d like on top
    of the [DiffusionPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/overview#diffusers.DiffusionPipeline).
    The main benefit of building on top of the `DiffusionPipeline` is anyone can load
    and use your pipeline by only adding one more argument, making it super easy for
    the community to access.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: ç¤¾åŒºæµæ°´çº¿å…è®¸æ‚¨åœ¨ [DiffusionPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/overview#diffusers.DiffusionPipeline)
    ä¹‹ä¸Šæ·»åŠ ä»»ä½•æ‚¨æƒ³è¦çš„é™„åŠ åŠŸèƒ½ã€‚åœ¨ `DiffusionPipeline` çš„åŸºç¡€ä¸Šæ„å»ºçš„ä¸»è¦å¥½å¤„æ˜¯ä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ªå‚æ•°æ¥åŠ è½½å’Œä½¿ç”¨æ‚¨çš„æµæ°´çº¿ï¼Œä½¿ç¤¾åŒºè½»æ¾è®¿é—®ã€‚
- en: This guide will show you how to create a community pipeline and explain how
    they work. To keep things simple, youâ€™ll create a â€œone-stepâ€ pipeline where the
    `UNet` does a single forward pass and calls the scheduler once.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: æœ¬æŒ‡å—å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•åˆ›å»ºä¸€ä¸ªç¤¾åŒºæµæ°´çº¿å¹¶è§£é‡Šå®ƒä»¬çš„å·¥ä½œåŸç†ã€‚ä¸ºäº†ä¿æŒç®€å•ï¼Œæ‚¨å°†åˆ›å»ºä¸€ä¸ªâ€œä¸€æ­¥â€æµæ°´çº¿ï¼Œå…¶ä¸­ `UNet` è¿›è¡Œä¸€æ¬¡å‰å‘ä¼ é€’å¹¶è°ƒç”¨è°ƒåº¦ç¨‹åºä¸€æ¬¡ã€‚
- en: Initialize the pipeline
  id: totrans-6
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: åˆå§‹åŒ–æµæ°´çº¿
- en: 'You should start by creating a `one_step_unet.py` file for your community pipeline.
    In this file, create a pipeline class that inherits from the [DiffusionPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/overview#diffusers.DiffusionPipeline)
    to be able to load model weights and the scheduler configuration from the Hub.
    The one-step pipeline needs a `UNet` and a scheduler, so youâ€™ll need to add these
    as arguments to the `__init__` function:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨åº”è¯¥é¦–å…ˆä¸ºæ‚¨çš„ç¤¾åŒºæµæ°´çº¿åˆ›å»ºä¸€ä¸ª `one_step_unet.py` æ–‡ä»¶ã€‚åœ¨æ­¤æ–‡ä»¶ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª [DiffusionPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/overview#diffusers.DiffusionPipeline)
    çš„æµæ°´çº¿ç±»ï¼Œä»¥ä¾¿èƒ½å¤Ÿä» Hub åŠ è½½æ¨¡å‹æƒé‡å’Œè°ƒåº¦ç¨‹åºé…ç½®ã€‚ä¸€æ­¥æµæ°´çº¿éœ€è¦ä¸€ä¸ª `UNet` å’Œä¸€ä¸ªè°ƒåº¦ç¨‹åºï¼Œå› æ­¤æ‚¨éœ€è¦å°†å®ƒä»¬ä½œä¸ºå‚æ•°æ·»åŠ åˆ° `__init__`
    å‡½æ•°ä¸­ï¼š
- en: '[PRE0]'
  id: totrans-8
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'To ensure your pipeline and its components (`unet` and `scheduler`) can be
    saved with [save_pretrained()](/docs/diffusers/v0.26.3/en/api/pipelines/overview#diffusers.DiffusionPipeline.save_pretrained),
    add them to the `register_modules` function:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†ç¡®ä¿æ‚¨çš„æµæ°´çº¿åŠå…¶ç»„ä»¶ï¼ˆ`unet` å’Œ `scheduler`ï¼‰å¯ä»¥é€šè¿‡ [save_pretrained()](/docs/diffusers/v0.26.3/en/api/pipelines/overview#diffusers.DiffusionPipeline.save_pretrained)
    è¿›è¡Œä¿å­˜ï¼Œå°†å®ƒä»¬æ·»åŠ åˆ° `register_modules` å‡½æ•°ä¸­ï¼š
- en: '[PRE1]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Cool, the `__init__` step is done and you can move to the forward pass now!
    ğŸ”¥
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: é…·ï¼Œ`__init__` æ­¥éª¤å·²å®Œæˆï¼Œç°åœ¨å¯ä»¥è½¬åˆ°å‰å‘ä¼ é€’äº†ï¼ğŸ”¥
- en: Define the forward pass
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å®šä¹‰å‰å‘ä¼ é€’
- en: 'In the forward pass, which we recommend defining as `__call__`, you have complete
    creative freedom to add whatever feature youâ€™d like. For our amazing one-step
    pipeline, create a random image and only call the `unet` and `scheduler` once
    by setting `timestep=1`:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨å‰å‘ä¼ é€’ä¸­ï¼Œæˆ‘ä»¬å»ºè®®å°†å…¶å®šä¹‰ä¸º `__call__`ï¼Œæ‚¨å¯ä»¥å®Œå…¨è‡ªç”±åœ°æ·»åŠ ä»»ä½•æ‚¨æƒ³è¦çš„åŠŸèƒ½ã€‚å¯¹äºæˆ‘ä»¬æƒŠäººçš„ä¸€æ­¥æµæ°´çº¿ï¼Œé€šè¿‡è®¾ç½® `timestep=1`
    åˆ›å»ºä¸€ä¸ªéšæœºå›¾åƒï¼Œå¹¶ä»…è°ƒç”¨ä¸€æ¬¡ `unet` å’Œ `scheduler`ï¼š
- en: '[PRE2]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Thatâ€™s it! ğŸš€ You can now run this pipeline by passing a `unet` and `scheduler`
    to it:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: å°±æ˜¯è¿™æ ·ï¼ğŸš€ ç°åœ¨æ‚¨å¯ä»¥é€šè¿‡ä¼ é€’ `unet` å’Œ `scheduler` æ¥è¿è¡Œæ­¤æµæ°´çº¿ï¼š
- en: '[PRE3]'
  id: totrans-16
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'But whatâ€™s even better is you can load pre-existing weights into the pipeline
    if the pipeline structure is identical. For example, you can load the [`google/ddpm-cifar10-32`](https://huggingface.co/google/ddpm-cifar10-32)
    weights into the one-step pipeline:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: ä½†æ›´å¥½çš„æ˜¯ï¼Œå¦‚æœæµæ°´çº¿ç»“æ„ç›¸åŒï¼Œæ‚¨å¯ä»¥å°†é¢„å…ˆå­˜åœ¨çš„æƒé‡åŠ è½½åˆ°æµæ°´çº¿ä¸­ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°† [`google/ddpm-cifar10-32`](https://huggingface.co/google/ddpm-cifar10-32)
    çš„æƒé‡åŠ è½½åˆ°ä¸€æ­¥æµæ°´çº¿ä¸­ï¼š
- en: '[PRE4]'
  id: totrans-18
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Share your pipeline
  id: totrans-19
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: åˆ†äº«æ‚¨çš„æµæ°´çº¿
- en: Open a Pull Request on the ğŸ§¨ Diffusers [repository](https://github.com/huggingface/diffusers)
    to add your awesome pipeline in `one_step_unet.py` to the [examples/community](https://github.com/huggingface/diffusers/tree/main/examples/community)
    subfolder.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ ğŸ§¨ Diffusers [repository](https://github.com/huggingface/diffusers) ä¸Šæ‰“å¼€ä¸€ä¸ª Pull
    Requestï¼Œå°†æ‚¨çš„å‡ºè‰²æµæ°´çº¿æ·»åŠ åˆ° [examples/community](https://github.com/huggingface/diffusers/tree/main/examples/community)
    å­æ–‡ä»¶å¤¹ä¸­ã€‚
- en: 'Once it is merged, anyone with `diffusers >= 0.4.0` installed can use this
    pipeline magically ğŸª„ by specifying it in the `custom_pipeline` argument:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦åˆå¹¶ï¼Œä»»ä½•å®‰è£…äº† `diffusers >= 0.4.0` çš„äººéƒ½å¯ä»¥é€šè¿‡åœ¨ `custom_pipeline` å‚æ•°ä¸­æŒ‡å®šå®ƒæ¥ç¥å¥‡åœ°ä½¿ç”¨è¿™ä¸ªæµæ°´çº¿
    ğŸª„ï¼š
- en: '[PRE5]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Another way to share your community pipeline is to upload the `one_step_unet.py`
    file directly to your preferred [model repository](https://huggingface.co/docs/hub/models-uploading)
    on the Hub. Instead of specifying the `one_step_unet.py` file, pass the model
    repository id to the `custom_pipeline` argument:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: åˆ†äº«æ‚¨çš„ç¤¾åŒºæµæ°´çº¿çš„å¦ä¸€ç§æ–¹æ³•æ˜¯å°† `one_step_unet.py` æ–‡ä»¶ç›´æ¥ä¸Šä¼ åˆ°æ‚¨é¦–é€‰çš„ [æ¨¡å‹å­˜å‚¨åº“](https://huggingface.co/docs/hub/models-uploading)
    ä¸Šçš„ Hubã€‚è€Œä¸æ˜¯æŒ‡å®š `one_step_unet.py` æ–‡ä»¶ï¼Œå°†æ¨¡å‹å­˜å‚¨åº“ id ä¼ é€’ç»™ `custom_pipeline` å‚æ•°ï¼š
- en: '[PRE6]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Take a look at the following table to compare the two sharing workflows to
    help you decide the best option for you:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: æŸ¥çœ‹ä»¥ä¸‹è¡¨æ ¼ï¼Œæ¯”è¾ƒä¸¤ç§å…±äº«å·¥ä½œæµç¨‹ï¼Œä»¥å¸®åŠ©æ‚¨å†³å®šæœ€é€‚åˆæ‚¨çš„é€‰é¡¹ï¼š
- en: '|  | GitHub community pipeline | HF Hub community pipeline |'
  id: totrans-26
  prefs: []
  type: TYPE_TB
  zh: '|  | GitHub ç¤¾åŒºæµæ°´çº¿ | HF Hub ç¤¾åŒºæµæ°´çº¿ |'
- en: '| --- | --- | --- |'
  id: totrans-27
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| usage | same | same |'
  id: totrans-28
  prefs: []
  type: TYPE_TB
  zh: '| ç”¨æ³• | ç›¸åŒ | ç›¸åŒ |'
- en: '| review process | open a Pull Request on GitHub and undergo a review process
    from the Diffusers team before merging; may be slower | upload directly to a Hub
    repository without any review; this is the fastest workflow |'
  id: totrans-29
  prefs: []
  type: TYPE_TB
  zh: '| å®¡æŸ¥æµç¨‹ | åœ¨ GitHub ä¸Šæ‰“å¼€ä¸€ä¸ª Pull Request å¹¶åœ¨åˆå¹¶ä¹‹å‰æ¥å— Diffusers å›¢é˜Ÿçš„å®¡æŸ¥æµç¨‹ï¼›å¯èƒ½ä¼šè¾ƒæ…¢ | ç›´æ¥ä¸Šä¼ åˆ°
    Hub å­˜å‚¨åº“ï¼Œæ— éœ€ä»»ä½•å®¡æŸ¥ï¼›è¿™æ˜¯æœ€å¿«çš„å·¥ä½œæµç¨‹ |'
- en: '| visibility | included in the official Diffusers repository and documentation
    | included on your HF Hub profile and relies on your own usage/promotion to gain
    visibility |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
  zh: '| å¯è§æ€§ | åŒ…å«åœ¨å®˜æ–¹ Diffusers å­˜å‚¨åº“å’Œæ–‡æ¡£ä¸­ | åŒ…å«åœ¨æ‚¨çš„ HF Hub ä¸ªäººèµ„æ–™ä¸­ï¼Œå¹¶ä¾èµ–äºæ‚¨è‡ªå·±çš„ä½¿ç”¨/æ¨å¹¿æ¥è·å¾—å¯è§æ€§ |'
- en: ğŸ’¡ You can use whatever package you want in your community pipeline file - as
    long as the user has it installed, everything will work fine. Make sure you have
    one and only one pipeline class that inherits from `DiffusionPipeline` because
    this is automatically detected.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ’¡ æ— è®ºæ‚¨åœ¨ç¤¾åŒºç®¡é“æ–‡ä»¶ä¸­ä½¿ç”¨ä»€ä¹ˆåŒ… - åªè¦ç”¨æˆ·å·²å®‰è£…ï¼Œä¸€åˆ‡éƒ½ä¼šæ­£å¸¸å·¥ä½œã€‚ç¡®ä¿æ‚¨æœ‰ä¸€ä¸ªä¸”ä»…æœ‰ä¸€ä¸ªä»`DiffusionPipeline`ç»§æ‰¿çš„ç®¡é“ç±»ï¼Œå› ä¸ºè¿™ä¼šè‡ªåŠ¨æ£€æµ‹ã€‚
- en: How do community pipelines work?
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç¤¾åŒºç®¡é“å¦‚ä½•å·¥ä½œï¼Ÿ
- en: 'A community pipeline is a class that inherits from [DiffusionPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/overview#diffusers.DiffusionPipeline)
    which means:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: ç¤¾åŒºç®¡é“æ˜¯ä»[DiffusionPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/overview#diffusers.DiffusionPipeline)ç»§æ‰¿çš„ç±»ï¼Œè¿™æ„å‘³ç€ï¼š
- en: It can be loaded with the `custom_pipeline` argument.
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å®ƒå¯ä»¥é€šè¿‡`custom_pipeline`å‚æ•°åŠ è½½ã€‚
- en: The model weights and scheduler configuration are loaded from `pretrained_model_name_or_path`.
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ¨¡å‹æƒé‡å’Œè°ƒåº¦å™¨é…ç½®ä»`pretrained_model_name_or_path`åŠ è½½ã€‚
- en: The code that implements a feature in the community pipeline is defined in a
    `pipeline.py` file.
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: åœ¨ç¤¾åŒºç®¡é“ä¸­å®ç°åŠŸèƒ½çš„ä»£ç åœ¨`pipeline.py`æ–‡ä»¶ä¸­å®šä¹‰ã€‚
- en: 'Sometimes you canâ€™t load all the pipeline components weights from an official
    repository. In this case, the other components should be passed directly to the
    pipeline:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: æœ‰æ—¶æ‚¨æ— æ³•ä»å®˜æ–¹å­˜å‚¨åº“åŠ è½½æ‰€æœ‰ç®¡é“ç»„ä»¶çš„æƒé‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¶ä»–ç»„ä»¶åº”ç›´æ¥ä¼ é€’ç»™ç®¡é“ï¼š
- en: '[PRE7]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The magic behind community pipelines is contained in the following code. It
    allows the community pipeline to be loaded from GitHub or the Hub, and itâ€™ll be
    available to all ğŸ§¨ Diffusers packages.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: ç¤¾åŒºç®¡é“èƒŒåçš„é­”åŠ›åŒ…å«åœ¨ä»¥ä¸‹ä»£ç ä¸­ã€‚å®ƒå…è®¸ä»GitHubæˆ–HubåŠ è½½ç¤¾åŒºç®¡é“ï¼Œå¹¶ä¸”å°†å¯¹æ‰€æœ‰ğŸ§¨ DiffusersåŒ…å¯ç”¨ã€‚
- en: '[PRE8]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
