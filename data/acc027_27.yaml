- en: Amazon SageMaker
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Amazon SageMaker
- en: 'Original text: [https://huggingface.co/docs/accelerate/usage_guides/sagemaker](https://huggingface.co/docs/accelerate/usage_guides/sagemaker)'
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸå§‹æ–‡æœ¬ï¼š[https://huggingface.co/docs/accelerate/usage_guides/sagemaker](https://huggingface.co/docs/accelerate/usage_guides/sagemaker)
- en: null
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: Hugging Face and Amazon introduced new [Hugging Face Deep Learning Containers
    (DLCs)](https://github.com/aws/deep-learning-containers/blob/master/available_images.md#huggingface-training-containers)
    to make it easier than ever to train Hugging Face Transformer models in [Amazon
    SageMaker](https://aws.amazon.com/sagemaker/).
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: Hugging Face å’Œäºšé©¬é€Šæ¨å‡ºäº†æ–°çš„ [Hugging Face Deep Learning Containers (DLCs)](https://github.com/aws/deep-learning-containers/blob/master/available_images.md#huggingface-training-containers)ï¼Œä½¿åœ¨
    [Amazon SageMaker](https://aws.amazon.com/sagemaker/) ä¸­è®­ç»ƒ Hugging Face Transformer
    æ¨¡å‹å˜å¾—æ¯”ä»¥å¾€æ›´å®¹æ˜“ã€‚
- en: Getting Started
  id: totrans-4
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å¼€å§‹
- en: Setup & Installation
  id: totrans-5
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: è®¾ç½®å’Œå®‰è£…
- en: Before you can run your ğŸ¤— Accelerate scripts on Amazon SageMaker you need to
    sign up for an AWS account. If you do not have an AWS account yet learn more [here](https://docs.aws.amazon.com/sagemaker/latest/dg/gs-set-up.html).
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ Amazon SageMaker ä¸Šè¿è¡Œæ‚¨çš„ ğŸ¤— Accelerate è„šæœ¬ä¹‹å‰ï¼Œæ‚¨éœ€è¦æ³¨å†Œä¸€ä¸ª AWS å¸æˆ·ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰ AWS å¸æˆ·ï¼Œè¯·åœ¨æ­¤å¤„äº†è§£æ›´å¤šä¿¡æ¯ã€‚
- en: 'After you have your AWS Account you need to install the `sagemaker` sdk for
    ğŸ¤— Accelerate with:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æ‹¥æœ‰ AWS å¸æˆ·åï¼Œæ‚¨éœ€è¦å®‰è£… `sagemaker` sdk ä»¥ä½¿ç”¨ ğŸ¤— Accelerateï¼š
- en: '[PRE0]'
  id: totrans-8
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'ğŸ¤— Accelerate currently uses the ğŸ¤— DLCs, with `transformers`, `datasets` and
    `tokenizers` pre-installed. ğŸ¤— Accelerate is not in the DLC yet (will soon be added!)
    so to use it within Amazon SageMaker you need to create a `requirements.txt` in
    the same directory where your training script is located and add it as dependency:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ¤— Accelerate ç›®å‰ä½¿ç”¨ ğŸ¤— DLCsï¼Œé¢„å®‰è£…äº† `transformers`ã€`datasets` å’Œ `tokenizers`ã€‚ğŸ¤— Accelerate
    å°šæœªåŒ…å«åœ¨ DLC ä¸­ï¼ˆå³å°†æ·»åŠ ï¼ï¼‰ï¼Œå› æ­¤è¦åœ¨ Amazon SageMaker ä¸­ä½¿ç”¨å®ƒï¼Œæ‚¨éœ€è¦åœ¨ä¸æ‚¨çš„è®­ç»ƒè„šæœ¬ä½äºåŒä¸€ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª `requirements.txt`
    å¹¶å°†å…¶æ·»åŠ ä¸ºä¾èµ–é¡¹ï¼š
- en: '[PRE1]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: You should also add any other dependencies you have to this `requirements.txt`.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨è¿˜åº”è¯¥å°†æ‚¨çš„å…¶ä»–ä¾èµ–é¡¹æ·»åŠ åˆ°æ­¤ `requirements.txt` ä¸­ã€‚
- en: Configure ğŸ¤— Accelerate
  id: totrans-12
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: é…ç½® ğŸ¤— Accelerate
- en: 'You can configure the launch configuration for Amazon SageMaker the same as
    you do for non SageMaker training jobs with the ğŸ¤— Accelerate CLI:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨å¯ä»¥ä½¿ç”¨ ğŸ¤— Accelerate CLI ä¸º Amazon SageMaker é…ç½®å¯åŠ¨é…ç½®ï¼Œä¸ä¸ºé SageMaker è®­ç»ƒä½œä¸šé…ç½®ç›¸åŒï¼š
- en: '[PRE2]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: ğŸ¤— Accelerate will go through a questionnaire about your Amazon SageMaker setup
    and create a config file you can edit.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ¤— Accelerate å°†é€šè¿‡é—®å·è°ƒæŸ¥äº†è§£æ‚¨çš„ Amazon SageMaker è®¾ç½®ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ‚¨å¯ä»¥ç¼–è¾‘çš„é…ç½®æ–‡ä»¶ã€‚
- en: ğŸ¤— Accelerate is not saving any of your credentials.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ¤— Accelerate ä¸ä¼šä¿å­˜æ‚¨çš„ä»»ä½•å‡­æ®ã€‚
- en: Prepare a ğŸ¤— Accelerate fine-tuning script
  id: totrans-17
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: å‡†å¤‡ä¸€ä¸ª ğŸ¤— Accelerate å¾®è°ƒè„šæœ¬
- en: 'The training script is very similar to a training script you might run outside
    of SageMaker, but to save your model after training you need to specify either
    `/opt/ml/model` or use `os.environ["SM_MODEL_DIR"]` as your save directory. After
    training, artifacts in this directory are uploaded to S3:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: è®­ç»ƒè„šæœ¬ä¸æ‚¨å¯èƒ½åœ¨ SageMaker ä¹‹å¤–è¿è¡Œçš„è®­ç»ƒè„šæœ¬éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯è¦åœ¨è®­ç»ƒåä¿å­˜æ¨¡å‹ï¼Œæ‚¨éœ€è¦æŒ‡å®š `/opt/ml/model` æˆ–ä½¿ç”¨ `os.environ["SM_MODEL_DIR"]`
    ä½œä¸ºä¿å­˜ç›®å½•ã€‚è®­ç»ƒåï¼Œæ­¤ç›®å½•ä¸­çš„å·¥ä»¶å°†ä¸Šä¼ åˆ° S3ï¼š
- en: '[PRE3]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: SageMaker doesnâ€™t support argparse actions. If you want to use, for example,
    boolean hyperparameters, you need to specify type as bool in your script and provide
    an explicit True or False value for this hyperparameter. [[REF]](https://sagemaker.readthedocs.io/en/stable/frameworks/pytorch/using_pytorch.html#prepare-a-pytorch-training-script).
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: SageMaker ä¸æ”¯æŒ argparse æ“ä½œã€‚å¦‚æœæ‚¨æƒ³ä½¿ç”¨å¸ƒå°”è¶…å‚æ•°ï¼Œä¾‹å¦‚ï¼Œæ‚¨éœ€è¦åœ¨è„šæœ¬ä¸­å°†ç±»å‹æŒ‡å®šä¸º boolï¼Œå¹¶ä¸ºæ­¤è¶…å‚æ•°æä¾›æ˜¾å¼çš„ True
    æˆ– False å€¼ã€‚[[REF]](https://sagemaker.readthedocs.io/en/stable/frameworks/pytorch/using_pytorch.html#prepare-a-pytorch-training-script)ã€‚
- en: Launch Training
  id: totrans-21
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: å¯åŠ¨è®­ç»ƒ
- en: 'You can launch your training with ğŸ¤— Accelerate CLI with:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨å¯ä»¥ä½¿ç”¨ ğŸ¤— Accelerate CLI å¯åŠ¨è®­ç»ƒï¼š
- en: '[PRE4]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: This will launch your training script using your configuration. The only thing
    you have to do is provide all the arguments needed by your training script as
    named arguments.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å°†ä½¿ç”¨æ‚¨çš„é…ç½®å¯åŠ¨è®­ç»ƒè„šæœ¬ã€‚æ‚¨å”¯ä¸€éœ€è¦åšçš„å°±æ˜¯æä¾›è®­ç»ƒè„šæœ¬æ‰€éœ€çš„æ‰€æœ‰å‚æ•°ä½œä¸ºå‘½åå‚æ•°ã€‚
- en: '**Examples**'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '**ç¤ºä¾‹**'
- en: If you run one of the example scripts, donâ€™t forget to add `accelerator.save('/opt/ml/model')`
    to it.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨è¿è¡Œå…¶ä¸­ä¸€ä¸ªç¤ºä¾‹è„šæœ¬ï¼Œè¯·ä¸è¦å¿˜è®°åœ¨å…¶ä¸­æ·»åŠ  `accelerator.save('/opt/ml/model')`ã€‚
- en: '[PRE5]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Outputs:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: è¾“å‡ºï¼š
- en: '[PRE6]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Advanced Features
  id: totrans-30
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: é«˜çº§åŠŸèƒ½
- en: 'Distributed Training: Data Parallelism'
  id: totrans-31
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: åˆ†å¸ƒå¼è®­ç»ƒï¼šæ•°æ®å¹¶è¡Œ
- en: 'Set up the accelerate config by running `accelerate config` and answer the
    SageMaker questions and set it up. To use SageMaker DDP, select it when asked
    `What is the distributed mode? ([0] No distributed training, [1] data parallelism):`.
    Example config below:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: é€šè¿‡è¿è¡Œ `accelerate config` æ¥è®¾ç½®åŠ é€Ÿé…ç½®ï¼Œå¹¶å›ç­” SageMaker çš„é—®é¢˜å¹¶è®¾ç½®å®ƒã€‚è¦ä½¿ç”¨ SageMaker DDPï¼Œè¯·åœ¨è¯¢é—®æ—¶é€‰æ‹©
    `What is the distributed mode? ([0] No distributed training, [1] data parallelism):`ã€‚ä»¥ä¸‹æ˜¯ç¤ºä¾‹é…ç½®ï¼š
- en: '[PRE7]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Distributed Training: Model Parallelism'
  id: totrans-34
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: åˆ†å¸ƒå¼è®­ç»ƒï¼šæ¨¡å‹å¹¶è¡Œ
- en: '*currently in development, will be supported soon.*'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '*ç›®å‰æ­£åœ¨å¼€å‘ä¸­ï¼Œå³å°†æ”¯æŒã€‚*'
- en: Python packages and dependencies
  id: totrans-36
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Python åŒ…å’Œä¾èµ–é¡¹
- en: ğŸ¤— Accelerate currently uses the ğŸ¤— DLCs, with `transformers`, `datasets` and
    `tokenizers` pre-installed. If you want to use different/other Python packages
    you can do this by adding them to the `requirements.txt`. These packages will
    be installed before your training script is started.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ¤— Accelerate ç›®å‰ä½¿ç”¨ ğŸ¤— DLCsï¼Œé¢„å®‰è£…äº† `transformers`ã€`datasets` å’Œ `tokenizers`ã€‚å¦‚æœæ‚¨æƒ³ä½¿ç”¨ä¸åŒ/å…¶ä»–
    Python åŒ…ï¼Œå¯ä»¥é€šè¿‡å°†å®ƒä»¬æ·»åŠ åˆ° `requirements.txt` æ¥å®ç°ã€‚è¿™äº›åŒ…å°†åœ¨å¯åŠ¨è®­ç»ƒè„šæœ¬ä¹‹å‰å®‰è£…ã€‚
- en: 'Local Training: SageMaker Local mode'
  id: totrans-38
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: æœ¬åœ°è®­ç»ƒï¼šSageMaker æœ¬åœ°æ¨¡å¼
- en: 'The local mode in the SageMaker SDK allows you to run your training script
    locally inside the HuggingFace DLC (Deep Learning container) or using your custom
    container image. This is useful for debugging and testing your training script
    inside the final container environment. Local mode uses Docker compose (*Note:
    Docker Compose V2 is not supported yet*). The SDK will handle the authentication
    against ECR to pull the DLC to your local environment. You can emulate CPU (single
    and multi-instance) and GPU (single instance) SageMaker training jobs.'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: SageMaker SDK ä¸­çš„æœ¬åœ°æ¨¡å¼å…è®¸æ‚¨åœ¨ HuggingFace DLCï¼ˆæ·±åº¦å­¦ä¹ å®¹å™¨ï¼‰å†…éƒ¨æˆ–ä½¿ç”¨è‡ªå®šä¹‰å®¹å™¨æ˜ åƒåœ¨æœ¬åœ°è¿è¡Œè®­ç»ƒè„šæœ¬ã€‚è¿™å¯¹äºåœ¨æœ€ç»ˆå®¹å™¨ç¯å¢ƒå†…è°ƒè¯•å’Œæµ‹è¯•æ‚¨çš„è®­ç»ƒè„šæœ¬éå¸¸æœ‰ç”¨ã€‚æœ¬åœ°æ¨¡å¼ä½¿ç”¨
    Docker composeï¼ˆ*æ³¨æ„ï¼šå°šä¸æ”¯æŒ Docker Compose V2*ï¼‰ã€‚SDK å°†å¤„ç†å¯¹ ECR çš„èº«ä»½éªŒè¯ï¼Œä»¥å°† DLC æ‹‰åˆ°æ‚¨çš„æœ¬åœ°ç¯å¢ƒã€‚æ‚¨å¯ä»¥æ¨¡æ‹Ÿ
    CPUï¼ˆå•å®ä¾‹å’Œå¤šå®ä¾‹ï¼‰å’Œ GPUï¼ˆå•å®ä¾‹ï¼‰SageMaker è®­ç»ƒä½œä¸šã€‚
- en: To use local mode, you need to set your `ec2_instance_type` to `local`.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: è¦ä½¿ç”¨æœ¬åœ°æ¨¡å¼ï¼Œæ‚¨éœ€è¦å°†`ec2_instance_type`è®¾ç½®ä¸º`local`ã€‚
- en: '[PRE8]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Advanced configuration
  id: totrans-42
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: é«˜çº§é…ç½®
- en: The configuration allows you to override parameters for the [Estimator](https://sagemaker.readthedocs.io/en/stable/api/training/estimators.html).
    These settings have to be applied in the config file and are not part of `accelerate
    config`. You can control many additional aspects of the training job, e.g. use
    Spot instances, enable network isolation and many more.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: é…ç½®å…è®¸æ‚¨è¦†ç›–[Estimator](https://sagemaker.readthedocs.io/en/stable/api/training/estimators.html)çš„å‚æ•°ã€‚è¿™äº›è®¾ç½®å¿…é¡»åœ¨é…ç½®æ–‡ä»¶ä¸­åº”ç”¨ï¼Œä¸æ˜¯`accelerate
    config`çš„ä¸€éƒ¨åˆ†ã€‚æ‚¨å¯ä»¥æ§åˆ¶è®­ç»ƒä½œä¸šçš„è®¸å¤šå…¶ä»–æ–¹é¢ï¼Œä¾‹å¦‚ä½¿ç”¨Spotå®ä¾‹ï¼Œå¯ç”¨ç½‘ç»œéš”ç¦»ç­‰ç­‰ã€‚
- en: '[PRE9]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: You can find all available configuration [here](https://sagemaker.readthedocs.io/en/stable/api/training/estimators.html).
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨å¯ä»¥åœ¨[è¿™é‡Œ](https://sagemaker.readthedocs.io/en/stable/api/training/estimators.html)æ‰¾åˆ°æ‰€æœ‰å¯ç”¨çš„é…ç½®ã€‚
- en: Use Spot Instances
  id: totrans-46
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ä½¿ç”¨Spotå®ä¾‹
- en: 'You can use Spot Instances e.g. using (see [Advanced configuration](#advanced-configuration)):'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨å¯ä»¥ä½¿ç”¨Spotå®ä¾‹ï¼Œä¾‹å¦‚ï¼ˆè¯·å‚é˜…[é«˜çº§é…ç½®](#advanced-configuration)ï¼‰ï¼š
- en: '[PRE10]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '*Note: Spot Instances are subject to be terminated and training to be continued
    from a checkpoint. This is not handled in ğŸ¤— Accelerate out of the box. Contact
    us if you would like this feature.*'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: '*æ³¨æ„ï¼šSpotå®ä¾‹å¯èƒ½ä¼šè¢«ç»ˆæ­¢ï¼Œè®­ç»ƒå°†ä»æ£€æŸ¥ç‚¹ç»§ç»­ã€‚è¿™åœ¨ğŸ¤— Accelerateä¸­æ²¡æœ‰é»˜è®¤å¤„ç†ã€‚å¦‚æœæ‚¨éœ€è¦æ­¤åŠŸèƒ½ï¼Œè¯·è”ç³»æˆ‘ä»¬ã€‚*'
- en: 'Remote scripts: Use scripts located on Github'
  id: totrans-50
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: è¿œç¨‹è„šæœ¬ï¼šä½¿ç”¨ä½äºGithubä¸Šçš„è„šæœ¬
- en: '*undecided if feature is needed. Contact us if you would like this feature.*'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '*å°šæœªç¡®å®šæ˜¯å¦éœ€è¦æ­¤åŠŸèƒ½ã€‚å¦‚æœæ‚¨éœ€è¦æ­¤åŠŸèƒ½ï¼Œè¯·è”ç³»æˆ‘ä»¬ã€‚*'
