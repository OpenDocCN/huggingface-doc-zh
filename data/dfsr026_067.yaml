- en: DreamBooth
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DreamBooth
- en: 'Original text: [https://huggingface.co/docs/diffusers/training/dreambooth](https://huggingface.co/docs/diffusers/training/dreambooth)'
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡é“¾æ¥ï¼š[https://huggingface.co/docs/diffusers/training/dreambooth](https://huggingface.co/docs/diffusers/training/dreambooth)
- en: null
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: '[DreamBooth](https://huggingface.co/papers/2208.12242) is a training technique
    that updates the entire diffusion model by training on just a few images of a
    subject or style. It works by associating a special word in the prompt with the
    example images.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[DreamBooth](https://huggingface.co/papers/2208.12242)æ˜¯ä¸€ç§è®­ç»ƒæŠ€æœ¯ï¼Œé€šè¿‡ä»…å¯¹ä¸»é¢˜æˆ–é£æ ¼çš„å°‘é‡å›¾åƒè¿›è¡Œè®­ç»ƒæ¥æ›´æ–°æ•´ä¸ªæ‰©æ•£æ¨¡å‹ã€‚å®ƒé€šè¿‡å°†æç¤ºä¸­çš„ç‰¹æ®Šå•è¯ä¸ç¤ºä¾‹å›¾åƒå…³è”èµ·æ¥å·¥ä½œã€‚'
- en: If youâ€™re training on a GPU with limited vRAM, you should try enabling the `gradient_checkpointing`
    and `mixed_precision` parameters in the training command. You can also reduce
    your memory footprint by using memory-efficient attention with [xFormers](../optimization/xformers).
    JAX/Flax training is also supported for efficient training on TPUs and GPUs, but
    it doesnâ€™t support gradient checkpointing or xFormers. You should have a GPU with
    >30GB of memory if you want to train faster with Flax.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨åœ¨å…·æœ‰æœ‰é™vRAMçš„GPUä¸Šè¿›è¡Œè®­ç»ƒï¼Œåº”å°è¯•åœ¨è®­ç»ƒå‘½ä»¤ä¸­å¯ç”¨`gradient_checkpointing`å’Œ`mixed_precision`å‚æ•°ã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨[xFormers](../optimization/xformers)çš„å†…å­˜é«˜æ•ˆæ³¨æ„åŠ›æ¥å‡å°‘å†…å­˜å ç”¨ã€‚JAX/Flaxè®­ç»ƒä¹Ÿæ”¯æŒåœ¨TPUå’ŒGPUä¸Šè¿›è¡Œé«˜æ•ˆè®­ç»ƒï¼Œä½†ä¸æ”¯æŒæ¢¯åº¦æ£€æŸ¥ç‚¹æˆ–xFormersã€‚å¦‚æœæ‚¨æƒ³è¦ä½¿ç”¨Flaxæ›´å¿«åœ°è¿›è¡Œè®­ç»ƒï¼Œåˆ™åº”è¯¥å…·æœ‰>30GBå†…å­˜çš„GPUã€‚
- en: This guide will explore the [train_dreambooth.py](https://github.com/huggingface/diffusers/blob/main/examples/dreambooth/train_dreambooth.py)
    script to help you become more familiar with it, and how you can adapt it for
    your own use-case.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: æœ¬æŒ‡å—å°†æ¢è®¨[train_dreambooth.py](https://github.com/huggingface/diffusers/blob/main/examples/dreambooth/train_dreambooth.py)è„šæœ¬ï¼Œä»¥å¸®åŠ©æ‚¨æ›´ç†Ÿæ‚‰å®ƒï¼Œå¹¶äº†è§£å¦‚ä½•ä¸ºè‡ªå·±çš„ç”¨ä¾‹è¿›è¡Œè°ƒæ•´ã€‚
- en: 'Before running the script, make sure you install the library from source:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿è¡Œè„šæœ¬ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨ä»æºä»£ç å®‰è£…åº“ï¼š
- en: '[PRE0]'
  id: totrans-7
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Navigate to the example folder with the training script and install the required
    dependencies for the script youâ€™re using:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¼èˆªåˆ°åŒ…å«è®­ç»ƒè„šæœ¬çš„ç¤ºä¾‹æ–‡ä»¶å¤¹ï¼Œå¹¶å®‰è£…æ‰€éœ€çš„ä¾èµ–é¡¹ä»¥ä¾›æ‚¨ä½¿ç”¨çš„è„šæœ¬ï¼š
- en: PyTorchFlax
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: PyTorchFlax
- en: '[PRE1]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: ğŸ¤— Accelerate is a library for helping you train on multiple GPUs/TPUs or with
    mixed-precision. Itâ€™ll automatically configure your training setup based on your
    hardware and environment. Take a look at the ğŸ¤— Accelerate [Quick tour](https://huggingface.co/docs/accelerate/quicktour)
    to learn more.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ¤— Accelerateæ˜¯ä¸€ä¸ªå¸®åŠ©æ‚¨åœ¨å¤šä¸ªGPU/TPUä¸Šè®­ç»ƒæˆ–ä½¿ç”¨æ··åˆç²¾åº¦çš„åº“ã€‚å®ƒå°†æ ¹æ®æ‚¨çš„ç¡¬ä»¶å’Œç¯å¢ƒè‡ªåŠ¨é…ç½®æ‚¨çš„è®­ç»ƒè®¾ç½®ã€‚æŸ¥çœ‹ğŸ¤— Accelerate
    [å¿«é€Ÿå…¥é—¨](https://huggingface.co/docs/accelerate/quicktour)ä»¥äº†è§£æ›´å¤šã€‚
- en: 'Initialize an ğŸ¤— Accelerate environment:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: åˆå§‹åŒ–ğŸ¤— Accelerateç¯å¢ƒï¼š
- en: '[PRE2]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'To setup a default ğŸ¤— Accelerate environment without choosing any configurations:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: è¦è®¾ç½®é»˜è®¤çš„ğŸ¤— Accelerateç¯å¢ƒè€Œä¸é€‰æ‹©ä»»ä½•é…ç½®ï¼š
- en: '[PRE3]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Or if your environment doesnâ€™t support an interactive shell, like a notebook,
    you can use:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ–è€…ï¼Œå¦‚æœæ‚¨çš„ç¯å¢ƒä¸æ”¯æŒäº¤äº’å¼shellï¼Œæ¯”å¦‚ç¬”è®°æœ¬ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ï¼š
- en: '[PRE4]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Lastly, if you want to train a model on your own dataset, take a look at the
    [Create a dataset for training](create_dataset) guide to learn how to create a
    dataset that works with the training script.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åï¼Œå¦‚æœæ‚¨æƒ³åœ¨è‡ªå·±çš„æ•°æ®é›†ä¸Šè®­ç»ƒæ¨¡å‹ï¼Œè¯·æŸ¥çœ‹[åˆ›å»ºç”¨äºè®­ç»ƒçš„æ•°æ®é›†](create_dataset)æŒ‡å—ï¼Œäº†è§£å¦‚ä½•åˆ›å»ºé€‚ç”¨äºè®­ç»ƒè„šæœ¬çš„æ•°æ®é›†ã€‚
- en: The following sections highlight parts of the training script that are important
    for understanding how to modify it, but it doesnâ€™t cover every aspect of the script
    in detail. If youâ€™re interested in learning more, feel free to read through the
    [script](https://github.com/huggingface/diffusers/blob/main/examples/dreambooth/train_dreambooth.py)
    and let us know if you have any questions or concerns.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: ä»¥ä¸‹éƒ¨åˆ†çªå‡ºäº†è®­ç»ƒè„šæœ¬ä¸­é‡è¦çš„éƒ¨åˆ†ï¼Œä»¥å¸®åŠ©æ‚¨äº†è§£å¦‚ä½•ä¿®æ”¹å®ƒï¼Œä½†å¹¶æœªè¯¦ç»†æ¶µç›–è„šæœ¬çš„æ¯ä¸ªæ–¹é¢ã€‚å¦‚æœæ‚¨æœ‰å…´è¶£äº†è§£æ›´å¤šï¼Œè¯·éšæ—¶é˜…è¯»[è„šæœ¬](https://github.com/huggingface/diffusers/blob/main/examples/dreambooth/train_dreambooth.py)ï¼Œå¹¶å‘Šè¯‰æˆ‘ä»¬å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–ç–‘è™‘ã€‚
- en: Script parameters
  id: totrans-20
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: è„šæœ¬å‚æ•°
- en: DreamBooth is very sensitive to training hyperparameters, and it is easy to
    overfit. Read the [Training Stable Diffusion with Dreambooth using ğŸ§¨ Diffusers](https://huggingface.co/blog/dreambooth)
    blog post for recommended settings for different subjects to help you choose the
    appropriate hyperparameters.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: DreamBoothå¯¹è®­ç»ƒè¶…å‚æ•°éå¸¸æ•æ„Ÿï¼Œå¾ˆå®¹æ˜“è¿‡æ‹Ÿåˆã€‚é˜…è¯»[ä½¿ç”¨ğŸ§¨ Diffusersè®­ç»ƒç¨³å®šæ‰©æ•£çš„DreamBooth](https://huggingface.co/blog/dreambooth)åšå®¢æ–‡ç« ï¼Œäº†è§£ä¸åŒä¸»é¢˜çš„æ¨èè®¾ç½®ï¼Œä»¥å¸®åŠ©æ‚¨é€‰æ‹©é€‚å½“çš„è¶…å‚æ•°ã€‚
- en: The training script offers many parameters for customizing your training run.
    All of the parameters and their descriptions are found in the [`parse_args()`](https://github.com/huggingface/diffusers/blob/072e00897a7cf4302c347a63ec917b4b8add16d4/examples/dreambooth/train_dreambooth.py#L228)
    function. The parameters are set with default values that should work pretty well
    out-of-the-box, but you can also set your own values in the training command if
    youâ€™d like.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: è®­ç»ƒè„šæœ¬æä¾›äº†è®¸å¤šå‚æ•°ï¼Œç”¨äºè‡ªå®šä¹‰æ‚¨çš„è®­ç»ƒè¿è¡Œã€‚æ‰€æœ‰å‚æ•°åŠå…¶æè¿°å‡åœ¨[`parse_args()`](https://github.com/huggingface/diffusers/blob/072e00897a7cf4302c347a63ec917b4b8add16d4/examples/dreambooth/train_dreambooth.py#L228)å‡½æ•°ä¸­æ‰¾åˆ°ã€‚è¿™äº›å‚æ•°è®¾ç½®äº†é»˜è®¤å€¼ï¼Œåº”è¯¥å¯ä»¥å¾ˆå¥½åœ°å¼€ç®±å³ç”¨ï¼Œä½†å¦‚æœæ‚¨æ„¿æ„ï¼Œä¹Ÿå¯ä»¥åœ¨è®­ç»ƒå‘½ä»¤ä¸­è®¾ç½®è‡ªå·±çš„å€¼ã€‚
- en: 'For example, to train in the bf16 format:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: ä¾‹å¦‚ï¼Œä»¥bf16æ ¼å¼è¿›è¡Œè®­ç»ƒï¼š
- en: '[PRE5]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Some basic and important parameters to know and specify are:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€äº›åŸºæœ¬å’Œé‡è¦çš„å‚æ•°éœ€è¦äº†è§£å’ŒæŒ‡å®šï¼š
- en: '`--pretrained_model_name_or_path`: the name of the model on the Hub or a local
    path to the pretrained model'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: --pretrained_model_name_or_pathï¼šHubä¸Šæ¨¡å‹çš„åç§°æˆ–é¢„è®­ç»ƒæ¨¡å‹çš„æœ¬åœ°è·¯å¾„
- en: '`--instance_data_dir`: path to a folder containing the training dataset (example
    images)'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: --instance_data_dirï¼šåŒ…å«è®­ç»ƒæ•°æ®é›†ï¼ˆç¤ºä¾‹å›¾åƒï¼‰çš„æ–‡ä»¶å¤¹è·¯å¾„
- en: '`--instance_prompt`: the text prompt that contains the special word for the
    example images'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: --instance_promptï¼šåŒ…å«ç¤ºä¾‹å›¾åƒçš„ç‰¹æ®Šå•è¯çš„æ–‡æœ¬æç¤º
- en: '`--train_text_encoder`: whether to also train the text encoder'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: --train_text_encoderï¼šæ˜¯å¦è¿˜è¦è®­ç»ƒæ–‡æœ¬ç¼–ç å™¨
- en: '`--output_dir`: where to save the trained model'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: --output_dirï¼šä¿å­˜è®­ç»ƒå¥½çš„æ¨¡å‹çš„ä½ç½®
- en: '`--push_to_hub`: whether to push the trained model to the Hub'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: --push_to_hubï¼šæ˜¯å¦å°†è®­ç»ƒå¥½çš„æ¨¡å‹æ¨é€åˆ°Hub
- en: '`--checkpointing_steps`: frequency of saving a checkpoint as the model trains;
    this is useful if for some reason training is interrupted, you can continue training
    from that checkpoint by adding `--resume_from_checkpoint` to your training command'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--checkpointing_steps`ï¼šä¿å­˜æ£€æŸ¥ç‚¹çš„é¢‘ç‡ï¼Œè¿™åœ¨è®­ç»ƒä¸­æ–­æ—¶å¾ˆæœ‰ç”¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨è®­ç»ƒå‘½ä»¤ä¸­æ·»åŠ  `--resume_from_checkpoint`
    ä»è¯¥æ£€æŸ¥ç‚¹ç»§ç»­è®­ç»ƒ'
- en: Min-SNR weighting
  id: totrans-33
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Min-SNR æƒé‡ç­–ç•¥
- en: The [Min-SNR](https://huggingface.co/papers/2303.09556) weighting strategy can
    help with training by rebalancing the loss to achieve faster convergence. The
    training script supports predicting `epsilon` (noise) or `v_prediction`, but Min-SNR
    is compatible with both prediction types. This weighting strategy is only supported
    by PyTorch and is unavailable in the Flax training script.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '[Min-SNR](https://huggingface.co/papers/2303.09556) æƒé‡ç­–ç•¥å¯ä»¥é€šè¿‡é‡æ–°å¹³è¡¡æŸå¤±æ¥å¸®åŠ©è®­ç»ƒï¼Œä»¥å®ç°æ›´å¿«çš„æ”¶æ•›ã€‚è®­ç»ƒè„šæœ¬æ”¯æŒé¢„æµ‹
    `epsilon`ï¼ˆå™ªéŸ³ï¼‰æˆ– `v_prediction`ï¼Œä½† Min-SNR ä¸ä¸¤ç§é¢„æµ‹ç±»å‹å…¼å®¹ã€‚è¿™ç§æƒé‡ç­–ç•¥ä»…ç”± PyTorch æ”¯æŒï¼Œåœ¨ Flax è®­ç»ƒè„šæœ¬ä¸­ä¸å¯ç”¨ã€‚'
- en: 'Add the `--snr_gamma` parameter and set it to the recommended value of 5.0:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: æ·»åŠ  `--snr_gamma` å‚æ•°ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºæ¨èå€¼ 5.0ï¼š
- en: '[PRE6]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Prior preservation loss
  id: totrans-37
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: å…ˆå‰ä¿ç•™æŸå¤±
- en: Prior preservation loss is a method that uses a modelâ€™s own generated samples
    to help it learn how to generate more diverse images. Because these generated
    sample images belong to the same class as the images you provided, they help the
    model retain what it has learned about the class and how it can use what it already
    knows about the class to make new compositions.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: å…ˆå‰çš„ä¿ç•™æŸå¤±æ˜¯ä¸€ç§æ–¹æ³•ï¼Œå®ƒåˆ©ç”¨æ¨¡å‹è‡ªå·±ç”Ÿæˆçš„æ ·æœ¬æ¥å¸®åŠ©å­¦ä¹ å¦‚ä½•ç”Ÿæˆæ›´å¤šæ ·åŒ–çš„å›¾åƒã€‚å› ä¸ºè¿™äº›ç”Ÿæˆçš„æ ·æœ¬å›¾åƒå±äºæ‚¨æä¾›çš„å›¾åƒç›¸åŒçš„ç±»åˆ«ï¼Œå®ƒä»¬å¸®åŠ©æ¨¡å‹ä¿ç•™å¯¹è¯¥ç±»åˆ«å·²å­¦ä¹ çš„çŸ¥è¯†ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨å·²çŸ¥çš„å…³äºè¯¥ç±»åˆ«çš„çŸ¥è¯†æ¥ç”Ÿæˆæ–°çš„ç»„åˆã€‚
- en: '`--with_prior_preservation`: whether to use prior preservation loss'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--with_prior_preservation`ï¼šæ˜¯å¦ä½¿ç”¨å…ˆå‰ä¿ç•™æŸå¤±'
- en: '`--prior_loss_weight`: controls the influence of the prior preservation loss
    on the model'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--prior_loss_weight`ï¼šæ§åˆ¶æ¨¡å‹å¯¹å…ˆå‰ä¿ç•™æŸå¤±çš„å½±å“'
- en: '`--class_data_dir`: path to a folder containing the generated class sample
    images'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--class_data_dir`ï¼šåŒ…å«ç”Ÿæˆçš„ç±»åˆ«æ ·æœ¬å›¾åƒçš„æ–‡ä»¶å¤¹è·¯å¾„'
- en: '`--class_prompt`: the text prompt describing the class of the generated sample
    images'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--class_prompt`ï¼šæè¿°ç”Ÿæˆæ ·æœ¬å›¾åƒç±»åˆ«çš„æ–‡æœ¬æç¤º'
- en: '[PRE7]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Train text encoder
  id: totrans-44
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: è®­ç»ƒæ–‡æœ¬ç¼–ç å™¨
- en: 'To improve the quality of the generated outputs, you can also train the text
    encoder in addition to the UNet. This requires additional memory and youâ€™ll need
    a GPU with at least 24GB of vRAM. If you have the necessary hardware, then training
    the text encoder produces better results, especially when generating images of
    faces. Enable this option by:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†æé«˜ç”Ÿæˆè¾“å‡ºçš„è´¨é‡ï¼Œæ‚¨è¿˜å¯ä»¥è®­ç»ƒæ–‡æœ¬ç¼–ç å™¨ä»¥åŠ UNetã€‚è¿™éœ€è¦é¢å¤–çš„å†…å­˜ï¼Œæ‚¨éœ€è¦è‡³å°‘å…·æœ‰ 24GB çš„ vRAM çš„ GPUã€‚å¦‚æœæ‚¨æœ‰å¿…è¦çš„ç¡¬ä»¶ï¼Œé‚£ä¹ˆè®­ç»ƒæ–‡æœ¬ç¼–ç å™¨ä¼šäº§ç”Ÿæ›´å¥½çš„ç»“æœï¼Œç‰¹åˆ«æ˜¯åœ¨ç”Ÿæˆé¢éƒ¨å›¾åƒæ—¶ã€‚é€šè¿‡ä»¥ä¸‹é€‰é¡¹å¯ç”¨æ­¤é€‰é¡¹ï¼š
- en: '[PRE8]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Training script
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: è®­ç»ƒè„šæœ¬
- en: 'DreamBooth comes with its own dataset classes:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: DreamBooth è‡ªå¸¦å…¶è‡ªå·±çš„æ•°æ®é›†ç±»ï¼š
- en: '[`DreamBoothDataset`](https://github.com/huggingface/diffusers/blob/072e00897a7cf4302c347a63ec917b4b8add16d4/examples/dreambooth/train_dreambooth.py#L604):
    preprocesses the images and class images, and tokenizes the prompts for training'
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`DreamBoothDataset`](https://github.com/huggingface/diffusers/blob/072e00897a7cf4302c347a63ec917b4b8add16d4/examples/dreambooth/train_dreambooth.py#L604)ï¼šé¢„å¤„ç†å›¾åƒå’Œç±»åˆ«å›¾åƒï¼Œå¹¶ä¸ºè®­ç»ƒä»¤ç‰ŒåŒ–æç¤º'
- en: '[`PromptDataset`](https://github.com/huggingface/diffusers/blob/072e00897a7cf4302c347a63ec917b4b8add16d4/examples/dreambooth/train_dreambooth.py#L738):
    generates the prompt embeddings to generate the class images'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`PromptDataset`](https://github.com/huggingface/diffusers/blob/072e00897a7cf4302c347a63ec917b4b8add16d4/examples/dreambooth/train_dreambooth.py#L738)ï¼šç”Ÿæˆæç¤ºåµŒå…¥ä»¥ç”Ÿæˆç±»åˆ«å›¾åƒ'
- en: 'If you enabled [prior preservation loss](https://github.com/huggingface/diffusers/blob/072e00897a7cf4302c347a63ec917b4b8add16d4/examples/dreambooth/train_dreambooth.py#L842),
    the class images are generated here:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨å¯ç”¨äº†[å…ˆå‰ä¿ç•™æŸå¤±](https://github.com/huggingface/diffusers/blob/072e00897a7cf4302c347a63ec917b4b8add16d4/examples/dreambooth/train_dreambooth.py#L842)ï¼Œåˆ™åœ¨æ­¤å¤„ç”Ÿæˆç±»åˆ«å›¾åƒï¼š
- en: '[PRE9]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Next is the [`main()`](https://github.com/huggingface/diffusers/blob/072e00897a7cf4302c347a63ec917b4b8add16d4/examples/dreambooth/train_dreambooth.py#L799)
    function which handles setting up the dataset for training and the training loop
    itself. The script loads the [tokenizer](https://github.com/huggingface/diffusers/blob/072e00897a7cf4302c347a63ec917b4b8add16d4/examples/dreambooth/train_dreambooth.py#L898),
    [scheduler and models](https://github.com/huggingface/diffusers/blob/072e00897a7cf4302c347a63ec917b4b8add16d4/examples/dreambooth/train_dreambooth.py#L912C1-L912C1):'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: æ¥ä¸‹æ¥æ˜¯ [`main()`](https://github.com/huggingface/diffusers/blob/072e00897a7cf4302c347a63ec917b4b8add16d4/examples/dreambooth/train_dreambooth.py#L799)
    å‡½æ•°ï¼Œè´Ÿè´£è®¾ç½®ç”¨äºè®­ç»ƒçš„æ•°æ®é›†å’Œè®­ç»ƒå¾ªç¯æœ¬èº«ã€‚è„šæœ¬åŠ è½½ [tokenizer](https://github.com/huggingface/diffusers/blob/072e00897a7cf4302c347a63ec917b4b8add16d4/examples/dreambooth/train_dreambooth.py#L898)ã€[è°ƒåº¦å™¨å’Œæ¨¡å‹](https://github.com/huggingface/diffusers/blob/072e00897a7cf4302c347a63ec917b4b8add16d4/examples/dreambooth/train_dreambooth.py#L912C1-L912C1)ï¼š
- en: '[PRE10]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Then, itâ€™s time to [create the training dataset](https://github.com/huggingface/diffusers/blob/072e00897a7cf4302c347a63ec917b4b8add16d4/examples/dreambooth/train_dreambooth.py#L1073)
    and DataLoader from `DreamBoothDataset`:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæ˜¯æ—¶å€™[åˆ›å»ºè®­ç»ƒæ•°æ®é›†](https://github.com/huggingface/diffusers/blob/072e00897a7cf4302c347a63ec917b4b8add16d4/examples/dreambooth/train_dreambooth.py#L1073)å’Œä»
    `DreamBoothDataset` åˆ›å»º DataLoader äº†ï¼š
- en: '[PRE11]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Lastly, the [training loop](https://github.com/huggingface/diffusers/blob/072e00897a7cf4302c347a63ec917b4b8add16d4/examples/dreambooth/train_dreambooth.py#L1151)
    takes care of the remaining steps such as converting images to latent space, adding
    noise to the input, predicting the noise residual, and calculating the loss.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åï¼Œ[è®­ç»ƒå¾ªç¯](https://github.com/huggingface/diffusers/blob/072e00897a7cf4302c347a63ec917b4b8add16d4/examples/dreambooth/train_dreambooth.py#L1151)
    å¤„ç†å‰©ä½™æ­¥éª¤ï¼Œå¦‚å°†å›¾åƒè½¬æ¢ä¸ºæ½œåœ¨ç©ºé—´ï¼Œå‘è¾“å…¥æ·»åŠ å™ªéŸ³ï¼Œé¢„æµ‹å™ªéŸ³æ®‹å·®ï¼Œå¹¶è®¡ç®—æŸå¤±ã€‚
- en: If you want to learn more about how the training loop works, check out the [Understanding
    pipelines, models and schedulers](../using-diffusers/write_own_pipeline) tutorial
    which breaks down the basic pattern of the denoising process.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨æƒ³äº†è§£è®­ç»ƒå¾ªç¯çš„å·¥ä½œåŸç†ï¼Œè¯·æŸ¥çœ‹ [ç†è§£ç®¡é“ã€æ¨¡å‹å’Œè°ƒåº¦å™¨](../using-diffusers/write_own_pipeline) æ•™ç¨‹ï¼Œè¯¥æ•™ç¨‹è§£æäº†å»å™ªè¿‡ç¨‹çš„åŸºæœ¬æ¨¡å¼ã€‚
- en: Launch the script
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å¯åŠ¨è„šæœ¬
- en: Youâ€™re now ready to launch the training script! ğŸš€
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨ç°åœ¨å¯ä»¥å¯åŠ¨è®­ç»ƒè„šæœ¬äº†ï¼ğŸš€
- en: For this guide, youâ€™ll download some images of a [dog](https://huggingface.co/datasets/diffusers/dog-example)
    and store them in a directory. But remember, you can create and use your own dataset
    if you want (see the [Create a dataset for training](create_dataset) guide).
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹äºè¿™ä¸ªæŒ‡å—ï¼Œæ‚¨å°†ä¸‹è½½ä¸€äº›[ç‹—](https://huggingface.co/datasets/diffusers/dog-example)çš„å›¾åƒå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨ä¸€ä¸ªç›®å½•ä¸­ã€‚ä½†è¯·è®°ä½ï¼Œå¦‚æœæ‚¨æ„¿æ„ï¼Œæ‚¨å¯ä»¥åˆ›å»ºå’Œä½¿ç”¨è‡ªå·±çš„æ•°æ®é›†ï¼ˆè¯·å‚é˜…[åˆ›å»ºç”¨äºè®­ç»ƒçš„æ•°æ®é›†](create_dataset)æŒ‡å—ï¼‰ã€‚
- en: '[PRE12]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Set the environment variable `MODEL_NAME` to a model id on the Hub or a path
    to a local model, `INSTANCE_DIR` to the path where you just downloaded the dog
    images to, and `OUTPUT_DIR` to where you want to save the model. Youâ€™ll use `sks`
    as the special word to tie the training to.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: å°†ç¯å¢ƒå˜é‡`MODEL_NAME`è®¾ç½®ä¸ºHubä¸Šçš„æ¨¡å‹IDæˆ–æœ¬åœ°æ¨¡å‹çš„è·¯å¾„ï¼Œ`INSTANCE_DIR`è®¾ç½®ä¸ºæ‚¨åˆšä¸‹è½½ç‹—å›¾ç‰‡çš„è·¯å¾„ï¼Œ`OUTPUT_DIR`è®¾ç½®ä¸ºæ‚¨æƒ³è¦ä¿å­˜æ¨¡å‹çš„è·¯å¾„ã€‚æ‚¨å°†ä½¿ç”¨`sks`ä½œä¸ºå°†è®­ç»ƒç»‘å®šåˆ°çš„ç‰¹æ®Šè¯ã€‚
- en: 'If youâ€™re interested in following along with the training process, you can
    periodically save generated images as training progresses. Add the following parameters
    to the training command:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨æœ‰å…´è¶£è·Ÿéšè®­ç»ƒè¿‡ç¨‹ï¼Œå¯ä»¥åœ¨è®­ç»ƒè¿›è¡Œæ—¶å®šæœŸä¿å­˜ç”Ÿæˆçš„å›¾åƒã€‚å°†ä»¥ä¸‹å‚æ•°æ·»åŠ åˆ°è®­ç»ƒå‘½ä»¤ä¸­ï¼š
- en: '[PRE13]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: One more thing before you launch the script! Depending on the GPU you have,
    you may need to enable certain optimizations to train DreamBooth.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨å¯åŠ¨è„šæœ¬ä¹‹å‰è¿˜æœ‰ä¸€ä»¶äº‹ï¼æ ¹æ®æ‚¨æ‹¥æœ‰çš„GPUï¼Œæ‚¨å¯èƒ½éœ€è¦å¯ç”¨æŸäº›ä¼˜åŒ–æ¥è®­ç»ƒDreamBoothã€‚
- en: 16GB12GB8GB
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 16GB12GB8GB
- en: 'On a 16GB GPU, you can use bitsandbytes 8-bit optimizer and gradient checkpointing
    to help you train a DreamBooth model. Install bitsandbytes:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨16GB GPUä¸Šï¼Œæ‚¨å¯ä»¥ä½¿ç”¨bitsandbytes 8ä½ä¼˜åŒ–å™¨å’Œæ¢¯åº¦æ£€æŸ¥ç‚¹æ¥å¸®åŠ©æ‚¨è®­ç»ƒDreamBoothæ¨¡å‹ã€‚å®‰è£…bitsandbytesï¼š
- en: '[PRE14]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Then, add the following parameter to your training command:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œå°†ä»¥ä¸‹å‚æ•°æ·»åŠ åˆ°æ‚¨çš„è®­ç»ƒå‘½ä»¤ä¸­ï¼š
- en: '[PRE15]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: PyTorchFlax
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: PyTorchFlax
- en: '[PRE16]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Once training is complete, you can use your newly trained model for inference!
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: è®­ç»ƒå®Œæˆåï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ–°è®­ç»ƒçš„æ¨¡å‹è¿›è¡Œæ¨ç†ï¼
- en: Canâ€™t wait to try your model for inference before training is complete? ğŸ¤­ Make
    sure you have the latest version of ğŸ¤— Accelerate installed.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è®­ç»ƒå®Œæˆä¹‹å‰å°±è¿«ä¸åŠå¾…åœ°å°è¯•æ‚¨çš„æ¨¡å‹è¿›è¡Œæ¨ç†ï¼ŸğŸ¤­ ç¡®ä¿æ‚¨å·²å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ğŸ¤— Accelerateã€‚
- en: '[PRE17]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: PyTorchFlax
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: PyTorchFlax
- en: '[PRE18]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: LoRA
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: LoRA
- en: LoRA is a training technique for significantly reducing the number of trainable
    parameters. As a result, training is faster and it is easier to store the resulting
    weights because they are a lot smaller (~100MBs). Use the [train_dreambooth_lora.py](https://github.com/huggingface/diffusers/blob/main/examples/dreambooth/train_dreambooth_lora.py)
    script to train with LoRA.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: LoRAæ˜¯ä¸€ç§ç”¨äºæ˜¾è‘—å‡å°‘å¯è®­ç»ƒå‚æ•°æ•°é‡çš„è®­ç»ƒæŠ€æœ¯ã€‚å› æ­¤ï¼Œè®­ç»ƒé€Ÿåº¦æ›´å¿«ï¼Œå­˜å‚¨ç»“æœæƒé‡æ›´å®¹æ˜“ï¼Œå› ä¸ºå®ƒä»¬è¦å°å¾—å¤šï¼ˆ~100MBï¼‰ã€‚ä½¿ç”¨[train_dreambooth_lora.py](https://github.com/huggingface/diffusers/blob/main/examples/dreambooth/train_dreambooth_lora.py)è„šæœ¬æ¥ä½¿ç”¨LoRAè¿›è¡Œè®­ç»ƒã€‚
- en: The LoRA training script is discussed in more detail in the [LoRA training](lora)
    guide.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: æœ‰å…³LoRAè®­ç»ƒè„šæœ¬çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[LoRAè®­ç»ƒ](lora)æŒ‡å—ã€‚
- en: Stable Diffusion XL
  id: totrans-82
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Stable Diffusion XL
- en: Stable Diffusion XL (SDXL) is a powerful text-to-image model that generates
    high-resolution images, and it adds a second text-encoder to its architecture.
    Use the [train_dreambooth_lora_sdxl.py](https://github.com/huggingface/diffusers/blob/main/examples/dreambooth/train_dreambooth_lora_sdxl.py)
    script to train a SDXL model with LoRA.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: Stable Diffusion XLï¼ˆSDXLï¼‰æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ–‡æœ¬åˆ°å›¾åƒæ¨¡å‹ï¼Œå¯ä»¥ç”Ÿæˆé«˜åˆ†è¾¨ç‡å›¾åƒï¼Œå¹¶åœ¨å…¶æ¶æ„ä¸­æ·»åŠ äº†ç¬¬äºŒä¸ªæ–‡æœ¬ç¼–ç å™¨ã€‚ä½¿ç”¨[train_dreambooth_lora_sdxl.py](https://github.com/huggingface/diffusers/blob/main/examples/dreambooth/train_dreambooth_lora_sdxl.py)è„šæœ¬æ¥è®­ç»ƒä¸€ä¸ªå¸¦æœ‰LoRAçš„SDXLæ¨¡å‹ã€‚
- en: The SDXL training script is discussed in more detail in the [SDXL training](sdxl)
    guide.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: æœ‰å…³SDXLè®­ç»ƒè„šæœ¬çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[SDXLè®­ç»ƒ](sdxl)æŒ‡å—ã€‚
- en: Next steps
  id: totrans-85
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä¸‹ä¸€æ­¥
- en: 'Congratulations on training your DreamBooth model! To learn more about how
    to use your new model, the following guide may be helpful:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: æ­å–œæ‚¨è®­ç»ƒæˆåŠŸDreamBoothæ¨¡å‹ï¼è¦äº†è§£å¦‚ä½•ä½¿ç”¨æ‚¨çš„æ–°æ¨¡å‹ï¼Œä»¥ä¸‹æŒ‡å—å¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ï¼š
- en: Learn how to [load a DreamBooth](../using-diffusers/loading_adapters) model
    for inference if you trained your model with LoRA.
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨ä½¿ç”¨LoRAè®­ç»ƒäº†æ‚¨çš„æ¨¡å‹ï¼Œå­¦ä¹ å¦‚ä½•[åŠ è½½DreamBooth](../using-diffusers/loading_adapters)æ¨¡å‹è¿›è¡Œæ¨ç†ã€‚
