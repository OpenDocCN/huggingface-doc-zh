- en: Load community pipelines and components
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: åŠ è½½ç¤¾åŒºç®¡é“å’Œç»„ä»¶
- en: 'Original text: [https://huggingface.co/docs/diffusers/using-diffusers/custom_pipeline_overview](https://huggingface.co/docs/diffusers/using-diffusers/custom_pipeline_overview)'
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡é“¾æ¥ï¼š[https://huggingface.co/docs/diffusers/using-diffusers/custom_pipeline_overview](https://huggingface.co/docs/diffusers/using-diffusers/custom_pipeline_overview)
- en: null
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: Community pipelines
  id: totrans-3
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç¤¾åŒºç®¡é“
- en: Community pipelines are any [DiffusionPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/overview#diffusers.DiffusionPipeline)
    class that are different from the original implementation as specified in their
    paper (for example, the [StableDiffusionControlNetPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/controlnet#diffusers.StableDiffusionControlNetPipeline)
    corresponds to the [Text-to-Image Generation with ControlNet Conditioning](https://arxiv.org/abs/2302.05543)
    paper). They provide additional functionality or extend the original implementation
    of a pipeline.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: ç¤¾åŒºç®¡é“æ˜¯ä»»ä½•ä¸åŸå§‹å®ç°ä¸åŒçš„[DiffusionPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/overview#diffusers.DiffusionPipeline)ç±»ï¼Œå¦‚å…¶è®ºæ–‡ä¸­æ‰€è¿°ï¼ˆä¾‹å¦‚ï¼Œ[StableDiffusionControlNetPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/controlnet#diffusers.StableDiffusionControlNetPipeline)å¯¹åº”äº[ä½¿ç”¨ControlNetæ¡ä»¶ç”Ÿæˆæ–‡æœ¬åˆ°å›¾åƒ](https://arxiv.org/abs/2302.05543)çš„è®ºæ–‡ï¼‰ã€‚å®ƒä»¬æä¾›é¢å¤–çš„åŠŸèƒ½æˆ–æ‰©å±•äº†ç®¡é“çš„åŸå§‹å®ç°ã€‚
- en: There are many cool community pipelines like [Speech to Image](https://github.com/huggingface/diffusers/tree/main/examples/community#speech-to-image)
    or [Composable Stable Diffusion](https://github.com/huggingface/diffusers/tree/main/examples/community#composable-stable-diffusion),
    and you can find all the official community pipelines [here](https://github.com/huggingface/diffusers/tree/main/examples/community).
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: æœ‰è®¸å¤šå¾ˆé…·çš„ç¤¾åŒºç®¡é“ï¼Œæ¯”å¦‚[è¯­éŸ³åˆ°å›¾åƒ](https://github.com/huggingface/diffusers/tree/main/examples/community#speech-to-image)æˆ–[å¯ç»„åˆç¨³å®šæ‰©æ•£](https://github.com/huggingface/diffusers/tree/main/examples/community#composable-stable-diffusion)ï¼Œæ‚¨å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/huggingface/diffusers/tree/main/examples/community)æ‰¾åˆ°æ‰€æœ‰å®˜æ–¹ç¤¾åŒºç®¡é“ã€‚
- en: 'To load any community pipeline on the Hub, pass the repository id of the community
    pipeline to the `custom_pipeline` argument and the model repository where youâ€™d
    like to load the pipeline weights and components from. For example, the example
    below loads a dummy pipeline from [`hf-internal-testing/diffusers-dummy-pipeline`](https://huggingface.co/hf-internal-testing/diffusers-dummy-pipeline/blob/main/pipeline.py)
    and the pipeline weights and components from [`google/ddpm-cifar10-32`](https://huggingface.co/google/ddpm-cifar10-32):'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: è¦åœ¨Hubä¸ŠåŠ è½½ä»»ä½•ç¤¾åŒºç®¡é“ï¼Œè¯·å°†ç¤¾åŒºç®¡é“çš„å­˜å‚¨åº“IDä¼ é€’ç»™`custom_pipeline`å‚æ•°ï¼Œå¹¶æŒ‡å®šæ‚¨å¸Œæœ›ä»ä¸­åŠ è½½ç®¡é“æƒé‡å’Œç»„ä»¶çš„æ¨¡å‹å­˜å‚¨åº“ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ç¤ºä¾‹ä»[`hf-internal-testing/diffusers-dummy-pipeline`](https://huggingface.co/hf-internal-testing/diffusers-dummy-pipeline/blob/main/pipeline.py)åŠ è½½ä¸€ä¸ªè™šæ‹Ÿç®¡é“ï¼Œä»[`google/ddpm-cifar10-32`](https://huggingface.co/google/ddpm-cifar10-32)åŠ è½½ç®¡é“æƒé‡å’Œç»„ä»¶ï¼š
- en: ğŸ”’ By loading a community pipeline from the Hugging Face Hub, you are trusting
    that the code you are loading is safe. Make sure to inspect the code online before
    loading and running it automatically!
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ”’ é€šè¿‡ä»Hugging Face HubåŠ è½½ç¤¾åŒºç®¡é“ï¼Œæ‚¨æ­£åœ¨ä¿¡ä»»æ‚¨åŠ è½½çš„ä»£ç æ˜¯å®‰å…¨çš„ã€‚åœ¨è‡ªåŠ¨åŠ è½½å’Œè¿è¡Œä¹‹å‰ï¼Œè¯·ç¡®ä¿åœ¨çº¿æ£€æŸ¥ä»£ç ï¼
- en: '[PRE0]'
  id: totrans-8
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Loading an official community pipeline is similar, but you can mix loading
    weights from an official repository id and pass pipeline components directly.
    The example below loads the community [CLIP Guided Stable Diffusion](https://github.com/huggingface/diffusers/tree/main/examples/community#clip-guided-stable-diffusion)
    pipeline, and you can pass the CLIP model components directly to it:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: åŠ è½½å®˜æ–¹ç¤¾åŒºç®¡é“ç±»ä¼¼ï¼Œä½†æ‚¨å¯ä»¥æ··åˆä»å®˜æ–¹å­˜å‚¨åº“IDåŠ è½½æƒé‡å¹¶ç›´æ¥ä¼ é€’ç®¡é“ç»„ä»¶ã€‚ä¸‹é¢çš„ç¤ºä¾‹åŠ è½½äº†ç¤¾åŒº[CLIPå¼•å¯¼ç¨³å®šæ‰©æ•£](https://github.com/huggingface/diffusers/tree/main/examples/community#clip-guided-stable-diffusion)ç®¡é“ï¼Œæ‚¨å¯ä»¥ç›´æ¥ä¼ é€’CLIPæ¨¡å‹ç»„ä»¶ç»™å®ƒï¼š
- en: '[PRE1]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: For more information about community pipelines, take a look at the [Community
    pipelines](custom_pipeline_examples) guide for how to use them and if youâ€™re interested
    in adding a community pipeline check out the [How to contribute a community pipeline](contribute_pipeline)
    guide!
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: æœ‰å…³ç¤¾åŒºç®¡é“çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹[ç¤¾åŒºç®¡é“](custom_pipeline_examples)æŒ‡å—ï¼Œäº†è§£å¦‚ä½•ä½¿ç”¨å®ƒä»¬ï¼Œå¦‚æœæ‚¨æœ‰å…´è¶£æ·»åŠ ç¤¾åŒºç®¡é“ï¼Œè¯·æŸ¥çœ‹[å¦‚ä½•è´¡çŒ®ç¤¾åŒºç®¡é“](contribute_pipeline)æŒ‡å—ï¼
- en: Community components
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç¤¾åŒºç»„ä»¶
- en: Community components allow users to build pipelines that may have customized
    components that are not a part of Diffusers. If your pipeline has custom components
    that Diffusers doesnâ€™t already support, you need to provide their implementations
    as Python modules. These customized components could be a VAE, UNet, and scheduler.
    In most cases, the text encoder is imported from the Transformers library. The
    pipeline code itself can also be customized.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: ç¤¾åŒºç»„ä»¶å…è®¸ç”¨æˆ·æ„å»ºå¯èƒ½å…·æœ‰è‡ªå®šä¹‰ç»„ä»¶çš„ç®¡é“ï¼Œè¿™äº›ç»„ä»¶ä¸æ˜¯Diffusersçš„ä¸€éƒ¨åˆ†ã€‚å¦‚æœæ‚¨çš„ç®¡é“å…·æœ‰Diffuserså°šæœªæ”¯æŒçš„è‡ªå®šä¹‰ç»„ä»¶ï¼Œæ‚¨éœ€è¦æä¾›å®ƒä»¬çš„å®ç°ä½œä¸ºPythonæ¨¡å—ã€‚è¿™äº›å®šåˆ¶ç»„ä»¶å¯ä»¥æ˜¯VAEã€UNetå’Œè°ƒåº¦å™¨ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ–‡æœ¬ç¼–ç å™¨æ˜¯ä»Transformersåº“å¯¼å…¥çš„ã€‚ç®¡é“ä»£ç æœ¬èº«ä¹Ÿå¯ä»¥å®šåˆ¶ã€‚
- en: This section shows how users should use community components to build a community
    pipeline.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: æœ¬èŠ‚å±•ç¤ºäº†ç”¨æˆ·åº”å¦‚ä½•ä½¿ç”¨ç¤¾åŒºç»„ä»¶æ¥æ„å»ºç¤¾åŒºç®¡é“ã€‚
- en: 'Youâ€™ll use the [showlab/show-1-base](https://huggingface.co/showlab/show-1-base)
    pipeline checkpoint as an example. So, letâ€™s start loading the components:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨å°†ä½¿ç”¨[showlab/show-1-base](https://huggingface.co/showlab/show-1-base)ç®¡é“æ£€æŸ¥ç‚¹ä½œä¸ºç¤ºä¾‹ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬å¼€å§‹åŠ è½½ç»„ä»¶ï¼š
- en: 'Import and load the text encoder from Transformers:'
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä»Transformerså¯¼å…¥å¹¶åŠ è½½æ–‡æœ¬ç¼–ç å™¨ï¼š
- en: '[PRE2]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Load a scheduler:'
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åŠ è½½è°ƒåº¦å™¨ï¼š
- en: '[PRE3]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Load an image processor:'
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åŠ è½½å›¾åƒå¤„ç†å™¨ï¼š
- en: '[PRE4]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: In steps 4 and 5, the custom [UNet](https://github.com/showlab/Show-1/blob/main/showone/models/unet_3d_condition.py)
    and [pipeline](https://huggingface.co/sayakpaul/show-1-base-with-code/blob/main/unet/showone_unet_3d_condition.py)
    implementation must match the format shown in their files for this example to
    work.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æ­¥éª¤4å’Œ5ä¸­ï¼Œè‡ªå®šä¹‰[UNet](https://github.com/showlab/Show-1/blob/main/showone/models/unet_3d_condition.py)å’Œ[pipeline](https://huggingface.co/sayakpaul/show-1-base-with-code/blob/main/unet/showone_unet_3d_condition.py)çš„å®ç°å¿…é¡»ä¸å…¶æ–‡ä»¶ä¸­æ˜¾ç¤ºçš„æ ¼å¼åŒ¹é…ï¼Œä»¥ä½¿æ­¤ç¤ºä¾‹æ­£å¸¸å·¥ä½œã€‚
- en: Now youâ€™ll load a [custom UNet](https://github.com/showlab/Show-1/blob/main/showone/models/unet_3d_condition.py),
    which in this example, has already been implemented in the `showone_unet_3d_condition.py`
    [script](https://huggingface.co/sayakpaul/show-1-base-with-code/blob/main/unet/showone_unet_3d_condition.py)
    for your convenience. Youâ€™ll notice the `UNet3DConditionModel` class name is changed
    to `ShowOneUNet3DConditionModel` because [UNet3DConditionModel](/docs/diffusers/v0.26.3/en/api/models/unet3d-cond#diffusers.UNet3DConditionModel)
    already exists in Diffusers. Any components needed for the `ShowOneUNet3DConditionModel`
    class should be placed in the `showone_unet_3d_condition.py` script.
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œæ‚¨å°†åŠ è½½ä¸€ä¸ª[è‡ªå®šä¹‰UNet](https://github.com/showlab/Show-1/blob/main/showone/models/unet_3d_condition.py)ï¼Œåœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œå·²ç»åœ¨`showone_unet_3d_condition.py`[è„šæœ¬](https://huggingface.co/sayakpaul/show-1-base-with-code/blob/main/unet/showone_unet_3d_condition.py)ä¸­å®ç°äº†è¿™ä¸ªUNetï¼Œä»¥æ–¹ä¾¿æ‚¨ä½¿ç”¨ã€‚æ‚¨ä¼šæ³¨æ„åˆ°`UNet3DConditionModel`ç±»åå·²æ›´æ”¹ä¸º`ShowOneUNet3DConditionModel`ï¼Œå› ä¸º[UNet3DConditionModel](/docs/diffusers/v0.26.3/en/api/models/unet3d-cond#diffusers.UNet3DConditionModel)å·²ç»å­˜åœ¨äºDiffusersä¸­ã€‚`ShowOneUNet3DConditionModel`ç±»æ‰€éœ€çš„ä»»ä½•ç»„ä»¶éƒ½åº”æ”¾åœ¨`showone_unet_3d_condition.py`è„šæœ¬ä¸­ã€‚
- en: 'Once this is done, you can initialize the UNet:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: å®Œæˆåï¼Œæ‚¨å¯ä»¥åˆå§‹åŒ–UNetï¼š
- en: '[PRE5]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Finally, youâ€™ll load the custom pipeline code. For this example, it has already
    been created for you in the `pipeline_t2v_base_pixel.py` [script](https://huggingface.co/sayakpaul/show-1-base-with-code/blob/main/pipeline_t2v_base_pixel.py).
    This script contains a custom `TextToVideoIFPipeline` class for generating videos
    from text. Just like the custom UNet, any code needed for the custom pipeline
    to work should go in the `pipeline_t2v_base_pixel.py` script.
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æœ€åï¼Œæ‚¨å°†åŠ è½½è‡ªå®šä¹‰ç®¡é“ä»£ç ã€‚åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œå·²ç»ä¸ºæ‚¨åœ¨`pipeline_t2v_base_pixel.py`[è„šæœ¬](https://huggingface.co/sayakpaul/show-1-base-with-code/blob/main/pipeline_t2v_base_pixel.py)ä¸­åˆ›å»ºäº†è¿™ä¸ªè„šæœ¬ï¼Œå…¶ä¸­åŒ…å«ç”¨äºä»æ–‡æœ¬ç”Ÿæˆè§†é¢‘çš„è‡ªå®šä¹‰`TextToVideoIFPipeline`ç±»ã€‚ä¸è‡ªå®šä¹‰UNetä¸€æ ·ï¼Œä»»ä½•ç”¨äºä½¿è‡ªå®šä¹‰ç®¡é“æ­£å¸¸å·¥ä½œçš„ä»£ç éƒ½åº”æ”¾åœ¨`pipeline_t2v_base_pixel.py`è„šæœ¬ä¸­ã€‚
- en: 'Once everything is in place, you can initialize the `TextToVideoIFPipeline`
    with the `ShowOneUNet3DConditionModel`:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€åˆ‡å°±ç»ªåï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`ShowOneUNet3DConditionModel`åˆå§‹åŒ–`TextToVideoIFPipeline`ï¼š
- en: '[PRE6]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Push the pipeline to the Hub to share with the community!
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: å°†ç®¡é“æ¨é€åˆ°Hubä»¥ä¸ç¤¾åŒºå…±äº«ï¼
- en: '[PRE7]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'After the pipeline is successfully pushed, you need a couple of changes:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: æˆåŠŸæ¨é€ç®¡é“åï¼Œæ‚¨éœ€è¦è¿›è¡Œä¸€äº›æ›´æ”¹ï¼š
- en: Change the `_class_name` attribute in [`model_index.json`](https://huggingface.co/sayakpaul/show-1-base-with-code/blob/main/model_index.json#L2)
    to `"pipeline_t2v_base_pixel"` and `"TextToVideoIFPipeline"`.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åœ¨[`model_index.json`](https://huggingface.co/sayakpaul/show-1-base-with-code/blob/main/model_index.json#L2)ä¸­æ›´æ”¹`_class_name`å±æ€§ä¸º`"pipeline_t2v_base_pixel"`å’Œ`"TextToVideoIFPipeline"`ã€‚
- en: Upload `showone_unet_3d_condition.py` to the `unet` [directory](https://huggingface.co/sayakpaul/show-1-base-with-code/blob/main/unet/showone_unet_3d_condition.py).
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å°†`showone_unet_3d_condition.py`ä¸Šä¼ åˆ°`unet`[ç›®å½•](https://huggingface.co/sayakpaul/show-1-base-with-code/blob/main/unet/showone_unet_3d_condition.py)ã€‚
- en: Upload `pipeline_t2v_base_pixel.py` to the pipeline base [directory](https://huggingface.co/sayakpaul/show-1-base-with-code/blob/main/unet/showone_unet_3d_condition.py).
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å°†`pipeline_t2v_base_pixel.py`ä¸Šä¼ åˆ°ç®¡é“åŸºç¡€[ç›®å½•](https://huggingface.co/sayakpaul/show-1-base-with-code/blob/main/unet/showone_unet_3d_condition.py)ã€‚
- en: To run inference, simply add the `trust_remote_code` argument while initializing
    the pipeline to handle all the â€œmagicâ€ behind the scenes.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: è¦è¿è¡Œæ¨ç†ï¼Œåªéœ€åœ¨åˆå§‹åŒ–ç®¡é“æ—¶æ·»åŠ `trust_remote_code`å‚æ•°ï¼Œä»¥å¤„ç†æ‰€æœ‰å¹•åçš„â€œé­”æœ¯â€ã€‚
- en: '[PRE8]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'As an additional reference example, you can refer to the repository structure
    of [stabilityai/japanese-stable-diffusion-xl](https://huggingface.co/stabilityai/japanese-stable-diffusion-xl/),
    that makes use of the `trust_remote_code` feature:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œä¸ºé¢å¤–çš„å‚è€ƒç¤ºä¾‹ï¼Œæ‚¨å¯ä»¥å‚è€ƒ[stabilityai/japanese-stable-diffusion-xl](https://huggingface.co/stabilityai/japanese-stable-diffusion-xl/)çš„å­˜å‚¨åº“ç»“æ„ï¼Œè¯¥å­˜å‚¨åº“åˆ©ç”¨äº†`trust_remote_code`åŠŸèƒ½ï¼š
- en: '[PRE9]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
