# Paint by Example

> åŸå§‹æ–‡æœ¬ï¼š[`huggingface.co/docs/diffusers/api/pipelines/paint_by_example`](https://huggingface.co/docs/diffusers/api/pipelines/paint_by_example)

[Paint by Example: åŸºäºç¤ºä¾‹çš„å›¾åƒç¼–è¾‘ä¸æ‰©æ•£æ¨¡å‹](https://huggingface.co/papers/2211.13227)ç”± Binxin Yangã€Shuyang Guã€Bo Zhangã€Ting Zhangã€Xuejin Chenã€Xiaoyan Sunã€Dong Chenã€Fang Wen æ’°å†™ã€‚

è¯¥è®ºæ–‡çš„æ‘˜è¦å¦‚ä¸‹ï¼š

*æœ€è¿‘ï¼Œè¯­è¨€å¼•å¯¼çš„å›¾åƒç¼–è¾‘å–å¾—äº†å·¨å¤§æˆåŠŸã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬é¦–æ¬¡ç ”ç©¶äº†ç¤ºä¾‹å¼•å¯¼çš„å›¾åƒç¼–è¾‘ï¼Œä»¥å®ç°æ›´ç²¾ç¡®çš„æ§åˆ¶ã€‚æˆ‘ä»¬é€šè¿‡åˆ©ç”¨è‡ªç›‘ç£è®­ç»ƒæ¥è§£å¼€å’Œé‡æ–°ç»„ç»‡æºå›¾åƒå’Œç¤ºä¾‹å›¾åƒæ¥å®ç°è¿™ä¸€ç›®æ ‡ã€‚ç„¶è€Œï¼Œæœ´ç´ çš„æ–¹æ³•ä¼šå¯¼è‡´æ˜æ˜¾çš„èåˆä¼ªå½±ã€‚æˆ‘ä»¬ä»”ç»†åˆ†æäº†è¿™ä¸€ç‚¹ï¼Œå¹¶æå‡ºäº†ä¿¡æ¯ç“¶é¢ˆå’Œå¼ºå¤§çš„å¢å¼ºï¼Œä»¥é¿å…ç›´æ¥å¤åˆ¶å’Œç²˜è´´ç¤ºä¾‹å›¾åƒçš„å¹³å‡¡è§£å†³æ–¹æ¡ˆã€‚åŒæ—¶ï¼Œä¸ºäº†ç¡®ä¿ç¼–è¾‘è¿‡ç¨‹çš„å¯æ§æ€§ï¼Œæˆ‘ä»¬ä¸ºç¤ºä¾‹å›¾åƒè®¾è®¡äº†ä»»æ„å½¢çŠ¶çš„è’™ç‰ˆï¼Œå¹¶åˆ©ç”¨æ— åˆ†ç±»å™¨çš„æŒ‡å¯¼æ¥å¢åŠ ä¸ç¤ºä¾‹å›¾åƒçš„ç›¸ä¼¼æ€§ã€‚æ•´ä¸ªæ¡†æ¶æ¶‰åŠæ‰©æ•£æ¨¡å‹çš„å•å‘ä¼ æ’­ï¼Œæ²¡æœ‰ä»»ä½•è¿­ä»£ä¼˜åŒ–ã€‚æˆ‘ä»¬è¯æ˜äº†æˆ‘ä»¬çš„æ–¹æ³•å–å¾—äº†ä»¤äººå°è±¡æ·±åˆ»çš„æ€§èƒ½ï¼Œå¹¶å®ç°äº†å¯¹é‡å¤–å›¾åƒçš„å¯æ§ç¼–è¾‘ï¼Œå…·æœ‰é«˜ä¿çœŸåº¦ã€‚*

åŸå§‹ä»£ç åº“å¯åœ¨[Fantasy-Studio/Paint-by-Example](https://github.com/Fantasy-Studio/Paint-by-Example)æ‰¾åˆ°ï¼Œå¹¶ä¸”æ‚¨å¯ä»¥åœ¨[æ¼”ç¤º](https://huggingface.co/spaces/Fantasy-Studio/Paint-by-Example)ä¸­å°è¯•å®ƒã€‚

## æç¤º

Paint by Example ç”±å®˜æ–¹[Fantasy-Studio/Paint-by-Example](https://huggingface.co/Fantasy-Studio/Paint-by-Example)æ£€æŸ¥ç‚¹æ”¯æŒã€‚è¯¥æ£€æŸ¥ç‚¹ä»[CompVis/stable-diffusion-v1-4](https://huggingface.co/CompVis/stable-diffusion-v1-4)å¼€å§‹ï¼Œç”¨äºä¿®å¤éƒ¨åˆ†é®ç½©å›¾åƒï¼Œæ¡ä»¶æ˜¯ç¤ºä¾‹å’Œå‚è€ƒå›¾åƒã€‚

è¯·åŠ¡å¿…æŸ¥çœ‹è°ƒåº¦ç¨‹åºæŒ‡å—ä»¥äº†è§£å¦‚ä½•æ¢ç´¢è°ƒåº¦ç¨‹åºé€Ÿåº¦å’Œè´¨é‡ä¹‹é—´çš„æƒè¡¡ï¼Œå¹¶æŸ¥çœ‹åœ¨å¤šä¸ªç®¡é“ä¸­é‡ç”¨ç»„ä»¶éƒ¨åˆ†ï¼Œä»¥äº†è§£å¦‚ä½•æœ‰æ•ˆåœ°å°†ç›¸åŒç»„ä»¶åŠ è½½åˆ°å¤šä¸ªç®¡é“ä¸­ã€‚

## PaintByExamplePipeline

### `class diffusers.PaintByExamplePipeline`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/paint_by_example/pipeline_paint_by_example.py#L151)

```py
( vae: AutoencoderKL image_encoder: PaintByExampleImageEncoder unet: UNet2DConditionModel scheduler: Union safety_checker: StableDiffusionSafetyChecker feature_extractor: CLIPImageProcessor requires_safety_checker: bool = False )
```

å‚æ•°

+   `vae`ï¼ˆAutoencoderKLã€LMSDiscreteScheduler æˆ– PNDMScheduler ä¹‹ä¸€ã€‚

+   `safety_checker` (`StableDiffusionSafetyChecker`) â€” ç”¨äºä¼°è®¡ç”Ÿæˆå›¾åƒæ˜¯å¦å¯èƒ½è¢«è§†ä¸ºå…·æœ‰å†’çŠ¯æ€§æˆ–æœ‰å®³çš„åˆ†ç±»æ¨¡å—ã€‚è¯·å‚è€ƒ [æ¨¡å‹å¡ç‰‡](https://huggingface.co/runwayml/stable-diffusion-v1-5) ä»¥è·å–æœ‰å…³æ¨¡å‹æ½œåœ¨å±å®³çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚

+   `feature_extractor` ([CLIPImageProcessor](https://huggingface.co/docs/transformers/v4.37.2/en/model_doc/clip#transformers.CLIPImageProcessor)) â€” ç”¨äºä»ç”Ÿæˆçš„å›¾åƒä¸­æå–ç‰¹å¾çš„ `CLIPImageProcessor`ï¼›ä½œä¸º `safety_checker` çš„è¾“å…¥ã€‚

ğŸ§ª è¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½ï¼

ä½¿ç”¨ Stable Diffusion è¿›è¡Œå›¾åƒå¼•å¯¼ä¿®å¤çš„æµæ°´çº¿ã€‚

è¯¥æ¨¡å‹ç»§æ‰¿è‡ª DiffusionPipelineã€‚æŸ¥çœ‹è¶…ç±»æ–‡æ¡£ä»¥è·å–æ‰€æœ‰æµæ°´çº¿å®ç°çš„é€šç”¨æ–¹æ³•ï¼ˆä¸‹è½½ã€ä¿å­˜ã€åœ¨ç‰¹å®šè®¾å¤‡ä¸Šè¿è¡Œç­‰ï¼‰ã€‚

#### `__call__`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/paint_by_example/pipeline_paint_by_example.py#L388)

```py
( example_image: Union image: Union mask_image: Union height: Optional = None width: Optional = None num_inference_steps: int = 50 guidance_scale: float = 5.0 negative_prompt: Union = None num_images_per_prompt: Optional = 1 eta: float = 0.0 generator: Union = None latents: Optional = None output_type: Optional = 'pil' return_dict: bool = True callback: Optional = None callback_steps: int = 1 ) â†’ export const metadata = 'undefined';StableDiffusionPipelineOutput or tuple
```

å‚æ•°

+   `example_image` (`torch.FloatTensor` æˆ– `PIL.Image.Image` æˆ– `List[PIL.Image.Image]`) â€” ç”¨äºæŒ‡å¯¼å›¾åƒç”Ÿæˆçš„ç¤ºä¾‹å›¾åƒã€‚

+   `image` (`torch.FloatTensor` æˆ– `PIL.Image.Image` æˆ– `List[PIL.Image.Image]`) â€” è¡¨ç¤ºè¦ä¿®å¤çš„å›¾åƒæ‰¹æ¬¡çš„å›¾åƒæˆ–å¼ é‡ï¼ˆå›¾åƒçš„éƒ¨åˆ†è¢« `mask_image` æ©ç›–ï¼Œæ ¹æ® `prompt` é‡æ–°ç»˜åˆ¶ï¼‰ã€‚

+   `mask_image` (`torch.FloatTensor` æˆ– `PIL.Image.Image` æˆ– `List[PIL.Image.Image]`) â€” ä»£è¡¨è¦æ©ç›– `image` çš„å›¾åƒæ‰¹æ¬¡çš„å›¾åƒæˆ–å¼ é‡ã€‚æ©ç›–ä¸­çš„ç™½è‰²åƒç´ è¢«é‡æ–°ç»˜åˆ¶ï¼Œè€Œé»‘è‰²åƒç´ è¢«ä¿ç•™ã€‚å¦‚æœ `mask_image` æ˜¯ PIL å›¾åƒï¼Œåˆ™åœ¨ä½¿ç”¨ä¹‹å‰å°†å…¶è½¬æ¢ä¸ºå•é€šé“ï¼ˆäº®åº¦ï¼‰ã€‚å¦‚æœæ˜¯å¼ é‡ï¼Œåˆ™åº”è¯¥åŒ…å«ä¸€ä¸ªé¢œè‰²é€šé“ï¼ˆLï¼‰è€Œä¸æ˜¯ 3ï¼Œå› æ­¤é¢„æœŸå½¢çŠ¶å°†æ˜¯ `(B, H, W, 1)`ã€‚

+   `height` (`int`, *å¯é€‰*, é»˜è®¤ä¸º `self.unet.config.sample_size * self.vae_scale_factor`) â€” ç”Ÿæˆå›¾åƒçš„åƒç´ é«˜åº¦ã€‚

+   `width` (`int`, *å¯é€‰*, é»˜è®¤ä¸º `self.unet.config.sample_size * self.vae_scale_factor`) â€” ç”Ÿæˆå›¾åƒçš„åƒç´ å®½åº¦ã€‚

+   `num_inference_steps` (`int`, *å¯é€‰*, é»˜è®¤ä¸º 50) â€” é™å™ªæ­¥éª¤çš„æ•°é‡ã€‚æ›´å¤šçš„é™å™ªæ­¥éª¤é€šå¸¸ä¼šå¯¼è‡´æ›´é«˜è´¨é‡çš„å›¾åƒï¼Œä½†ä¼šé™ä½æ¨ç†é€Ÿåº¦ã€‚

+   `guidance_scale` (`float`, *å¯é€‰*, é»˜è®¤ä¸º 7.5) â€” æ›´é«˜çš„å¼•å¯¼æ¯”ä¾‹å€¼é¼“åŠ±æ¨¡å‹ç”Ÿæˆä¸æ–‡æœ¬ `prompt` å¯†åˆ‡ç›¸å…³çš„å›¾åƒï¼Œä½†ä¼šé™ä½å›¾åƒè´¨é‡ã€‚å½“ `guidance_scale > 1` æ—¶å¯ç”¨å¼•å¯¼æ¯”ä¾‹ã€‚

+   `negative_prompt` (`str` æˆ– `List[str]`, *å¯é€‰*) â€” ç”¨äºæŒ‡å¯¼å›¾åƒç”Ÿæˆä¸­ä¸åŒ…æ‹¬çš„æç¤ºã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™éœ€è¦ä¼ é€’ `negative_prompt_embeds`ã€‚åœ¨ä¸ä½¿ç”¨å¼•å¯¼æ—¶ï¼ˆ`guidance_scale < 1`ï¼‰å°†è¢«å¿½ç•¥ã€‚

+   `num_images_per_prompt` (`int`, *å¯é€‰*, é»˜è®¤ä¸º 1) â€” æ¯ä¸ªæç¤ºç”Ÿæˆçš„å›¾åƒæ•°é‡ã€‚

+   `eta` (`float`, *å¯é€‰*, é»˜è®¤ä¸º 0.0) â€” å¯¹åº”äº [DDIM](https://arxiv.org/abs/2010.02502) è®ºæ–‡ä¸­çš„å‚æ•° eta (Î·)ã€‚ä»…é€‚ç”¨äº DDIMSchedulerï¼Œåœ¨å…¶ä»–è°ƒåº¦ç¨‹åºä¸­å°†è¢«å¿½ç•¥ã€‚

+   `generator` (`torch.Generator` æˆ– `List[torch.Generator]`, *å¯é€‰*) â€” ç”¨äºä½¿ç”Ÿæˆè¿‡ç¨‹ç¡®å®šæ€§çš„ [`torch.Generator`](https://pytorch.org/docs/stable/generated/torch.Generator.html)ã€‚

+   `latents` (`torch.FloatTensor`, *å¯é€‰*) â€” ä»é«˜æ–¯åˆ†å¸ƒä¸­é‡‡æ ·çš„é¢„ç”Ÿæˆå˜ˆæ‚æ½œå˜é‡ï¼Œç”¨ä½œå›¾åƒç”Ÿæˆçš„è¾“å…¥ã€‚å¯ç”¨äºä½¿ç”¨ä¸åŒæç¤ºè°ƒæ•´ç›¸åŒç”Ÿæˆã€‚å¦‚æœæœªæä¾›ï¼Œåˆ™é€šè¿‡ä½¿ç”¨æä¾›çš„éšæœº `generator` è¿›è¡Œé‡‡æ ·ç”Ÿæˆæ½œå˜é‡å¼ é‡ã€‚

+   `output_type` (`str`, *å¯é€‰*, é»˜è®¤ä¸º `"pil"`) â€” ç”Ÿæˆå›¾åƒçš„è¾“å‡ºæ ¼å¼ã€‚é€‰æ‹© `PIL.Image` æˆ– `np.array` ä¹‹é—´çš„ä¸€ä¸ªã€‚

+   `return_dict` (`bool`, *å¯é€‰*, é»˜è®¤ä¸º `True`) â€” æ˜¯å¦è¿”å› StableDiffusionPipelineOutput è€Œä¸æ˜¯æ™®é€šå…ƒç»„ã€‚

+   `callback` (`Callable`, *å¯é€‰*) â€” åœ¨æ¨æ–­è¿‡ç¨‹ä¸­æ¯ `callback_steps` æ­¥è°ƒç”¨çš„å‡½æ•°ã€‚è¯¥å‡½æ•°ä½¿ç”¨ä»¥ä¸‹å‚æ•°è°ƒç”¨ï¼š`callback(step: int, timestep: int, latents: torch.FloatTensor)`ã€‚

+   `callback_steps` (`int`, *å¯é€‰*, é»˜è®¤ä¸º 1) â€” è°ƒç”¨ `callback` å‡½æ•°çš„é¢‘ç‡ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™åœ¨æ¯ä¸€æ­¥è°ƒç”¨å›è°ƒã€‚

è¿”å›

StableDiffusionPipelineOutput æˆ– `tuple`

å¦‚æœ `return_dict` ä¸º `True`ï¼Œåˆ™è¿”å› StableDiffusionPipelineOutputï¼Œå¦åˆ™è¿”å›ä¸€ä¸ª `tuple`ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ç”Ÿæˆçš„å›¾åƒåˆ—è¡¨ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼ŒæŒ‡ç¤ºç›¸åº”ç”Ÿæˆçš„å›¾åƒæ˜¯å¦åŒ…å«â€œä¸å®‰å…¨å†…å®¹â€ï¼ˆnsfwï¼‰ã€‚

å°†ç®¡é“è°ƒç”¨å‡½æ•°ç”¨äºç”Ÿæˆã€‚

ç¤ºä¾‹ï¼š

```py
>>> import PIL
>>> import requests
>>> import torch
>>> from io import BytesIO
>>> from diffusers import PaintByExamplePipeline

>>> def download_image(url):
...     response = requests.get(url)
...     return PIL.Image.open(BytesIO(response.content)).convert("RGB")

>>> img_url = (
...     "https://raw.githubusercontent.com/Fantasy-Studio/Paint-by-Example/main/examples/image/example_1.png"
... )
>>> mask_url = (
...     "https://raw.githubusercontent.com/Fantasy-Studio/Paint-by-Example/main/examples/mask/example_1.png"
... )
>>> example_url = "https://raw.githubusercontent.com/Fantasy-Studio/Paint-by-Example/main/examples/reference/example_1.jpg"

>>> init_image = download_image(img_url).resize((512, 512))
>>> mask_image = download_image(mask_url).resize((512, 512))
>>> example_image = download_image(example_url).resize((512, 512))

>>> pipe = PaintByExamplePipeline.from_pretrained(
...     "Fantasy-Studio/Paint-by-Example",
...     torch_dtype=torch.float16,
... )
>>> pipe = pipe.to("cuda")

>>> image = pipe(image=init_image, mask_image=mask_image, example_image=example_image).images[0]
>>> image
```

## StableDiffusionPipelineOutput

### `class diffusers.pipelines.stable_diffusion.StableDiffusionPipelineOutput`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion/pipeline_output.py#L10)

```py
( images: Union nsfw_content_detected: Optional )
```

å‚æ•°

+   `images` (`List[PIL.Image.Image]` æˆ– `np.ndarray`) â€” é•¿åº¦ä¸º `batch_size` çš„å»å™ª PIL å›¾åƒåˆ—è¡¨æˆ–å½¢çŠ¶ä¸º `(batch_size, height, width, num_channels)` çš„ NumPy æ•°ç»„ã€‚

+   `nsfw_content_detected` (`List[bool]`) â€” åˆ—è¡¨ï¼ŒæŒ‡ç¤ºç›¸åº”ç”Ÿæˆçš„å›¾åƒæ˜¯å¦åŒ…å«â€œä¸å®‰å…¨å†…å®¹â€ï¼ˆnsfwï¼‰æˆ–å¦‚æœæ— æ³•æ‰§è¡Œå®‰å…¨æ£€æŸ¥ï¼Œåˆ™ä¸º `None`ã€‚

ç¨³å®šæ‰©æ•£ç®¡é“çš„è¾“å‡ºç±»ã€‚
