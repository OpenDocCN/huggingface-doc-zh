# AutoencoderKL

> [`huggingface.co/docs/diffusers/api/models/autoencoderkl`](https://huggingface.co/docs/diffusers/api/models/autoencoderkl)

å˜åˆ†è‡ªåŠ¨ç¼–ç å™¨ï¼ˆVAEï¼‰æ¨¡å‹ä¸ KL æŸå¤±åœ¨[Diederik P. Kingma å’Œ Max Welling çš„ã€Šè‡ªåŠ¨ç¼–ç å˜åˆ†è´å¶æ–¯ã€‹](https://arxiv.org/abs/1312.6114v11)ä¸­å¼•å…¥ã€‚è¯¥æ¨¡å‹ç”¨äºå°†å›¾åƒç¼–ç ä¸ºæ½œåœ¨å˜é‡ï¼Œå¹¶å°†æ½œåœ¨è¡¨ç¤ºè§£ç ä¸ºå›¾åƒã€‚

è®ºæ–‡æ‘˜è¦å¦‚ä¸‹ï¼š

*æˆ‘ä»¬å¦‚ä½•åœ¨è¿ç»­æ½œåœ¨å˜é‡å…·æœ‰éš¾ä»¥å¤„ç†çš„åéªŒåˆ†å¸ƒå’Œå¤§å‹æ•°æ®é›†çš„æƒ…å†µä¸‹ï¼Œåœ¨æœ‰å‘æ¦‚ç‡æ¨¡å‹ä¸­æ‰§è¡Œé«˜æ•ˆçš„æ¨æ–­å’Œå­¦ä¹ ï¼Ÿæˆ‘ä»¬å¼•å…¥äº†ä¸€ç§éšæœºå˜åˆ†æ¨æ–­å’Œå­¦ä¹ ç®—æ³•ï¼Œå¯æ‰©å±•åˆ°å¤§å‹æ•°æ®é›†ï¼Œå¹¶ä¸”åœ¨ä¸€äº›æ¸©å’Œçš„å¯å¾®æ¡ä»¶ä¸‹ï¼Œç”šè‡³åœ¨éš¾ä»¥å¤„ç†çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å·¥ä½œã€‚æˆ‘ä»¬çš„è´¡çŒ®æœ‰ä¸¤ä¸ªæ–¹é¢ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¡¨æ˜å˜åˆ†ä¸‹ç•Œçš„é‡æ–°å‚æ•°åŒ–äº§ç”Ÿäº†ä¸€ä¸ªä¸‹ç•Œä¼°è®¡å™¨ï¼Œå¯ä»¥é€šè¿‡æ ‡å‡†éšæœºæ¢¯åº¦æ–¹æ³•ç›´æ¥ä¼˜åŒ–ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬è¡¨æ˜å¯¹äºå…·æœ‰è¿ç»­æ½œåœ¨å˜é‡çš„ i.i.d.æ•°æ®é›†ï¼Œé€šè¿‡ä½¿ç”¨æå‡ºçš„ä¸‹ç•Œä¼°è®¡å™¨å°†è¿‘ä¼¼æ¨æ–­æ¨¡å‹ï¼ˆä¹Ÿç§°ä¸ºè¯†åˆ«æ¨¡å‹ï¼‰æ‹Ÿåˆåˆ°éš¾ä»¥å¤„ç†çš„åéªŒï¼Œå¯ä»¥ä½¿åéªŒæ¨æ–­ç‰¹åˆ«é«˜æ•ˆã€‚ç†è®ºä¼˜åŠ¿åœ¨å®éªŒç»“æœä¸­å¾—åˆ°ä½“ç°ã€‚*

## ä»åŸå§‹æ ¼å¼åŠ è½½

é»˜è®¤æƒ…å†µä¸‹ï¼Œåº”ä½¿ç”¨ from_pretrained()åŠ è½½ AutoencoderKLï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨`FromOriginalVAEMixin.from_single_file`ä»åŸå§‹æ ¼å¼åŠ è½½ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```py
from diffusers import AutoencoderKL

url = "https://huggingface.co/stabilityai/sd-vae-ft-mse-original/blob/main/vae-ft-mse-840000-ema-pruned.safetensors"  # can also be a local file
model = AutoencoderKL.from_single_file(url)
```

## AutoencoderKL

### `class diffusers.AutoencoderKL`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/autoencoders/autoencoder_kl.py#L35)

```py
( in_channels: int = 3 out_channels: int = 3 down_block_types: Tuple = ('DownEncoderBlock2D',) up_block_types: Tuple = ('UpDecoderBlock2D',) block_out_channels: Tuple = (64,) layers_per_block: int = 1 act_fn: str = 'silu' latent_channels: int = 4 norm_num_groups: int = 32 sample_size: int = 32 scaling_factor: float = 0.18215 force_upcast: float = True )
```

å‚æ•°

+   `in_channels`ï¼ˆintï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 3ï¼‰â€” è¾“å…¥å›¾åƒä¸­çš„é€šé“æ•°ã€‚

+   `out_channels`ï¼ˆintï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 3ï¼‰â€” è¾“å‡ºä¸­çš„é€šé“æ•°ã€‚

+   `down_block_types`ï¼ˆ`Tuple[str]`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`("DownEncoderBlock2D",)`ï¼‰â€” ä¸‹é‡‡æ ·å—ç±»å‹çš„å…ƒç»„ã€‚

+   `up_block_types`ï¼ˆ`Tuple[str]`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`("UpDecoderBlock2D",)`ï¼‰â€” ä¸Šé‡‡æ ·å—ç±»å‹çš„å…ƒç»„ã€‚

+   `block_out_channels`ï¼ˆ`Tuple[int]`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`(64,)`ï¼‰â€” å—è¾“å‡ºé€šé“çš„å…ƒç»„ã€‚

+   `act_fn`ï¼ˆ`str`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`"silu"`ï¼‰â€” è¦ä½¿ç”¨çš„æ¿€æ´»å‡½æ•°ã€‚

+   `latent_channels`ï¼ˆ`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 4ï¼‰â€” æ½œåœ¨ç©ºé—´ä¸­çš„é€šé“æ•°ã€‚

+   `sample_size`ï¼ˆ`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`32`ï¼‰â€” æ ·æœ¬è¾“å…¥å¤§å°ã€‚

+   `scaling_factor`ï¼ˆ`float`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 0.18215ï¼‰â€” ä½¿ç”¨è®­ç»ƒé›†çš„ç¬¬ä¸€æ‰¹è®¡ç®—å‡ºçš„è®­ç»ƒæ½œåœ¨ç©ºé—´çš„åˆ†é‡æ ‡å‡†å·®ã€‚åœ¨è®­ç»ƒæ‰©æ•£æ¨¡å‹æ—¶ï¼Œç”¨äºå°†æ½œåœ¨ç©ºé—´ç¼©æ”¾ä¸ºå•ä½æ–¹å·®ã€‚åœ¨ä¼ é€’ç»™æ‰©æ•£æ¨¡å‹ä¹‹å‰ï¼Œæ½œåœ¨å˜é‡ä½¿ç”¨å…¬å¼`z = z * scaling_factor`è¿›è¡Œç¼©æ”¾ã€‚è§£ç æ—¶ï¼Œæ½œåœ¨å˜é‡ä½¿ç”¨å…¬å¼è¿›è¡Œç¼©æ”¾å›åŸå§‹æ¯”ä¾‹ï¼š`z = 1 / scaling_factor * z`ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[å…·æœ‰æ½œåœ¨æ‰©æ•£æ¨¡å‹çš„é«˜åˆ†è¾¨ç‡å›¾åƒåˆæˆ](https://arxiv.org/abs/2112.10752)è®ºæ–‡çš„ 4.3.2 å’Œ D.1 èŠ‚ã€‚

+   `force_upcast`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`True`ï¼‰â€” å¦‚æœå¯ç”¨ï¼Œå®ƒå°†å¼ºåˆ¶ VAE åœ¨é«˜åˆ†è¾¨ç‡å›¾åƒç®¡é“ï¼ˆå¦‚ SD-XLï¼‰ä¸­ä»¥ float32 è¿è¡Œã€‚ VAE å¯ä»¥å¾®è°ƒ/è®­ç»ƒåˆ°è¾ƒä½èŒƒå›´è€Œä¸ä¼šå¤±å»å¤ªå¤šç²¾åº¦ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`force_upcast`å¯ä»¥è®¾ç½®ä¸º`False` - å‚è§ï¼š[`huggingface.co/madebyollin/sdxl-vae-fp16-fix`](https://huggingface.co/madebyollin/sdxl-vae-fp16-fix)

å…·æœ‰ KL æŸå¤±çš„ VAE æ¨¡å‹ï¼Œç”¨äºå°†å›¾åƒç¼–ç ä¸ºæ½œåœ¨å˜é‡ï¼Œå¹¶å°†æ½œåœ¨è¡¨ç¤ºè§£ç ä¸ºå›¾åƒã€‚

æ­¤æ¨¡å‹ç»§æ‰¿è‡ª ModelMixinã€‚æŸ¥çœ‹è¶…ç±»æ–‡æ¡£ä»¥äº†è§£ä¸ºæ‰€æœ‰æ¨¡å‹å®ç°çš„é€šç”¨æ–¹æ³•ï¼ˆä¾‹å¦‚ä¸‹è½½æˆ–ä¿å­˜ï¼‰ã€‚

#### `wrapper`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/utils/accelerate_utils.py#L43)

```py
( *args **kwargs )
```

#### `wrapper`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/utils/accelerate_utils.py#L43)

```py
( *args **kwargs )
```

#### `disable_slicing`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/autoencoders/autoencoder_kl.py#L152)

```py
( )
```

ç¦ç”¨åˆ‡ç‰‡ VAE è§£ç ã€‚å¦‚æœä¹‹å‰å¯ç”¨äº†`enable_slicing`ï¼Œåˆ™æ­¤æ–¹æ³•å°†è¿”å›åˆ°ä¸€æ­¥è®¡ç®—è§£ç ã€‚

#### `disable_tiling`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/autoencoders/autoencoder_kl.py#L138)

```py
( )
```

ç¦ç”¨å¹³é“º VAE è§£ç ã€‚å¦‚æœä¹‹å‰å¯ç”¨äº†`enable_tiling`ï¼Œåˆ™æ­¤æ–¹æ³•å°†è¿”å›åˆ°ä¸€æ­¥è®¡ç®—è§£ç ã€‚

#### `enable_slicing`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/autoencoders/autoencoder_kl.py#L145)

```py
( )
```

å¯ç”¨åˆ‡ç‰‡ VAE è§£ç ã€‚å½“å¯ç”¨æ­¤é€‰é¡¹æ—¶ï¼ŒVAE å°†å°†è¾“å…¥å¼ é‡åˆ†å‰²æˆåˆ‡ç‰‡ï¼Œä»¥ä¾¿åœ¨å¤šä¸ªæ­¥éª¤ä¸­è®¡ç®—è§£ç ã€‚è¿™å¯¹äºèŠ‚çœä¸€äº›å†…å­˜å¹¶å…è®¸æ›´å¤§çš„æ‰¹é‡å¤§å°éå¸¸æœ‰ç”¨ã€‚

#### `enable_tiling`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/autoencoders/autoencoder_kl.py#L130)

```py
( use_tiling: bool = True )
```

å¯ç”¨å¹³é“º VAE è§£ç ã€‚å½“å¯ç”¨æ­¤é€‰é¡¹æ—¶ï¼ŒVAE å°†å°†è¾“å…¥å¼ é‡åˆ†å‰²æˆç“¦ç‰‡ï¼Œä»¥ä¾¿åœ¨å¤šä¸ªæ­¥éª¤ä¸­è®¡ç®—è§£ç å’Œç¼–ç ã€‚è¿™å¯¹äºèŠ‚çœå¤§é‡å†…å­˜å¹¶å…è®¸å¤„ç†æ›´å¤§çš„å›¾åƒéå¸¸æœ‰ç”¨ã€‚

#### `forward`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/autoencoders/autoencoder_kl.py#L423)

```py
( sample: FloatTensor sample_posterior: bool = False return_dict: bool = True generator: Optional = None )
```

å‚æ•°

+   `sample`ï¼ˆ`torch.FloatTensor`ï¼‰â€” è¾“å…¥æ ·æœ¬ã€‚

+   `sample_posterior`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`False`ï¼‰â€” æ˜¯å¦ä»åéªŒä¸­æŠ½æ ·ã€‚

+   `return_dict`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`True`ï¼‰â€” æ˜¯å¦è¿”å›`DecoderOutput`è€Œä¸æ˜¯æ™®é€šå…ƒç»„ã€‚

#### `fuse_qkv_projections`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/autoencoders/autoencoder_kl.py#L452)

```py
( )
```

å¯ç”¨èåˆ QKV æŠ•å½±ã€‚å¯¹äºè‡ªæ³¨æ„åŠ›æ¨¡å—ï¼Œæ‰€æœ‰æŠ•å½±çŸ©é˜µï¼ˆå³æŸ¥è¯¢ã€é”®ã€å€¼ï¼‰éƒ½è¢«èåˆã€‚å¯¹äºäº¤å‰æ³¨æ„åŠ›æ¨¡å—ï¼Œé”®å’Œå€¼æŠ•å½±çŸ©é˜µè¢«èåˆã€‚

æ­¤ API ä¸ºğŸ§ªå®éªŒæ€§è´¨ã€‚

#### `set_attn_processor`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/autoencoders/autoencoder_kl.py#L185)

```py
( processor: Union )
```

å‚æ•°

+   `processor`ï¼ˆ`dict`æˆ–ä»…`AttentionProcessor`ï¼‰â€” å®ä¾‹åŒ–çš„å¤„ç†å™¨ç±»æˆ–å°†è®¾ç½®ä¸º**æ‰€æœ‰**`Attention`å±‚çš„å¤„ç†å™¨ç±»å­—å…¸ã€‚

    å¦‚æœ`processor`æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œåˆ™é”®éœ€è¦å®šä¹‰ç›¸åº”äº¤å‰æ³¨æ„åŠ›å¤„ç†å™¨çš„è·¯å¾„ã€‚åœ¨è®¾ç½®å¯è®­ç»ƒçš„æ³¨æ„åŠ›å¤„ç†å™¨æ—¶ï¼Œå¼ºçƒˆå»ºè®®è¿™æ ·åšã€‚

è®¾ç½®ç”¨äºè®¡ç®—æ³¨æ„åŠ›çš„æ³¨æ„åŠ›å¤„ç†å™¨ã€‚

#### `set_default_attn_processor`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/autoencoders/autoencoder_kl.py#L220)

```py
( )
```

ç¦ç”¨è‡ªå®šä¹‰æ³¨æ„åŠ›å¤„ç†å™¨å¹¶è®¾ç½®é»˜è®¤çš„æ³¨æ„åŠ›å®ç°ã€‚

#### `tiled_decode`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/autoencoders/autoencoder_kl.py#L375)

```py
( z: FloatTensor return_dict: bool = True ) â†’ export const metadata = 'undefined';~models.vae.DecoderOutput or tuple
```

å‚æ•°

+   `z`ï¼ˆ`torch.FloatTensor`ï¼‰â€” æ½œåœ¨å‘é‡çš„è¾“å…¥æ‰¹æ¬¡ã€‚

+   `return_dict`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`True`ï¼‰â€” æ˜¯å¦è¿”å›`~models.vae.DecoderOutput`è€Œä¸æ˜¯æ™®é€šçš„å…ƒç»„ã€‚

è¿”å›

`~models.vae.DecoderOutput`æˆ–`tuple`

å¦‚æœ`return_dict`ä¸º Trueï¼Œåˆ™è¿”å›`~models.vae.DecoderOutput`ï¼Œå¦åˆ™è¿”å›æ™®é€šçš„`tuple`ã€‚

ä½¿ç”¨å¹³é“ºè§£ç å™¨è§£ç ä¸€æ‰¹å›¾åƒã€‚

#### `tiled_encode`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/autoencoders/autoencoder_kl.py#L321)

```py
( x: FloatTensor return_dict: bool = True ) â†’ export const metadata = 'undefined';~models.autoencoder_kl.AutoencoderKLOutput or tuple
```

å‚æ•°

+   `x`ï¼ˆ`torch.FloatTensor`ï¼‰-å›¾åƒçš„è¾“å…¥æ‰¹æ¬¡ã€‚

+   `return_dict`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`True`ï¼‰-æ˜¯å¦è¿”å›`~models.autoencoder_kl.AutoencoderKLOutput`è€Œä¸æ˜¯æ™®é€šçš„å…ƒç»„ã€‚

è¿”å›

`~models.autoencoder_kl.AutoencoderKLOutput`æˆ–`tuple`

å¦‚æœ return_dict ä¸º Trueï¼Œåˆ™è¿”å›`~models.autoencoder_kl.AutoencoderKLOutput`ï¼Œå¦åˆ™è¿”å›æ™®é€šçš„`tuple`ã€‚

ä½¿ç”¨ç“¦ç‰‡ç¼–ç æ‰¹é‡å›¾åƒã€‚

å¯ç”¨æ­¤é€‰é¡¹æ—¶ï¼ŒVAE å°†è¾“å…¥å¼ é‡åˆ†å‰²æˆç“¦ç‰‡ä»¥åœ¨å‡ ä¸ªæ­¥éª¤ä¸­è®¡ç®—ç¼–ç ã€‚è¿™å¯¹äºä¿æŒå†…å­˜ä½¿ç”¨é‡æ’å®šè€Œä¸å—å›¾åƒå¤§å°å½±å“å¾ˆæœ‰ç”¨ã€‚ç“¦ç‰‡ç¼–ç çš„æœ€ç»ˆç»“æœä¸éç“¦ç‰‡ç¼–ç ä¸åŒï¼Œå› ä¸ºæ¯ä¸ªç“¦ç‰‡ä½¿ç”¨ä¸åŒçš„ç¼–ç å™¨ã€‚ä¸ºäº†é¿å…ç“¦ç‰‡ä¼ªå½±ï¼Œç“¦ç‰‡é‡å å¹¶æ··åˆåœ¨ä¸€èµ·ä»¥å½¢æˆå¹³æ»‘çš„è¾“å‡ºã€‚æ‚¨ä»ç„¶å¯èƒ½çœ‹åˆ°è¾“å‡ºä¸­çš„ç“¦ç‰‡å¤§å°å˜åŒ–ï¼Œä½†å®ƒä»¬åº”è¯¥ä¸å¤ªæ˜æ˜¾ã€‚

#### `unfuse_qkv_projections`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/autoencoders/autoencoder_kl.py#L476)

```py
( )
```

å¦‚æœå¯ç”¨ï¼Œç¦ç”¨èåˆçš„ QKV æŠ•å½±ã€‚

æ­¤ API ä¸ºğŸ§ªå®éªŒæ€§è´¨ã€‚

## è‡ªåŠ¨ç¼–ç å™¨ KL è¾“å‡º

### `class diffusers.models.modeling_outputs.AutoencoderKLOutput`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/modeling_outputs.py#L6)

```py
( latent_dist: DiagonalGaussianDistribution )
```

å‚æ•°

+   `latent_dist`ï¼ˆ`DiagonalGaussianDistribution`ï¼‰-`Encoder`çš„ç¼–ç è¾“å‡ºè¡¨ç¤ºä¸º`DiagonalGaussianDistribution`çš„å‡å€¼å’Œ logvarã€‚`DiagonalGaussianDistribution`å…è®¸ä»åˆ†å¸ƒä¸­é‡‡æ ·æ½œåœ¨å˜é‡ã€‚

AutoencoderKL ç¼–ç æ–¹æ³•çš„è¾“å‡ºã€‚

## DecoderOutput

### `class diffusers.models.autoencoders.vae.DecoderOutput`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/autoencoders/vae.py#L33)

```py
( sample: FloatTensor )
```

å‚æ•°

+   `sample`ï¼ˆå½¢çŠ¶ä¸º`(batch_size, num_channels, height, width)`çš„`torch.FloatTensor`ï¼‰-æ¨¡å‹æœ€åä¸€å±‚çš„è§£ç è¾“å‡ºæ ·æœ¬ã€‚

è§£ç æ–¹æ³•çš„è¾“å‡ºã€‚

## FlaxAutoencoderKL

### `class diffusers.FlaxAutoencoderKL`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/vae_flax.py#L726)

```py
( in_channels: int = 3 out_channels: int = 3 down_block_types: Tuple = ('DownEncoderBlock2D',) up_block_types: Tuple = ('UpDecoderBlock2D',) block_out_channels: Tuple = (64,) layers_per_block: int = 1 act_fn: str = 'silu' latent_channels: int = 4 norm_num_groups: int = 32 sample_size: int = 32 scaling_factor: float = 0.18215 dtype: dtype = <class 'jax.numpy.float32'> parent: Union = <flax.linen.module._Sentinel object at 0x7fbd557629e0> name: Optional = None )
```

å‚æ•°

+   `in_channels`ï¼ˆ`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 3ï¼‰-è¾“å…¥å›¾åƒä¸­çš„é€šé“æ•°ã€‚

+   `out_channels`ï¼ˆ`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 3ï¼‰-è¾“å‡ºä¸­çš„é€šé“æ•°ã€‚

+   `down_block_types`ï¼ˆ`Tuple[str]`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`(DownEncoderBlock2D)`ï¼‰-ä¸‹é‡‡æ ·å—ç±»å‹çš„å…ƒç»„ã€‚

+   `up_block_types`ï¼ˆ`Tuple[str]`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`(UpDecoderBlock2D)`ï¼‰-ä¸Šé‡‡æ ·å—ç±»å‹çš„å…ƒç»„ã€‚

+   `block_out_channels`ï¼ˆ`Tuple[str]`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`(64,)`ï¼‰-å—è¾“å‡ºé€šé“çš„å…ƒç»„ã€‚

+   `layers_per_block`ï¼ˆ`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`2`ï¼‰-æ¯ä¸ªå—çš„ ResNet å±‚æ•°ã€‚

+   `act_fn`ï¼ˆ`str`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`silu`ï¼‰-è¦ä½¿ç”¨çš„æ¿€æ´»å‡½æ•°ã€‚

+   `latent_channels`ï¼ˆ`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`4`ï¼‰-æ½œåœ¨ç©ºé—´ä¸­çš„é€šé“æ•°ã€‚

+   `norm_num_groups`ï¼ˆ`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`32`ï¼‰-è§„èŒƒåŒ–çš„ç»„æ•°ã€‚

+   `sample_size`ï¼ˆ`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 32ï¼‰-æ ·æœ¬è¾“å…¥å¤§å°ã€‚

+   `scaling_factor`ï¼ˆ`float`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 0.18215ï¼‰-ä½¿ç”¨è®­ç»ƒé›†çš„ç¬¬ä¸€æ‰¹è®¡ç®—çš„è®­ç»ƒæ½œåœ¨ç©ºé—´çš„åˆ†é‡æ ‡å‡†å·®ã€‚è¿™ç”¨äºåœ¨è®­ç»ƒæ‰©æ•£æ¨¡å‹æ—¶å°†æ½œåœ¨ç©ºé—´ç¼©æ”¾ä¸ºå•ä½æ–¹å·®ã€‚åœ¨ä¼ é€’ç»™æ‰©æ•£æ¨¡å‹ä¹‹å‰ï¼Œæ½œåœ¨ç©ºé—´ä½¿ç”¨å…¬å¼`z = z * scaling_factor`è¿›è¡Œç¼©æ”¾ã€‚è§£ç æ—¶ï¼Œæ½œåœ¨å˜é‡ä½¿ç”¨å…¬å¼ç¼©æ”¾å›åŸå§‹æ¯”ä¾‹ï¼š`z = 1 / scaling_factor * z`ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[å…·æœ‰æ½œåœ¨æ‰©æ•£æ¨¡å‹çš„é«˜åˆ†è¾¨ç‡å›¾åƒåˆæˆ](https://arxiv.org/abs/2112.10752)è®ºæ–‡çš„ 4.3.2 å’Œ D.1 èŠ‚ã€‚

+   `dtype` (`jnp.dtype`, *å¯é€‰*, é»˜è®¤ä¸º `jnp.float32`) â€” å‚æ•°çš„`dtype`ã€‚

å¸¦æœ‰ KL æŸå¤±çš„è§£ç æ½œåœ¨è¡¨ç¤ºçš„ Flax VAE æ¨¡å‹çš„å®ç°ã€‚

è¿™ä¸ªæ¨¡å‹ç»§æ‰¿è‡ª FlaxModelMixinã€‚æŸ¥çœ‹è¶…ç±»æ–‡æ¡£ä»¥äº†è§£ä¸ºæ‰€æœ‰æ¨¡å‹å®ç°çš„é€šç”¨æ–¹æ³•ï¼ˆå¦‚ä¸‹è½½æˆ–ä¿å­˜ï¼‰ã€‚

è¿™ä¸ªæ¨¡å‹æ˜¯ä¸€ä¸ª Flax Linen [flax.linen.Module](https://flax.readthedocs.io/en/latest/flax.linen.html#module)å­ç±»ã€‚å°†å…¶ç”¨ä½œå¸¸è§„çš„ Flax Linen æ¨¡å—ï¼Œå¹¶å‚è€ƒ Flax æ–‡æ¡£ä»¥äº†è§£ä¸å…¶ä¸€èˆ¬ä½¿ç”¨å’Œè¡Œä¸ºç›¸å…³çš„æ‰€æœ‰äº‹é¡¹ã€‚

æ”¯æŒä»¥ä¸‹ JAX ç‰¹æ€§ï¼š

+   [å³æ—¶ç¼–è¯‘ï¼ˆJITï¼‰](https://jax.readthedocs.io/en/latest/jax.html#just-in-time-compilation-jit)

+   [è‡ªåŠ¨å¾®åˆ†](https://jax.readthedocs.io/en/latest/jax.html#automatic-differentiation)

+   [çŸ¢é‡åŒ–](https://jax.readthedocs.io/en/latest/jax.html#vectorization-vmap)

+   [å¹¶è¡ŒåŒ–](https://jax.readthedocs.io/en/latest/jax.html#parallelization-pmap)

## FlaxAutoencoderKLOutput

### `class diffusers.models.vae_flax.FlaxAutoencoderKLOutput`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/vae_flax.py#L47)

```py
( latent_dist: FlaxDiagonalGaussianDistribution )
```

å‚æ•°

+   `latent_dist` (`FlaxDiagonalGaussianDistribution`) â€” `Encoder`çš„ç¼–ç è¾“å‡ºï¼Œè¡¨ç¤ºä¸º`FlaxDiagonalGaussianDistribution`çš„å‡å€¼å’Œ logvarã€‚`FlaxDiagonalGaussianDistribution`å…è®¸ä»åˆ†å¸ƒä¸­é‡‡æ ·æ½œåœ¨å˜é‡ã€‚

AutoencoderKL ç¼–ç æ–¹æ³•çš„è¾“å‡ºã€‚

#### `replace`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/flax/struct.py#L111)

```py
( **updates )
```

â€œè¿”å›ä¸€ä¸ªç”¨æ–°å€¼æ›¿æ¢æŒ‡å®šå­—æ®µçš„æ–°å¯¹è±¡ã€‚

## FlaxDecoderOutput

### `class diffusers.models.vae_flax.FlaxDecoderOutput`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/vae_flax.py#L32)

```py
( sample: Array )
```

å‚æ•°

+   `æ ·æœ¬` (`å½¢çŠ¶ä¸º`(batch_size, num_channels, height, width)`çš„`jnp.ndarray`) â€” æ¨¡å‹æœ€åä¸€å±‚çš„è§£ç è¾“å‡ºæ ·æœ¬ã€‚

+   `dtype` (`jnp.dtype`, *å¯é€‰*, é»˜è®¤ä¸º `jnp.float32`) â€” å‚æ•°çš„`dtype`ã€‚

è§£ç æ–¹æ³•çš„è¾“å‡ºã€‚

#### `replace`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/flax/struct.py#L111)

```py
( **updates )
```

â€œè¿”å›ä¸€ä¸ªç”¨æ–°å€¼æ›¿æ¢æŒ‡å®šå­—æ®µçš„æ–°å¯¹è±¡ã€‚
