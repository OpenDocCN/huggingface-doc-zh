# æ–‡æœ¬åè½¬

> åŸå§‹æ–‡æœ¬ï¼š[`huggingface.co/docs/diffusers/api/loaders/textual_inversion`](https://huggingface.co/docs/diffusers/api/loaders/textual_inversion)

æ–‡æœ¬åè½¬æ˜¯ä¸€ç§é€šè¿‡ä»å°‘é‡ç¤ºä¾‹å›¾åƒä¸­å­¦ä¹ æ–°çš„æ–‡æœ¬åµŒå…¥æ¥ä¸ªæ€§åŒ–æ¨¡å‹çš„è®­ç»ƒæ–¹æ³•ã€‚è®­ç»ƒç”Ÿæˆçš„æ–‡ä»¶éå¸¸å°ï¼ˆå‡  KBï¼‰ï¼Œæ–°çš„åµŒå…¥å¯ä»¥åŠ è½½åˆ°æ–‡æœ¬ç¼–ç å™¨ä¸­ã€‚

`TextualInversionLoaderMixin`æä¾›äº†ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºä» Diffusers å’Œ Automatic1111 ä¸­åŠ è½½æ–‡æœ¬åè½¬åµŒå…¥åˆ°æ–‡æœ¬ç¼–ç å™¨ä¸­ï¼Œå¹¶åŠ è½½ä¸€ä¸ªç‰¹æ®Šçš„æ ‡è®°æ¥æ¿€æ´»è¿™äº›åµŒå…¥ã€‚

è¦äº†è§£å¦‚ä½•åŠ è½½æ–‡æœ¬åè½¬åµŒå…¥çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æ–‡æœ¬åè½¬åŠ è½½æŒ‡å—ã€‚

## TextualInversionLoaderMixin

### `class diffusers.loaders.TextualInversionLoaderMixin`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/textual_inversion.py#L112)

```py
( )
```

åŠ è½½æ–‡æœ¬åè½¬æ ‡è®°å’ŒåµŒå…¥åˆ°åˆ†è¯å™¨å’Œæ–‡æœ¬ç¼–ç å™¨ä¸­ã€‚

#### `load_textual_inversion`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/textual_inversion.py#L265)

```py
( pretrained_model_name_or_path: Union token: Union = None tokenizer: Optional = None text_encoder: Optional = None **kwargs )
```

å‚æ•°

+   `pretrained_model_name_or_path`ï¼ˆ`str`æˆ–`os.PathLike`æˆ–`List[str æˆ– os.PathLike]`æˆ–`Dict`æˆ–`List[Dict]`ï¼‰â€” å¯ä»¥æ˜¯ä»¥ä¸‹ä¹‹ä¸€æˆ–å®ƒä»¬çš„åˆ—è¡¨ï¼š

    +   ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé¢„è®­ç»ƒæ¨¡å‹åœ¨ Hub ä¸Šæ‰˜ç®¡çš„*æ¨¡å‹ id*ï¼ˆä¾‹å¦‚`sd-concepts-library/low-poly-hd-logos-icons`ï¼‰ã€‚

    +   ä¸€ä¸ªåŒ…å«æ–‡æœ¬åè½¬æƒé‡çš„*ç›®å½•*è·¯å¾„ï¼ˆä¾‹å¦‚`./my_text_inversion_directory/`ï¼‰ã€‚

    +   ä¸€ä¸ªåŒ…å«æ–‡æœ¬åè½¬æƒé‡çš„*æ–‡ä»¶*è·¯å¾„ï¼ˆä¾‹å¦‚`./my_text_inversions.pt`ï¼‰ã€‚

    +   ä¸€ä¸ª[torch çŠ¶æ€å­—å…¸](https://pytorch.org/tutorials/beginner/saving_loading_models.html#what-is-a-state-dict)ã€‚

+   `token`ï¼ˆ`str`æˆ–`List[str]`ï¼Œ*å¯é€‰*ï¼‰â€” ç”¨äºæ–‡æœ¬åè½¬æƒé‡çš„è¦†ç›–æ ‡è®°ã€‚å¦‚æœ`pretrained_model_name_or_path`æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ™`token`ä¹Ÿå¿…é¡»æ˜¯ç›¸åŒé•¿åº¦çš„åˆ—è¡¨ã€‚

+   `text_encoder`ï¼ˆ[CLIPTextModel](https://huggingface.co/docs/transformers/v4.37.2/en/model_doc/clip#transformers.CLIPTextModel)ï¼Œ*å¯é€‰*ï¼‰â€” å†»ç»“çš„æ–‡æœ¬ç¼–ç å™¨ï¼ˆ[clip-vit-large-patch14](https://huggingface.co/openai/clip-vit-large-patch14)ï¼‰ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™å‡½æ•°å°†ä½¿ç”¨ self.tokenizerã€‚

+   `tokenizer`ï¼ˆ[CLIPTokenizer](https://huggingface.co/docs/transformers/v4.37.2/en/model_doc/clip#transformers.CLIPTokenizer)ï¼Œ*å¯é€‰*ï¼‰â€” ç”¨äºå¯¹æ–‡æœ¬è¿›è¡Œåˆ†è¯çš„`CLIPTokenizer`ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™å‡½æ•°å°†ä½¿ç”¨ self.tokenizerã€‚

+   `weight_name`ï¼ˆ`str`ï¼Œ*å¯é€‰*ï¼‰â€” è‡ªå®šä¹‰æƒé‡æ–‡ä»¶çš„åç§°ã€‚å½“ï¼š

    +   ä¿å­˜çš„æ–‡æœ¬åè½¬æ–‡ä»¶ä»¥ğŸ¤— Diffusers æ ¼å¼ä¿å­˜ï¼Œä½†æ˜¯ä¿å­˜åœ¨ç‰¹å®šæƒé‡åç§°ä¸‹ï¼Œä¾‹å¦‚`text_inv.bin`ã€‚

    +   ä¿å­˜çš„æ–‡æœ¬åè½¬æ–‡ä»¶æ˜¯ä»¥ Automatic1111 æ ¼å¼ä¿å­˜çš„ã€‚

+   `cache_dir`ï¼ˆ`Union[str, os.PathLike]`ï¼Œ*å¯é€‰*ï¼‰â€” ä¸‹è½½çš„é¢„è®­ç»ƒæ¨¡å‹é…ç½®ç¼“å­˜åœ¨å…¶ä¸­çš„ç›®å½•è·¯å¾„ï¼Œå¦‚æœä¸ä½¿ç”¨æ ‡å‡†ç¼“å­˜ã€‚

+   `force_download`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`False`ï¼‰â€” æ˜¯å¦å¼ºåˆ¶ï¼ˆé‡æ–°ï¼‰ä¸‹è½½æ¨¡å‹æƒé‡å’Œé…ç½®æ–‡ä»¶ï¼Œè¦†ç›–ç¼“å­˜ç‰ˆæœ¬ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚

+   `resume_download`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`False`ï¼‰â€” æ˜¯å¦æ¢å¤ä¸‹è½½æ¨¡å‹æƒé‡å’Œé…ç½®æ–‡ä»¶ã€‚å¦‚æœè®¾ç½®ä¸º`False`ï¼Œä»»ä½•æœªå®Œå…¨ä¸‹è½½çš„æ–‡ä»¶å°†è¢«åˆ é™¤ã€‚

+   `proxies`ï¼ˆ`Dict[str, str]`ï¼Œ*å¯é€‰*ï¼‰â€” ä¸€ä¸ªæŒ‰åè®®æˆ–ç«¯ç‚¹ä½¿ç”¨çš„ä»£ç†æœåŠ¡å™¨å­—å…¸ï¼Œä¾‹å¦‚ï¼Œ`{'http': 'foo.bar:3128', 'http://hostname': 'foo.bar:4012'}`ã€‚ä»£ç†ä¼šåœ¨æ¯ä¸ªè¯·æ±‚ä¸­ä½¿ç”¨ã€‚

+   `local_files_only`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`False`ï¼‰â€” æ˜¯å¦ä»…åŠ è½½æœ¬åœ°æ¨¡å‹æƒé‡å’Œé…ç½®æ–‡ä»¶ã€‚å¦‚æœè®¾ç½®ä¸º`True`ï¼Œåˆ™æ¨¡å‹ä¸ä¼šä» Hub ä¸‹è½½ã€‚

+   `token` (`str` or *bool*, *optional*) â€” ç”¨ä½œè¿œç¨‹æ–‡ä»¶ HTTP ä»¤ç‰Œçš„æ ‡è®°ã€‚å¦‚æœä¸º`True`ï¼Œåˆ™ä½¿ç”¨ä»`diffusers-cli login`ç”Ÿæˆçš„æ ‡è®°ï¼ˆå­˜å‚¨åœ¨`~/.huggingface`ä¸­ï¼‰ã€‚

+   `revision` (`str`, *optional*, defaults to `"main"`) â€” è¦ä½¿ç”¨çš„ç‰¹å®šæ¨¡å‹ç‰ˆæœ¬ã€‚å¯ä»¥æ˜¯åˆ†æ”¯åç§°ã€æ ‡ç­¾åç§°ã€æäº¤ ID æˆ– Git å…è®¸çš„ä»»ä½•æ ‡è¯†ç¬¦ã€‚

+   `subfolder` (`str`, *optional*, defaults to `""`) â€” æ¨¡å‹æ–‡ä»¶åœ¨ Hub æˆ–æœ¬åœ°è¾ƒå¤§æ¨¡å‹å­˜å‚¨åº“ä¸­çš„å­æ–‡ä»¶å¤¹ä½ç½®ã€‚

+   `mirror` (`str`, *optional*) â€” å¦‚æœæ‚¨åœ¨ä¸­å›½ä¸‹è½½æ¨¡å‹æ—¶é‡åˆ°å¯è®¿é—®æ€§é—®é¢˜ï¼Œè¯·ä½¿ç”¨é•œåƒæºã€‚æˆ‘ä»¬ä¸ä¿è¯æºçš„åŠæ—¶æ€§æˆ–å®‰å…¨æ€§ï¼Œæ‚¨åº”å‚è€ƒé•œåƒç«™ç‚¹è·å–æ›´å¤šä¿¡æ¯ã€‚

å°†æ–‡æœ¬åè½¬åµŒå…¥åŠ è½½åˆ° StableDiffusionPipeline çš„æ–‡æœ¬ç¼–ç å™¨ä¸­ï¼ˆæ”¯æŒğŸ¤— Diffusers å’Œ Automatic1111 æ ¼å¼ï¼‰ã€‚

ç¤ºä¾‹ï¼š

è¦åŠ è½½ğŸ¤— Diffusers æ ¼å¼çš„æ–‡æœ¬åè½¬åµŒå…¥å‘é‡ï¼š

```py
from diffusers import StableDiffusionPipeline
import torch

model_id = "runwayml/stable-diffusion-v1-5"
pipe = StableDiffusionPipeline.from_pretrained(model_id, torch_dtype=torch.float16).to("cuda")

pipe.load_textual_inversion("sd-concepts-library/cat-toy")

prompt = "A <cat-toy> backpack"

image = pipe(prompt, num_inference_steps=50).images[0]
image.save("cat-backpack.png")
```

è¦åŠ è½½ Automatic1111 æ ¼å¼çš„æ–‡æœ¬åè½¬åµŒå…¥å‘é‡ï¼Œè¯·ç¡®ä¿é¦–å…ˆä¸‹è½½å‘é‡ï¼ˆä¾‹å¦‚ä»[civitAI](https://civitai.com/models/3036?modelVersionId=9857)ï¼‰ï¼Œç„¶ååŠ è½½å‘é‡

æœ¬åœ°ï¼š

```py
from diffusers import StableDiffusionPipeline
import torch

model_id = "runwayml/stable-diffusion-v1-5"
pipe = StableDiffusionPipeline.from_pretrained(model_id, torch_dtype=torch.float16).to("cuda")

pipe.load_textual_inversion("./charturnerv2.pt", token="charturnerv2")

prompt = "charturnerv2, multiple views of the same character in the same outfit, a character turnaround of a woman wearing a black jacket and red shirt, best quality, intricate details."

image = pipe(prompt, num_inference_steps=50).images[0]
image.save("character.png")
```

#### `maybe_convert_prompt`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/textual_inversion.py#L117)

```py
( prompt: Union tokenizer: PreTrainedTokenizer ) â†’ export const metadata = 'undefined';str or list of str
```

å‚æ•°

+   `prompt` (`str` æˆ– `str` åˆ—è¡¨ï¼‰â€” ç”¨äºæŒ‡å¯¼å›¾åƒç”Ÿæˆçš„æç¤ºã€‚

+   `tokenizer` (`PreTrainedTokenizer`) â€” è´Ÿè´£å°†æç¤ºç¼–ç ä¸ºè¾“å…¥æ ‡è®°çš„åˆ†è¯å™¨ã€‚

è¿”å›

`str` æˆ– `str` åˆ—è¡¨

è½¬æ¢åçš„æç¤º

å¤„ç†åŒ…å«ç‰¹æ®Šæ ‡è®°çš„æç¤ºï¼Œè¯¥æ ‡è®°å¯¹åº”äºè¦æ›¿æ¢ä¸ºå¤šä¸ªç‰¹æ®Šæ ‡è®°ä¸­çš„ä¸€ä¸ªçš„å¤šå‘é‡æ–‡æœ¬åè½¬åµŒå…¥ã€‚å¦‚æœæç¤ºæ²¡æœ‰æ–‡æœ¬åè½¬æ ‡è®°ï¼Œæˆ–è€…æ–‡æœ¬åè½¬æ ‡è®°æ˜¯å•ä¸ªå‘é‡ï¼Œåˆ™è¿”å›è¾“å…¥æç¤ºã€‚

#### `unload_textual_inversion`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/textual_inversion.py#L457)

```py
( tokens: Union = None )
```

ä» StableDiffusionPipeline çš„æ–‡æœ¬ç¼–ç å™¨ä¸­å¸è½½æ–‡æœ¬åè½¬åµŒå…¥

ç¤ºä¾‹ï¼š

```py
from diffusers import AutoPipelineForText2Image
import torch

pipeline = AutoPipelineForText2Image.from_pretrained("runwayml/stable-diffusion-v1-5")

# Example 1
pipeline.load_textual_inversion("sd-concepts-library/gta5-artwork")
pipeline.load_textual_inversion("sd-concepts-library/moeb-style")

# Remove all token embeddings
pipeline.unload_textual_inversion()

# Example 2
pipeline.load_textual_inversion("sd-concepts-library/moeb-style")
pipeline.load_textual_inversion("sd-concepts-library/gta5-artwork")

# Remove just one token
pipeline.unload_textual_inversion("<moe-bius>")
```
