# DDPMScheduler

> åŸæ–‡é“¾æ¥ï¼š[`huggingface.co/docs/diffusers/api/schedulers/ddpm`](https://huggingface.co/docs/diffusers/api/schedulers/ddpm)

[å»å™ªæ‰©æ•£æ¦‚ç‡æ¨¡å‹](https://huggingface.co/papers/2006.11239)ï¼ˆDDPMï¼‰ç”± Jonathan Hoã€Ajay Jain å’Œ Pieter Abbeel æå‡ºäº†åŒåçš„åŸºäºæ‰©æ•£çš„æ¨¡å‹ã€‚åœ¨ ğŸ¤— Diffusers åº“çš„ä¸Šä¸‹æ–‡ä¸­ï¼ŒDDPM æŒ‡çš„æ˜¯è®ºæ–‡ä¸­çš„ç¦»æ•£å»å™ªè°ƒåº¦ç¨‹åºä»¥åŠæµæ°´çº¿ã€‚

è®ºæ–‡æ‘˜è¦å¦‚ä¸‹ï¼š

*æˆ‘ä»¬ä½¿ç”¨æ‰©æ•£æ¦‚ç‡æ¨¡å‹è¿›è¡Œé«˜è´¨é‡å›¾åƒåˆæˆï¼Œè¿™æ˜¯ä¸€ç±»å—éå¹³è¡¡çƒ­åŠ›å­¦è€ƒè™‘å¯å‘çš„æ½œå˜é‡æ¨¡å‹ã€‚æˆ‘ä»¬é€šè¿‡æ ¹æ®æ‰©æ•£æ¦‚ç‡æ¨¡å‹å’Œä½¿ç”¨ Langevin åŠ¨åŠ›å­¦è¿›è¡Œå»å™ªå¾—åˆ†åŒ¹é…ä¹‹é—´çš„æ–°é¢–è¿æ¥è®¾è®¡çš„åŠ æƒå˜åˆ†ç•Œæ¥è®­ç»ƒï¼Œè·å¾—äº†æœ€ä½³ç»“æœï¼Œæˆ‘ä»¬çš„æ¨¡å‹è‡ªç„¶åœ°é‡‡ç”¨äº†ä¸€ç§æ¸è¿›çš„æœ‰æŸè§£å‹ç¼©æ–¹æ¡ˆï¼Œå¯ä»¥è§£é‡Šä¸ºè‡ªå›å½’è§£ç çš„ä¸€èˆ¬åŒ–ã€‚åœ¨æ— æ¡ä»¶çš„ CIFAR10 æ•°æ®é›†ä¸Šï¼Œæˆ‘ä»¬è·å¾—äº† 9.46 çš„ Inception åˆ†æ•°å’Œ 3.17 çš„æœ€æ–° FID åˆ†æ•°ã€‚åœ¨ 256x256 LSUN ä¸Šï¼Œæˆ‘ä»¬è·å¾—äº†ç±»ä¼¼äº ProgressiveGAN çš„æ ·æœ¬è´¨é‡ã€‚æˆ‘ä»¬çš„å®ç°å¯åœ¨ [æ­¤ https URL](https://github.com/hojonathanho/diffusion) ä¸Šæ‰¾åˆ°ã€‚*

## DDPMScheduler

### `class diffusers.DDPMScheduler`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/schedulers/scheduling_ddpm.py#L129)

```py
( num_train_timesteps: int = 1000 beta_start: float = 0.0001 beta_end: float = 0.02 beta_schedule: str = 'linear' trained_betas: Union = None variance_type: str = 'fixed_small' clip_sample: bool = True prediction_type: str = 'epsilon' thresholding: bool = False dynamic_thresholding_ratio: float = 0.995 clip_sample_range: float = 1.0 sample_max_value: float = 1.0 timestep_spacing: str = 'leading' steps_offset: int = 0 rescale_betas_zero_snr: int = False )
```

å‚æ•°

+   `num_train_timesteps` (`int`, é»˜è®¤ä¸º 1000) â€” è®­ç»ƒæ¨¡å‹çš„æ‰©æ•£æ­¥æ•°ã€‚

+   `beta_start` (`float`, é»˜è®¤ä¸º 0.0001) â€” æ¨æ–­çš„èµ·å§‹ `beta` å€¼ã€‚

+   `beta_end` (`float`, é»˜è®¤ä¸º 0.02) â€” æœ€ç»ˆçš„ `beta` å€¼ã€‚

+   `beta_schedule` (`str`, é»˜è®¤ä¸º `"linear"`) â€” beta è®¡åˆ’ï¼Œä» beta èŒƒå›´åˆ°ç”¨äºæ­¥è¿›æ¨¡å‹çš„ä¸€ç³»åˆ— beta çš„æ˜ å°„ã€‚å¯é€‰æ‹© `linear`ã€`scaled_linear` æˆ– `squaredcos_cap_v2`ã€‚

+   `trained_betas` (`np.ndarray`, *å¯é€‰*) â€” ä¸€ç»„ beta æ•°ç»„ï¼Œç›´æ¥ä¼ é€’ç»™æ„é€ å‡½æ•°ï¼Œè€Œä¸ä½¿ç”¨ `beta_start` å’Œ `beta_end`ã€‚

+   `variance_type` (`str`, é»˜è®¤ä¸º `"fixed_small"`) â€” åœ¨å‘å»å™ªæ ·æœ¬æ·»åŠ å™ªå£°æ—¶å‰ªåˆ‡æ–¹å·®ã€‚å¯é€‰æ‹© `fixed_small`ã€`fixed_small_log`ã€`fixed_large`ã€`fixed_large_log`ã€`learned` æˆ– `learned_range`ã€‚

+   `clip_sample` (`bool`, é»˜è®¤ä¸º `True`) â€” ä¸ºäº†æ•°å€¼ç¨³å®šæ€§è€Œå‰ªåˆ‡é¢„æµ‹æ ·æœ¬ã€‚

+   `clip_sample_range` (`float`, é»˜è®¤ä¸º 1.0) â€” æ ·æœ¬å‰ªåˆ‡çš„æœ€å¤§å¹…åº¦ã€‚ä»…åœ¨ `clip_sample=True` æ—¶æœ‰æ•ˆã€‚

+   `prediction_type` (`str`, é»˜è®¤ä¸º `epsilon`, *å¯é€‰*) â€” è°ƒåº¦å™¨å‡½æ•°çš„é¢„æµ‹ç±»å‹ï¼›å¯ä»¥æ˜¯ `epsilon`ï¼ˆé¢„æµ‹æ‰©æ•£è¿‡ç¨‹çš„å™ªå£°ï¼‰ã€`sample`ï¼ˆç›´æ¥é¢„æµ‹æœ‰å™ªå£°çš„æ ·æœ¬ï¼‰æˆ– `v_prediction`ï¼ˆå‚è§[Imagen Video](https://imagen.research.google/video/paper.pdf)è®ºæ–‡çš„ç¬¬ 2.4 èŠ‚ï¼‰ã€‚

+   `thresholding` (`bool`, é»˜è®¤ä¸º `False`) â€” æ˜¯å¦ä½¿ç”¨â€œåŠ¨æ€é˜ˆå€¼â€æ–¹æ³•ã€‚è¿™ä¸é€‚ç”¨äºç¨³å®šæ‰©æ•£ç­‰æ½œç©ºé—´æ‰©æ•£æ¨¡å‹ã€‚

+   `dynamic_thresholding_ratio` (`float`, é»˜è®¤ä¸º 0.995) â€” åŠ¨æ€é˜ˆå€¼æ–¹æ³•çš„æ¯”ç‡ã€‚ä»…åœ¨ `thresholding=True` æ—¶æœ‰æ•ˆã€‚

+   `sample_max_value` (`float`, é»˜è®¤ä¸º 1.0) â€” åŠ¨æ€é˜ˆå€¼çš„é˜ˆå€¼å€¼ã€‚ä»…åœ¨ `thresholding=True` æ—¶æœ‰æ•ˆã€‚

+   `timestep_spacing` (`str`, é»˜è®¤ä¸º `"leading"`) â€” æ—¶é—´æ­¥é•¿åº”è¯¥å¦‚ä½•ç¼©æ”¾ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ[Common Diffusion Noise Schedules and Sample Steps are Flawed](https://huggingface.co/papers/2305.08891)çš„è¡¨ 2ã€‚

+   `steps_offset` (`int`, é»˜è®¤ä¸º 0) â€” æ·»åŠ åˆ°æ¨æ–­æ­¥éª¤çš„åç§»é‡ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ `offset=1` å’Œ `set_alpha_to_one=False` çš„ç»„åˆï¼Œä½¿æœ€åä¸€æ­¥ä½¿ç”¨æ­¥éª¤ 0 ç”¨äºå…ˆå‰ alpha äº§å“ï¼Œå°±åƒåœ¨ Stable Diffusion ä¸­ä¸€æ ·ã€‚

+   `rescale_betas_zero_snr`ï¼ˆé»˜è®¤ä¸º`False`çš„`bool`ï¼‰- æ˜¯å¦é‡æ–°ç¼©æ”¾ beta ä»¥ä½¿ç»ˆç«¯ SNR ä¸ºé›¶ã€‚è¿™ä½¿æ¨¡å‹èƒ½å¤Ÿç”Ÿæˆéå¸¸æ˜äº®å’Œé»‘æš—çš„æ ·æœ¬ï¼Œè€Œä¸ä»…é™äºå…·æœ‰ä¸­ç­‰äº®åº¦çš„æ ·æœ¬ã€‚ä¸[`--offset_noise`](https://github.com/huggingface/diffusers/blob/74fd735eb073eb1d774b1ab4154a0876eb82f055/examples/dreambooth/train_dreambooth.py#L506) loosely ç›¸å…³ã€‚

`DDPMScheduler`æ¢ç´¢å»å™ªå¾—åˆ†åŒ¹é…å’Œæœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦é‡‡æ ·ä¹‹é—´çš„è”ç³»ã€‚

æ­¤æ¨¡å‹ç»§æ‰¿è‡ª SchedulerMixin å’Œ ConfigMixinã€‚æ£€æŸ¥è¶…ç±»æ–‡æ¡£ä»¥äº†è§£åº“ä¸ºæ‰€æœ‰è°ƒåº¦å™¨å®ç°çš„é€šç”¨æ–¹æ³•ï¼Œä¾‹å¦‚åŠ è½½å’Œä¿å­˜ã€‚

#### `scale_model_input`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/schedulers/scheduling_ddpm.py#L236)

```py
( sample: FloatTensor timestep: Optional = None ) â†’ export const metadata = 'undefined';torch.FloatTensor
```

å‚æ•°

+   `sample`ï¼ˆ`torch.FloatTensor`ï¼‰- è¾“å…¥æ ·æœ¬ã€‚

+   `timestep`ï¼ˆ`int`ï¼Œ*å¯é€‰*ï¼‰- æ‰©æ•£é“¾ä¸­çš„å½“å‰æ—¶é—´æ­¥ã€‚

è¿”å›

`torch.FloatTensor`

ä¸€ä¸ªç»è¿‡ç¼©æ”¾çš„è¾“å…¥æ ·æœ¬ã€‚

ç¡®ä¿ä¸éœ€è¦æ ¹æ®å½“å‰æ—¶é—´æ­¥ç¼©æ”¾å»å™ªæ¨¡å‹è¾“å…¥çš„è°ƒåº¦å™¨å¯äº’æ¢ã€‚

#### `set_timesteps`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/schedulers/scheduling_ddpm.py#L253)

```py
( num_inference_steps: Optional = None device: Union = None timesteps: Optional = None )
```

å‚æ•°

+   `num_inference_steps`ï¼ˆ`int`ï¼‰- ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹ç”Ÿæˆæ ·æœ¬æ—¶ä½¿ç”¨çš„æ‰©æ•£æ­¥æ•°ã€‚å¦‚æœä½¿ç”¨ï¼Œåˆ™`timesteps`å¿…é¡»ä¸º`None`ã€‚

+   `device`ï¼ˆ`str`æˆ–`torch.device`ï¼Œ*å¯é€‰*ï¼‰- æ—¶é—´æ­¥åº”ç§»åŠ¨åˆ°çš„è®¾å¤‡ã€‚å¦‚æœä¸º`None`ï¼Œåˆ™ä¸ç§»åŠ¨æ—¶é—´æ­¥ã€‚

+   `timesteps`ï¼ˆ`List[int]`ï¼Œ*å¯é€‰*ï¼‰- ç”¨äºæ”¯æŒæ—¶é—´æ­¥ä¹‹é—´ä»»æ„é—´è·çš„è‡ªå®šä¹‰æ—¶é—´æ­¥ã€‚å¦‚æœä¸º`None`ï¼Œåˆ™ä½¿ç”¨æ—¶é—´æ­¥ä¹‹é—´ç­‰è·ç¦»çš„é»˜è®¤æ—¶é—´æ­¥é—´è·ç­–ç•¥ã€‚å¦‚æœä¼ é€’äº†`timesteps`ï¼Œåˆ™`num_inference_steps`å¿…é¡»ä¸º`None`ã€‚

è®¾ç½®ç”¨äºæ‰©æ•£é“¾çš„ç¦»æ•£æ—¶é—´æ­¥ï¼ˆåœ¨æ¨ç†ä¹‹å‰è¿è¡Œï¼‰ã€‚

#### `step`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/schedulers/scheduling_ddpm.py#L401)

```py
( model_output: FloatTensor timestep: int sample: FloatTensor generator = None return_dict: bool = True ) â†’ export const metadata = 'undefined';DDPMSchedulerOutput or tuple
```

å‚æ•°

+   `model_output`ï¼ˆ`torch.FloatTensor`ï¼‰- ä»å­¦ä¹ æ‰©æ•£æ¨¡å‹çš„ç›´æ¥è¾“å‡ºã€‚

+   `timestep`ï¼ˆ`float`ï¼‰- æ‰©æ•£é“¾ä¸­çš„å½“å‰ç¦»æ•£æ—¶é—´æ­¥ã€‚

+   `sample`ï¼ˆ`torch.FloatTensor`ï¼‰- ç”±æ‰©æ•£è¿‡ç¨‹åˆ›å»ºçš„æ ·æœ¬çš„å½“å‰å®ä¾‹ã€‚

+   `generator`ï¼ˆ`torch.Generator`ï¼Œ*å¯é€‰*ï¼‰- éšæœºæ•°ç”Ÿæˆå™¨ã€‚

+   `return_dict`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`True`ï¼‰- æ˜¯å¦è¿”å› DDPMSchedulerOutput æˆ–`tuple`ã€‚

è¿”å›

DDPMSchedulerOutput æˆ–`tuple`

å¦‚æœ`return_dict`ä¸º`True`ï¼Œåˆ™è¿”å› DDPMSchedulerOutputï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªå…ƒç»„ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ ·æœ¬å¼ é‡ã€‚

é€šè¿‡åè½¬ SDE é¢„æµ‹å‰ä¸€ä¸ªæ—¶é—´æ­¥çš„æ ·æœ¬ã€‚æ­¤å‡½æ•°ä»å­¦ä¹ æ¨¡å‹è¾“å‡ºï¼ˆé€šå¸¸æ˜¯é¢„æµ‹çš„å™ªå£°ï¼‰ä¼ æ’­æ‰©æ•£è¿‡ç¨‹ã€‚

## DDPMSchedulerOutput

### `class diffusers.schedulers.scheduling_ddpm.DDPMSchedulerOutput`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/schedulers/scheduling_ddpm.py#L30)

```py
( prev_sample: FloatTensor pred_original_sample: Optional = None )
```

å‚æ•°

+   `prev_sample`ï¼ˆ`torch.FloatTensor`ï¼Œå½¢çŠ¶ä¸º`ï¼ˆbatch_sizeï¼Œnum_channelsï¼Œheightï¼Œwidthï¼‰`ï¼Œç”¨äºå›¾åƒï¼‰- ä¸Šä¸€ä¸ªæ—¶é—´æ­¥çš„è®¡ç®—æ ·æœ¬`ï¼ˆx_{t-1}ï¼‰`ã€‚`prev_sample`åº”è¯¥åœ¨å»å™ªå¾ªç¯ä¸­ä½œä¸ºä¸‹ä¸€ä¸ªæ¨¡å‹è¾“å…¥ä½¿ç”¨ã€‚

+   `pred_original_sample`ï¼ˆ`torch.FloatTensor`ï¼Œå½¢çŠ¶ä¸º`(batch_size, num_channels, height, width)`ï¼Œç”¨äºå›¾åƒï¼‰- åŸºäºå½“å‰æ—¶é—´æ­¥çš„æ¨¡å‹è¾“å‡ºçš„é¢„æµ‹å»å™ªæ ·æœ¬`(x_{0})`ã€‚`pred_original_sample`å¯ç”¨äºé¢„è§ˆè¿›å±•æˆ–æŒ‡å¯¼ã€‚

è°ƒåº¦ç¨‹åºçš„`step`å‡½æ•°è¾“å‡ºçš„è¾“å‡ºç±»ã€‚
