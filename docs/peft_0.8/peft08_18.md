# 为 PEFT 做出贡献

> 原文链接：[`huggingface.co/docs/peft/developer_guides/contributing`](https://huggingface.co/docs/peft/developer_guides/contributing)

我们很高兴接受对 PEFT 的贡献。如果您计划贡献，请阅读此内容，以使过程尽可能顺利。

## 安装

对于 PEFT 的代码贡献，您应该选择“source”安装方法。

如果您是第一次创建拉取请求，请按照 GitHub 的[创建拉取请求](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request)指南操作。

## 测试和代码质量检查

无论贡献类型如何（除非仅涉及文档），在创建 PR 之前，您应该运行测试和代码质量检查，以确保您的贡献不会破坏任何内容并遵循项目标准。

我们提供一个 Makefile 来执行必要的测试。运行以下代码进行单元测试：

```py
make test
```

运行以下代码之一，要么只检查，要么检查并修复代码质量和风格：

```py
make quality  # just check
make style  # check and fix
```

运行所有测试可能需要几分钟，因此在开发过程中，只运行特定于您更改的测试可能更有效。

```py
pytest tests/ -k <name-of-test>
```

这应该更快完成，从而实现更快的迭代。但是，您仍应在创建 PR 之前运行整个测试套件，因为您的更改可能会无意中破坏乍一看与之无关的测试。

如果您的更改特定于硬件设置（例如，需要 CUDA），请查看[tests/test_gpu_examples.py](https://github.com/huggingface/peft/blob/1c1c7fdaa6e6abaa53939b865dee1eded82ad032/tests/test_gpu_examples.py)和[tests/test_common_gpu.py](https://github.com/huggingface/peft/blob/1c1c7fdaa6e6abaa53939b865dee1eded82ad032/tests/test_common_gpu.py)，看看是否有必要在那里添加测试。如果您的更改可能会影响保存和加载模型，请使用`--regression`标志运行测试以触发回归测试。

在您处理 PR 时，由于其他更改被合并而导致底层代码库发生更改是可能的。如果发生这种情况-特别是在出现合并冲突时-请使用最新更改更新您的分支。这可以是合并或变基，一旦准备就绪，我们将压缩并合并 PR。

## PR 描述

在打开 PR 时，请提供对您提出的更改的良好描述。如果与其他问题或 PR 相关，请引用它们。提供良好的描述不仅有助于审阅人员更好更快地审查您的代码，还可以稍后（作为基础）用于提交消息，有助于项目的长期维护。

如果您的代码进行了一些重要更改，也可以添加注释来解释这些更改。例如，如果您不得不多次迭代您的实现，因为最明显的方法不起作用，那么需要添加代码注释。

## Bug 修复

请描述导致错误的情况。如果存在问题，请链接到它（例如，“解决＃12345”）。

理想情况下，提供 bug 修复时，应该附带一个针对该 bug 的测试。测试应该在当前代码中失败，并在 bug 修复后通过。在测试中添加一个引用问题或 PR 的注释。没有测试，将更难以防止未来的回归。

## 添加新的微调方法

新的参数高效微调方法正在不断开发。如果您想将新的有前途的方法添加到 PEFT，请按照以下步骤。

1.  在开始实现新方法之前，请通过 GitHub 提出您的建议。这样，维护者可以给您一些早期反馈。

1.  请添加方法的来源链接（通常是一篇论文）。应提供一些证据表明有人对使用该方法感兴趣。我们不会添加刚刚发布的新方法，但没有需求的证据。

1.  在实现方法时，最好查找已经存在的实现作为指南。此外，当您构建代码时，请从其他 PEFT 方法中汲取灵感。例如，如果您的方法类似于 LoRA，那么将代码结构化或者在合适的地方重用一些函数或类是有意义的（一些代码重复是可以接受的，但不要过度）。

1.  理想情况下，除了实现新方法之外，还应该有示例（笔记本，脚本），文档和一个广泛的测试套件，证明该方法可以与各种任务一起工作。然而，这可能更具挑战性，因此只提供实现和至少一个可工作的示例是可以接受的。文档和测试可以在后续的 PR 中添加。

1.  一旦您有了似乎有效的东西，请不要犹豫，即使它还没有达到可合并的状态，也可以创建一个草案 PR。维护者很乐意在这个过程中给您反馈和指导。

## 添加其他功能

最好先在 GitHub 上提出添加新功能的建议。这样，您可以在花费太多时间实现之前与维护者讨论是否有意义添加该功能。

新功能通常应该附带测试和文档或示例。没有后者，用户将很难发现您的新功能。

对代码的更改应该以向后兼容的方式实现。例如，在功能合并后，现有代码应该继续以相同的方式工作。
