# æ•°æ®é›† ðŸ¤ Arrow

> åŽŸæ–‡é“¾æŽ¥ï¼š[`huggingface.co/docs/datasets/about_arrow`](https://huggingface.co/docs/datasets/about_arrow)

## Arrow æ˜¯ä»€ä¹ˆï¼Ÿ

[Arrow](https://arrow.apache.org/)ä½¿å¤§é‡æ•°æ®èƒ½å¤Ÿå¿«é€Ÿå¤„ç†å’Œç§»åŠ¨ã€‚å®ƒæ˜¯ä¸€ç§ç‰¹å®šçš„æ•°æ®æ ¼å¼ï¼Œä»¥åˆ—å¼å†…å­˜å¸ƒå±€å­˜å‚¨æ•°æ®ã€‚è¿™æä¾›äº†å‡ ä¸ªé‡è¦ä¼˜åŠ¿ï¼š

+   Arrow çš„æ ‡å‡†æ ¼å¼å…è®¸[é›¶æ‹·è´è¯»å–](https://en.wikipedia.org/wiki/Zero-copy)ï¼Œä»Žè€Œæ¶ˆé™¤äº†å‡ ä¹Žæ‰€æœ‰çš„åºåˆ—åŒ–å¼€é”€ã€‚

+   Arrow æ˜¯ä¸Žè¯­è¨€æ— å…³çš„ï¼Œå› æ­¤æ”¯æŒä¸åŒçš„ç¼–ç¨‹è¯­è¨€ã€‚

+   Arrow æ˜¯é¢å‘åˆ—çš„ï¼Œå› æ­¤åœ¨æŸ¥è¯¢å’Œå¤„ç†æ•°æ®çš„åˆ‡ç‰‡æˆ–åˆ—æ—¶æ›´å¿«ã€‚

+   Arrow å…è®¸æ— æ‹·è´åœ°å°†æ•°æ®ä¼ é€’ç»™æ ‡å‡†çš„æœºå™¨å­¦ä¹ å·¥å…·ï¼Œå¦‚ NumPyã€Pandasã€PyTorch å’Œ TensorFlowã€‚

+   Arrow æ”¯æŒè®¸å¤šå¯èƒ½æ˜¯åµŒå¥—çš„åˆ—ç±»åž‹ã€‚

## å†…å­˜æ˜ å°„

ðŸ¤— æ•°æ®é›†ä½¿ç”¨ Arrow ä½œä¸ºå…¶æœ¬åœ°ç¼“å­˜ç³»ç»Ÿã€‚å®ƒå…è®¸æ•°æ®é›†ç”±ä¸€ä¸ªåœ¨ç£ç›˜ä¸Šçš„ç¼“å­˜æ”¯æŒï¼Œè¯¥ç¼“å­˜ä¸ºå¿«é€ŸæŸ¥æ‰¾è€Œè¿›è¡Œäº†å†…å­˜æ˜ å°„ã€‚è¿™ç§æž¶æž„å…è®¸åœ¨è®¾å¤‡å†…å­˜ç›¸å¯¹è¾ƒå°çš„æœºå™¨ä¸Šä½¿ç”¨å¤§åž‹æ•°æ®é›†ã€‚

ä¾‹å¦‚ï¼ŒåŠ è½½å®Œæ•´çš„è‹±æ–‡ç»´åŸºç™¾ç§‘æ•°æ®é›†åªéœ€è¦å‡  MB çš„ RAMï¼š

```py
>>> import os; import psutil; import timeit
>>> from datasets import load_dataset

# Process.memory_info is expressed in bytes, so convert to megabytes 
>>> mem_before = psutil.Process(os.getpid()).memory_info().rss / (1024 * 1024)
>>> wiki = load_dataset("wikipedia", "20220301.en", split="train")
>>> mem_after = psutil.Process(os.getpid()).memory_info().rss / (1024 * 1024)

>>> print(f"RAM memory used: {(mem_after - mem_before)} MB")
RAM memory used: 50 MB
```

è¿™æ˜¯å¯èƒ½çš„ï¼Œå› ä¸º Arrow æ•°æ®å®žé™…ä¸Šæ˜¯ä»Žç£ç›˜å†…å­˜æ˜ å°„çš„ï¼Œè€Œä¸æ˜¯åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å†…å­˜æ˜ å°„å…è®¸è®¿é—®ç£ç›˜ä¸Šçš„æ•°æ®ï¼Œå¹¶åˆ©ç”¨è™šæ‹Ÿå†…å­˜åŠŸèƒ½è¿›è¡Œå¿«é€ŸæŸ¥æ‰¾ã€‚

## æ€§èƒ½

ä½¿ç”¨ Arrow è¿­ä»£å†…å­˜æ˜ å°„æ•°æ®é›†å¾ˆå¿«ã€‚åœ¨ç¬”è®°æœ¬ç”µè„‘ä¸Šè¿­ä»£ç»´åŸºç™¾ç§‘å¯ä»¥è¾¾åˆ° 1-3 Gbit/s çš„é€Ÿåº¦ï¼š

```py
>>> s = """batch_size = 1000
... for batch in wiki.iter(batch_size):
...     ...
... """

>>> elapsed_time = timeit.timeit(stmt=s, number=1, globals=globals())
>>> print(f"Time to iterate over the {wiki.dataset_size >> 30} GB dataset: {elapsed_time:.1f} sec, "
...       f"ie. {float(wiki.dataset_size >> 27)/elapsed_time:.1f} Gb/s")
Time to iterate over the 18 GB dataset: 31.8 sec, ie. 4.8 Gb/s
```
