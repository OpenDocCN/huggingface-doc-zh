# UNet2DModel

> åŸæ–‡é“¾æ¥: [https://huggingface.co/docs/diffusers/api/models/unet2d](https://huggingface.co/docs/diffusers/api/models/unet2d)

[UNet](https://huggingface.co/papers/1505.04597) æ¨¡å‹æœ€åˆç”±Ronnebergerç­‰äººæå‡ºï¼Œç”¨äºç”Ÿç‰©åŒ»å­¦å›¾åƒåˆ†å‰²ï¼Œä½†å®ƒä¹Ÿå¸¸ç”¨äºğŸ¤— Diffusersï¼Œå› ä¸ºå®ƒè¾“å‡ºä¸è¾“å…¥ç›¸åŒå¤§å°çš„å›¾åƒã€‚å®ƒæ˜¯æ‰©æ•£ç³»ç»Ÿä¸­æœ€é‡è¦çš„ç»„ä»¶ä¹‹ä¸€ï¼Œå› ä¸ºå®ƒä¿ƒè¿›äº†å®é™…çš„æ‰©æ•£è¿‡ç¨‹ã€‚åœ¨ğŸ¤— Diffusersä¸­æœ‰å‡ ä¸ªUNetæ¨¡å‹çš„å˜ä½“ï¼Œå–å†³äºå…¶ç»´åº¦æ•°é‡ä»¥åŠæ˜¯å¦æ˜¯æ¡ä»¶æ¨¡å‹ã€‚è¿™æ˜¯ä¸€ä¸ª2D UNetæ¨¡å‹ã€‚

è®ºæ–‡æ‘˜è¦å¦‚ä¸‹:

*æœ‰å¾ˆå¤§çš„å…±è¯†ï¼ŒæˆåŠŸè®­ç»ƒæ·±åº¦ç½‘ç»œéœ€è¦æˆåƒä¸Šä¸‡ä¸ªæ³¨é‡Šçš„è®­ç»ƒæ ·æœ¬ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§ä¾èµ–äºå¼ºå¤§æ•°æ®å¢å¼ºçš„ç½‘ç»œå’Œè®­ç»ƒç­–ç•¥ï¼Œä»¥æ›´æœ‰æ•ˆåœ°åˆ©ç”¨å¯ç”¨çš„æ³¨é‡Šæ ·æœ¬ã€‚è¯¥æ¶æ„ç”±ä¸€ä¸ªæ”¶ç¼©è·¯å¾„å’Œä¸€ä¸ªå¯¹ç§°æ‰©å±•è·¯å¾„ç»„æˆï¼Œç”¨äºæ•è·ä¸Šä¸‹æ–‡å’Œå®ç°ç²¾ç¡®çš„å®šä½ã€‚æˆ‘ä»¬å±•ç¤ºäº†è¿™æ ·ä¸€ä¸ªç½‘ç»œå¯ä»¥ä»å¾ˆå°‘çš„å›¾åƒä¸­è¿›è¡Œç«¯åˆ°ç«¯çš„è®­ç»ƒï¼Œå¹¶ä¸”åœ¨ISBIæŒ‘æˆ˜ä¸­ï¼ˆç”¨äºç”µå­æ˜¾å¾®é•œå †ä¸­ç¥ç»å…ƒç»“æ„çš„åˆ†å‰²ï¼‰ä¸Šèƒœè¿‡å…ˆå‰æœ€ä½³æ–¹æ³•ï¼ˆæ»‘åŠ¨çª—å£å·ç§¯ç½‘ç»œï¼‰ã€‚ä½¿ç”¨ç›¸åŒçš„ç½‘ç»œåœ¨é€å°„å…‰å­¦æ˜¾å¾®é•œå›¾åƒï¼ˆç›¸å·®å’ŒDICï¼‰ä¸Šè®­ç»ƒï¼Œæˆ‘ä»¬åœ¨è¿™äº›ç±»åˆ«ä¸Šä»¥å¾ˆå¤§çš„ä¼˜åŠ¿èµ¢å¾—äº†2015å¹´çš„ISBIç»†èƒè·Ÿè¸ªæŒ‘æˆ˜ã€‚æ­¤å¤–ï¼Œè¯¥ç½‘ç»œé€Ÿåº¦å¾ˆå¿«ã€‚å¯¹512x512å›¾åƒçš„åˆ†å‰²åœ¨æœ€æ–°çš„GPUä¸Šä¸åˆ°ä¸€ç§’ã€‚å®Œæ•´çš„å®ç°ï¼ˆåŸºäºCaffeï¼‰å’Œè®­ç»ƒçš„ç½‘ç»œå¯åœ¨[http://lmb.informatik.uni-freiburg.de/people/ronneber/u-net](http://lmb.informatik.uni-freiburg.de/people/ronneber/u-net)ä¸Šè·å¾—ã€‚*

## UNet2DModel

### `class diffusers.UNet2DModel`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/unets/unet_2d.py#L40)

```py
( sample_size: Union = None in_channels: int = 3 out_channels: int = 3 center_input_sample: bool = False time_embedding_type: str = 'positional' freq_shift: int = 0 flip_sin_to_cos: bool = True down_block_types: Tuple = ('DownBlock2D', 'AttnDownBlock2D', 'AttnDownBlock2D', 'AttnDownBlock2D') up_block_types: Tuple = ('AttnUpBlock2D', 'AttnUpBlock2D', 'AttnUpBlock2D', 'UpBlock2D') block_out_channels: Tuple = (224, 448, 672, 896) layers_per_block: int = 2 mid_block_scale_factor: float = 1 downsample_padding: int = 1 downsample_type: str = 'conv' upsample_type: str = 'conv' dropout: float = 0.0 act_fn: str = 'silu' attention_head_dim: Optional = 8 norm_num_groups: int = 32 attn_norm_num_groups: Optional = None norm_eps: float = 1e-05 resnet_time_scale_shift: str = 'default' add_attention: bool = True class_embed_type: Optional = None num_class_embeds: Optional = None num_train_timesteps: Optional = None )
```

å‚æ•°

+   `sample_size` (`int` æˆ– `Tuple[int, int]`, *å¯é€‰*, é»˜è®¤ä¸º`None`) â€” è¾“å…¥/è¾“å‡ºæ ·æœ¬çš„é«˜åº¦å’Œå®½åº¦ã€‚ç»´åº¦å¿…é¡»æ˜¯`2 ** (len(block_out_channels) - 1)`çš„å€æ•°ã€‚

+   `in_channels` (`int`, *å¯é€‰*, é»˜è®¤ä¸º3) â€” è¾“å…¥æ ·æœ¬ä¸­çš„é€šé“æ•°ã€‚

+   `out_channels` (`int`, *å¯é€‰*, é»˜è®¤ä¸º3) â€” è¾“å‡ºä¸­çš„é€šé“æ•°ã€‚

+   `center_input_sample` (`bool`, *å¯é€‰*, é»˜è®¤ä¸º`False`) â€” æ˜¯å¦å°†è¾“å…¥æ ·æœ¬å±…ä¸­ã€‚

+   `time_embedding_type` (`str`, *å¯é€‰*, é»˜è®¤ä¸º`"positional"`) â€” è¦ä½¿ç”¨çš„æ—¶é—´åµŒå…¥ç±»å‹ã€‚

+   `freq_shift` (`int`, *å¯é€‰*, é»˜è®¤ä¸º0) â€” å‚…ç«‹å¶æ—¶é—´åµŒå…¥çš„é¢‘ç§»ã€‚

+   `flip_sin_to_cos` (`bool`, *å¯é€‰*, é»˜è®¤ä¸º`True`) â€” æ˜¯å¦å°†æ­£å¼¦ç¿»è½¬ä¸ºä½™å¼¦ä»¥ç”¨äºå‚…ç«‹å¶æ—¶é—´åµŒå…¥ã€‚

+   `down_block_types` (`Tuple[str]`, *å¯é€‰*, é»˜è®¤ä¸º`("DownBlock2D", "AttnDownBlock2D", "AttnDownBlock2D", "AttnDownBlock2D")`) â€” ä¸‹é‡‡æ ·å—ç±»å‹çš„å…ƒç»„ã€‚

+   `mid_block_type` (`str`, *å¯é€‰*, é»˜è®¤ä¸º`"UNetMidBlock2D"`) â€” UNetä¸­é—´å—çš„ç±»å‹ï¼Œå¯ä»¥æ˜¯`UNetMidBlock2D`æˆ–`UnCLIPUNetMidBlock2D`ã€‚

+   `up_block_types` (`Tuple[str]`, *å¯é€‰*, é»˜è®¤ä¸º`("AttnUpBlock2D", "AttnUpBlock2D", "AttnUpBlock2D", "UpBlock2D")`) â€” ä¸Šé‡‡æ ·å—ç±»å‹çš„å…ƒç»„ã€‚

+   `block_out_channels` (`Tuple[int]`, *å¯é€‰*, é»˜è®¤ä¸º`(224, 448, 672, 896)`) â€” å—è¾“å‡ºé€šé“çš„å…ƒç»„ã€‚

+   `layers_per_block` (`int`, *å¯é€‰*, é»˜è®¤ä¸º`2`) â€” æ¯ä¸ªå—çš„å±‚æ•°ã€‚

+   `mid_block_scale_factor` (`float`, *å¯é€‰*, é»˜è®¤ä¸º`1`) â€” ä¸­é—´å—çš„æ¯”ä¾‹å› å­ã€‚

+   `downsample_padding` (`int`, *å¯é€‰*, é»˜è®¤ä¸º`1`) â€” ä¸‹é‡‡æ ·å·ç§¯çš„å¡«å……ã€‚

+   `downsample_type` (`str`, *å¯é€‰*, é»˜è®¤ä¸º`conv`) â€” ä¸‹é‡‡æ ·å±‚çš„ä¸‹é‡‡æ ·ç±»å‹ã€‚é€‰æ‹©`conv`æˆ–â€œresnetâ€ä¹‹é—´ã€‚

+   `upsample_type` (`str`, *å¯é€‰*, é»˜è®¤ä¸º`conv`) â€” ä¸Šé‡‡æ ·å±‚çš„ä¸Šé‡‡æ ·ç±»å‹ã€‚é€‰æ‹©`conv`æˆ–â€œresnetâ€ä¹‹é—´ã€‚

+   `dropout` (`float`, *optional*, defaults to 0.0) â€” è¦ä½¿ç”¨çš„ dropout æ¦‚ç‡ã€‚

+   `act_fn` (`str`, *optional*, defaults to `"silu"`) â€” è¦ä½¿ç”¨çš„æ¿€æ´»å‡½æ•°ã€‚

+   `attention_head_dim` (`int`, *optional*, defaults to `8`) â€” æ³¨æ„åŠ›å¤´ç»´åº¦ã€‚

+   `norm_num_groups` (`int`, *optional*, defaults to `32`) â€” è§„èŒƒåŒ–çš„ç»„æ•°ã€‚

+   `attn_norm_num_groups` (`int`, *optional*, defaults to `None`) â€” å¦‚æœè®¾ç½®ä¸ºæ•´æ•°ï¼Œåˆ™åœ¨ä¸­é—´å—çš„ `Attention` å±‚ä¸­åˆ›å»ºä¸€ä¸ªç»„è§„èŒƒåŒ–å±‚ï¼Œå…·æœ‰ç»™å®šçš„ç»„æ•°ã€‚å¦‚æœä¿æŒä¸º `None`ï¼Œåˆ™ä»…å½“ `resnet_time_scale_shift` è®¾ç½®ä¸º `default` æ—¶æ‰ä¼šåˆ›å»ºç»„è§„èŒƒåŒ–å±‚ï¼Œå¦‚æœåˆ›å»ºï¼Œå°†å…·æœ‰ `norm_num_groups` ç»„ã€‚

+   `norm_eps` (`float`, *optional*, defaults to `1e-5`) â€” è§„èŒƒåŒ–çš„ epsilonã€‚

+   `resnet_time_scale_shift` (`str`, *optional*, defaults to `"default"`) â€” ResNet å—çš„æ—¶é—´å°ºåº¦åç§»é…ç½®ï¼ˆå‚è§ `ResnetBlock2D`ï¼‰ã€‚å¯é€‰æ‹© `default` æˆ– `scale_shift`ã€‚

+   `class_embed_type` (`str`, *optional*, defaults to `None`) â€” è¦ä½¿ç”¨çš„ç±»åˆ«åµŒå…¥ç±»å‹ï¼Œæœ€ç»ˆå°†ä¸æ—¶é—´åµŒå…¥ç›¸åŠ ã€‚å¯é€‰æ‹© `None`ã€`"timestep"` æˆ– `"identity"`ã€‚

+   `num_class_embeds` (`int`, *optional*, defaults to `None`) â€” å½“æ‰§è¡Œç±»åˆ«æ¡ä»¶åŒ–æ—¶ï¼Œå¯å­¦ä¹ åµŒå…¥çŸ©é˜µçš„è¾“å…¥ç»´åº¦ï¼Œå°†è¢«æŠ•å½±åˆ° `time_embed_dim`ï¼Œå¹¶ä¸” `class_embed_type` ç­‰äº `None`ã€‚

ä¸€ä¸ªæ¥å—å˜ˆæ‚æ ·æœ¬å’Œæ—¶é—´æ­¥é•¿å¹¶è¿”å›ä¸€ä¸ªå½¢çŠ¶ä¸ºæ ·æœ¬çš„ UNet æ¨¡å‹ã€‚

æ­¤æ¨¡å‹ç»§æ‰¿è‡ª [ModelMixin](/docs/diffusers/v0.26.3/en/api/models/overview#diffusers.ModelMixin)ã€‚æŸ¥çœ‹è¶…ç±»æ–‡æ¡£ä»¥äº†è§£ä¸ºæ‰€æœ‰æ¨¡å‹å®ç°çš„é€šç”¨æ–¹æ³•ï¼ˆå¦‚ä¸‹è½½æˆ–ä¿å­˜ï¼‰ã€‚

#### `forward`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/unets/unet_2d.py#L243)

```py
( sample: FloatTensor timestep: Union class_labels: Optional = None return_dict: bool = True ) â†’ export const metadata = 'undefined';~models.unet_2d.UNet2DOutput or tuple
```

å‚æ•°

+   `sample` (`torch.FloatTensor`ï¼‰ â€” å…·æœ‰ä»¥ä¸‹å½¢çŠ¶çš„å˜ˆæ‚è¾“å…¥å¼ é‡ `(batch, channel, height, width)`ã€‚

+   `timestep` (`torch.FloatTensor` æˆ– `float` æˆ– `int`) â€” ç”¨äºå»å™ªè¾“å…¥çš„æ—¶é—´æ­¥æ•°ã€‚

+   `class_labels` (`torch.FloatTensor`, *optional*, defaults to `None`) â€” ç”¨äºæ¡ä»¶åŒ–çš„å¯é€‰ç±»åˆ«æ ‡ç­¾ã€‚å®ƒä»¬çš„åµŒå…¥å°†ä¸æ—¶é—´æ­¥åµŒå…¥ç›¸åŠ ã€‚

+   `return_dict` (`bool`, *optional*, defaults to `True`) â€” æ˜¯å¦è¿”å›ä¸€ä¸ª `~models.unet_2d.UNet2DOutput` è€Œä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„ tupleã€‚

è¿”å›

`~models.unet_2d.UNet2DOutput` æˆ– `tuple`

å¦‚æœ `return_dict` ä¸º Trueï¼Œåˆ™è¿”å›ä¸€ä¸ª `~models.unet_2d.UNet2DOutput`ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ª `tuple`ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ ·æœ¬å¼ é‡ã€‚

[UNet2DModel](/docs/diffusers/v0.26.3/en/api/models/unet2d#diffusers.UNet2DModel) çš„å‰å‘æ–¹æ³•ã€‚

## UNet2DOutput

### `class diffusers.models.unets.unet_2d.UNet2DOutput`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/unets/unet_2d.py#L27)

```py
( sample: FloatTensor )
```

å‚æ•°

+   `sample` (`torch.FloatTensor`ï¼Œå½¢çŠ¶ä¸º `(batch_size, num_channels, height, width)`ï¼‰ â€” æ¨¡å‹æœ€åä¸€å±‚çš„éšè—çŠ¶æ€è¾“å‡ºã€‚

[UNet2DModel](/docs/diffusers/v0.26.3/en/api/models/unet2d#diffusers.UNet2DModel) çš„è¾“å‡ºã€‚
