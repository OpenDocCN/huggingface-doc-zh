# ONNX Runtime

> åŸå§‹æ–‡æœ¬ï¼š[https://huggingface.co/docs/diffusers/optimization/onnx](https://huggingface.co/docs/diffusers/optimization/onnx)

ğŸ¤— [Optimum](https://github.com/huggingface/optimum)æä¾›äº†ä¸ONNX Runtimeå…¼å®¹çš„ç¨³å®šæ‰©æ•£ç®¡é“ã€‚æ‚¨éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ğŸ¤— Optimumä»¥æ”¯æŒONNX Runtimeï¼š

```py
pip install -q optimum["onnxruntime"]
```

æœ¬æŒ‡å—å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨ONNX Runtimeä¸ç¨³å®šæ‰©æ•£å’Œç¨³å®šæ‰©æ•£XLï¼ˆSDXLï¼‰ç®¡é“ã€‚

## ç¨³å®šæ‰©æ•£

è¦åŠ è½½å¹¶è¿è¡Œæ¨ç†ï¼Œè¯·ä½¿ç”¨[ORTStableDiffusionPipeline](https://huggingface.co/docs/optimum/v1.16.2/en/onnxruntime/package_reference/modeling_ort#optimum.onnxruntime.ORTStableDiffusionPipeline)ã€‚å¦‚æœæ‚¨æƒ³åŠ è½½PyTorchæ¨¡å‹å¹¶å°†å…¶å³æ—¶è½¬æ¢ä¸ºONNXæ ¼å¼ï¼Œè¯·è®¾ç½®`export=True`ï¼š

```py
from optimum.onnxruntime import ORTStableDiffusionPipeline

model_id = "runwayml/stable-diffusion-v1-5"
pipeline = ORTStableDiffusionPipeline.from_pretrained(model_id, export=True)
prompt = "sailing ship in storm by Leonardo da Vinci"
image = pipeline(prompt).images[0]
pipeline.save_pretrained("./onnx-stable-diffusion-v1-5")
```

åœ¨æ‰¹å¤„ç†ä¸­ç”Ÿæˆå¤šä¸ªæç¤ºä¼¼ä¹ä¼šå ç”¨å¤ªå¤šå†…å­˜ã€‚åœ¨æˆ‘ä»¬ç ”ç©¶æ­¤é—®é¢˜æ—¶ï¼Œæ‚¨å¯èƒ½éœ€è¦é€ä¸ªè¿­ä»£è€Œä¸æ˜¯æ‰¹å¤„ç†ã€‚

å°†ç®¡é“ä»¥ç¦»çº¿ONNXæ ¼å¼å¯¼å‡ºï¼Œå¹¶ç¨åç”¨äºæ¨ç†ï¼Œè¯·ä½¿ç”¨[`optimum-cli export`](https://huggingface.co/docs/optimum/main/en/exporters/onnx/usage_guides/export_a_model#exporting-a-model-to-onnx-using-the-cli)å‘½ä»¤ï¼š

```py
optimum-cli export onnx --model runwayml/stable-diffusion-v1-5 sd_v15_onnx/
```

ç„¶åæ‰§è¡Œæ¨ç†ï¼ˆæ‚¨ä¸å¿…å†æ¬¡æŒ‡å®š`export=True`ï¼‰ï¼š

```py
from optimum.onnxruntime import ORTStableDiffusionPipeline

model_id = "sd_v15_onnx"
pipeline = ORTStableDiffusionPipeline.from_pretrained(model_id)
prompt = "sailing ship in storm by Leonardo da Vinci"
image = pipeline(prompt).images[0]
```

![](../Images/fef3f7dc8a705f8b94622883fd936702.png)

æ‚¨å¯ä»¥åœ¨ğŸ¤— Optimum [æ–‡æ¡£](https://huggingface.co/docs/optimum/)ä¸­æ‰¾åˆ°æ›´å¤šç¤ºä¾‹ï¼Œå¹¶ä¸”æ”¯æŒæ–‡æœ¬åˆ°å›¾åƒã€å›¾åƒåˆ°å›¾åƒå’Œä¿®å¤çš„ç¨³å®šæ‰©æ•£ã€‚

## ç¨³å®šæ‰©æ•£XL

è¦åŠ è½½å¹¶è¿è¡ŒSDXLæ¨ç†ï¼Œè¯·ä½¿ç”¨[ORTStableDiffusionXLPipeline](https://huggingface.co/docs/optimum/v1.16.2/en/onnxruntime/package_reference/modeling_ort#optimum.onnxruntime.ORTStableDiffusionXLPipeline)ï¼š

```py
from optimum.onnxruntime import ORTStableDiffusionXLPipeline

model_id = "stabilityai/stable-diffusion-xl-base-1.0"
pipeline = ORTStableDiffusionXLPipeline.from_pretrained(model_id)
prompt = "sailing ship in storm by Leonardo da Vinci"
image = pipeline(prompt).images[0]
```

è¦å°†ç®¡é“ä»¥ONNXæ ¼å¼å¯¼å‡ºå¹¶ç¨åç”¨äºæ¨ç†ï¼Œè¯·ä½¿ç”¨[`optimum-cli export`](https://huggingface.co/docs/optimum/main/en/exporters/onnx/usage_guides/export_a_model#exporting-a-model-to-onnx-using-the-cli)å‘½ä»¤ï¼š

```py
optimum-cli export onnx --model stabilityai/stable-diffusion-xl-base-1.0 --task stable-diffusion-xl sd_xl_onnx/
```

æ”¯æŒæ–‡æœ¬åˆ°å›¾åƒå’Œå›¾åƒåˆ°å›¾åƒçš„SDXLæ ¼å¼ã€‚
