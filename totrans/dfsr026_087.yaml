- en: How to run Stable Diffusion with Core ML
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: å¦‚ä½•åœ¨Core MLä¸­è¿è¡Œç¨³å®šæ‰©æ•£
- en: 'Original text: [https://huggingface.co/docs/diffusers/optimization/coreml](https://huggingface.co/docs/diffusers/optimization/coreml)'
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸå§‹æ–‡æœ¬ï¼š[https://huggingface.co/docs/diffusers/optimization/coreml](https://huggingface.co/docs/diffusers/optimization/coreml)
- en: null
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: '[Core ML](https://developer.apple.com/documentation/coreml) is the model format
    and machine learning library supported by Apple frameworks. If you are interested
    in running Stable Diffusion models inside your macOS or iOS/iPadOS apps, this
    guide will show you how to convert existing PyTorch checkpoints into the Core
    ML format and use them for inference with Python or Swift.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: Core MLæ˜¯ç”±Appleæ¡†æ¶æ”¯æŒçš„æ¨¡å‹æ ¼å¼å’Œæœºå™¨å­¦ä¹ åº“ã€‚å¦‚æœæ‚¨æœ‰å…´è¶£åœ¨macOSæˆ–iOS/iPadOSåº”ç”¨ç¨‹åºä¸­è¿è¡ŒStable Diffusionæ¨¡å‹ï¼Œæœ¬æŒ‡å—å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•å°†ç°æœ‰çš„PyTorchæ£€æŸ¥ç‚¹è½¬æ¢ä¸ºCore
    MLæ ¼å¼ï¼Œå¹¶ä½¿ç”¨Pythonæˆ–Swiftè¿›è¡Œæ¨æ–­ã€‚
- en: 'Core ML models can leverage all the compute engines available in Apple devices:
    the CPU, the GPU, and the Apple Neural Engine (or ANE, a tensor-optimized accelerator
    available in Apple Silicon Macs and modern iPhones/iPads). Depending on the model
    and the device itâ€™s running on, Core ML can mix and match compute engines too,
    so some portions of the model may run on the CPU while others run on GPU, for
    example.'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Core MLæ¨¡å‹å¯ä»¥åˆ©ç”¨Appleè®¾å¤‡ä¸­çš„æ‰€æœ‰è®¡ç®—å¼•æ“ï¼šCPUã€GPUå’ŒAppleç¥ç»å¼•æ“ï¼ˆæˆ–ANEï¼Œä¸€ç§åœ¨Apple Silicon Macå’Œç°ä»£iPhone/iPadä¸­å¯ç”¨çš„å¼ é‡ä¼˜åŒ–åŠ é€Ÿå™¨ï¼‰ã€‚æ ¹æ®æ¨¡å‹å’Œè¿è¡Œè®¾å¤‡ï¼ŒCore
    MLä¹Ÿå¯ä»¥æ··åˆåŒ¹é…è®¡ç®—å¼•æ“ï¼Œå› æ­¤æ¨¡å‹çš„æŸäº›éƒ¨åˆ†å¯èƒ½åœ¨CPUä¸Šè¿è¡Œï¼Œè€Œå…¶ä»–éƒ¨åˆ†å¯èƒ½åœ¨GPUä¸Šè¿è¡Œï¼Œä¾‹å¦‚ã€‚
- en: You can also run the `diffusers` Python codebase on Apple Silicon Macs using
    the `mps` accelerator built into PyTorch. This approach is explained in depth
    in [the mps guide](mps), but it is not compatible with native apps.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨è¿˜å¯ä»¥åœ¨Apple Silicon Macä¸Šä½¿ç”¨å†…ç½®äºPyTorchä¸­çš„mpsåŠ é€Ÿå™¨è¿è¡Œ`diffusers` Pythonä»£ç åº“ã€‚è¿™ç§æ–¹æ³•åœ¨mpsæŒ‡å—ä¸­æœ‰è¯¦ç»†è¯´æ˜ï¼Œä½†ä¸å…¼å®¹æœ¬æœºåº”ç”¨ç¨‹åºã€‚
- en: Stable Diffusion Core ML Checkpoints
  id: totrans-6
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç¨³å®šæ‰©æ•£Core MLæ£€æŸ¥ç‚¹
- en: Stable Diffusion weights (or checkpoints) are stored in the PyTorch format,
    so you need to convert them to the Core ML format before we can use them inside
    native apps.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: ç¨³å®šæ‰©æ•£æƒé‡ï¼ˆæˆ–æ£€æŸ¥ç‚¹ï¼‰å­˜å‚¨åœ¨PyTorchæ ¼å¼ä¸­ï¼Œå› æ­¤æ‚¨éœ€è¦å°†å®ƒä»¬è½¬æ¢ä¸ºCore MLæ ¼å¼ï¼Œç„¶åæˆ‘ä»¬æ‰èƒ½åœ¨æœ¬æœºåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒä»¬ã€‚
- en: Thankfully, Apple engineers developed [a conversion tool](https://github.com/apple/ml-stable-diffusion#-converting-models-to-core-ml)
    based on `diffusers` to convert the PyTorch checkpoints to Core ML.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: å¹¸è¿çš„æ˜¯ï¼ŒAppleå·¥ç¨‹å¸ˆåŸºäº`diffusers`å¼€å‘äº†[ä¸€ä¸ªè½¬æ¢å·¥å…·](https://github.com/apple/ml-stable-diffusion#-converting-models-to-core-ml)ï¼Œç”¨äºå°†PyTorchæ£€æŸ¥ç‚¹è½¬æ¢ä¸ºCore
    MLã€‚
- en: 'Before you convert a model, though, take a moment to explore the Hugging Face
    Hub â€“ chances are the model youâ€™re interested in is already available in Core
    ML format:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è½¬æ¢æ¨¡å‹ä¹‹å‰ï¼Œè¯·èŠ±ç‚¹æ—¶é—´æ¢ç´¢Hugging Face Hub - ä½ æ„Ÿå…´è¶£çš„æ¨¡å‹å¾ˆå¯èƒ½å·²ç»ä»¥Core MLæ ¼å¼å¯ç”¨ï¼š
- en: the [Apple](https://huggingface.co/apple) organization includes Stable Diffusion
    versions 1.4, 1.5, 2.0 base, and 2.1 base
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Appleç»„ç»‡åŒ…æ‹¬ç¨³å®šæ‰©æ•£ç‰ˆæœ¬1.4ã€1.5ã€2.0åŸºç¡€å’Œ2.1åŸºç¡€
- en: '[coreml community](https://huggingface.co/coreml-community) includes custom
    finetuned models'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`coreml community`åŒ…æ‹¬è‡ªå®šä¹‰å¾®è°ƒæ¨¡å‹'
- en: use this [filter](https://huggingface.co/models?pipeline_tag=text-to-image&library=coreml&p=2&sort=likes)
    to return all available Core ML checkpoints
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨æ­¤è¿‡æ»¤å™¨è¿”å›æ‰€æœ‰å¯ç”¨çš„Core MLæ£€æŸ¥ç‚¹
- en: If you canâ€™t find the model youâ€™re interested in, we recommend you follow the
    instructions for [Converting Models to Core ML](https://github.com/apple/ml-stable-diffusion#-converting-models-to-core-ml)
    by Apple.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‰¾ä¸åˆ°æ‚¨æ„Ÿå…´è¶£çš„æ¨¡å‹ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨æŒ‰ç…§Appleæä¾›çš„[å°†æ¨¡å‹è½¬æ¢ä¸ºCore ML](https://github.com/apple/ml-stable-diffusion#-converting-models-to-core-ml)è¯´æ˜è¿›è¡Œæ“ä½œã€‚
- en: Selecting the Core ML Variant to Use
  id: totrans-14
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: é€‰æ‹©è¦ä½¿ç”¨çš„Core MLå˜ä½“
- en: 'Stable Diffusion models can be converted to different Core ML variants intended
    for different purposes:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: ç¨³å®šæ‰©æ•£æ¨¡å‹å¯ä»¥è½¬æ¢ä¸ºç”¨äºä¸åŒç›®çš„çš„ä¸åŒCore MLå˜ä½“ï¼š
- en: 'The type of attention blocks used. The attention operation is used to â€œpay
    attentionâ€ to the relationship between different areas in the image representations
    and to understand how the image and text representations are related. Attention
    is compute- and memory-intensive, so different implementations exist that consider
    the hardware characteristics of different devices. For Core ML Stable Diffusion
    models, there are two attention variants:'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨çš„æ³¨æ„åŠ›å—ç±»å‹ã€‚æ³¨æ„åŠ›æ“ä½œç”¨äºâ€œå…³æ³¨â€å›¾åƒè¡¨ç¤ºä¸­ä¸åŒåŒºåŸŸä¹‹é—´çš„å…³ç³»ï¼Œå¹¶ç†è§£å›¾åƒå’Œæ–‡æœ¬è¡¨ç¤ºä¹‹é—´çš„å…³ç³»ã€‚æ³¨æ„åŠ›æ˜¯è®¡ç®—å’Œå†…å­˜å¯†é›†å‹çš„ï¼Œå› æ­¤å­˜åœ¨ä¸åŒçš„å®ç°ï¼Œè€ƒè™‘äº†ä¸åŒè®¾å¤‡çš„ç¡¬ä»¶ç‰¹æ€§ã€‚å¯¹äºCore
    ML Stable Diffusionæ¨¡å‹ï¼Œæœ‰ä¸¤ç§æ³¨æ„åŠ›å˜ä½“ï¼š
- en: '`split_einsum` ([introduced by Apple](https://machinelearning.apple.com/research/neural-engine-transformers))
    is optimized for ANE devices, which is available in modern iPhones, iPads and
    M-series computers.'
  id: totrans-17
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`split_einsum`ï¼ˆç”±Appleå¼•å…¥ï¼‰ç»è¿‡ä¼˜åŒ–ï¼Œé€‚ç”¨äºç°ä»£iPhoneã€iPadå’ŒMç³»åˆ—è®¡ç®—æœºä¸­å¯ç”¨çš„ANEè®¾å¤‡ã€‚'
- en: The â€œoriginalâ€ attention (the base implementation used in `diffusers`) is only
    compatible with CPU/GPU and not ANE. It can be *faster* to run your model on CPU
    + GPU using `original` attention than ANE. See [this performance benchmark](https://huggingface.co/blog/fast-mac-diffusers#performance-benchmarks)
    as well as some [additional measures provided by the community](https://github.com/huggingface/swift-coreml-diffusers/issues/31)
    for additional details.
  id: totrans-18
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: â€œåŸå§‹â€æ³¨æ„åŠ›ï¼ˆåœ¨`diffusers`ä¸­ä½¿ç”¨çš„åŸºæœ¬å®ç°ï¼‰ä»…ä¸CPU/GPUå…¼å®¹ï¼Œè€Œä¸ä¸ANEå…¼å®¹ã€‚ä½¿ç”¨`original`æ³¨æ„åŠ›åœ¨CPU + GPUä¸Šè¿è¡Œæ¨¡å‹å¯èƒ½æ¯”ANEæ›´å¿«ã€‚æŸ¥çœ‹æ­¤æ€§èƒ½åŸºå‡†ä»¥åŠç¤¾åŒºæä¾›çš„ä¸€äº›å…¶ä»–æªæ–½ï¼Œä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚
- en: The supported inference framework.
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ”¯æŒçš„æ¨æ–­æ¡†æ¶ã€‚
- en: '`packages` are suitable for Python inference. This can be used to test converted
    Core ML models before attempting to integrate them inside native apps, or if you
    want to explore Core ML performance but donâ€™t need to support native apps. For
    example, an application with a web UI could perfectly use a Python Core ML backend.'
  id: totrans-20
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`packages`é€‚ç”¨äºPythonæ¨æ–­ã€‚è¿™å¯ä»¥ç”¨äºåœ¨å°è¯•å°†å…¶é›†æˆåˆ°æœ¬æœºåº”ç”¨ç¨‹åºä¹‹å‰æµ‹è¯•è½¬æ¢çš„Core MLæ¨¡å‹ï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³æ¢ç´¢Core MLæ€§èƒ½ä½†ä¸éœ€è¦æ”¯æŒæœ¬æœºåº”ç”¨ç¨‹åºã€‚ä¾‹å¦‚ï¼Œå…·æœ‰Web
    UIçš„åº”ç”¨ç¨‹åºå¯ä»¥å®Œç¾åœ°ä½¿ç”¨Python Core MLåç«¯ã€‚'
- en: '`compiled` models are required for Swift code. The `compiled` models in the
    Hub split the large UNet model weights into several files for compatibility with
    iOS and iPadOS devices. This corresponds to the [`--chunk-unet` conversion option](https://github.com/apple/ml-stable-diffusion#-converting-models-to-core-ml).
    If you want to support native apps, then you need to select the `compiled` variant.'
  id: totrans-21
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: Swiftä»£ç éœ€è¦`compiled`æ¨¡å‹ã€‚Hubä¸­çš„`compiled`æ¨¡å‹å°†å¤§å‹UNetæ¨¡å‹æƒé‡æ‹†åˆ†ä¸ºå‡ ä¸ªæ–‡ä»¶ï¼Œä»¥ä¾¿ä¸iOSå’ŒiPadOSè®¾å¤‡å…¼å®¹ã€‚è¿™å¯¹åº”äº[`--chunk-unet`è½¬æ¢é€‰é¡¹](https://github.com/apple/ml-stable-diffusion#-converting-models-to-core-ml)ã€‚å¦‚æœè¦æ”¯æŒåŸç”Ÿåº”ç”¨ç¨‹åºï¼Œåˆ™éœ€è¦é€‰æ‹©`compiled`å˜ä½“ã€‚
- en: 'The official Core ML Stable Diffusion [models](https://huggingface.co/apple/coreml-stable-diffusion-v1-4/tree/main)
    include these variants, but the community ones may vary:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: å®˜æ–¹çš„Core ML Stable Diffusion [æ¨¡å‹](https://huggingface.co/apple/coreml-stable-diffusion-v1-4/tree/main)åŒ…æ‹¬è¿™äº›å˜ä½“ï¼Œä½†ç¤¾åŒºçš„å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼š
- en: '[PRE0]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: You can download and use the variant you need as shown below.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼ä¸‹è½½å¹¶ä½¿ç”¨æ‚¨éœ€è¦çš„å˜ä½“ã€‚
- en: Core ML Inference in Python
  id: totrans-25
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Pythonä¸­çš„Core MLæ¨æ–­
- en: 'Install the following libraries to run Core ML inference in Python:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: å®‰è£…ä»¥ä¸‹åº“ä»¥åœ¨Pythonä¸­è¿è¡ŒCore MLæ¨æ–­ï¼š
- en: '[PRE1]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Download the Model Checkpoints
  id: totrans-28
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ä¸‹è½½æ¨¡å‹æ£€æŸ¥ç‚¹
- en: To run inference in Python, use one of the versions stored in the `packages`
    folders because the `compiled` ones are only compatible with Swift. You may choose
    whether you want to use `original` or `split_einsum` attention.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: è¦åœ¨Pythonä¸­è¿è¡Œæ¨æ–­ï¼Œè¯·ä½¿ç”¨å­˜å‚¨åœ¨`packages`æ–‡ä»¶å¤¹ä¸­çš„ç‰ˆæœ¬ï¼Œå› ä¸º`compiled`ç‰ˆæœ¬ä»…ä¸Swiftå…¼å®¹ã€‚æ‚¨å¯ä»¥é€‰æ‹©æ˜¯å¦è¦ä½¿ç”¨`original`æˆ–`split_einsum`æ³¨æ„åŠ›ã€‚
- en: 'This is how youâ€™d download the `original` attention variant from the Hub to
    a directory called `models`:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™æ˜¯æ‚¨å¦‚ä½•ä»Hubä¸‹è½½`original`æ³¨æ„åŠ›å˜ä½“åˆ°åä¸º`models`çš„ç›®å½•ä¸­ï¼š
- en: '[PRE2]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Inference
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: æ¨æ–­
- en: Once you have downloaded a snapshot of the model, you can test it using Appleâ€™s
    Python script.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦æ‚¨ä¸‹è½½äº†æ¨¡å‹çš„å¿«ç…§ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Appleçš„Pythonè„šæœ¬è¿›è¡Œæµ‹è¯•ã€‚
- en: '[PRE3]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Pass the path of the downloaded checkpoint with `-i` flag to the script. `--compute-unit`
    indicates the hardware you want to allow for inference. It must be one of the
    following options: `ALL`, `CPU_AND_GPU`, `CPU_ONLY`, `CPU_AND_NE`. You may also
    provide an optional output path, and a seed for reproducibility.'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨`-i`æ ‡å¿—å°†ä¸‹è½½çš„æ£€æŸ¥ç‚¹è·¯å¾„ä¼ é€’ç»™è„šæœ¬ã€‚`--compute-unit`æŒ‡ç¤ºæ‚¨è¦å…è®¸ç”¨äºæ¨æ–­çš„ç¡¬ä»¶ã€‚å®ƒå¿…é¡»æ˜¯ä»¥ä¸‹é€‰é¡¹ä¹‹ä¸€ï¼š`ALL`ã€`CPU_AND_GPU`ã€`CPU_ONLY`ã€`CPU_AND_NE`ã€‚æ‚¨è¿˜å¯ä»¥æä¾›å¯é€‰çš„è¾“å‡ºè·¯å¾„å’Œä¸€ä¸ªç”¨äºå¯é‡ç°æ€§çš„ç§å­ã€‚
- en: The inference script assumes youâ€™re using the original version of the Stable
    Diffusion model, `CompVis/stable-diffusion-v1-4`. If you use another model, you
    *have* to specify its Hub id in the inference command line, using the `--model-version`
    option. This works for models already supported and custom models you trained
    or fine-tuned yourself.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: æ¨æ–­è„šæœ¬å‡å®šæ‚¨æ­£åœ¨ä½¿ç”¨Stable Diffusionæ¨¡å‹çš„åŸå§‹ç‰ˆæœ¬ï¼Œ`CompVis/stable-diffusion-v1-4`ã€‚å¦‚æœæ‚¨ä½¿ç”¨å¦ä¸€ä¸ªæ¨¡å‹ï¼Œåˆ™*å¿…é¡»*åœ¨æ¨æ–­å‘½ä»¤è¡Œä¸­æŒ‡å®šå…¶Hub
    idï¼Œä½¿ç”¨`--model-version`é€‰é¡¹ã€‚è¿™é€‚ç”¨äºå·²æ”¯æŒçš„æ¨¡å‹å’Œæ‚¨è‡ªå·±è®­ç»ƒæˆ–å¾®è°ƒçš„è‡ªå®šä¹‰æ¨¡å‹ã€‚
- en: 'For example, if you want to use [`runwayml/stable-diffusion-v1-5`](https://huggingface.co/runwayml/stable-diffusion-v1-5):'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³ä½¿ç”¨[`runwayml/stable-diffusion-v1-5`](https://huggingface.co/runwayml/stable-diffusion-v1-5)ï¼š
- en: '[PRE4]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Core ML inference in Swift
  id: totrans-39
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Swiftä¸­çš„Core MLæ¨æ–­
- en: Running inference in Swift is slightly faster than in Python because the models
    are already compiled in the `mlmodelc` format. This is noticeable on app startup
    when the model is loaded but shouldnâ€™t be noticeable if you run several generations
    afterward.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨Swiftä¸­è¿è¡Œæ¨æ–­æ¯”åœ¨Pythonä¸­ç¨å¿«ï¼Œå› ä¸ºæ¨¡å‹å·²ç»ä»¥`mlmodelc`æ ¼å¼ç¼–è¯‘ã€‚è¿™åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶åŠ è½½æ¨¡å‹æ—¶ä¼šæœ‰æ‰€æ³¨æ„ï¼Œä½†å¦‚æœä¹‹åè¿è¡Œå‡ ä»£ï¼Œå°±ä¸åº”è¯¥æœ‰æ˜æ˜¾çš„æ„Ÿè§‰ã€‚
- en: Download
  id: totrans-41
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ä¸‹è½½
- en: 'To run inference in Swift on your Mac, you need one of the `compiled` checkpoint
    versions. We recommend you download them locally using Python code similar to
    the previous example, but with one of the `compiled` variants:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: è¦åœ¨Macä¸Šçš„Swiftä¸­è¿è¡Œæ¨æ–­ï¼Œæ‚¨éœ€è¦å…¶ä¸­ä¸€ä¸ª`compiled`æ£€æŸ¥ç‚¹ç‰ˆæœ¬ã€‚æˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨ç±»ä¼¼äºä¸Šä¸€ä¸ªç¤ºä¾‹çš„Pythonä»£ç åœ¨æœ¬åœ°ä¸‹è½½å®ƒä»¬ï¼Œä½†ä½¿ç”¨å…¶ä¸­ä¸€ä¸ª`compiled`å˜ä½“ï¼š
- en: '[PRE5]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Inference
  id: totrans-44
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: æ¨æ–­
- en: 'To run inference, please clone Appleâ€™s repo:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: è¦è¿è¡Œæ¨æ–­ï¼Œè¯·å…‹éš†Appleçš„å­˜å‚¨åº“ï¼š
- en: '[PRE6]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'And then use Appleâ€™s command line tool, [Swift Package Manager](https://www.swift.org/package-manager/#):'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åä½¿ç”¨Appleçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œ[Swift Package Manager](https://www.swift.org/package-manager/#)ï¼š
- en: '[PRE7]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'You have to specify in `--resource-path` one of the checkpoints downloaded
    in the previous step, so please make sure it contains compiled Core ML bundles
    with the extension `.mlmodelc`. The `--compute-units` has to be one of these values:
    `all`, `cpuOnly`, `cpuAndGPU`, `cpuAndNeuralEngine`.'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨`--resource-path`ä¸­æŒ‡å®šåœ¨ä¸Šä¸€æ­¥ä¸­ä¸‹è½½çš„æ£€æŸ¥ç‚¹ä¹‹ä¸€ï¼Œå› æ­¤è¯·ç¡®ä¿å®ƒåŒ…å«æ‰©å±•åä¸º`.mlmodelc`çš„å·²ç¼–è¯‘çš„Core MLæ†ç»‘åŒ…ã€‚`--compute-units`å¿…é¡»æ˜¯ä»¥ä¸‹å€¼ä¹‹ä¸€ï¼š`all`ã€`cpuOnly`ã€`cpuAndGPU`ã€`cpuAndNeuralEngine`ã€‚
- en: For more details, please refer to the [instructions in Appleâ€™s repo](https://github.com/apple/ml-stable-diffusion).
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒ[Appleå­˜å‚¨åº“ä¸­çš„è¯´æ˜](https://github.com/apple/ml-stable-diffusion)ã€‚
- en: Supported Diffusers Features
  id: totrans-51
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ”¯æŒçš„DiffusersåŠŸèƒ½
- en: 'The Core ML models and inference code donâ€™t support many of the features, options,
    and flexibility of ğŸ§¨ Diffusers. These are some of the limitations to keep in mind:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: Core MLæ¨¡å‹å’Œæ¨æ–­ä»£ç ä¸æ”¯æŒğŸ§¨ Diffusersçš„è®¸å¤šåŠŸèƒ½ã€é€‰é¡¹å’Œçµæ´»æ€§ã€‚è¿™äº›æ˜¯éœ€è¦ç‰¢è®°çš„ä¸€äº›é™åˆ¶ï¼š
- en: Core ML models are only suitable for inference. They canâ€™t be used for training
    or fine-tuning.
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Core MLæ¨¡å‹ä»…é€‚ç”¨äºæ¨æ–­ã€‚å®ƒä»¬ä¸èƒ½ç”¨äºè®­ç»ƒæˆ–å¾®è°ƒã€‚
- en: Only two schedulers have been ported to Swift, the default one used by Stable
    Diffusion and `DPMSolverMultistepScheduler`, which we ported to Swift from our
    `diffusers` implementation. We recommend you use `DPMSolverMultistepScheduler`,
    since it produces the same quality in about half the steps.
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: åªæœ‰ä¸¤ä¸ªè°ƒåº¦ç¨‹åºå·²ç»ç§»æ¤åˆ°Swiftï¼Œä¸€ä¸ªæ˜¯Stable Diffusionä½¿ç”¨çš„é»˜è®¤è°ƒåº¦ç¨‹åºï¼Œå¦ä¸€ä¸ªæ˜¯æˆ‘ä»¬ä»æˆ‘ä»¬çš„`diffusers`å®ç°ä¸­ç§»æ¤åˆ°Swiftçš„`DPMSolverMultistepScheduler`ã€‚æˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨`DPMSolverMultistepScheduler`ï¼Œå› ä¸ºå®ƒåœ¨å¤§çº¦ä¸€åŠçš„æ­¥éª¤ä¸­äº§ç”Ÿç›¸åŒçš„è´¨é‡ã€‚
- en: Negative prompts, classifier-free guidance scale, and image-to-image tasks are
    available in the inference code. Advanced features such as depth guidance, ControlNet,
    and latent upscalers are not available yet.
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: è´Ÿé¢æç¤ºã€æ— åˆ†ç±»å™¨æŒ‡å¯¼æ¯”ä¾‹å’Œå›¾åƒåˆ°å›¾åƒä»»åŠ¡åœ¨æ¨æ–­ä»£ç ä¸­å¯ç”¨ã€‚é«˜çº§åŠŸèƒ½ï¼Œå¦‚æ·±åº¦æŒ‡å¯¼ã€ControlNetå’Œæ½œåœ¨çš„æ”¾å¤§å™¨ç›®å‰è¿˜ä¸å¯ç”¨ã€‚
- en: Appleâ€™s [conversion and inference repo](https://github.com/apple/ml-stable-diffusion)
    and our own [swift-coreml-diffusers](https://github.com/huggingface/swift-coreml-diffusers)
    repos are intended as technology demonstrators to enable other developers to build
    upon.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: è‹¹æœçš„[è½¬æ¢å’Œæ¨ç†å­˜å‚¨åº“](https://github.com/apple/ml-stable-diffusion)å’Œæˆ‘ä»¬è‡ªå·±çš„[swift-coreml-diffusers](https://github.com/huggingface/swift-coreml-diffusers)å­˜å‚¨åº“æ—¨åœ¨ä½œä¸ºæŠ€æœ¯æ¼”ç¤ºï¼Œä»¥ä½¿å…¶ä»–å¼€å‘äººå‘˜èƒ½å¤Ÿæ„å»ºåœ¨å…¶åŸºç¡€ä¸Šã€‚
- en: If you feel strongly about any missing features, please feel free to open a
    feature request or, better yet, a contribution PR ğŸ™‚.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨å¯¹ä»»ä½•ç¼ºå¤±çš„åŠŸèƒ½æ„Ÿåˆ°å¼ºçƒˆï¼Œè¯·éšæ—¶æå‡ºåŠŸèƒ½è¯·æ±‚æˆ–æ›´å¥½åœ°æäº¤è´¡çŒ® PRğŸ™‚ã€‚
- en: Native Diffusers Swift app
  id: totrans-58
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æœ¬åœ°æ‰©æ•£å™¨ Swift åº”ç”¨ç¨‹åº
- en: One easy way to run Stable Diffusion on your own Apple hardware is to use [our
    open-source Swift repo](https://github.com/huggingface/swift-coreml-diffusers),
    based on `diffusers` and Appleâ€™s conversion and inference repo. You can study
    the code, compile it with [Xcode](https://developer.apple.com/xcode/) and adapt
    it for your own needs. For your convenience, thereâ€™s also a [standalone Mac app
    in the App Store](https://apps.apple.com/app/diffusers/id1666309574), so you can
    play with it without having to deal with the code or IDE. If you are a developer
    and have determined that Core ML is the best solution to build your Stable Diffusion
    app, then you can use the rest of this guide to get started with your project.
    We canâ€™t wait to see what youâ€™ll build ğŸ™‚.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æ‚¨è‡ªå·±çš„è‹¹æœç¡¬ä»¶ä¸Šè¿è¡Œ Stable Diffusion çš„ä¸€ç§ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨[æˆ‘ä»¬çš„å¼€æº Swift å­˜å‚¨åº“](https://github.com/huggingface/swift-coreml-diffusers)ï¼ŒåŸºäº
    `diffusers` å’Œè‹¹æœçš„è½¬æ¢å’Œæ¨ç†å­˜å‚¨åº“ã€‚æ‚¨å¯ä»¥ç ”ç©¶ä»£ç ï¼Œä½¿ç”¨[Xcode](https://developer.apple.com/xcode/)ç¼–è¯‘å®ƒï¼Œå¹¶æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œè¿˜æœ‰ä¸€ä¸ª[ç‹¬ç«‹çš„
    Mac åº”ç”¨ç¨‹åºåœ¨ App Store ä¸­](https://apps.apple.com/app/diffusers/id1666309574)ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥åœ¨ä¸å¿…å¤„ç†ä»£ç æˆ–
    IDE çš„æƒ…å†µä¸‹è¿›è¡Œæ“ä½œã€‚å¦‚æœæ‚¨æ˜¯å¼€å‘äººå‘˜ï¼Œå¹¶ä¸”å·²ç¡®å®š Core ML æ˜¯æ„å»º Stable Diffusion åº”ç”¨ç¨‹åºçš„æœ€ä½³è§£å†³æ–¹æ¡ˆï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä½¿ç”¨æœ¬æŒ‡å—çš„å…¶ä½™éƒ¨åˆ†å¼€å§‹æ‚¨çš„é¡¹ç›®ã€‚æˆ‘ä»¬è¿«ä¸åŠå¾…åœ°æƒ³çœ‹åˆ°æ‚¨å°†ä¼šæ„å»ºçš„å†…å®¹ğŸ™‚ã€‚
