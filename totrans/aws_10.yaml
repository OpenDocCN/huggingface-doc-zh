- en: Create your own chatbot with llama-2-13B on AWS Inferentia
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: åœ¨AWS Inferentiaä¸Šä½¿ç”¨llama-2-13Båˆ›å»ºæ‚¨è‡ªå·±çš„èŠå¤©æœºå™¨äºº
- en: 'Original text: [https://huggingface.co/docs/optimum-neuron/tutorials/llama2-13b-chatbot](https://huggingface.co/docs/optimum-neuron/tutorials/llama2-13b-chatbot)'
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸå§‹æ–‡æœ¬ï¼š[https://huggingface.co/docs/optimum-neuron/tutorials/llama2-13b-chatbot](https://huggingface.co/docs/optimum-neuron/tutorials/llama2-13b-chatbot)
- en: null
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: '*There is a notebook version of that tutorial [here](https://github.com/huggingface/optimum-neuron/blob/main/notebooks/text-generation/llama2-13b-chatbot.ipynb)*.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '*è¿™é‡Œæœ‰ä¸€ä¸ªç¬”è®°æœ¬ç‰ˆæœ¬çš„æ•™ç¨‹[é“¾æ¥](https://github.com/huggingface/optimum-neuron/blob/main/notebooks/text-generation/llama2-13b-chatbot.ipynb)*ã€‚'
- en: This guide will detail how to export, deploy and run a **LLama-2 13B** chat
    model on AWS inferentia.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨AWS inferentiaä¸Šå¯¼å‡ºã€éƒ¨ç½²å’Œè¿è¡Œ**LLama-2 13B**èŠå¤©æ¨¡å‹ã€‚
- en: 'You will learn how to:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨å°†å­¦ä¹ å¦‚ä½•ï¼š
- en: export the Llama-2 model to the Neuron format,
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å°†Llama-2æ¨¡å‹å¯¼å‡ºä¸ºNeuronæ ¼å¼ï¼Œ
- en: push the exported model to the Hugging Face Hub,
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å°†å¯¼å‡ºçš„æ¨¡å‹æ¨é€åˆ°Hugging Face Hubï¼Œ
- en: deploy the model and use it in a chat application.
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: éƒ¨ç½²æ¨¡å‹å¹¶åœ¨èŠå¤©åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒã€‚
- en: 'Note: This tutorial was created on a inf2.48xlarge AWS EC2 Instance.'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„ï¼šæœ¬æ•™ç¨‹æ˜¯åœ¨ä¸€ä¸ªinf2.48xlargeçš„AWS EC2å®ä¾‹ä¸Šåˆ›å»ºçš„ã€‚
- en: 1\. Export the Llama 2 model to Neuron
  id: totrans-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1\. å°†Llama 2æ¨¡å‹å¯¼å‡ºåˆ°Neuron
- en: For this guide, we will use the non-gated [NousResearch/Llama-2-13b-chat-hf](https://huggingface.co/NousResearch/Llama-2-13b-chat-hf)
    model, which is functionally equivalent to the original [meta-llama/Llama-2-13b-chat-hf](https://huggingface.co/meta-llama/Llama-2-13b-chat-hf).
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨éé—¨æ§[NousResearch/Llama-2-13b-chat-hf](https://huggingface.co/NousResearch/Llama-2-13b-chat-hf)æ¨¡å‹ï¼Œå®ƒåœ¨åŠŸèƒ½ä¸Šç­‰åŒäºåŸå§‹çš„[meta-llama/Llama-2-13b-chat-hf](https://huggingface.co/meta-llama/Llama-2-13b-chat-hf)æ¨¡å‹ã€‚
- en: This model is part of the **Llama 2** family of models, and has been tuned to
    recognize chat interactions between a *user* and an *assistant* (more on that
    later).
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: è¯¥æ¨¡å‹æ˜¯**Llama 2**ç³»åˆ—æ¨¡å‹çš„ä¸€éƒ¨åˆ†ï¼Œå·²ç»è°ƒæ•´ä¸ºè¯†åˆ«*ç”¨æˆ·*å’Œ*åŠ©æ‰‹*ä¹‹é—´çš„èŠå¤©äº’åŠ¨ï¼ˆç¨åä¼šè¯¦ç»†ä»‹ç»ï¼‰ã€‚
- en: As explained in the [optimum-neuron documentation](https://huggingface.co/docs/optimum-neuron/guides/export_model#why-compile-to-neuron-model)
    , models need to be compiled and exported to a serialized format before running
    them on Neuron devices.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚[æœ€ä½³ç¥ç»å…ƒæ–‡æ¡£](https://huggingface.co/docs/optimum-neuron/guides/export_model#why-compile-to-neuron-model)ä¸­æ‰€è§£é‡Šçš„ï¼Œæ¨¡å‹éœ€è¦åœ¨Neuronè®¾å¤‡ä¸Šè¿è¡Œä¹‹å‰è¢«ç¼–è¯‘å’Œå¯¼å‡ºä¸ºåºåˆ—åŒ–æ ¼å¼ã€‚
- en: Fortunately, ğŸ¤— **optimum-neuron** offers a [very simple API](https://huggingface.co/docs/optimum-neuron/guides/models#configuring-the-export-of-a-generative-model)
    to export standard ğŸ¤— [transformers models](https://huggingface.co/docs/transformers/index)
    to the Neuron format.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: å¹¸è¿çš„æ˜¯ï¼ŒğŸ¤— **optimum-neuron** æä¾›äº†ä¸€ä¸ªéå¸¸ç®€å•çš„ [API](https://huggingface.co/docs/optimum-neuron/guides/models#configuring-the-export-of-a-generative-model)
    æ¥å°†æ ‡å‡† ğŸ¤— [transformers æ¨¡å‹](https://huggingface.co/docs/transformers/index) å¯¼å‡ºä¸ºNeuronæ ¼å¼ã€‚
- en: 'When exporting the model, we will specify two sets of parameters:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨å¯¼å‡ºæ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬å°†æŒ‡å®šä¸¤ç»„å‚æ•°ï¼š
- en: using *compiler_args*, we specify on how many cores we want the model to be
    deployed (each neuron device has two cores), and with which precision (here *float16*),
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨*compiler_args*ï¼Œæˆ‘ä»¬æŒ‡å®šè¦éƒ¨ç½²æ¨¡å‹çš„æ ¸å¿ƒæ•°ï¼ˆæ¯ä¸ªç¥ç»å…ƒè®¾å¤‡æœ‰ä¸¤ä¸ªæ ¸å¿ƒï¼‰ï¼Œä»¥åŠç²¾åº¦ï¼ˆè¿™é‡Œæ˜¯*float16*ï¼‰ï¼Œ
- en: using *input_shapes*, we set the static input and output dimensions of the model.
    All model compilers require static shapes, and neuron makes no exception. Note
    that the *sequence_length* not only constrains the length of the input context,
    but also the length of the Key/Value cache, and thus, the output length.
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨*input_shapes*ï¼Œæˆ‘ä»¬è®¾ç½®æ¨¡å‹çš„é™æ€è¾“å…¥å’Œè¾“å‡ºç»´åº¦ã€‚æ‰€æœ‰æ¨¡å‹ç¼–è¯‘å™¨éƒ½éœ€è¦é™æ€å½¢çŠ¶ï¼Œç¥ç»å…ƒä¹Ÿä¸ä¾‹å¤–ã€‚è¯·æ³¨æ„ï¼Œ*sequence_length*ä¸ä»…é™åˆ¶äº†è¾“å…¥ä¸Šä¸‹æ–‡çš„é•¿åº¦ï¼Œè¿˜é™åˆ¶äº†Key/Valueç¼“å­˜çš„é•¿åº¦ï¼Œå› æ­¤ä¹Ÿé™åˆ¶äº†è¾“å‡ºé•¿åº¦ã€‚
- en: Depending on your choice of parameters and inferentia host, this may take from
    a few minutes to more than an hour.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: æ ¹æ®æ‚¨é€‰æ‹©çš„å‚æ•°å’Œinferentiaä¸»æœºï¼Œè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿåˆ°ä¸€ä¸ªå¤šå°æ—¶çš„æ—¶é—´ã€‚
- en: For your convenience, we host a pre-compiled version of that model on the Hugging
    Face hub, so you can skip the export and start using the model immediately in
    section 2.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬åœ¨Hugging Face hubä¸Šæ‰˜ç®¡äº†è¯¥æ¨¡å‹çš„é¢„ç¼–è¯‘ç‰ˆæœ¬ï¼Œå› æ­¤æ‚¨å¯ä»¥è·³è¿‡å¯¼å‡ºå¹¶ç«‹å³åœ¨ç¬¬2èŠ‚ä¸­å¼€å§‹ä½¿ç”¨è¯¥æ¨¡å‹ã€‚
- en: '[PRE0]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: This will probably take a while.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´ã€‚
- en: Fortunately, you will need to do this only once because you can save your model
    and reload it later.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: å¹¸è¿çš„æ˜¯ï¼Œæ‚¨åªéœ€è¦åšä¸€æ¬¡è¿™ä¸ªæ“ä½œï¼Œå› ä¸ºæ‚¨å¯ä»¥ä¿å­˜æ‚¨çš„æ¨¡å‹å¹¶ç¨åé‡æ–°åŠ è½½å®ƒã€‚
- en: '[PRE1]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Even better, you can push it to the [Hugging Face hub](https://huggingface.co/models).
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: æ›´å¥½çš„æ˜¯ï¼Œæ‚¨å¯ä»¥å°†å…¶æ¨é€åˆ°[Hugging Face hub](https://huggingface.co/models)ã€‚
- en: For that, you need to be logged in to a [HuggingFace account](https://huggingface.co/join).
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦ç™»å½•åˆ°[HuggingFaceå¸æˆ·](https://huggingface.co/join)ã€‚
- en: 'In the terminal, just type the following command and paste your Hugging Face
    token when requested:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ç»ˆç«¯ä¸­ï¼Œåªéœ€è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå¹¶åœ¨è¯·æ±‚æ—¶ç²˜è´´æ‚¨çš„Hugging Faceä»¤ç‰Œï¼š
- en: '[PRE2]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: By default, the model will be uploaded to your account (organization equal to
    your user name).
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨¡å‹å°†ä¸Šä¼ åˆ°æ‚¨çš„å¸æˆ·ï¼ˆç»„ç»‡ç­‰äºæ‚¨çš„ç”¨æˆ·åï¼‰ã€‚
- en: Feel free to edit the code below if you want to upload the model to a specific
    [Hugging Face organization](https://huggingface.co/docs/hub/organizations).
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨æƒ³å°†æ¨¡å‹ä¸Šä¼ åˆ°ç‰¹å®šçš„[Hugging Faceç»„ç»‡](https://huggingface.co/docs/hub/organizations)ï¼Œè¯·éšæ„ç¼–è¾‘ä¸‹é¢çš„ä»£ç ã€‚
- en: '[PRE3]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: A few more words about export parameters.
  id: totrans-31
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: å…³äºå¯¼å‡ºå‚æ•°çš„æ›´å¤šè¯´æ˜ã€‚
- en: 'The minimum memory required to load a model can be computed with:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: åŠ è½½æ¨¡å‹æ‰€éœ€çš„æœ€å°å†…å­˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¡ç®—ï¼š
- en: '[PRE4]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The **Llama 2 13B** model uses *float16* weights (stored on 2 bytes) and has
    13 billion parameters, which means it requires at least 2 * 13B or ~26GB of memory
    to store its weights.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '**Llama 2 13B**æ¨¡å‹ä½¿ç”¨*float16*æƒé‡ï¼ˆå­˜å‚¨åœ¨2å­—èŠ‚ä¸­ï¼‰ï¼Œæœ‰130äº¿å‚æ•°ï¼Œè¿™æ„å‘³ç€è‡³å°‘éœ€è¦2 * 13Bæˆ–~26GBçš„å†…å­˜æ¥å­˜å‚¨å…¶æƒé‡ã€‚'
- en: Each NeuronCore has 16GB of memory which means that a 26GB model cannot fit
    on a single NeuronCore.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: æ¯ä¸ªNeuronCoreæœ‰16GBçš„å†…å­˜ï¼Œè¿™æ„å‘³ç€26GBçš„æ¨¡å‹æ— æ³•æ”¾å…¥å•ä¸ªNeuronCoreä¸­ã€‚
- en: In reality, the total space required is much greater than just the number of
    parameters due to caching attention layer projections (KV caching). This caching
    mechanism grows memory allocations linearly with sequence length and batch size.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: å®é™…ä¸Šï¼Œç”±äºç¼“å­˜æ³¨æ„åŠ›å±‚æŠ•å½±ï¼ˆKVç¼“å­˜ï¼‰ï¼Œæ‰€éœ€çš„æ€»ç©ºé—´è¿œè¿œå¤§äºå‚æ•°æ•°é‡ã€‚è¿™ç§ç¼“å­˜æœºåˆ¶ä¼šéšç€åºåˆ—é•¿åº¦å’Œæ‰¹é‡å¤§å°çº¿æ€§å¢é•¿å†…å­˜åˆ†é…ã€‚
- en: Here we set the *batch_size* to 1, meaning that we can only process one input
    prompt in parallel. We set the *sequence_length* to 2048, which corresponds to
    half the model maximum capacity (4096).
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†*batch_size*è®¾ç½®ä¸º1ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åªèƒ½å¹¶è¡Œå¤„ç†ä¸€ä¸ªè¾“å…¥æç¤ºã€‚æˆ‘ä»¬å°†*sequence_length*è®¾ç½®ä¸º2048ï¼Œè¿™å¯¹åº”äºæ¨¡å‹æœ€å¤§å®¹é‡çš„ä¸€åŠï¼ˆ4096ï¼‰ã€‚
- en: The formula to evaluate the size of the KV cache is more involved as it also
    depends on parameters related to the model architecture, such as the width of
    the embeddings and the number of decoder blocks.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: è¯„ä¼°KVç¼“å­˜å¤§å°çš„å…¬å¼æ›´å¤æ‚ï¼Œå› ä¸ºå®ƒè¿˜å–å†³äºä¸æ¨¡å‹æ¶æ„ç›¸å…³çš„å‚æ•°ï¼Œæ¯”å¦‚åµŒå…¥çš„å®½åº¦å’Œè§£ç å™¨å—çš„æ•°é‡ã€‚
- en: Bottom-line is, to get very large language models to fit, tensor parallelism
    is used to split weights, data, and compute across multiple NeuronCores, keeping
    in mind that the memory on each core cannot exceed 16GB.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: æ€»çš„æ¥è¯´ï¼Œä¸ºäº†ä½¿éå¸¸å¤§çš„è¯­è¨€æ¨¡å‹é€‚åº”ï¼Œå¼ é‡å¹¶è¡Œæ€§è¢«ç”¨æ¥åœ¨å¤šä¸ªNeuronCoresä¹‹é—´åˆ†å‰²æƒé‡ã€æ•°æ®å’Œè®¡ç®—ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ¯ä¸ªæ ¸å¿ƒä¸Šçš„å†…å­˜ä¸èƒ½è¶…è¿‡16GBã€‚
- en: Note that increasing the number of cores beyond the minimum requirement almost
    always results in a faster model. Increasing the tensor parallelism degree improves
    memory bandwidth which improves model performance.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ï¼Œå°†æ ¸å¿ƒæ•°é‡å¢åŠ åˆ°æœ€ä½è¦æ±‚ä¹‹ä¸Šå‡ ä¹æ€»æ˜¯ä¼šå¯¼è‡´æ¨¡å‹è¿è¡Œæ›´å¿«ã€‚å¢åŠ å¼ é‡å¹¶è¡Œåº¦ä¼šæé«˜å†…å­˜å¸¦å®½ï¼Œä»è€Œæé«˜æ¨¡å‹æ€§èƒ½ã€‚
- en: To optimize performance itâ€™s recommended to use all cores available on the instance.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œå»ºè®®ä½¿ç”¨å®ä¾‹ä¸Šæ‰€æœ‰å¯ç”¨çš„æ ¸å¿ƒã€‚
- en: In this guide we use all the 24 cores of the *inf2.48xlarge*, but this should
    be changed to 12 if you are using a *inf2.24xlarge* instance.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨*inf2.48xlarge*çš„æ‰€æœ‰24ä¸ªæ ¸å¿ƒï¼Œä½†å¦‚æœæ‚¨ä½¿ç”¨*inf2.24xlarge*å®ä¾‹ï¼Œåˆ™åº”å°†å…¶æ›´æ”¹ä¸º12ä¸ªæ ¸å¿ƒã€‚
- en: 2\. Generate text using Llama 2 on AWS Inferentia2
  id: totrans-43
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 2. åœ¨AWS Inferentia2ä¸Šä½¿ç”¨Llama 2ç”Ÿæˆæ–‡æœ¬
- en: Once your model has been exported, you can generate text using the transformers
    library, as it has been described in [detail in this post](https://huggingface.co/blog/how-to-generate).
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦æ‚¨çš„æ¨¡å‹è¢«å¯¼å‡ºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨transformersåº“ç”Ÿæˆæ–‡æœ¬ï¼Œå¦‚åœ¨[è¿™ç¯‡æ–‡ç« ](https://huggingface.co/blog/how-to-generate)ä¸­è¯¦ç»†æè¿°çš„ã€‚
- en: 'If as suggested you skipped the first section, donâ€™t worry: we will use a precompiled
    model already present on the hub instead.'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨æŒ‰ç…§å»ºè®®è·³è¿‡äº†ç¬¬ä¸€éƒ¨åˆ†ï¼Œä¸ç”¨æ‹…å¿ƒï¼šæˆ‘ä»¬å°†ä½¿ç”¨hubä¸Šå·²ç»å­˜åœ¨çš„é¢„ç¼–è¯‘æ¨¡å‹ã€‚
- en: '[PRE5]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: We will need a *Llama 2* tokenizer to convert the prompt strings to text tokens.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å°†éœ€è¦ä¸€ä¸ª*Llama 2*åˆ†è¯å™¨å°†æç¤ºå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ–‡æœ¬æ ‡è®°ã€‚
- en: '[PRE6]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The following generation strategies are supported:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: æ”¯æŒä»¥ä¸‹ç”Ÿæˆç­–ç•¥ï¼š
- en: greedy search,
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: è´ªå©ªæœç´¢ï¼Œ
- en: multinomial sampling with top-k and top-p (with temperature).
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨top-kå’Œtop-pï¼ˆå¸¦æœ‰æ¸©åº¦ï¼‰çš„å¤šé¡¹å¼é‡‡æ ·ã€‚
- en: Most logits pre-processing/filters (such as repetition penalty) are supported.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: å¤§å¤šæ•°å¯¹æ•°é¢„å¤„ç†/è¿‡æ»¤ï¼ˆå¦‚é‡å¤æƒ©ç½šï¼‰éƒ½å—æ”¯æŒã€‚
- en: '[PRE7]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 3\. Create a chat application using llama on AWS Inferentia2
  id: totrans-54
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 3. åœ¨AWS Inferentia2ä¸Šä½¿ç”¨llamaåˆ›å»ºèŠå¤©åº”ç”¨
- en: We specifically selected a **Llama 2** chat variant to illustrate the excellent
    behaviour of the exported model when the length of the encoding context grows.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ç‰¹æ„é€‰æ‹©äº†**Llama 2**èŠå¤©å˜ä½“ï¼Œä»¥å±•ç¤ºå¯¼å‡ºæ¨¡å‹åœ¨ç¼–ç ä¸Šä¸‹æ–‡é•¿åº¦å¢åŠ æ—¶çš„å‡ºè‰²è¡Œä¸ºã€‚
- en: The model expects the prompts to be formatted following a specific template
    corresponding to the interactions between a *user* role and an *assistant* role.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: æ¨¡å‹æœŸæœ›æç¤ºæŒ‰ç…§ç‰¹å®šæ¨¡æ¿æ ¼å¼åŒ–ï¼Œè¯¥æ¨¡æ¿å¯¹åº”äº*ç”¨æˆ·*è§’è‰²å’Œ*åŠ©æ‰‹*è§’è‰²ä¹‹é—´çš„äº’åŠ¨ã€‚
- en: Each chat model has its own convention for encoding such contents, and we will
    not go into too much details in this guide, because we will directly use the [Hugging
    Face chat templates](https://huggingface.co/blog/chat-templates) corresponding
    to our model.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: æ¯ä¸ªèŠå¤©æ¨¡å‹éƒ½æœ‰è‡ªå·±çš„çº¦å®šæ¥ç¼–ç è¿™äº›å†…å®¹ï¼Œæˆ‘ä»¬åœ¨æœ¬æŒ‡å—ä¸­ä¸ä¼šè¯¦ç»†ä»‹ç»ï¼Œå› ä¸ºæˆ‘ä»¬å°†ç›´æ¥ä½¿ç”¨ä¸æˆ‘ä»¬çš„æ¨¡å‹å¯¹åº”çš„[Hugging FaceèŠå¤©æ¨¡æ¿](https://huggingface.co/blog/chat-templates)ã€‚
- en: The utility function below converts a list of exchanges between the user and
    the model into a well-formatted chat prompt.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸‹é¢çš„å®ç”¨å‡½æ•°å°†æŠŠç”¨æˆ·å’Œæ¨¡å‹ä¹‹é—´çš„äº¤æµåˆ—è¡¨è½¬æ¢ä¸ºæ ¼å¼è‰¯å¥½çš„èŠå¤©æç¤ºã€‚
- en: '[PRE8]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: We are now equipped to build a simplistic chat application.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½æ„å»ºä¸€ä¸ªç®€å•çš„èŠå¤©åº”ç”¨ç¨‹åºã€‚
- en: We simply store the interactions between the user and the assistant in a list
    that we use to generate the input prompt.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬ç®€å•åœ°å°†ç”¨æˆ·å’ŒåŠ©æ‰‹ä¹‹é—´çš„äº’åŠ¨å­˜å‚¨åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªåˆ—è¡¨æ¥ç”Ÿæˆè¾“å…¥æç¤ºã€‚
- en: '[PRE9]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'To test the chat application you can use for instance the following sequence
    of prompts:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: è¦æµ‹è¯•èŠå¤©åº”ç”¨ç¨‹åºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æç¤ºåºåˆ—ï¼š
- en: '[PRE10]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: <Warning>
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: <è­¦å‘Š>
- en: While very powerful, Large language models can sometimes *hallucinate*. We call
    *hallucinations* generated content that is irrelevant or made-up but presented
    by the model as if it was accurate. This is a flaw of LLMs and is not a side effect
    of using them on Trainium / Inferentia.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: å°½ç®¡éå¸¸å¼ºå¤§ï¼Œå¤§å‹è¯­è¨€æ¨¡å‹æœ‰æ—¶å¯èƒ½ä¼šâ€œå¹»è§‰â€ã€‚æˆ‘ä»¬ç§°ç”Ÿæˆçš„å†…å®¹ä¸ºâ€œå¹»è§‰â€ï¼Œå¦‚æœå†…å®¹ä¸ä¸»é¢˜æ— å…³æˆ–æ˜¯è™šæ„çš„ï¼Œä½†æ¨¡å‹å‘ˆç°å‡ºæ¥çš„å¥½åƒæ˜¯å‡†ç¡®çš„ã€‚è¿™æ˜¯LLMçš„ä¸€ä¸ªç¼ºé™·ï¼Œä¸æ˜¯åœ¨Trainium
    / Inferentiaä¸Šä½¿ç”¨å®ƒä»¬çš„å‰¯ä½œç”¨ã€‚
- en: </Warning>
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: </è­¦å‘Š>
