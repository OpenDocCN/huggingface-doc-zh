- en: Cache management
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç¼“å­˜ç®¡ç†
- en: 'Original text: [https://huggingface.co/docs/datasets/cache](https://huggingface.co/docs/datasets/cache)'
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸå§‹æ–‡æœ¬ï¼š[https://huggingface.co/docs/datasets/cache](https://huggingface.co/docs/datasets/cache)
- en: null
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: When you download a dataset, the processing scripts and data are stored locally
    on your computer. The cache allows ğŸ¤— Datasets to avoid re-downloading or processing
    the entire dataset every time you use it.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: å½“æ‚¨ä¸‹è½½æ•°æ®é›†æ—¶ï¼Œå¤„ç†è„šæœ¬å’Œæ•°æ®ä¼šå­˜å‚¨åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šã€‚ç¼“å­˜å…è®¸ğŸ¤— æ•°æ®é›†é¿å…æ¯æ¬¡ä½¿ç”¨æ—¶é‡æ–°ä¸‹è½½æˆ–å¤„ç†æ•´ä¸ªæ•°æ®é›†ã€‚
- en: 'This guide will show you how to:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: æœ¬æŒ‡å—å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ï¼š
- en: Change the cache directory.
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ›´æ”¹ç¼“å­˜ç›®å½•ã€‚
- en: Control how a dataset is loaded from the cache.
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ§åˆ¶æ•°æ®é›†ä»ç¼“å­˜ä¸­åŠ è½½çš„æ–¹å¼ã€‚
- en: Clean up cache files in the directory.
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ¸…ç†ç›®å½•ä¸­çš„ç¼“å­˜æ–‡ä»¶ã€‚
- en: Enable or disable caching.
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¯ç”¨æˆ–ç¦ç”¨ç¼“å­˜ã€‚
- en: Cache directory
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç¼“å­˜ç›®å½•
- en: 'The default cache directory is `~/.cache/huggingface/datasets`. Change the
    cache location by setting the shell environment variable, `HF_DATASETS_CACHE`
    to another directory:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: é»˜è®¤ç¼“å­˜ç›®å½•æ˜¯`~/.cache/huggingface/datasets`ã€‚é€šè¿‡è®¾ç½®shellç¯å¢ƒå˜é‡`HF_DATASETS_CACHE`åˆ°å¦ä¸€ä¸ªç›®å½•æ¥æ›´æ”¹ç¼“å­˜ä½ç½®ï¼š
- en: '[PRE0]'
  id: totrans-11
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'When you load a dataset, you also have the option to change where the data
    is cached. Change the `cache_dir` parameter to the path you want:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: åŠ è½½æ•°æ®é›†æ—¶ï¼Œæ‚¨è¿˜å¯ä»¥æ›´æ”¹æ•°æ®ç¼“å­˜çš„ä½ç½®ã€‚å°†`cache_dir`å‚æ•°æ›´æ”¹ä¸ºæ‚¨æƒ³è¦çš„è·¯å¾„ï¼š
- en: '[PRE1]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Similarly, you can change where a metric is cached with the `cache_dir` parameter:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: åŒæ ·ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`cache_dir`å‚æ•°æ›´æ”¹æŒ‡æ ‡çš„ç¼“å­˜ä½ç½®ï¼š
- en: '[PRE2]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Download mode
  id: totrans-16
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä¸‹è½½æ¨¡å¼
- en: 'After you download a dataset, control how it is loaded by [load_dataset()](/docs/datasets/v2.17.0/en/package_reference/loading_methods#datasets.load_dataset)
    with the `download_mode` parameter. By default, ğŸ¤— Datasets will reuse a dataset
    if it exists. But if you need the original dataset without any processing functions
    applied, re-download the files as shown below:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸‹è½½æ•°æ®é›†åï¼Œé€šè¿‡[load_dataset()](/docs/datasets/v2.17.0/en/package_reference/loading_methods#datasets.load_dataset)çš„`download_mode`å‚æ•°æ§åˆ¶æ•°æ®é›†çš„åŠ è½½æ–¹å¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒğŸ¤—
    æ•°æ®é›†å°†é‡ç”¨æ•°æ®é›†ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨éœ€è¦åŸå§‹æ•°æ®é›†è€Œæ²¡æœ‰åº”ç”¨ä»»ä½•å¤„ç†å‡½æ•°ï¼Œåˆ™æŒ‰ç…§ä¸‹é¢æ‰€ç¤ºé‡æ–°ä¸‹è½½æ–‡ä»¶ï¼š
- en: '[PRE3]'
  id: totrans-18
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Refer to [DownloadMode](/docs/datasets/v2.17.0/en/package_reference/builder_classes#datasets.DownloadMode)
    for a full list of download modes.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: å‚è€ƒ[DownloadMode](/docs/datasets/v2.17.0/en/package_reference/builder_classes#datasets.DownloadMode)è·å–ä¸‹è½½æ¨¡å¼çš„å®Œæ•´åˆ—è¡¨ã€‚
- en: Cache files
  id: totrans-20
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç¼“å­˜æ–‡ä»¶
- en: 'Clean up the cache files in the directory with [Dataset.cleanup_cache_files()](/docs/datasets/v2.17.0/en/package_reference/main_classes#datasets.Dataset.cleanup_cache_files):'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: é€šè¿‡[Dataset.cleanup_cache_files()](/docs/datasets/v2.17.0/en/package_reference/main_classes#datasets.Dataset.cleanup_cache_files)æ¸…ç†ç›®å½•ä¸­çš„ç¼“å­˜æ–‡ä»¶ï¼š
- en: '[PRE4]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Enable or disable caching
  id: totrans-23
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å¯ç”¨æˆ–ç¦ç”¨ç¼“å­˜
- en: 'If youâ€™re using a cached file locally, it will automatically reload the dataset
    with any previous transforms you applied to the dataset. Disable this behavior
    by setting the argument `load_from_cache_file=False` in [Dataset.map()](/docs/datasets/v2.17.0/en/package_reference/main_classes#datasets.Dataset.map):'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨åœ¨æœ¬åœ°ä½¿ç”¨ç¼“å­˜æ–‡ä»¶ï¼Œåˆ™å®ƒå°†è‡ªåŠ¨é‡æ–°åŠ è½½æ•°æ®é›†ï¼Œå¹¶åº”ç”¨åˆ°æ•°æ®é›†çš„ä»»ä½•å…ˆå‰è½¬æ¢ã€‚é€šè¿‡åœ¨[Dataset.map()](/docs/datasets/v2.17.0/en/package_reference/main_classes#datasets.Dataset.map)ä¸­è®¾ç½®å‚æ•°`load_from_cache_file=False`æ¥ç¦ç”¨æ­¤è¡Œä¸ºï¼š
- en: '[PRE5]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: In the example above, ğŸ¤— Datasets will execute the function `add_prefix` over
    the entire dataset again instead of loading the dataset from its previous state.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒğŸ¤— æ•°æ®é›†å°†å†æ¬¡åœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šæ‰§è¡Œå‡½æ•°`add_prefix`ï¼Œè€Œä¸æ˜¯ä»å…¶å…ˆå‰çŠ¶æ€åŠ è½½æ•°æ®é›†ã€‚
- en: 'Disable caching on a global scale with [disable_caching()](/docs/datasets/v2.17.0/en/package_reference/main_classes#datasets.disable_caching):'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: é€šè¿‡[disable_caching()](/docs/datasets/v2.17.0/en/package_reference/main_classes#datasets.disable_caching)åœ¨å…¨å±€èŒƒå›´å†…ç¦ç”¨ç¼“å­˜ï¼š
- en: '[PRE6]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: When you disable caching, ğŸ¤— Datasets will no longer reload cached files when
    applying transforms to datasets. Any transform you apply on your dataset will
    be need to be reapplied.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: å½“ç¦ç”¨ç¼“å­˜æ—¶ï¼ŒğŸ¤— æ•°æ®é›†åœ¨å¯¹æ•°æ®é›†åº”ç”¨è½¬æ¢æ—¶å°†ä¸å†é‡æ–°åŠ è½½ç¼“å­˜æ–‡ä»¶ã€‚æ‚¨å¯¹æ•°æ®é›†åº”ç”¨çš„ä»»ä½•è½¬æ¢éƒ½éœ€è¦é‡æ–°åº”ç”¨ã€‚
- en: If you want to reuse a dataset from scratch, try setting the `download_mode`
    parameter in [load_dataset()](/docs/datasets/v2.17.0/en/package_reference/loading_methods#datasets.load_dataset)
    instead.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨æƒ³ä»å¤´å¼€å§‹é‡ç”¨æ•°æ®é›†ï¼Œè¯·å°è¯•åœ¨[load_dataset()](/docs/datasets/v2.17.0/en/package_reference/loading_methods#datasets.load_dataset)ä¸­è®¾ç½®`download_mode`å‚æ•°ã€‚
- en: 'You can also avoid caching your metric entirely, and keep it in CPU memory
    instead:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨è¿˜å¯ä»¥å®Œå…¨é¿å…ç¼“å­˜æŒ‡æ ‡ï¼Œå¹¶å°†å…¶ä¿ç•™åœ¨CPUå†…å­˜ä¸­ï¼š
- en: '[PRE7]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Keeping the predictions in-memory is not possible in a distributed setting since
    the CPU memory spaces of the various processes are not shared.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨åˆ†å¸ƒå¼è®¾ç½®ä¸­ï¼Œç”±äºå„ä¸ªè¿›ç¨‹çš„CPUå†…å­˜ç©ºé—´ä¸å…±äº«ï¼Œæ— æ³•å°†é¢„æµ‹ä¿ç•™åœ¨å†…å­˜ä¸­ã€‚
- en: Improve performance
  id: totrans-34
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æé«˜æ€§èƒ½
- en: 'Disabling the cache and copying the dataset in-memory will speed up dataset
    operations. There are two options for copying the dataset in-memory:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: ç¦ç”¨ç¼“å­˜å¹¶å°†æ•°æ®é›†å¤åˆ¶åˆ°å†…å­˜ä¸­å°†åŠ å¿«æ•°æ®é›†æ“ä½œã€‚æœ‰ä¸¤ç§é€‰é¡¹å¯ä»¥å°†æ•°æ®é›†å¤åˆ¶åˆ°å†…å­˜ä¸­ï¼š
- en: Set `datasets.config.IN_MEMORY_MAX_SIZE` to a nonzero value (in bytes) that
    fits in your RAM memory.
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å°†`datasets.config.IN_MEMORY_MAX_SIZE`è®¾ç½®ä¸ºé€‚åˆRAMå†…å­˜çš„éé›¶å€¼ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚
- en: Set the environment variable `HF_DATASETS_IN_MEMORY_MAX_SIZE` to a nonzero value.
    Note that the first method takes higher precedence.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å°†ç¯å¢ƒå˜é‡`HF_DATASETS_IN_MEMORY_MAX_SIZE`è®¾ç½®ä¸ºéé›¶å€¼ã€‚è¯·æ³¨æ„ï¼Œç¬¬ä¸€ç§æ–¹æ³•ä¼˜å…ˆçº§æ›´é«˜ã€‚
