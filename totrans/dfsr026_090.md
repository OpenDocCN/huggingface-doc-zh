# Habana Gaudi

> åŸå§‹æ–‡æœ¬ï¼š[`huggingface.co/docs/diffusers/optimization/habana`](https://huggingface.co/docs/diffusers/optimization/habana)

ğŸ¤— Diffusers é€šè¿‡ğŸ¤— [Optimum](https://huggingface.co/docs/optimum/habana/usage_guides/stable_diffusion)ä¸ Habana Gaudi å…¼å®¹ã€‚æŒ‰ç…§[å®‰è£…](https://docs.habana.ai/en/latest/Installation_Guide/index.html)æŒ‡å—å®‰è£… SynapseAI å’Œ Gaudi é©±åŠ¨ç¨‹åºï¼Œç„¶åå®‰è£… Optimum Habanaï¼š

```py
python -m pip install --upgrade-strategy eager optimum[habana]
```

ä½¿ç”¨ Gaudi ä¸Šçš„ Stable Diffusion 1 å’Œ 2 ç”Ÿæˆå›¾åƒï¼Œæ‚¨éœ€è¦å®ä¾‹åŒ–ä¸¤ä¸ªå®ä¾‹ï¼š

+   `GaudiStableDiffusionPipeline`ï¼Œä¸€ä¸ªç”¨äºæ–‡æœ¬åˆ°å›¾åƒç”Ÿæˆçš„ç®¡é“ã€‚

+   `GaudiDDIMScheduler`ï¼Œä¸€ä¸ªç»è¿‡ä¼˜åŒ–çš„ Gaudi è°ƒåº¦å™¨ã€‚

å½“æ‚¨åˆå§‹åŒ–ç®¡é“æ—¶ï¼Œå¿…é¡»æŒ‡å®š`use_habana=True`ä»¥åœ¨ HPUs ä¸Šéƒ¨ç½²å®ƒï¼Œå¹¶ä¸”ä¸ºäº†è·å¾—å°½å¯èƒ½å¿«çš„ç”Ÿæˆé€Ÿåº¦ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨`use_hpu_graphs=True`å¯ç”¨**HPU å›¾**ã€‚

æœ€åï¼ŒæŒ‡å®šä¸€ä¸ªå¯ä»¥ä»[Habana](https://huggingface.co/Habana)ç»„ç»‡åœ¨ Hub ä¸Šä¸‹è½½çš„`GaudiConfig`ã€‚

```py
from optimum.habana import GaudiConfig
from optimum.habana.diffusers import GaudiDDIMScheduler, GaudiStableDiffusionPipeline

model_name = "stabilityai/stable-diffusion-2-base"
scheduler = GaudiDDIMScheduler.from_pretrained(model_name, subfolder="scheduler")
pipeline = GaudiStableDiffusionPipeline.from_pretrained(
    model_name,
    scheduler=scheduler,
    use_habana=True,
    use_hpu_graphs=True,
    gaudi_config="Habana/stable-diffusion-2",
)
```

ç°åœ¨ï¼Œæ‚¨å¯ä»¥è°ƒç”¨ç®¡é“æŒ‰æ‰¹æ¬¡ä»ä¸€ä¸ªæˆ–å¤šä¸ªæç¤ºç”Ÿæˆå›¾åƒï¼š

```py
outputs = pipeline(
    prompt=[
        "High quality photo of an astronaut riding a horse in space",
        "Face of a yellow cat, high resolution, sitting on a park bench",
    ],
    num_images_per_prompt=10,
    batch_size=4,
)
```

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ğŸ¤— Optimum Habana çš„[æ–‡æ¡£](https://huggingface.co/docs/optimum/habana/usage_guides/stable_diffusion)å’Œå®˜æ–¹ GitHub å­˜å‚¨åº“ä¸­æä¾›çš„[ç¤ºä¾‹](https://github.com/huggingface/optimum-habana/tree/main/examples/stable-diffusion)ã€‚

## åŸºå‡†æµ‹è¯•

æˆ‘ä»¬å¯¹ Habana çš„ç¬¬ä¸€ä»£ Gaudi å’Œ Gaudi2 è¿›è¡Œäº†åŸºå‡†æµ‹è¯•ï¼Œä½¿ç”¨[Habana/stable-diffusion](https://huggingface.co/Habana/stable-diffusion)å’Œ[Habana/stable-diffusion-2](https://huggingface.co/Habana/stable-diffusion-2) Gaudi é…ç½®ï¼ˆæ··åˆç²¾åº¦ bf16/fp32ï¼‰æ¥å±•ç¤ºå®ƒä»¬çš„æ€§èƒ½ã€‚

å¯¹äº[Stable Diffusion v1.5](https://huggingface.co/runwayml/stable-diffusion-v1-5)åœ¨ 512x512 å›¾åƒä¸Šï¼š

|  | å»¶è¿Ÿï¼ˆæ‰¹é‡å¤§å°=1ï¼‰ | ååé‡ |
| --- | :-: | :-: |
| ç¬¬ä¸€ä»£ Gaudi | 3.80 ç§’ | 0.308 images/sï¼ˆæ‰¹é‡å¤§å°=8ï¼‰ |
| Gaudi2 | 1.33 ç§’ | 1.081 images/sï¼ˆæ‰¹é‡å¤§å°=8ï¼‰ |

å¯¹äº[Stable Diffusion v2.1](https://huggingface.co/stabilityai/stable-diffusion-2-1)åœ¨ 768x768 å›¾åƒä¸Šï¼š

|  | å»¶è¿Ÿï¼ˆæ‰¹é‡å¤§å°=1ï¼‰ | ååé‡ |
| --- | :-: | :-: |
| ç¬¬ä¸€ä»£ Gaudi | 10.2 ç§’ | 0.108 images/sï¼ˆæ‰¹é‡å¤§å°=4ï¼‰ |
| Gaudi2 | 3.17 ç§’ | 0.379 images/sï¼ˆæ‰¹é‡å¤§å°=8ï¼‰ |
