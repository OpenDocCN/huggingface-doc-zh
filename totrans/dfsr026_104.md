# LoRA

> åŸæ–‡ï¼š[https://huggingface.co/docs/diffusers/api/loaders/lora](https://huggingface.co/docs/diffusers/api/loaders/lora)

LoRAæ˜¯ä¸€ç§å¿«é€Ÿè½»é‡çº§çš„è®­ç»ƒæ–¹æ³•ï¼Œå®ƒæ’å…¥å¹¶è®­ç»ƒäº†æ•°é‡æ˜æ˜¾è¾ƒå°‘çš„å‚æ•°ï¼Œè€Œä¸æ˜¯æ‰€æœ‰æ¨¡å‹å‚æ•°ã€‚è¿™ä¼šäº§ç”Ÿä¸€ä¸ªè¾ƒå°çš„æ–‡ä»¶ï¼ˆçº¦100 MBï¼‰ï¼Œä½¿å¾—å¯ä»¥æ›´å¿«åœ°è®­ç»ƒæ¨¡å‹æ¥å­¦ä¹ ä¸€ä¸ªæ–°æ¦‚å¿µã€‚LoRAæƒé‡é€šå¸¸åŠ è½½åˆ°UNetã€æ–‡æœ¬ç¼–ç å™¨æˆ–ä¸¤è€…ä¸­ã€‚æœ‰ä¸¤ä¸ªç”¨äºåŠ è½½LoRAæƒé‡çš„ç±»ï¼š

+   `LoraLoaderMixin`æä¾›äº†ç”¨äºåŠ è½½å’Œå¸è½½ã€èåˆå’Œè§£é™¤èåˆã€å¯ç”¨å’Œç¦ç”¨ä»¥åŠç®¡ç†LoRAæƒé‡çš„æ›´å¤šå‡½æ•°çš„å‡½æ•°ã€‚æ­¤ç±»å¯ä¸ä»»ä½•æ¨¡å‹ä¸€èµ·ä½¿ç”¨ã€‚

+   `StableDiffusionXLLoraLoaderMixin`æ˜¯`LoraLoaderMixin`ç±»çš„[ç¨³å®šæ‰©æ•£ï¼ˆSDXLï¼‰](../../api/pipelines/stable_diffusion/stable_diffusion_xl)ç‰ˆæœ¬ï¼Œç”¨äºåŠ è½½å’Œä¿å­˜LoRAæƒé‡ã€‚å®ƒåªèƒ½ä¸SDXLæ¨¡å‹ä¸€èµ·ä½¿ç”¨ã€‚

è¦äº†è§£å¦‚ä½•åŠ è½½LoRAæƒé‡çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[LoRA](../../using-diffusers/loading_adapters#lora)åŠ è½½æŒ‡å—ã€‚

## LoraLoaderMixin

### `class diffusers.loaders.LoraLoaderMixin`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L72)

```py
( )
```

å°†LoRAå±‚åŠ è½½åˆ°[UNet2DConditionModel](/docs/diffusers/v0.26.3/en/api/models/unet2d-cond#diffusers.UNet2DConditionModel)å’Œ[`CLIPTextModel`](https://huggingface.co/docs/transformers/model_doc/clip#transformers.CLIPTextModel)ä¸­ã€‚

#### `delete_adapters`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L1284)

```py
( adapter_names: Union )
```

å‚æ•°

+   `åˆ é™¤`é€‚é…å™¨åç§°çš„LoRAå±‚ï¼Œç”¨äºUNetå’Œæ–‡æœ¬ç¼–ç å™¨ã€‚ â€” adapter_names (`Union[List[str], str]`): è¦åˆ é™¤çš„é€‚é…å™¨çš„åç§°ã€‚å¯ä»¥æ˜¯å•ä¸ªå­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²åˆ—è¡¨

#### `disable_lora_for_text_encoder`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L1208)

```py
( text_encoder: Optional = None )
```

å‚æ•°

+   `text_encoder` (`torch.nn.Module`, *å¯é€‰*) â€” ç”¨äºç¦ç”¨LoRAå±‚çš„æ–‡æœ¬ç¼–ç å™¨æ¨¡å—ã€‚å¦‚æœä¸º`None`ï¼Œåˆ™ä¼šå°è¯•è·å–`text_encoder`å±æ€§ã€‚

ç¦ç”¨æ–‡æœ¬ç¼–ç å™¨çš„LoRAå±‚ã€‚

#### `enable_lora_for_text_encoder`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L1225)

```py
( text_encoder: Optional = None )
```

å‚æ•°

+   `text_encoder` (`torch.nn.Module`, *å¯é€‰*) â€” ç”¨äºå¯ç”¨LoRAå±‚çš„æ–‡æœ¬ç¼–ç å™¨æ¨¡å—ã€‚å¦‚æœä¸º`None`ï¼Œåˆ™ä¼šå°è¯•è·å–`text_encoder`å±æ€§ã€‚

å¯ç”¨æ–‡æœ¬ç¼–ç å™¨çš„LoRAå±‚ã€‚

#### `fuse_lora`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L1000)

```py
( fuse_unet: bool = True fuse_text_encoder: bool = True lora_scale: float = 1.0 safe_fusing: bool = False adapter_names: Optional = None )
```

å‚æ•°

+   `fuse_unet` (`bool`, é»˜è®¤ä¸º `True`) â€” æ˜¯å¦èåˆUNetçš„LoRAå‚æ•°ã€‚

+   `fuse_text_encoder` (`bool`, é»˜è®¤ä¸º `True`) â€” æ˜¯å¦èåˆæ–‡æœ¬ç¼–ç å™¨LoRAå‚æ•°ã€‚å¦‚æœæ–‡æœ¬ç¼–ç å™¨æœªä½¿ç”¨LoRAå‚æ•°è¿›è¡Œmonkey-patchï¼Œåˆ™ä¸ä¼šäº§ç”Ÿä»»ä½•æ•ˆæœã€‚

+   `lora_scale` (`float`, é»˜è®¤ä¸º 1.0) â€” æ§åˆ¶LoRAå‚æ•°å¯¹è¾“å‡ºçš„å½±å“ç¨‹åº¦ã€‚

+   `safe_fusing` (`bool`, é»˜è®¤ä¸º `False`) â€” åœ¨èåˆä¹‹å‰æ£€æŸ¥èåˆæƒé‡æ˜¯å¦ä¸ºNaNå€¼ï¼Œå¦‚æœå€¼ä¸ºNaNï¼Œåˆ™ä¸è¿›è¡Œèåˆã€‚

+   `adapter_names` (`List[str]`, *å¯é€‰*) â€” ç”¨äºèåˆçš„é€‚é…å™¨åç§°ã€‚å¦‚æœæœªä¼ é€’ä»»ä½•å†…å®¹ï¼Œåˆ™å°†èåˆæ‰€æœ‰æ´»åŠ¨é€‚é…å™¨ã€‚

å°†LoRAå‚æ•°èåˆåˆ°ç›¸åº”å—çš„åŸå§‹å‚æ•°ä¸­ã€‚

è¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§APIã€‚

ç¤ºä¾‹ï¼š

```py
from diffusers import DiffusionPipeline
import torch

pipeline = DiffusionPipeline.from_pretrained(
    "stabilityai/stable-diffusion-xl-base-1.0", torch_dtype=torch.float16
).to("cuda")
pipeline.load_lora_weights("nerijs/pixel-art-xl", weight_name="pixel-art-xl.safetensors", adapter_name="pixel")
pipeline.fuse_lora(lora_scale=0.7)
```

#### `get_active_adapters`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L1308)

```py
( )
```

è·å–å½“å‰æ´»åŠ¨é€‚é…å™¨çš„åˆ—è¡¨ã€‚

ç¤ºä¾‹ï¼š

```py
from diffusers import DiffusionPipeline

pipeline = DiffusionPipeline.from_pretrained(
    "stabilityai/stable-diffusion-xl-base-1.0",
).to("cuda")
pipeline.load_lora_weights("CiroN2022/toy-face", weight_name="toy_face_sdxl.safetensors", adapter_name="toy")
pipeline.get_active_adapters()
```

#### `get_list_adapters`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L1340)

```py
( )
```

è·å–ç®¡é“ä¸­æ‰€æœ‰å¯ç”¨é€‚é…å™¨çš„å½“å‰åˆ—è¡¨ã€‚

#### `load_lora_into_text_encoder`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L484)

```py
( state_dict network_alphas text_encoder prefix = None lora_scale = 1.0 low_cpu_mem_usage = None adapter_name = None _pipeline = None )
```

å‚æ•°

+   `state_dict` (`dict`) â€” åŒ…å«loraå±‚å‚æ•°çš„æ ‡å‡†çŠ¶æ€å­—å…¸ã€‚é”®åº”è¯¥ä»¥é¢å¤–çš„`text_encoder`ä¸ºå‰ç¼€ï¼Œä»¥åŒºåˆ†unet loraå±‚ã€‚

+   `network_alphas` (`Dict[str, float]`) â€” æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…`LoRALinearLayer`ã€‚

+   `text_encoder` (`CLIPTextModel`) â€” è¦åŠ è½½LoRAå±‚çš„æ–‡æœ¬ç¼–ç å™¨æ¨¡å‹ã€‚

+   `prefix` (`str`) â€” `state_dict`ä¸­`text_encoder`çš„é¢„æœŸå‰ç¼€ã€‚

+   `lora_scale` (`float`) â€” åœ¨å°†loraçº¿æ€§å±‚çš„è¾“å‡ºä¸å¸¸è§„loraå±‚çš„è¾“å‡ºç›¸åŠ ä¹‹å‰ï¼Œéœ€è¦å¯¹å…¶è¿›è¡Œç¼©æ”¾çš„æ¯”ä¾‹ã€‚

+   `low_cpu_mem_usage` (`bool`, *å¯é€‰*, å¦‚æœtorchç‰ˆæœ¬ >= 1.9.0åˆ™é»˜è®¤ä¸º`True`ï¼Œå¦åˆ™ä¸º`False`) â€” åŠ å¿«æ¨¡å‹åŠ è½½ï¼Œä»…åŠ è½½é¢„è®­ç»ƒæƒé‡è€Œä¸åˆå§‹åŒ–æƒé‡ã€‚åœ¨åŠ è½½æ¨¡å‹æ—¶ï¼Œè¿˜å°è¯•ä¸ä½¿ç”¨è¶…è¿‡CPUå†…å­˜ä¸­çš„1å€æ¨¡å‹å¤§å°ï¼ˆåŒ…æ‹¬å³°å€¼å†…å­˜ï¼‰ã€‚ä»…æ”¯æŒPyTorch >= 1.9.0ã€‚å¦‚æœæ‚¨ä½¿ç”¨è¾ƒæ—§ç‰ˆæœ¬çš„PyTorchï¼Œå°†æ­¤å‚æ•°è®¾ç½®ä¸º`True`å°†å¼•å‘é”™è¯¯ã€‚

+   `adapter_name` (`str`, *å¯é€‰*) â€” ç”¨äºå¼•ç”¨åŠ è½½çš„é€‚é…å™¨æ¨¡å‹çš„é€‚é…å™¨åç§°ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†ä½¿ç”¨`default_{i}`ï¼Œå…¶ä¸­iæ˜¯æ­£åœ¨åŠ è½½çš„é€‚é…å™¨çš„æ€»æ•°ã€‚

è¿™å°†æŠŠ`state_dict`ä¸­æŒ‡å®šçš„LoRAå±‚åŠ è½½åˆ°`text_encoder`ä¸­

#### `load_lora_into_transformer`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L667)

```py
( state_dict network_alphas transformer low_cpu_mem_usage = None adapter_name = None _pipeline = None )
```

å‚æ•°

+   `state_dict` (`dict`) â€” åŒ…å«loraå±‚å‚æ•°çš„æ ‡å‡†çŠ¶æ€å­—å…¸ã€‚é”®å¯ä»¥ç›´æ¥ç´¢å¼•åˆ°unetï¼Œä¹Ÿå¯ä»¥ä»¥é¢å¤–çš„`unet`ä¸ºå‰ç¼€ï¼Œç”¨äºåŒºåˆ†æ–‡æœ¬ç¼–ç å™¨loraå±‚ã€‚

+   `network_alphas` (`Dict[str, float]`) â€” æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…`LoRALinearLayer`ã€‚

+   `unet` (`UNet2DConditionModel`) â€” è¦åŠ è½½LoRAå±‚çš„UNetæ¨¡å‹ã€‚

+   `low_cpu_mem_usage` (`bool`, *å¯é€‰*, å¦‚æœtorchç‰ˆæœ¬ >= 1.9.0åˆ™é»˜è®¤ä¸º`True`ï¼Œå¦åˆ™ä¸º`False`) â€” åŠ å¿«æ¨¡å‹åŠ è½½ï¼Œä»…åŠ è½½é¢„è®­ç»ƒæƒé‡è€Œä¸åˆå§‹åŒ–æƒé‡ã€‚åœ¨åŠ è½½æ¨¡å‹æ—¶ï¼Œè¿˜å°è¯•ä¸ä½¿ç”¨è¶…è¿‡CPUå†…å­˜ä¸­çš„1å€æ¨¡å‹å¤§å°ï¼ˆåŒ…æ‹¬å³°å€¼å†…å­˜ï¼‰ã€‚ä»…æ”¯æŒPyTorch >= 1.9.0ã€‚å¦‚æœæ‚¨ä½¿ç”¨è¾ƒæ—§ç‰ˆæœ¬çš„PyTorchï¼Œå°†æ­¤å‚æ•°è®¾ç½®ä¸º`True`å°†å¼•å‘é”™è¯¯ã€‚

+   `adapter_name` (`str`, *å¯é€‰*) â€” ç”¨äºå¼•ç”¨åŠ è½½çš„é€‚é…å™¨æ¨¡å‹çš„é€‚é…å™¨åç§°ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†ä½¿ç”¨`default_{i}`ï¼Œå…¶ä¸­iæ˜¯æ­£åœ¨åŠ è½½çš„é€‚é…å™¨çš„æ€»æ•°ã€‚

è¿™å°†æŠŠ`state_dict`ä¸­æŒ‡å®šçš„LoRAå±‚åŠ è½½åˆ°`transformer`ä¸­ã€‚

#### `load_lora_into_unet`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L375)

```py
( state_dict network_alphas unet low_cpu_mem_usage = None adapter_name = None _pipeline = None )
```

å‚æ•°

+   `state_dict` (`dict`) â€” åŒ…å«loraå±‚å‚æ•°çš„æ ‡å‡†çŠ¶æ€å­—å…¸ã€‚é”®å¯ä»¥ç›´æ¥ç´¢å¼•åˆ°unetï¼Œä¹Ÿå¯ä»¥ä»¥é¢å¤–çš„`unet`ä¸ºå‰ç¼€ï¼Œç”¨äºåŒºåˆ†æ–‡æœ¬ç¼–ç å™¨loraå±‚ã€‚

+   `network_alphas` (`Dict[str, float]`) â€” æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…`LoRALinearLayer`ã€‚

+   `unet` (`UNet2DConditionModel`) â€” è¦åŠ è½½LoRAå±‚çš„UNetæ¨¡å‹ã€‚

+   `low_cpu_mem_usage` (`bool`, *å¯é€‰*, å¦‚æœtorchç‰ˆæœ¬ >= 1.9.0åˆ™é»˜è®¤ä¸º`True`ï¼Œå¦åˆ™ä¸º`False`) â€” åŠ å¿«æ¨¡å‹åŠ è½½ï¼Œä»…åŠ è½½é¢„è®­ç»ƒæƒé‡è€Œä¸åˆå§‹åŒ–æƒé‡ã€‚åœ¨åŠ è½½æ¨¡å‹æ—¶ï¼Œè¿˜å°è¯•ä¸ä½¿ç”¨è¶…è¿‡CPUå†…å­˜ä¸­çš„1å€æ¨¡å‹å¤§å°ï¼ˆåŒ…æ‹¬å³°å€¼å†…å­˜ï¼‰ã€‚ä»…æ”¯æŒPyTorch >= 1.9.0ã€‚å¦‚æœæ‚¨ä½¿ç”¨è¾ƒæ—§ç‰ˆæœ¬çš„PyTorchï¼Œå°†æ­¤å‚æ•°è®¾ç½®ä¸º`True`å°†å¼•å‘é”™è¯¯ã€‚

+   `adapter_name` (`str`, *å¯é€‰*) â€” ç”¨äºå¼•ç”¨åŠ è½½çš„é€‚é…å™¨æ¨¡å‹çš„é€‚é…å™¨åç§°ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†ä½¿ç”¨`default_{i}`ï¼Œå…¶ä¸­iæ˜¯æ­£åœ¨åŠ è½½çš„é€‚é…å™¨çš„æ€»æ•°ã€‚

è¿™å°†æŠŠ`state_dict`ä¸­æŒ‡å®šçš„LoRAå±‚åŠ è½½åˆ°`unet`ä¸­ã€‚

#### `load_lora_weights`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L83)

```py
( pretrained_model_name_or_path_or_dict: Union adapter_name = None **kwargs )
```

å‚æ•°

+   `pretrained_model_name_or_path_or_dict` (`str`æˆ–`os.PathLike`æˆ–`dict`) â€” æŸ¥çœ‹[lora_state_dict()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.LoraLoaderMixin.lora_state_dict)ã€‚

+   `kwargs` (`dict`ï¼Œ*å¯é€‰*) â€” æŸ¥çœ‹[lora_state_dict()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.LoraLoaderMixin.lora_state_dict)ã€‚

+   `adapter_name` (`str`ï¼Œ*å¯é€‰*) â€” ç”¨äºå¼•ç”¨åŠ è½½çš„é€‚é…å™¨æ¨¡å‹çš„é€‚é…å™¨åç§°ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†ä½¿ç”¨`default_{i}`ï¼Œå…¶ä¸­iæ˜¯æ­£åœ¨åŠ è½½çš„é€‚é…å™¨æ€»æ•°ã€‚

å°†`pretrained_model_name_or_path_or_dict`ä¸­æŒ‡å®šçš„LoRAæƒé‡åŠ è½½åˆ°`self.unet`å’Œ`self.text_encoder`ä¸­ã€‚

æ‰€æœ‰kwargséƒ½å°†è½¬å‘åˆ°`self.lora_state_dict`ã€‚

æŸ¥çœ‹[lora_state_dict()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.LoraLoaderMixin.lora_state_dict)ä»¥è·å–æœ‰å…³å¦‚ä½•åŠ è½½çŠ¶æ€å­—å…¸çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚

æŸ¥çœ‹[load_lora_into_unet()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.LoraLoaderMixin.load_lora_into_unet)ä»¥è·å–æœ‰å…³å¦‚ä½•å°†çŠ¶æ€å­—å…¸åŠ è½½åˆ°`self.unet`ä¸­çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚

æŸ¥çœ‹[load_lora_into_text_encoder()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.LoraLoaderMixin.load_lora_into_text_encoder)ä»¥è·å–æœ‰å…³å¦‚ä½•å°†çŠ¶æ€å­—å…¸åŠ è½½åˆ°`self.text_encoder`ä¸­çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚

#### `lora_state_dict`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L138)

```py
( pretrained_model_name_or_path_or_dict: Union **kwargs )
```

å‚æ•°

+   `pretrained_model_name_or_path_or_dict` (`str`æˆ–`os.PathLike`æˆ–`dict`) â€” å¯ä»¥æ˜¯ï¼š

    +   ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé¢„è®­ç»ƒæ¨¡å‹åœ¨Hubä¸Šæ‰˜ç®¡çš„*æ¨¡å‹ID*ï¼ˆä¾‹å¦‚`google/ddpm-celebahq-256`ï¼‰ã€‚

    +   ä¸€ä¸ª*ç›®å½•*è·¯å¾„ï¼ˆä¾‹å¦‚`./my_model_directory`ï¼‰ï¼Œå…¶ä¸­åŒ…å«ä½¿ç”¨[ModelMixin.save_pretrained()](/docs/diffusers/v0.26.3/en/api/models/overview#diffusers.ModelMixin.save_pretrained)ä¿å­˜çš„æ¨¡å‹æƒé‡ã€‚

    +   ä¸€ä¸ª[torchçŠ¶æ€å­—å…¸](https://pytorch.org/tutorials/beginner/saving_loading_models.html#what-is-a-state-dict)ã€‚

+   `cache_dir` (`Union[str, os.PathLike]`ï¼Œ*å¯é€‰*) â€” ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹é…ç½®çš„ç›®å½•è·¯å¾„ï¼Œå¦‚æœæœªä½¿ç”¨æ ‡å‡†ç¼“å­˜ã€‚

+   `force_download` (`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`False`) â€” æ˜¯å¦å¼ºåˆ¶ï¼ˆé‡æ–°ï¼‰ä¸‹è½½æ¨¡å‹æƒé‡å’Œé…ç½®æ–‡ä»¶ï¼Œè¦†ç›–ç¼“å­˜ç‰ˆæœ¬ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚

+   `resume_download` (`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`False`) â€” æ˜¯å¦æ¢å¤ä¸‹è½½æ¨¡å‹æƒé‡å’Œé…ç½®æ–‡ä»¶ã€‚å¦‚æœè®¾ç½®ä¸º`False`ï¼Œåˆ™åˆ é™¤ä»»ä½•æœªå®Œå…¨ä¸‹è½½çš„æ–‡ä»¶ã€‚

+   `proxies` (`Dict[str, str]`ï¼Œ*å¯é€‰*) â€” è¦ä½¿ç”¨çš„ä»£ç†æœåŠ¡å™¨å­—å…¸ï¼ŒæŒ‰åè®®æˆ–ç«¯ç‚¹ï¼Œä¾‹å¦‚ï¼Œ`{'http': 'foo.bar:3128', 'http://hostname': 'foo.bar:4012'}`ã€‚ä»£ç†åœ¨æ¯ä¸ªè¯·æ±‚ä¸Šä½¿ç”¨ã€‚

+   `local_files_only` (`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`False`) â€” æ˜¯å¦ä»…åŠ è½½æœ¬åœ°æ¨¡å‹æƒé‡å’Œé…ç½®æ–‡ä»¶ã€‚å¦‚æœè®¾ç½®ä¸º`True`ï¼Œåˆ™ä¸ä¼šä»Hubä¸‹è½½æ¨¡å‹ã€‚

+   `token` (`str`æˆ–*bool*ï¼Œ*å¯é€‰*) â€” ç”¨ä½œè¿œç¨‹æ–‡ä»¶çš„HTTPä»¤ç‰Œçš„æˆæƒã€‚å¦‚æœä¸º`True`ï¼Œåˆ™ä½¿ç”¨ä»`diffusers-cli login`ç”Ÿæˆçš„ä»¤ç‰Œï¼ˆå­˜å‚¨åœ¨`~/.huggingface`ï¼‰ã€‚

+   `revision` (`str`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`"main"`) â€” è¦ä½¿ç”¨çš„ç‰¹å®šæ¨¡å‹ç‰ˆæœ¬ã€‚å¯ä»¥æ˜¯åˆ†æ”¯åç§°ã€æ ‡ç­¾åç§°ã€æäº¤IDæˆ–Gitå…è®¸çš„ä»»ä½•æ ‡è¯†ç¬¦ã€‚

+   `subfolder` (`str`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`""`) â€” æ¨¡å‹æ–‡ä»¶åœ¨Hubæˆ–æœ¬åœ°è¾ƒå¤§æ¨¡å‹å­˜å‚¨åº“ä¸­çš„å­æ–‡ä»¶å¤¹ä½ç½®ã€‚

+   `low_cpu_mem_usage` (`bool`ï¼Œ*å¯é€‰*ï¼Œå¦‚æœtorchç‰ˆæœ¬>= 1.9.0ï¼Œé»˜è®¤ä¸º`True`ï¼Œå¦åˆ™ä¸º`False`) â€” åŠ é€Ÿæ¨¡å‹åŠ è½½ï¼Œä»…åŠ è½½é¢„è®­ç»ƒæƒé‡è€Œä¸åˆå§‹åŒ–æƒé‡ã€‚è¿™è¿˜å°è¯•åœ¨åŠ è½½æ¨¡å‹æ—¶ä¸ä½¿ç”¨è¶…è¿‡1å€æ¨¡å‹å¤§å°çš„CPUå†…å­˜ï¼ˆåŒ…æ‹¬å³°å€¼å†…å­˜ï¼‰ã€‚ä»…æ”¯æŒPyTorch >= 1.9.0ã€‚å¦‚æœæ‚¨ä½¿ç”¨è¾ƒæ—§ç‰ˆæœ¬çš„PyTorchï¼Œå°†æ­¤å‚æ•°è®¾ç½®ä¸º`True`å°†å¼•å‘é”™è¯¯ã€‚

+   `mirror`ï¼ˆ`str`ï¼Œ*å¯é€‰*ï¼‰â€” å¦‚æœæ‚¨åœ¨ä¸­å›½ä¸‹è½½æ¨¡å‹æ—¶é‡åˆ°å¯è®¿é—®æ€§é—®é¢˜ï¼Œå¯ä»¥å°†æºé•œåƒåˆ°è§£å†³é—®é¢˜ã€‚æˆ‘ä»¬ä¸ä¿è¯æºçš„åŠæ—¶æ€§æˆ–å®‰å…¨æ€§ï¼Œæ‚¨åº”å‚è€ƒé•œåƒç«™ç‚¹è·å–æ›´å¤šä¿¡æ¯ã€‚

è¿”å›LoRAæƒé‡å’Œç½‘ç»œÎ±çš„çŠ¶æ€å­—å…¸ã€‚

æˆ‘ä»¬æ”¯æŒä»¥æœ‰é™çš„èƒ½åŠ›åŠ è½½A1111æ ¼å¼çš„LoRAæ£€æŸ¥ç‚¹ã€‚

æ­¤å‡½æ•°æ˜¯å®éªŒæ€§çš„ï¼Œå¯èƒ½ä¼šåœ¨å°†æ¥æ›´æ”¹ã€‚

#### `save_lora_weights`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L869)

```py
( save_directory: Union unet_lora_layers: Dict = None text_encoder_lora_layers: Dict = None transformer_lora_layers: Dict = None is_main_process: bool = True weight_name: str = None save_function: Callable = None safe_serialization: bool = True )
```

å‚æ•°

+   `save_directory`ï¼ˆ`str`æˆ–`os.PathLike`ï¼‰â€” è¦ä¿å­˜LoRAå‚æ•°çš„ç›®å½•ã€‚å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œå°†ä¼šåˆ›å»ºã€‚

+   `unet_lora_layers`ï¼ˆ`Dict[str, torch.nn.Module]`æˆ–`Dict[str, torch.Tensor]`ï¼‰â€” ä¸`unet`å¯¹åº”çš„LoRAå±‚çš„çŠ¶æ€å­—å…¸ã€‚

+   `text_encoder_lora_layers`ï¼ˆ`Dict[str, torch.nn.Module]`æˆ–`Dict[str, torch.Tensor]`ï¼‰â€” ä¸`text_encoder`å¯¹åº”çš„LoRAå±‚çš„çŠ¶æ€å­—å…¸ã€‚å¿…é¡»æ˜¾å¼ä¼ é€’æ–‡æœ¬ç¼–ç å™¨LoRAçŠ¶æ€å­—å…¸ï¼Œå› ä¸ºå®ƒæ¥è‡ªğŸ¤— Transformersã€‚

+   `is_main_process`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`True`ï¼‰â€” è°ƒç”¨æ­¤å‡½æ•°çš„è¿›ç¨‹æ˜¯å¦ä¸ºä¸»è¿›ç¨‹ã€‚åœ¨åˆ†å¸ƒå¼è®­ç»ƒæœŸé—´éå¸¸æœ‰ç”¨ï¼Œå½“æ‚¨éœ€è¦åœ¨æ‰€æœ‰è¿›ç¨‹ä¸Šè°ƒç”¨æ­¤å‡½æ•°æ—¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»…åœ¨ä¸»è¿›ç¨‹ä¸Šè®¾ç½®`is_main_process=True`ï¼Œä»¥é¿å…ç«äº‰æ¡ä»¶ã€‚

+   `save_function`ï¼ˆ`Callable`ï¼‰â€” ç”¨äºä¿å­˜çŠ¶æ€å­—å…¸çš„å‡½æ•°ã€‚åœ¨åˆ†å¸ƒå¼è®­ç»ƒæœŸé—´éœ€è¦ç”¨å¦ä¸€ç§æ–¹æ³•æ›¿æ¢`torch.save`æ—¶å¾ˆæœ‰ç”¨ã€‚å¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡`DIFFUSERS_SAVE_MODE`è¿›è¡Œé…ç½®ã€‚

+   `safe_serialization`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`True`ï¼‰â€” æ˜¯å¦ä½¿ç”¨`safetensors`ä¿å­˜æ¨¡å‹ï¼Œè¿˜æ˜¯ä½¿ç”¨ä¼ ç»Ÿçš„PyTorchæ–¹å¼ä¸`pickle`ä¿å­˜ã€‚

ä¿å­˜ä¸UNetå’Œæ–‡æœ¬ç¼–ç å™¨å¯¹åº”çš„LoRAå‚æ•°ã€‚

#### `set_adapters_for_text_encoder`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L1166)

```py
( adapter_names: Union text_encoder: Optional = None text_encoder_weights: List = None )
```

å‚æ•°

+   `adapter_names`ï¼ˆ`List[str]`æˆ–`str`ï¼‰â€” è¦ä½¿ç”¨çš„é€‚é…å™¨çš„åç§°ã€‚

+   `text_encoder`ï¼ˆ`torch.nn.Module`ï¼Œ*å¯é€‰*ï¼‰â€” è¦è®¾ç½®é€‚é…å™¨å±‚çš„æ–‡æœ¬ç¼–ç å™¨æ¨¡å—ã€‚å¦‚æœä¸º`None`ï¼Œå°†å°è¯•è·å–`text_encoder`å±æ€§ã€‚

+   `text_encoder_weights`ï¼ˆ`List[float]`ï¼Œ*å¯é€‰*ï¼‰â€” ç”¨äºæ–‡æœ¬ç¼–ç å™¨çš„æƒé‡ã€‚å¦‚æœä¸º`None`ï¼Œåˆ™æ‰€æœ‰é€‚é…å™¨çš„æƒé‡éƒ½è®¾ç½®ä¸º`1.0`ã€‚

ä¸ºæ–‡æœ¬ç¼–ç å™¨è®¾ç½®é€‚é…å™¨å±‚ã€‚

#### `set_lora_device`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L1363)

```py
( adapter_names: List device: Union )
```

å‚æ•°

+   `adapter_names`ï¼ˆ`List[str]`ï¼‰â€” è¦å‘é€åˆ°è®¾å¤‡çš„é€‚é…å™¨åˆ—è¡¨ã€‚

+   `device`ï¼ˆ`Union[torch.device, str, int]`ï¼‰â€” è¦å‘é€é€‚é…å™¨çš„è®¾å¤‡ã€‚å¯ä»¥æ˜¯torchè®¾å¤‡ã€å­—ç¬¦ä¸²æˆ–æ•´æ•°ã€‚

å°†`adapter_names`ä¸­åˆ—å‡ºçš„LoRAç§»åŠ¨åˆ°ç›®æ ‡è®¾å¤‡ã€‚å¦‚æœè¦åŠ è½½å¤šä¸ªé€‚é…å™¨å¹¶é‡Šæ”¾ä¸€äº›GPUå†…å­˜ï¼Œå¯ä»¥å°†LoRAå¸è½½åˆ°CPUä¸Šã€‚

#### `unfuse_lora`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L1106)

```py
( unfuse_unet: bool = True unfuse_text_encoder: bool = True )
```

å‚æ•°

+   `unfuse_unet`ï¼ˆ`bool`ï¼Œé»˜è®¤ä¸º`True`ï¼‰â€” æ˜¯å¦è§£é™¤UNetçš„LoRAå‚æ•°ã€‚

+   `unfuse_text_encoder`ï¼ˆ`bool`ï¼Œé»˜è®¤ä¸º`True`ï¼‰â€” æ˜¯å¦è§£é™¤æ–‡æœ¬ç¼–ç å™¨LoRAå‚æ•°çš„èåˆã€‚å¦‚æœæ–‡æœ¬ç¼–ç å™¨æœªä½¿ç”¨LoRAå‚æ•°è¿›è¡Œmonkey-patchï¼Œåˆ™ä¸ä¼šäº§ç”Ÿä»»ä½•æ•ˆæœã€‚

æ’¤é”€[`pipe.fuse_lora()`](https://huggingface.co/docs/diffusers/main/en/api/loaders#diffusers.loaders.LoraLoaderMixin.fuse_lora)çš„æ•ˆæœã€‚

è¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§APIã€‚

#### `unload_lora_weights`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L968)

```py
( )
```

å¸è½½LoRAå‚æ•°ã€‚

ç¤ºä¾‹ï¼š

```py
>>> # Assuming `pipeline` is already loaded with the LoRA parameters.
>>> pipeline.unload_lora_weights()
>>> ...
```

## StableDiffusionXLLoraLoaderMixin

### `class diffusers.loaders.StableDiffusionXLLoraLoaderMixin`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L1404)

```py
( )
```

æ­¤ç±»ä½¿ç”¨ LoRA åŠ è½½/ä¿å­˜ä»£ç è¦†ç›–äº† `LoraLoaderMixin`ï¼Œè¯¥ä»£ç ç‰¹å®šäº SDXLã€‚

#### `load_lora_weights`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/loaders/lora.py#L1408)

```py
( pretrained_model_name_or_path_or_dict: Union adapter_name: Optional = None **kwargs )
```

å‚æ•°

+   `pretrained_model_name_or_path_or_dict` (`str` æˆ– `os.PathLike` æˆ– `dict`) â€” æŸ¥çœ‹ [lora_state_dict()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.LoraLoaderMixin.lora_state_dict)ã€‚

+   `adapter_name` (`str`, *å¯é€‰*) â€” ç”¨äºå¼•ç”¨åŠ è½½çš„é€‚é…å™¨æ¨¡å‹çš„é€‚é…å™¨åç§°ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†ä½¿ç”¨ `default_{i}`ï¼Œå…¶ä¸­ i æ˜¯è¦åŠ è½½çš„é€‚é…å™¨æ€»æ•°ã€‚

+   `kwargs` (`dict`, *å¯é€‰*) â€” æŸ¥çœ‹ [lora_state_dict()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.LoraLoaderMixin.lora_state_dict)ã€‚

å°†åœ¨ `pretrained_model_name_or_path_or_dict` ä¸­æŒ‡å®šçš„ LoRA æƒé‡åŠ è½½åˆ° `self.unet` å’Œ `self.text_encoder` ä¸­ã€‚

æ‰€æœ‰ kwargs éƒ½ä¼šä¼ é€’ç»™ `self.lora_state_dict`ã€‚

æŸ¥çœ‹ [lora_state_dict()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.LoraLoaderMixin.lora_state_dict) ä»¥äº†è§£å¦‚ä½•åŠ è½½çŠ¶æ€å­—å…¸çš„æ›´å¤šç»†èŠ‚ã€‚

æŸ¥çœ‹ [load_lora_into_unet()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.LoraLoaderMixin.load_lora_into_unet) ä»¥äº†è§£å¦‚ä½•å°†çŠ¶æ€å­—å…¸åŠ è½½åˆ° `self.unet` ä¸­çš„æ›´å¤šç»†èŠ‚ã€‚

æŸ¥çœ‹ [load_lora_into_text_encoder()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.LoraLoaderMixin.load_lora_into_text_encoder) ä»¥äº†è§£å¦‚ä½•å°†çŠ¶æ€å­—å…¸åŠ è½½åˆ° `self.text_encoder` ä¸­çš„æ›´å¤šç»†èŠ‚ã€‚
