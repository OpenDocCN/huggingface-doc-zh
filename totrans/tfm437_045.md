# æ–‡æœ¬ç”Ÿæˆç­–ç•¥

> åŽŸæ–‡ï¼š[https://huggingface.co/docs/transformers/v4.37.2/en/generation_strategies](https://huggingface.co/docs/transformers/v4.37.2/en/generation_strategies)

æ–‡æœ¬ç”Ÿæˆå¯¹äºŽè®¸å¤šNLPä»»åŠ¡è‡³å…³é‡è¦ï¼Œä¾‹å¦‚å¼€æ”¾å¼æ–‡æœ¬ç”Ÿæˆã€æ‘˜è¦ã€ç¿»è¯‘ç­‰ã€‚å®ƒè¿˜åœ¨å„ç§æ··åˆæ¨¡æ€åº”ç”¨ä¸­å‘æŒ¥ä½œç”¨ï¼Œè¿™äº›åº”ç”¨çš„è¾“å‡ºæ˜¯æ–‡æœ¬ï¼Œå¦‚è¯­éŸ³è½¬æ–‡æœ¬å’Œè§†è§‰è½¬æ–‡æœ¬ã€‚ä¸€äº›å¯ä»¥ç”Ÿæˆæ–‡æœ¬çš„æ¨¡åž‹åŒ…æ‹¬GPT2ã€XLNetã€OpenAI GPTã€CTRLã€TransformerXLã€XLMã€Bartã€T5ã€GITã€Whisperã€‚

æŸ¥çœ‹ä¸€äº›ä½¿ç”¨[generate()](/docs/transformers/v4.37.2/en/main_classes/text_generation#transformers.GenerationMixin.generate)æ–¹æ³•ä¸ºä¸åŒä»»åŠ¡ç”Ÿæˆæ–‡æœ¬è¾“å‡ºçš„ç¤ºä¾‹ï¼š

+   [æ–‡æœ¬æ‘˜è¦](./tasks/summarization#inference)

+   [å›¾åƒæ ‡é¢˜](./model_doc/git#transformers.GitForCausalLM.forward.example)

+   [éŸ³é¢‘è½¬å½•](./model_doc/whisper#transformers.WhisperForConditionalGeneration.forward.example)

è¯·æ³¨æ„ï¼Œç”Ÿæˆæ–¹æ³•çš„è¾“å…¥å–å†³äºŽæ¨¡åž‹çš„æ¨¡æ€ã€‚å®ƒä»¬ç”±æ¨¡åž‹çš„é¢„å¤„ç†å™¨ç±»è¿”å›žï¼Œä¾‹å¦‚AutoTokenizeræˆ–AutoProcessorã€‚å¦‚æžœæ¨¡åž‹çš„é¢„å¤„ç†å™¨åˆ›å»ºå¤šç§ç±»åž‹çš„è¾“å…¥ï¼Œè¯·å°†æ‰€æœ‰è¾“å…¥ä¼ é€’ç»™generate()ã€‚æ‚¨å¯ä»¥åœ¨ç›¸åº”æ¨¡åž‹çš„æ–‡æ¡£ä¸­äº†è§£æ›´å¤šå…³äºŽå„ä¸ªæ¨¡åž‹çš„é¢„å¤„ç†å™¨çš„ä¿¡æ¯ã€‚

é€‰æ‹©ç”Ÿæˆæ–‡æœ¬çš„è¾“å‡ºæ ‡è®°çš„è¿‡ç¨‹ç§°ä¸ºè§£ç ï¼Œæ‚¨å¯ä»¥è‡ªå®šä¹‰`generate()`æ–¹æ³•å°†ä½¿ç”¨çš„è§£ç ç­–ç•¥ã€‚ä¿®æ”¹è§£ç ç­–ç•¥ä¸ä¼šæ”¹å˜ä»»ä½•å¯è®­ç»ƒå‚æ•°çš„å€¼ã€‚ä½†æ˜¯ï¼Œå®ƒå¯èƒ½ä¼šæ˜¾è‘—å½±å“ç”Ÿæˆè¾“å‡ºçš„è´¨é‡ã€‚å®ƒå¯ä»¥å¸®åŠ©å‡å°‘æ–‡æœ¬ä¸­çš„é‡å¤ï¼Œå¹¶ä½¿å…¶æ›´è¿žè´¯ã€‚

æœ¬æŒ‡å—æè¿°ï¼š

+   é»˜è®¤ç”Ÿæˆé…ç½®

+   å¸¸è§çš„è§£ç ç­–ç•¥åŠå…¶ä¸»è¦å‚æ•°

+   åœ¨ðŸ¤— Hubä¸Šä¿å­˜å’Œå…±äº«è‡ªå®šä¹‰ç”Ÿæˆé…ç½®ä¸Žæ‚¨çš„å¾®è°ƒæ¨¡åž‹

## é»˜è®¤æ–‡æœ¬ç”Ÿæˆé…ç½®

æ¨¡åž‹çš„è§£ç ç­–ç•¥åœ¨å…¶ç”Ÿæˆé…ç½®ä¸­å®šä¹‰ã€‚åœ¨ç®¡é“å†…ä½¿ç”¨é¢„è®­ç»ƒæ¨¡åž‹è¿›è¡ŒæŽ¨æ–­æ—¶ï¼Œæ¨¡åž‹è°ƒç”¨`PreTrainedModel.generate()`æ–¹æ³•ï¼Œåœ¨å¹•åŽåº”ç”¨é»˜è®¤ç”Ÿæˆé…ç½®ã€‚å½“æ²¡æœ‰ä¿å­˜è‡ªå®šä¹‰é…ç½®ä¸Žæ¨¡åž‹ä¸€èµ·æ—¶ï¼Œä¹Ÿä¼šä½¿ç”¨é»˜è®¤é…ç½®ã€‚

å½“æ‚¨æ˜¾å¼åŠ è½½æ¨¡åž‹æ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡`model.generation_config`æ£€æŸ¥éšä¹‹æä¾›çš„ç”Ÿæˆé…ç½®ï¼š

```py
>>> from transformers import AutoModelForCausalLM

>>> model = AutoModelForCausalLM.from_pretrained("distilgpt2")
>>> model.generation_config
GenerationConfig {
    "bos_token_id": 50256,
    "eos_token_id": 50256,
}
```

æ‰“å°å‡º`model.generation_config`åªæ˜¾ç¤ºä¸Žé»˜è®¤ç”Ÿæˆé…ç½®ä¸åŒçš„å€¼ï¼Œå¹¶ä¸åˆ—å‡ºä»»ä½•é»˜è®¤å€¼ã€‚

é»˜è®¤ç”Ÿæˆé…ç½®é™åˆ¶è¾“å‡ºä¸Žè¾“å…¥æç¤ºçš„ç»„åˆå¤§å°æœ€å¤šä¸º20ä¸ªæ ‡è®°ï¼Œä»¥é¿å…é‡åˆ°èµ„æºé™åˆ¶ã€‚é»˜è®¤è§£ç ç­–ç•¥æ˜¯è´ªå©ªæœç´¢ï¼Œè¿™æ˜¯ä¸€ç§æœ€ç®€å•çš„è§£ç ç­–ç•¥ï¼Œå®ƒé€‰æ‹©å…·æœ‰æœ€é«˜æ¦‚çŽ‡çš„æ ‡è®°ä½œä¸ºä¸‹ä¸€ä¸ªæ ‡è®°ã€‚å¯¹äºŽè®¸å¤šä»»åŠ¡å’Œå°è¾“å‡ºå¤§å°ï¼Œè¿™ç§æ–¹æ³•æ•ˆæžœå¾ˆå¥½ã€‚ç„¶è€Œï¼Œå½“ç”¨äºŽç”Ÿæˆè¾ƒé•¿çš„è¾“å‡ºæ—¶ï¼Œè´ªå©ªæœç´¢å¯èƒ½ä¼šå¼€å§‹äº§ç”Ÿé«˜åº¦é‡å¤çš„ç»“æžœã€‚

## è‡ªå®šä¹‰æ–‡æœ¬ç”Ÿæˆ

æ‚¨å¯ä»¥é€šè¿‡ç›´æŽ¥å°†å‚æ•°åŠå…¶å€¼ä¼ é€’ç»™`generate`æ–¹æ³•æ¥è¦†ç›–ä»»ä½•`generation_config`ï¼š

```py
>>> my_model.generate(**inputs, num_beams=4, do_sample=True)
```

å³ä½¿é»˜è®¤è§£ç ç­–ç•¥å¯¹æ‚¨çš„ä»»åŠ¡å¤§éƒ¨åˆ†æœ‰æ•ˆï¼Œæ‚¨ä»ç„¶å¯ä»¥å¾®è°ƒä¸€äº›å†…å®¹ã€‚ä¸€äº›å¸¸è°ƒæ•´çš„å‚æ•°åŒ…æ‹¬ï¼š

+   `max_new_tokens`ï¼šè¦ç”Ÿæˆçš„æ ‡è®°çš„æœ€å¤§æ•°é‡ã€‚æ¢å¥è¯è¯´ï¼Œè¾“å‡ºåºåˆ—çš„å¤§å°ï¼Œä¸åŒ…æ‹¬æç¤ºä¸­çš„æ ‡è®°ã€‚ä½œä¸ºä½¿ç”¨è¾“å‡ºé•¿åº¦ä½œä¸ºåœæ­¢æ ‡å‡†çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæ‚¨å¯ä»¥é€‰æ‹©åœ¨å®Œæ•´ç”Ÿæˆè¶…è¿‡æŸä¸ªæ—¶é—´é‡æ—¶åœæ­¢ç”Ÿæˆã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹[StoppingCriteria](/docs/transformers/v4.37.2/en/internal/generation_utils#transformers.StoppingCriteria)ã€‚

+   `num_beams`ï¼šé€šè¿‡æŒ‡å®šé«˜äºŽ1çš„æ³¢æŸæ•°é‡ï¼Œæ‚¨å®žé™…ä¸Šæ˜¯ä»Žè´ªå©ªæœç´¢åˆ‡æ¢åˆ°æ³¢æŸæœç´¢ã€‚è¿™ç§ç­–ç•¥åœ¨æ¯ä¸ªæ—¶é—´æ­¥è¯„ä¼°å‡ ä¸ªå‡è®¾ï¼Œæœ€ç»ˆé€‰æ‹©å…·æœ‰æ•´ä¸ªåºåˆ—çš„æœ€é«˜æ¦‚çŽ‡çš„å‡è®¾ã€‚è¿™æœ‰ä¸€ä¸ªä¼˜ç‚¹ï¼Œå¯ä»¥è¯†åˆ«ä»¥è¾ƒä½Žæ¦‚çŽ‡åˆå§‹æ ‡è®°å¼€å¤´çš„é«˜æ¦‚çŽ‡åºåˆ—ï¼Œå¹¶ä¸”ä¼šè¢«è´ªå©ªæœç´¢å¿½ç•¥ã€‚

+   `do_sample`ï¼šå¦‚æžœè®¾ç½®ä¸º`True`ï¼Œæ­¤å‚æ•°å°†å¯ç”¨è§£ç ç­–ç•¥ï¼Œå¦‚å¤šé¡¹å¼é‡‡æ ·ã€æ³¢æŸæœç´¢å¤šé¡¹å¼é‡‡æ ·ã€Top-Ké‡‡æ ·å’ŒTop-pé‡‡æ ·ã€‚æ‰€æœ‰è¿™äº›ç­–ç•¥ä»Žæ•´ä¸ªè¯æ±‡è¡¨çš„æ¦‚çŽ‡åˆ†å¸ƒä¸­é€‰æ‹©ä¸‹ä¸€ä¸ªæ ‡è®°ï¼Œå…·æœ‰å„ç§ç‰¹å®šç­–ç•¥çš„è°ƒæ•´ã€‚

+   `num_return_sequences`ï¼šè¦ä¸ºæ¯ä¸ªè¾“å…¥è¿”å›žçš„åºåˆ—å€™é€‰æ•°ã€‚æ­¤é€‰é¡¹ä»…é€‚ç”¨äºŽæ”¯æŒå¤šä¸ªåºåˆ—å€™é€‰çš„è§£ç ç­–ç•¥ï¼Œä¾‹å¦‚æ³¢æŸæœç´¢å’Œé‡‡æ ·çš„å˜ä½“ã€‚è´ªå©ªæœç´¢å’Œå¯¹æ¯”æœç´¢ç­‰è§£ç ç­–ç•¥è¿”å›žå•ä¸ªè¾“å‡ºåºåˆ—ã€‚

## ä¿å­˜å¸¦æœ‰æ‚¨çš„æ¨¡åž‹çš„è‡ªå®šä¹‰è§£ç ç­–ç•¥

å¦‚æžœæ‚¨æƒ³è¦ä¸Žç‰¹å®šç”Ÿæˆé…ç½®å…±äº«æ‚¨å¾®è°ƒçš„æ¨¡åž‹ï¼Œæ‚¨å¯ä»¥ï¼š

+   åˆ›å»ºä¸€ä¸ª[GenerationConfig](/docs/transformers/v4.37.2/en/main_classes/text_generation#transformers.GenerationConfig)ç±»å®žä¾‹

+   æŒ‡å®šè§£ç ç­–ç•¥å‚æ•°

+   ä½¿ç”¨[GenerationConfig.save_pretrained()](/docs/transformers/v4.37.2/en/main_classes/text_generation#transformers.GenerationConfig.save_pretrained)ä¿å­˜æ‚¨çš„ç”Ÿæˆé…ç½®ï¼Œç¡®ä¿å°†å…¶`config_file_name`å‚æ•°ç•™ç©º

+   å°†`push_to_hub`è®¾ç½®ä¸º`True`ï¼Œå°†æ‚¨çš„é…ç½®ä¸Šä¼ åˆ°æ¨¡åž‹çš„å­˜å‚¨åº“

```py
>>> from transformers import AutoModelForCausalLM, GenerationConfig

>>> model = AutoModelForCausalLM.from_pretrained("my_account/my_model")
>>> generation_config = GenerationConfig(
...     max_new_tokens=50, do_sample=True, top_k=50, eos_token_id=model.config.eos_token_id
... )
>>> generation_config.save_pretrained("my_account/my_model", push_to_hub=True)
```

æ‚¨è¿˜å¯ä»¥åœ¨å•ä¸ªç›®å½•ä¸­å­˜å‚¨å¤šä¸ªç”Ÿæˆé…ç½®ï¼Œåˆ©ç”¨[GenerationConfig.save_pretrained()](/docs/transformers/v4.37.2/en/main_classes/text_generation#transformers.GenerationConfig.save_pretrained)ä¸­çš„`config_file_name`å‚æ•°ã€‚æ‚¨å¯ä»¥ç¨åŽä½¿ç”¨[GenerationConfig.from_pretrained()](/docs/transformers/v4.37.2/en/main_classes/text_generation#transformers.GenerationConfig.from_pretrained)å®žä¾‹åŒ–å®ƒä»¬ã€‚å¦‚æžœæ‚¨æƒ³ä¸ºå•ä¸ªæ¨¡åž‹å­˜å‚¨å¤šä¸ªç”Ÿæˆé…ç½®ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨äºŽé‡‡æ ·çš„åˆ›æ„æ–‡æœ¬ç”Ÿæˆï¼Œä¸€ä¸ªç”¨äºŽæ³¢æŸæœç´¢çš„æ‘˜è¦ï¼‰ï¼Œåˆ™å¿…é¡»å…·æœ‰æ­£ç¡®çš„Hubæƒé™ä»¥å‘æ¨¡åž‹æ·»åŠ é…ç½®æ–‡ä»¶ã€‚

```py
>>> from transformers import AutoModelForSeq2SeqLM, AutoTokenizer, GenerationConfig

>>> tokenizer = AutoTokenizer.from_pretrained("t5-small")
>>> model = AutoModelForSeq2SeqLM.from_pretrained("t5-small")

>>> translation_generation_config = GenerationConfig(
...     num_beams=4,
...     early_stopping=True,
...     decoder_start_token_id=0,
...     eos_token_id=model.config.eos_token_id,
...     pad_token=model.config.pad_token_id,
... )

>>> # Tip: add `push_to_hub=True` to push to the Hub
>>> translation_generation_config.save_pretrained("/tmp", "translation_generation_config.json")

>>> # You could then use the named generation config file to parameterize generation
>>> generation_config = GenerationConfig.from_pretrained("/tmp", "translation_generation_config.json")
>>> inputs = tokenizer("translate English to French: Configuration files are easy to use!", return_tensors="pt")
>>> outputs = model.generate(**inputs, generation_config=generation_config)
>>> print(tokenizer.batch_decode(outputs, skip_special_tokens=True))
['Les fichiers de configuration sont faciles Ã  utiliser!']
```

## æµå¼ä¼ è¾“

`generate()`æ”¯æŒæµå¼ä¼ è¾“ï¼Œé€šè¿‡å…¶`streamer`è¾“å…¥ã€‚`streamer`è¾“å…¥ä¸Žå…·æœ‰ä»¥ä¸‹æ–¹æ³•çš„ç±»çš„ä»»ä½•å®žä¾‹å…¼å®¹ï¼š`put()`å’Œ`end()`ã€‚åœ¨å†…éƒ¨ï¼Œ`put()`ç”¨äºŽæŽ¨é€æ–°æ ‡è®°ï¼Œ`end()`ç”¨äºŽæ ‡è®°æ–‡æœ¬ç”Ÿæˆçš„ç»“æŸã€‚

æµåª’ä½“ç±»çš„APIä»åœ¨å¼€å‘ä¸­ï¼Œå¯èƒ½ä¼šåœ¨æœªæ¥å‘ç”Ÿå˜åŒ–ã€‚

å®žé™…ä¸Šï¼Œæ‚¨å¯ä»¥ä¸ºå„ç§ç›®çš„åˆ¶ä½œè‡ªå·±çš„æµå¼ä¼ è¾“ç±»ï¼æˆ‘ä»¬è¿˜ä¸ºæ‚¨å‡†å¤‡äº†åŸºæœ¬çš„æµå¼ä¼ è¾“ç±»ä¾›æ‚¨ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨[TextStreamer](/docs/transformers/v4.37.2/en/internal/generation_utils#transformers.TextStreamer)ç±»å°†`generate()`çš„è¾“å‡ºæµå¼ä¼ è¾“åˆ°å±å¹•ä¸Šï¼Œæ¯æ¬¡ä¸€ä¸ªè¯ï¼š

```py
>>> from transformers import AutoModelForCausalLM, AutoTokenizer, TextStreamer

>>> tok = AutoTokenizer.from_pretrained("gpt2")
>>> model = AutoModelForCausalLM.from_pretrained("gpt2")
>>> inputs = tok(["An increasing sequence: one,"], return_tensors="pt")
>>> streamer = TextStreamer(tok)

>>> # Despite returning the usual output, the streamer will also print the generated text to stdout.
>>> _ = model.generate(**inputs, streamer=streamer, max_new_tokens=20)
An increasing sequence: one, two, three, four, five, six, seven, eight, nine, ten, eleven,
```

## è§£ç ç­–ç•¥

æŸäº›`generate()`å‚æ•°çš„ç»„åˆï¼Œæœ€ç»ˆ`generation_config`å¯ä»¥ç”¨äºŽå¯ç”¨ç‰¹å®šçš„è§£ç ç­–ç•¥ã€‚å¦‚æžœæ‚¨å¯¹è¿™ä¸ªæ¦‚å¿µè¿˜ä¸ç†Ÿæ‚‰ï¼Œæˆ‘ä»¬å»ºè®®é˜…è¯»[è¿™ç¯‡åšæ–‡ï¼Œå±•ç¤ºäº†å¸¸è§çš„è§£ç ç­–ç•¥å¦‚ä½•å·¥ä½œ](https://huggingface.co/blog/how-to-generate)ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†å±•ç¤ºæŽ§åˆ¶è§£ç ç­–ç•¥çš„ä¸€äº›å‚æ•°ï¼Œå¹¶è¯´æ˜Žå¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚

### è´ªå©ªæœç´¢

`generate`é»˜è®¤ä½¿ç”¨è´ªå©ªæœç´¢è§£ç ï¼Œå› æ­¤æ‚¨æ— éœ€ä¼ é€’ä»»ä½•å‚æ•°æ¥å¯ç”¨å®ƒã€‚è¿™æ„å‘³ç€å‚æ•°`num_beams`è®¾ç½®ä¸º1ï¼Œ`do_sample=False`ã€‚

```py
>>> from transformers import AutoModelForCausalLM, AutoTokenizer

>>> prompt = "I look forward to"
>>> checkpoint = "distilgpt2"

>>> tokenizer = AutoTokenizer.from_pretrained(checkpoint)
>>> inputs = tokenizer(prompt, return_tensors="pt")

>>> model = AutoModelForCausalLM.from_pretrained(checkpoint)
>>> outputs = model.generate(**inputs)
>>> tokenizer.batch_decode(outputs, skip_special_tokens=True)
['I look forward to seeing you all again!\n\n\n\n\n\n\n\n\n\n\n']
```

### å¯¹æ¯”æœç´¢

å¯¹æ¯”æœç´¢è§£ç ç­–ç•¥æ˜¯åœ¨2022å¹´çš„è®ºæ–‡[A Contrastive Framework for Neural Text Generation](https://arxiv.org/abs/2202.06417)ä¸­æå‡ºçš„ã€‚å®ƒå±•ç¤ºäº†ç”Ÿæˆéžé‡å¤ä½†è¿žè´¯çš„é•¿è¾“å‡ºçš„ä¼˜è¶Šç»“æžœã€‚è¦äº†è§£å¯¹æ¯”æœç´¢çš„å·¥ä½œåŽŸç†ï¼Œè¯·æŸ¥çœ‹[è¿™ç¯‡åšå®¢æ–‡ç« ](https://huggingface.co/blog/introducing-csearch)ã€‚å¯ç”¨å’ŒæŽ§åˆ¶å¯¹æ¯”æœç´¢è¡Œä¸ºçš„ä¸¤ä¸ªä¸»è¦å‚æ•°æ˜¯`penalty_alpha`å’Œ`top_k`ï¼š

```py
>>> from transformers import AutoTokenizer, AutoModelForCausalLM

>>> checkpoint = "gpt2-large"
>>> tokenizer = AutoTokenizer.from_pretrained(checkpoint)
>>> model = AutoModelForCausalLM.from_pretrained(checkpoint)

>>> prompt = "Hugging Face Company is"
>>> inputs = tokenizer(prompt, return_tensors="pt")

>>> outputs = model.generate(**inputs, penalty_alpha=0.6, top_k=4, max_new_tokens=100)
>>> tokenizer.batch_decode(outputs, skip_special_tokens=True)
['Hugging Face Company is a family owned and operated business. We pride ourselves on being the best
in the business and our customer service is second to none.\n\nIf you have any questions about our
products or services, feel free to contact us at any time. We look forward to hearing from you!']
```

### å¤šé¡¹å¼æŠ½æ ·

ä¸Žæ€»æ˜¯é€‰æ‹©å…·æœ‰æœ€é«˜æ¦‚çŽ‡çš„æ ‡è®°ä½œä¸ºä¸‹ä¸€ä¸ªæ ‡è®°çš„è´ªå©ªæœç´¢ç›¸åï¼Œå¤šé¡¹å¼æŠ½æ ·ï¼ˆä¹Ÿç§°ä¸ºç¥–å…ˆæŠ½æ ·ï¼‰æ ¹æ®æ¨¡åž‹ç»™å‡ºçš„æ•´ä¸ªè¯æ±‡è¡¨ä¸Šçš„æ¦‚çŽ‡åˆ†å¸ƒéšæœºé€‰æ‹©ä¸‹ä¸€ä¸ªæ ‡è®°ã€‚æ¯ä¸ªå…·æœ‰éžé›¶æ¦‚çŽ‡çš„æ ‡è®°éƒ½æœ‰è¢«é€‰æ‹©çš„æœºä¼šï¼Œä»Žè€Œé™ä½Žé‡å¤çš„é£Žé™©ã€‚

è¦å¯ç”¨å¤šé¡¹å¼æŠ½æ ·ï¼Œè¯·è®¾ç½®`do_sample=True`å’Œ`num_beams=1`ã€‚

```py
>>> from transformers import AutoTokenizer, AutoModelForCausalLM, set_seed
>>> set_seed(0)  # For reproducibility

>>> checkpoint = "gpt2-large"
>>> tokenizer = AutoTokenizer.from_pretrained(checkpoint)
>>> model = AutoModelForCausalLM.from_pretrained(checkpoint)

>>> prompt = "Today was an amazing day because"
>>> inputs = tokenizer(prompt, return_tensors="pt")

>>> outputs = model.generate(**inputs, do_sample=True, num_beams=1, max_new_tokens=100)
>>> tokenizer.batch_decode(outputs, skip_special_tokens=True)
['Today was an amazing day because when you go to the World Cup and you don\'t, or when you don\'t get invited,
that\'s a terrible feeling."']
```

### æŸæœç´¢è§£ç 

ä¸Žè´ªå©ªæœç´¢ä¸åŒï¼ŒæŸæœç´¢è§£ç åœ¨æ¯ä¸ªæ—¶é—´æ­¥ä¿ç•™å‡ ä¸ªå‡è®¾ï¼Œå¹¶æœ€ç»ˆé€‰æ‹©æ•´ä¸ªåºåˆ—çš„æ€»ä½“æ¦‚çŽ‡æœ€é«˜çš„å‡è®¾ã€‚è¿™æœ‰åŠ©äºŽè¯†åˆ«ä»¥è¾ƒä½Žæ¦‚çŽ‡åˆå§‹æ ‡è®°å¼€å¤´çš„é«˜æ¦‚çŽ‡åºåˆ—ï¼Œè¿™äº›åºåˆ—åœ¨è´ªå©ªæœç´¢ä¸­ä¼šè¢«å¿½ç•¥ã€‚

è¦å¯ç”¨è¿™ç§è§£ç ç­–ç•¥ï¼Œè¯·æŒ‡å®š`num_beams`ï¼ˆå³è¦è·Ÿè¸ªçš„å‡è®¾æ•°é‡ï¼‰å¤§äºŽ1ã€‚

```py
>>> from transformers import AutoModelForCausalLM, AutoTokenizer

>>> prompt = "It is astonishing how one can"
>>> checkpoint = "gpt2-medium"

>>> tokenizer = AutoTokenizer.from_pretrained(checkpoint)
>>> inputs = tokenizer(prompt, return_tensors="pt")

>>> model = AutoModelForCausalLM.from_pretrained(checkpoint)

>>> outputs = model.generate(**inputs, num_beams=5, max_new_tokens=50)
>>> tokenizer.batch_decode(outputs, skip_special_tokens=True)
['It is astonishing how one can have such a profound impact on the lives of so many people in such a short period of
time."\n\nHe added: "I am very proud of the work I have been able to do in the last few years.\n\n"I have']
```

### æŸæœç´¢å¤šé¡¹å¼æŠ½æ ·

æ­£å¦‚å…¶åç§°æ‰€ç¤ºï¼Œè¿™ç§è§£ç ç­–ç•¥å°†æŸæœç´¢ä¸Žå¤šé¡¹å¼æŠ½æ ·ç»“åˆåœ¨ä¸€èµ·ã€‚æ‚¨éœ€è¦æŒ‡å®š`num_beams`å¤§äºŽ1ï¼Œå¹¶è®¾ç½®`do_sample=True`ä»¥ä½¿ç”¨è¿™ç§è§£ç ç­–ç•¥ã€‚

```py
>>> from transformers import AutoTokenizer, AutoModelForSeq2SeqLM, set_seed
>>> set_seed(0)  # For reproducibility

>>> prompt = "translate English to German: The house is wonderful."
>>> checkpoint = "t5-small"

>>> tokenizer = AutoTokenizer.from_pretrained(checkpoint)
>>> inputs = tokenizer(prompt, return_tensors="pt")

>>> model = AutoModelForSeq2SeqLM.from_pretrained(checkpoint)

>>> outputs = model.generate(**inputs, num_beams=5, do_sample=True)
>>> tokenizer.decode(outputs[0], skip_special_tokens=True)
'Das Haus ist wunderbar.'
```

### å¤šæ ·æŸæœç´¢è§£ç 

å¤šæ ·æŸæœç´¢è§£ç ç­–ç•¥æ˜¯æŸæœç´¢ç­–ç•¥çš„æ‰©å±•ï¼Œå…è®¸ç”Ÿæˆæ›´å¤šæ ·åŒ–çš„æŸåºåˆ—ä¾›é€‰æ‹©ã€‚è¦äº†è§£å…¶å·¥ä½œåŽŸç†ï¼Œè¯·å‚è€ƒ[Diverse Beam Search: Decoding Diverse Solutions from Neural Sequence Models](https://arxiv.org/pdf/1610.02424.pdf)ã€‚è¿™ç§æ–¹æ³•æœ‰ä¸‰ä¸ªä¸»è¦å‚æ•°ï¼š`num_beams`ã€`num_beam_groups`å’Œ`diversity_penalty`ã€‚å¤šæ ·æ€§æƒ©ç½šç¡®ä¿è¾“å‡ºåœ¨ç»„é—´æ˜¯ä¸åŒçš„ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªç»„å†…ä½¿ç”¨æŸæœç´¢ã€‚

```py
>>> from transformers import AutoTokenizer, AutoModelForSeq2SeqLM

>>> checkpoint = "google/pegasus-xsum"
>>> prompt = (
...     "The Permaculture Design Principles are a set of universal design principles "
...     "that can be applied to any location, climate and culture, and they allow us to design "
...     "the most efficient and sustainable human habitation and food production systems. "
...     "Permaculture is a design system that encompasses a wide variety of disciplines, such "
...     "as ecology, landscape design, environmental science and energy conservation, and the "
...     "Permaculture design principles are drawn from these various disciplines. Each individual "
...     "design principle itself embodies a complete conceptual framework based on sound "
...     "scientific principles. When we bring all these separate  principles together, we can "
...     "create a design system that both looks at whole systems, the parts that these systems "
...     "consist of, and how those parts interact with each other to create a complex, dynamic, "
...     "living system. Each design principle serves as a tool that allows us to integrate all "
...     "the separate parts of a design, referred to as elements, into a functional, synergistic, "
...     "whole system, where the elements harmoniously interact and work together in the most "
...     "efficient way possible."
... )

>>> tokenizer = AutoTokenizer.from_pretrained(checkpoint)
>>> inputs = tokenizer(prompt, return_tensors="pt")

>>> model = AutoModelForSeq2SeqLM.from_pretrained(checkpoint)

>>> outputs = model.generate(**inputs, num_beams=5, num_beam_groups=5, max_new_tokens=30, diversity_penalty=1.0)
>>> tokenizer.decode(outputs[0], skip_special_tokens=True)
'The Design Principles are a set of universal design principles that can be applied to any location, climate and
culture, and they allow us to design the'
```

æœ¬æŒ‡å—è¯´æ˜Žäº†å¯ç”¨å„ç§è§£ç ç­–ç•¥çš„ä¸»è¦å‚æ•°ã€‚`generate`æ–¹æ³•è¿˜æœ‰æ›´é«˜çº§çš„å‚æ•°ï¼Œå¯ä»¥è¿›ä¸€æ­¥æŽ§åˆ¶`generate`æ–¹æ³•çš„è¡Œä¸ºã€‚æœ‰å…³å¯ç”¨å‚æ•°çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚è€ƒ[APIæ–‡æ¡£](./main_classes/text_generation.md)ã€‚

### æŽ¨æµ‹è§£ç 

æŽ¨æµ‹è§£ç ï¼ˆä¹Ÿç§°ä¸ºè¾…åŠ©è§£ç ï¼‰æ˜¯ä¸Šè¿°è§£ç ç­–ç•¥çš„ä¿®æ”¹ç‰ˆæœ¬ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªåŠ©ç†æ¨¡åž‹ï¼ˆç†æƒ³æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªæ›´å°çš„æ¨¡åž‹ï¼‰ä¸Žç›¸åŒçš„åˆ†è¯å™¨ï¼Œç”Ÿæˆä¸€äº›å€™é€‰æ ‡è®°ã€‚ç„¶åŽä¸»æ¨¡åž‹åœ¨å•ä¸ªå‰å‘ä¼ é€’ä¸­éªŒè¯å€™é€‰æ ‡è®°ï¼Œä»Žè€ŒåŠ å¿«è§£ç è¿‡ç¨‹ã€‚å¦‚æžœ`do_sample=True`ï¼Œåˆ™ä½¿ç”¨[æŽ¨æµ‹è§£ç è®ºæ–‡](https://arxiv.org/pdf/2211.17192.pdf)ä¸­å¼•å…¥çš„é‡æ–°æŠ½æ ·è¿›è¡Œæ ‡è®°éªŒè¯ã€‚

ç›®å‰ï¼Œåªæ”¯æŒè´ªå©ªæœç´¢å’ŒæŠ½æ ·ä¸Žè¾…åŠ©è§£ç ï¼Œå¹¶ä¸”è¾…åŠ©è§£ç ä¸æ”¯æŒæ‰¹é‡è¾“å…¥ã€‚è¦äº†è§£æ›´å¤šå…³äºŽè¾…åŠ©è§£ç çš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹[è¿™ç¯‡åšå®¢æ–‡ç« ](https://huggingface.co/blog/assisted-generation)ã€‚

è¦å¯ç”¨è¾…åŠ©è§£ç ï¼Œè¯·ä½¿ç”¨ä¸€ä¸ªæ¨¡åž‹è®¾ç½®`assistant_model`å‚æ•°ã€‚

```py
>>> from transformers import AutoModelForCausalLM, AutoTokenizer

>>> prompt = "Alice and Bob"
>>> checkpoint = "EleutherAI/pythia-1.4b-deduped"
>>> assistant_checkpoint = "EleutherAI/pythia-160m-deduped"

>>> tokenizer = AutoTokenizer.from_pretrained(checkpoint)
>>> inputs = tokenizer(prompt, return_tensors="pt")

>>> model = AutoModelForCausalLM.from_pretrained(checkpoint)
>>> assistant_model = AutoModelForCausalLM.from_pretrained(assistant_checkpoint)
>>> outputs = model.generate(**inputs, assistant_model=assistant_model)
>>> tokenizer.batch_decode(outputs, skip_special_tokens=True)
['Alice and Bob are sitting in a bar. Alice is drinking a beer and Bob is drinking a']
```

åœ¨ä½¿ç”¨è¾…åŠ©è§£ç ä¸ŽæŠ½æ ·æ–¹æ³•æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`temperature`å‚æ•°æ¥æŽ§åˆ¶éšæœºæ€§ï¼Œå°±åƒåœ¨å¤šé¡¹å¼æŠ½æ ·ä¸­ä¸€æ ·ã€‚ç„¶è€Œï¼Œåœ¨è¾…åŠ©è§£ç ä¸­ï¼Œé™ä½Žæ¸©åº¦å¯èƒ½æœ‰åŠ©äºŽæé«˜å»¶è¿Ÿã€‚

```py
>>> from transformers import AutoModelForCausalLM, AutoTokenizer, set_seed
>>> set_seed(42)  # For reproducibility

>>> prompt = "Alice and Bob"
>>> checkpoint = "EleutherAI/pythia-1.4b-deduped"
>>> assistant_checkpoint = "EleutherAI/pythia-160m-deduped"

>>> tokenizer = AutoTokenizer.from_pretrained(checkpoint)
>>> inputs = tokenizer(prompt, return_tensors="pt")

>>> model = AutoModelForCausalLM.from_pretrained(checkpoint)
>>> assistant_model = AutoModelForCausalLM.from_pretrained(assistant_checkpoint)
>>> outputs = model.generate(**inputs, assistant_model=assistant_model, do_sample=True, temperature=0.5)
>>> tokenizer.batch_decode(outputs, skip_special_tokens=True)
['Alice and Bob are going to the same party. It is a small party, in a small']
```
