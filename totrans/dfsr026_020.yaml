- en: Load different Stable Diffusion formats
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: åŠ è½½ä¸åŒçš„ Stable Diffusion æ ¼å¼
- en: 'Original text: [https://huggingface.co/docs/diffusers/using-diffusers/other-formats](https://huggingface.co/docs/diffusers/using-diffusers/other-formats)'
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸå§‹æ–‡æœ¬ï¼š[https://huggingface.co/docs/diffusers/using-diffusers/other-formats](https://huggingface.co/docs/diffusers/using-diffusers/other-formats)
- en: null
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: Stable Diffusion models are available in different formats depending on the
    framework theyâ€™re trained and saved with, and where you download them from. Converting
    these formats for use in ğŸ¤— Diffusers allows you to use all the features supported
    by the library, such as [using different schedulers](schedulers) for inference,
    [building your custom pipeline](write_own_pipeline), and a variety of techniques
    and methods for [optimizing inference speed](../optimization/opt_overview).
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: ç¨³å®šçš„æ‰©æ•£æ¨¡å‹ä»¥ä¸åŒçš„æ ¼å¼æä¾›ï¼Œå…·ä½“å–å†³äºå®ƒä»¬æ‰€è®­ç»ƒå’Œä¿å­˜çš„æ¡†æ¶ï¼Œä»¥åŠæ‚¨ä»å“ªé‡Œä¸‹è½½å®ƒä»¬ã€‚å°†è¿™äº›æ ¼å¼è½¬æ¢ä¸º ğŸ¤— Diffusers ä»¥ä¾¿åœ¨åº“ä¸­ä½¿ç”¨æ‰€æœ‰æ”¯æŒçš„åŠŸèƒ½ï¼Œä¾‹å¦‚[ä½¿ç”¨ä¸åŒçš„è°ƒåº¦å™¨](schedulers)è¿›è¡Œæ¨æ–­ï¼Œ[æ„å»ºè‡ªå®šä¹‰æµæ°´çº¿](write_own_pipeline)ï¼Œä»¥åŠå„ç§ç”¨äº[ä¼˜åŒ–æ¨æ–­é€Ÿåº¦](../optimization/opt_overview)çš„æŠ€æœ¯å’Œæ–¹æ³•ã€‚
- en: We highly recommend using the `.safetensors` format because it is more secure
    than traditional pickled files which are vulnerable and can be exploited to execute
    any code on your machine (learn more in the [Load safetensors](using_safetensors)
    guide).
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½¿ç”¨ `.safetensors` æ ¼å¼ï¼Œå› ä¸ºå®ƒæ¯”ä¼ ç»Ÿçš„å¯è¢«åˆ©ç”¨æ¥åœ¨æ‚¨çš„æœºå™¨ä¸Šæ‰§è¡Œä»»ä½•ä»£ç çš„ pickled æ–‡ä»¶æ›´å®‰å…¨ï¼ˆåœ¨[åŠ è½½ safetensors](using_safetensors)æŒ‡å—ä¸­äº†è§£æ›´å¤šï¼‰ã€‚
- en: This guide will show you how to convert other Stable Diffusion formats to be
    compatible with ğŸ¤— Diffusers.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: æœ¬æŒ‡å—å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•å°†å…¶ä»– Stable Diffusion æ ¼å¼è½¬æ¢ä¸ºä¸ ğŸ¤— Diffusers å…¼å®¹ã€‚
- en: PyTorch .ckpt
  id: totrans-6
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: PyTorch .ckpt
- en: The checkpoint - or `.ckpt` - format is commonly used to store and save models.
    The `.ckpt` file contains the entire model and is typically several GBs in size.
    While you can load and use a `.ckpt` file directly with the [from_single_file()](/docs/diffusers/v0.26.3/en/api/loaders/single_file#diffusers.loaders.FromSingleFileMixin.from_single_file)
    method, it is generally better to convert the `.ckpt` file to ğŸ¤— Diffusers so both
    formats are available.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: æ£€æŸ¥ç‚¹ - æˆ– `.ckpt` - æ ¼å¼é€šå¸¸ç”¨äºå­˜å‚¨å’Œä¿å­˜æ¨¡å‹ã€‚`.ckpt` æ–‡ä»¶åŒ…å«æ•´ä¸ªæ¨¡å‹ï¼Œé€šå¸¸å¤§å°ä¸ºå‡ ä¸ªGBã€‚è™½ç„¶æ‚¨å¯ä»¥ç›´æ¥ä½¿ç”¨ [from_single_file()](/docs/diffusers/v0.26.3/en/api/loaders/single_file#diffusers.loaders.FromSingleFileMixin.from_single_file)
    æ–¹æ³•åŠ è½½å’Œä½¿ç”¨ `.ckpt` æ–‡ä»¶ï¼Œä½†é€šå¸¸æœ€å¥½å°† `.ckpt` æ–‡ä»¶è½¬æ¢ä¸º ğŸ¤— Diffusersï¼Œä»¥ä¾¿ä¸¤ç§æ ¼å¼éƒ½å¯ç”¨ã€‚
- en: 'There are two options for converting a `.ckpt` file: use a Space to convert
    the checkpoint or convert the `.ckpt` file with a script.'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: æœ‰ä¸¤ç§é€‰é¡¹å¯ä»¥è½¬æ¢ `.ckpt` æ–‡ä»¶ï¼šä½¿ç”¨ Space è½¬æ¢æ£€æŸ¥ç‚¹æˆ–ä½¿ç”¨è„šæœ¬è½¬æ¢ `.ckpt` æ–‡ä»¶ã€‚
- en: Convert with a Space
  id: totrans-9
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ä½¿ç”¨ Space è¿›è¡Œè½¬æ¢
- en: The easiest and most convenient way to convert a `.ckpt` file is to use the
    [SD to Diffusers](https://huggingface.co/spaces/diffusers/sd-to-diffusers) Space.
    You can follow the instructions on the Space to convert the `.ckpt` file.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: è½¬æ¢ `.ckpt` æ–‡ä»¶çš„æœ€ç®€å•å’Œæœ€ä¾¿æ·çš„æ–¹æ³•æ˜¯ä½¿ç”¨ [SD to Diffusers](https://huggingface.co/spaces/diffusers/sd-to-diffusers)
    Spaceã€‚æ‚¨å¯ä»¥æŒ‰ç…§ Space ä¸Šçš„è¯´æ˜è½¬æ¢ `.ckpt` æ–‡ä»¶ã€‚
- en: This approach works well for basic models, but it may struggle with more customized
    models. Youâ€™ll know the Space failed if it returns an empty pull request or error.
    In this case, you can try converting the `.ckpt` file with a script.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ç§æ–¹æ³•é€‚ç”¨äºåŸºæœ¬æ¨¡å‹ï¼Œä½†å¯èƒ½åœ¨æ›´å®šåˆ¶çš„æ¨¡å‹ä¸Šé‡åˆ°å›°éš¾ã€‚å¦‚æœè¿”å›ç©ºçš„æ‹‰å–è¯·æ±‚æˆ–é”™è¯¯ï¼Œåˆ™ä¼šçŸ¥é“ç©ºé—´å¤±è´¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥å°è¯•ä½¿ç”¨è„šæœ¬è½¬æ¢ `.ckpt`
    æ–‡ä»¶ã€‚
- en: Convert with a script
  id: totrans-12
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ä½¿ç”¨è„šæœ¬è¿›è¡Œè½¬æ¢
- en: ğŸ¤— Diffusers provides a [conversion script](https://github.com/huggingface/diffusers/blob/main/scripts/convert_original_stable_diffusion_to_diffusers.py)
    for converting `.ckpt` files. This approach is more reliable than the Space above.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ¤— Diffusers æä¾›äº†ä¸€ä¸ª[è½¬æ¢è„šæœ¬](https://github.com/huggingface/diffusers/blob/main/scripts/convert_original_stable_diffusion_to_diffusers.py)ç”¨äºè½¬æ¢
    `.ckpt` æ–‡ä»¶ã€‚è¿™ç§æ–¹æ³•æ¯”ä¸Šé¢çš„ Space æ›´å¯é ã€‚
- en: Before you start, make sure you have a local clone of ğŸ¤— Diffusers to run the
    script and log in to your Hugging Face account so you can open pull requests and
    push your converted model to the Hub.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨æœ‰ä¸€ä¸ªæœ¬åœ°å…‹éš†çš„ ğŸ¤— Diffusers ä»¥è¿è¡Œè„šæœ¬ï¼Œå¹¶ç™»å½•åˆ°æ‚¨çš„ Hugging Face å¸æˆ·ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥æ‰“å¼€æ‹‰å–è¯·æ±‚å¹¶å°†è½¬æ¢çš„æ¨¡å‹æ¨é€åˆ°
    Hubã€‚
- en: '[PRE0]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'To use the script:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨è„šæœ¬ï¼š
- en: 'Git clone the repository containing the `.ckpt` file you want to convert. For
    this example, letâ€™s convert this [TemporalNet](https://huggingface.co/CiaraRowles/TemporalNet)
    `.ckpt` file:'
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å…‹éš†åŒ…å«æ‚¨è¦è½¬æ¢çš„ `.ckpt` æ–‡ä»¶çš„å­˜å‚¨åº“ã€‚ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬è½¬æ¢è¿™ä¸ª [TemporalNet](https://huggingface.co/CiaraRowles/TemporalNet)
    `.ckpt` æ–‡ä»¶ï¼š
- en: '[PRE1]'
  id: totrans-18
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Open a pull request on the repository where youâ€™re converting the checkpoint
    from:'
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åœ¨æ‚¨ä»ä¸­è½¬æ¢æ£€æŸ¥ç‚¹çš„å­˜å‚¨åº“ä¸Šæ‰“å¼€ä¸€ä¸ªæ‹‰å–è¯·æ±‚ï¼š
- en: '[PRE2]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'There are several input arguments to configure in the conversion script, but
    the most important ones are:'
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: è½¬æ¢è„šæœ¬ä¸­æœ‰å‡ ä¸ªè¾“å…¥å‚æ•°éœ€è¦é…ç½®ï¼Œä½†æœ€é‡è¦çš„æ˜¯ï¼š
- en: '`checkpoint_path`: the path to the `.ckpt` file to convert.'
  id: totrans-22
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`checkpoint_path`ï¼šè¦è½¬æ¢çš„ `.ckpt` æ–‡ä»¶çš„è·¯å¾„ã€‚'
- en: '`original_config_file`: a YAML file defining the configuration of the original
    architecture. If you canâ€™t find this file, try searching for the YAML file in
    the GitHub repository where you found the `.ckpt` file.'
  id: totrans-23
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`original_config_file`ï¼šå®šä¹‰åŸå§‹æ¶æ„é…ç½®çš„ YAML æ–‡ä»¶ã€‚å¦‚æœæ‰¾ä¸åˆ°æ­¤æ–‡ä»¶ï¼Œè¯·å°è¯•åœ¨æ‰¾åˆ° `.ckpt` æ–‡ä»¶çš„ GitHub
    å­˜å‚¨åº“ä¸­æœç´¢ YAML æ–‡ä»¶ã€‚'
- en: '`dump_path`: the path to the converted model.'
  id: totrans-24
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`dump_path`ï¼šè½¬æ¢æ¨¡å‹çš„è·¯å¾„ã€‚'
- en: For example, you can take the `cldm_v15.yaml` file from the [ControlNet](https://github.com/lllyasviel/ControlNet/tree/main/models)
    repository because the TemporalNet model is a Stable Diffusion v1.5 and ControlNet
    model.
  id: totrans-25
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä» [ControlNet](https://github.com/lllyasviel/ControlNet/tree/main/models)
    å­˜å‚¨åº“ä¸­è·å– `cldm_v15.yaml` æ–‡ä»¶ï¼Œå› ä¸º TemporalNet æ¨¡å‹æ˜¯ Stable Diffusion v1.5 å’Œ ControlNet
    æ¨¡å‹ã€‚
- en: 'Now you can run the script to convert the `.ckpt` file:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ç°åœ¨æ‚¨å¯ä»¥è¿è¡Œè„šæœ¬æ¥è½¬æ¢ `.ckpt` æ–‡ä»¶ï¼š
- en: '[PRE3]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Once the conversion is done, upload your converted model and test out the resulting
    [pull request](https://huggingface.co/CiaraRowles/TemporalNet/discussions/13)!
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: è½¬æ¢å®Œæˆåï¼Œä¸Šä¼ æ‚¨è½¬æ¢çš„æ¨¡å‹å¹¶æµ‹è¯•ç”Ÿæˆçš„[æ‹‰å–è¯·æ±‚](https://huggingface.co/CiaraRowles/TemporalNet/discussions/13)!
- en: '[PRE4]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Keras .pb or .h5
  id: totrans-30
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Keras .pb æˆ– .h5
- en: ğŸ§ª This is an experimental feature. Only Stable Diffusion v1 checkpoints are
    supported by the Convert KerasCV Space at the moment.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ§ª è¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½ã€‚ç›®å‰ Convert KerasCV Space ä»…æ”¯æŒ Stable Diffusion v1 æ£€æŸ¥ç‚¹ã€‚
- en: '[KerasCV](https://keras.io/keras_cv/) supports training for [Stable Diffusion](https://github.com/keras-team/keras-cv/blob/master/keras_cv/models/stable_diffusion)
    v1 and v2\. However, it offers limited support for experimenting with Stable Diffusion
    models for inference and deployment whereas ğŸ¤— Diffusers has a more complete set
    of features for this purpose, such as different [noise schedulers](https://huggingface.co/docs/diffusers/using-diffusers/schedulers),
    [flash attention](https://huggingface.co/docs/diffusers/optimization/xformers),
    and [other optimization techniques](https://huggingface.co/docs/diffusers/optimization/fp16).'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: The [Convert KerasCV](https://huggingface.co/spaces/sayakpaul/convert-kerascv-sd-diffusers)
    Space converts `.pb` or `.h5` files to PyTorch, and then wraps them in a [StableDiffusionPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/stable_diffusion/text2img#diffusers.StableDiffusionPipeline)
    so it is ready for inference. The converted checkpoint is stored in a repository
    on the Hugging Face Hub.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: For this example, letâ€™s convert the [`sayakpaul/textual-inversion-kerasio`](https://huggingface.co/sayakpaul/textual-inversion-kerasio/tree/main)
    checkpoint which was trained with Textual Inversion. It uses the special token
    `<my-funny-cat>` to personalize images with cats.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: 'The Convert KerasCV Space allows you to input the following:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: Your Hugging Face token.
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Paths to download the UNet and text encoder weights from. Depending on how the
    model was trained, you donâ€™t necessarily need to provide the paths to both the
    UNet and text encoder. For example, Textual Inversion only requires the embeddings
    from the text encoder and a text-to-image model only requires the UNet weights.
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Placeholder token is only applicable for textual inversion models.
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The `output_repo_prefix` is the name of the repository where the converted model
    is stored.
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Click the **Submit** button to automatically convert the KerasCV checkpoint!
    Once the checkpoint is successfully converted, youâ€™ll see a link to the new repository
    containing the converted checkpoint. Follow the link to the new repository, and
    youâ€™ll see the Convert KerasCV Space generated a model card with an inference
    widget to try out the converted model.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: 'If you prefer to run inference with code, click on the **Use in Diffusers**
    button in the upper right corner of the model card to copy and paste the code
    snippet:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Then, you can generate an image like:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: A1111 LoRA files
  id: totrans-45
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[Automatic1111](https://github.com/AUTOMATIC1111/stable-diffusion-webui) (A1111)
    is a popular web UI for Stable Diffusion that supports model sharing platforms
    like [Civitai](https://civitai.com/). Models trained with the Low-Rank Adaptation
    (LoRA) technique are especially popular because theyâ€™re fast to train and have
    a much smaller file size than a fully finetuned model. ğŸ¤— Diffusers supports loading
    A1111 LoRA checkpoints with [load_lora_weights()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.LoraLoaderMixin.load_lora_weights):'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Download a LoRA checkpoint from Civitai; this example uses the [Blueprintify
    SD XL 1.0](https://civitai.com/models/150986/blueprintify-sd-xl-10) checkpoint,
    but feel free to try out any LoRA checkpoint!
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Load the LoRA checkpoint into the pipeline with the [load_lora_weights()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.LoraLoaderMixin.load_lora_weights)
    method:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Now you can use the pipeline to generate images:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![](../Images/cee84d318d0e1d6c11ae7b5a6f49a8ca.png)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
