- en: Stable Diffusion XL
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç¨³å®šæ‰©æ•£XL
- en: 'Original text: [https://huggingface.co/docs/diffusers/training/sdxl](https://huggingface.co/docs/diffusers/training/sdxl)'
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸå§‹æ–‡æœ¬ï¼š[https://huggingface.co/docs/diffusers/training/sdxl](https://huggingface.co/docs/diffusers/training/sdxl)
- en: null
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: This script is experimental, and itâ€™s easy to overfit and run into issues like
    catastrophic forgetting. Try exploring different hyperparameters to get the best
    results on your dataset.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªè„šæœ¬æ˜¯å®éªŒæ€§çš„ï¼Œå¾ˆå®¹æ˜“è¿‡æ‹Ÿåˆå¹¶é‡åˆ°åƒç¾éš¾æ€§é—å¿˜è¿™æ ·çš„é—®é¢˜ã€‚å°è¯•æ¢ç´¢ä¸åŒçš„è¶…å‚æ•°ä»¥è·å¾—æ•°æ®é›†ä¸Šçš„æœ€ä½³ç»“æœã€‚
- en: '[Stable Diffusion XL (SDXL)](https://hf.co/papers/2307.01952) is a larger and
    more powerful iteration of the Stable Diffusion model, capable of producing higher
    resolution images.'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '[ç¨³å®šæ‰©æ•£XLï¼ˆSDXLï¼‰](https://hf.co/papers/2307.01952)æ˜¯ç¨³å®šæ‰©æ•£æ¨¡å‹çš„ä¸€ä¸ªæ›´å¤§æ›´å¼ºå¤§çš„è¿­ä»£ç‰ˆæœ¬ï¼Œèƒ½å¤Ÿç”Ÿæˆæ›´é«˜åˆ†è¾¨ç‡çš„å›¾åƒã€‚'
- en: SDXLâ€™s UNet is 3x larger and the model adds a second text encoder to the architecture.
    Depending on the hardware available to you, this can be very computationally intensive
    and it may not run on a consumer GPU like a Tesla T4\. To help fit this larger
    model into memory and to speedup training, try enabling `gradient_checkpointing`,
    `mixed_precision`, and `gradient_accumulation_steps`. You can reduce your memory-usage
    even more by enabling memory-efficient attention with [xFormers](../optimization/xformers)
    and using [bitsandbytesâ€™](https://github.com/TimDettmers/bitsandbytes) 8-bit optimizer.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: SDXLçš„UNetæ˜¯3å€å¤§ï¼Œæ¨¡å‹åœ¨æ¶æ„ä¸­æ·»åŠ äº†ç¬¬äºŒä¸ªæ–‡æœ¬ç¼–ç å™¨ã€‚æ ¹æ®æ‚¨å¯ç”¨çš„ç¡¬ä»¶ï¼Œè¿™å¯èƒ½éå¸¸è®¡ç®—å¯†é›†ï¼Œå¯èƒ½æ— æ³•åœ¨åƒTesla T4è¿™æ ·çš„æ¶ˆè´¹è€…GPUä¸Šè¿è¡Œã€‚ä¸ºäº†å°†è¿™ä¸ªæ›´å¤§çš„æ¨¡å‹é€‚åº”å†…å­˜å¹¶åŠ å¿«è®­ç»ƒé€Ÿåº¦ï¼Œè¯·å°è¯•å¯ç”¨`gradient_checkpointing`ã€`mixed_precision`å’Œ`gradient_accumulation_steps`ã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡å¯ç”¨[xFormers](../optimization/xformers)çš„å†…å­˜é«˜æ•ˆæ³¨æ„åŠ›å’Œä½¿ç”¨[bitsandbytes'](https://github.com/TimDettmers/bitsandbytes)
    8ä½ä¼˜åŒ–å™¨æ¥è¿›ä¸€æ­¥å‡å°‘å†…å­˜ä½¿ç”¨ã€‚
- en: This guide will explore the [train_text_to_image_sdxl.py](https://github.com/huggingface/diffusers/blob/main/examples/text_to_image/train_text_to_image_sdxl.py)
    training script to help you become more familiar with it, and how you can adapt
    it for your own use-case.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: æœ¬æŒ‡å—å°†æ¢è®¨[train_text_to_image_sdxl.py](https://github.com/huggingface/diffusers/blob/main/examples/text_to_image/train_text_to_image_sdxl.py)è®­ç»ƒè„šæœ¬ï¼Œä»¥å¸®åŠ©æ‚¨æ›´ç†Ÿæ‚‰å®ƒï¼Œä»¥åŠå¦‚ä½•ä¸ºæ‚¨è‡ªå·±çš„ç”¨ä¾‹è¿›è¡Œè°ƒæ•´ã€‚
- en: 'Before running the script, make sure you install the library from source:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿è¡Œè„šæœ¬ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä»æºä»£ç å®‰è£…åº“ï¼š
- en: '[PRE0]'
  id: totrans-8
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Then navigate to the example folder containing the training script and install
    the required dependencies for the script youâ€™re using:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åè½¬åˆ°åŒ…å«è®­ç»ƒè„šæœ¬çš„ç¤ºä¾‹æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸ºæ‚¨æ­£åœ¨ä½¿ç”¨çš„è„šæœ¬å®‰è£…æ‰€éœ€çš„ä¾èµ–é¡¹ï¼š
- en: '[PRE1]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: ğŸ¤— Accelerate is a library for helping you train on multiple GPUs/TPUs or with
    mixed-precision. Itâ€™ll automatically configure your training setup based on your
    hardware and environment. Take a look at the ğŸ¤— Accelerate [Quick tour](https://huggingface.co/docs/accelerate/quicktour)
    to learn more.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: ğŸ¤— Accelerateæ˜¯ä¸€ä¸ªå¸®åŠ©æ‚¨åœ¨å¤šä¸ªGPU/TPUä¸Šæˆ–ä½¿ç”¨æ··åˆç²¾åº¦è¿›è¡Œè®­ç»ƒçš„åº“ã€‚å®ƒå°†æ ¹æ®æ‚¨çš„ç¡¬ä»¶å’Œç¯å¢ƒè‡ªåŠ¨é…ç½®æ‚¨çš„è®­ç»ƒè®¾ç½®ã€‚æŸ¥çœ‹ğŸ¤— Accelerate
    [å¿«é€Ÿå…¥é—¨](https://huggingface.co/docs/accelerate/quicktour)ä»¥äº†è§£æ›´å¤šã€‚
- en: 'Initialize an ğŸ¤— Accelerate environment:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: åˆå§‹åŒ–ä¸€ä¸ªğŸ¤— Accelerateç¯å¢ƒï¼š
- en: '[PRE2]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'To setup a default ğŸ¤— Accelerate environment without choosing any configurations:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: è¦è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ğŸ¤— Accelerateç¯å¢ƒè€Œä¸é€‰æ‹©ä»»ä½•é…ç½®ï¼š
- en: '[PRE3]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Or if your environment doesnâ€™t support an interactive shell, like a notebook,
    you can use:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ–è€…ï¼Œå¦‚æœæ‚¨çš„ç¯å¢ƒä¸æ”¯æŒäº¤äº’å¼shellï¼Œå¦‚ç¬”è®°æœ¬ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ï¼š
- en: '[PRE4]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Lastly, if you want to train a model on your own dataset, take a look at the
    [Create a dataset for training](create_dataset) guide to learn how to create a
    dataset that works with the training script.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åï¼Œå¦‚æœæ‚¨æƒ³åœ¨è‡ªå·±çš„æ•°æ®é›†ä¸Šè®­ç»ƒæ¨¡å‹ï¼Œè¯·æŸ¥çœ‹[åˆ›å»ºç”¨äºè®­ç»ƒçš„æ•°æ®é›†](create_dataset)æŒ‡å—ï¼Œäº†è§£å¦‚ä½•åˆ›å»ºé€‚ç”¨äºè®­ç»ƒè„šæœ¬çš„æ•°æ®é›†ã€‚
- en: Script parameters
  id: totrans-19
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: è„šæœ¬å‚æ•°
- en: The following sections highlight parts of the training script that are important
    for understanding how to modify it, but it doesnâ€™t cover every aspect of the script
    in detail. If youâ€™re interested in learning more, feel free to read through the
    [script](https://github.com/huggingface/diffusers/blob/main/examples/text_to_image/train_text_to_image_sdxl.py)
    and let us know if you have any questions or concerns.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: ä»¥ä¸‹å„èŠ‚çªå‡ºäº†è®­ç»ƒè„šæœ¬çš„é‡è¦éƒ¨åˆ†ï¼Œä»¥å¸®åŠ©æ‚¨äº†è§£å¦‚ä½•ä¿®æ”¹å®ƒï¼Œä½†å¹¶æœªè¯¦ç»†æ¶µç›–è„šæœ¬çš„æ¯ä¸ªæ–¹é¢ã€‚å¦‚æœæ‚¨æœ‰å…´è¶£äº†è§£æ›´å¤šï¼Œè¯·éšæ—¶é˜…è¯»[è„šæœ¬](https://github.com/huggingface/diffusers/blob/main/examples/text_to_image/train_text_to_image_sdxl.py)ï¼Œå¹¶å‘Šè¯‰æˆ‘ä»¬æ‚¨æ˜¯å¦æœ‰ä»»ä½•é—®é¢˜æˆ–ç–‘è™‘ã€‚
- en: The training script provides many parameters to help you customize your training
    run. All of the parameters and their descriptions are found in the [`parse_args()`](https://github.com/huggingface/diffusers/blob/aab6de22c33cc01fb7bc81c0807d6109e2c998c9/examples/text_to_image/train_text_to_image_sdxl.py#L129)
    function. This function provides default values for each parameter, such as the
    training batch size and learning rate, but you can also set your own values in
    the training command if youâ€™d like.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: è®­ç»ƒè„šæœ¬æä¾›äº†è®¸å¤šå‚æ•°ï¼Œä»¥å¸®åŠ©æ‚¨è‡ªå®šä¹‰è®­ç»ƒè¿è¡Œã€‚æ‰€æœ‰å‚æ•°åŠå…¶æè¿°éƒ½å¯ä»¥åœ¨[`parse_args()`](https://github.com/huggingface/diffusers/blob/aab6de22c33cc01fb7bc81c0807d6109e2c998c9/examples/text_to_image/train_text_to_image_sdxl.py#L129)å‡½æ•°ä¸­æ‰¾åˆ°ã€‚è¯¥å‡½æ•°ä¸ºæ¯ä¸ªå‚æ•°æä¾›äº†é»˜è®¤å€¼ï¼Œå¦‚è®­ç»ƒæ‰¹é‡å¤§å°å’Œå­¦ä¹ ç‡ï¼Œä½†å¦‚æœæ‚¨æ„¿æ„ï¼Œä¹Ÿå¯ä»¥åœ¨è®­ç»ƒå‘½ä»¤ä¸­è®¾ç½®è‡ªå·±çš„å€¼ã€‚
- en: 'For example, to speedup training with mixed precision using the bf16 format,
    add the `--mixed_precision` parameter to the training command:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: ä¾‹å¦‚ï¼Œä¸ºäº†ä½¿ç”¨bf16æ ¼å¼åŠ å¿«è®­ç»ƒé€Ÿåº¦ï¼Œå°†`--mixed_precision`å‚æ•°æ·»åŠ åˆ°è®­ç»ƒå‘½ä»¤ä¸­ï¼š
- en: '[PRE5]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Most of the parameters are identical to the parameters in the [Text-to-image](text2image#script-parameters)
    training guide, so youâ€™ll focus on the parameters that are relevant to training
    SDXL in this guide.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: å¤§å¤šæ•°å‚æ•°ä¸[æ–‡æœ¬åˆ°å›¾åƒ](text2image#script-parameters)è®­ç»ƒæŒ‡å—ä¸­çš„å‚æ•°ç›¸åŒï¼Œå› æ­¤æ‚¨å°†ä¸“æ³¨äºæœ¬æŒ‡å—ä¸­ä¸è®­ç»ƒSDXLç›¸å…³çš„å‚æ•°ã€‚
- en: '`--pretrained_vae_model_name_or_path`: path to a pretrained VAE; the SDXL VAE
    is known to suffer from numerical instability, so this parameter allows you to
    specify a better [VAE](https://huggingface.co/madebyollin/sdxl-vae-fp16-fix)'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--pretrained_vae_model_name_or_path`ï¼šé¢„è®­ç»ƒVAEçš„è·¯å¾„ï¼›SDXL VAEå·²çŸ¥å­˜åœ¨æ•°å€¼ä¸ç¨³å®šæ€§é—®é¢˜ï¼Œå› æ­¤æ­¤å‚æ•°å…è®¸æ‚¨æŒ‡å®šæ›´å¥½çš„[VAE](https://huggingface.co/madebyollin/sdxl-vae-fp16-fix)'
- en: '`--proportion_empty_prompts`: the proportion of image prompts to replace with
    empty strings'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--proportion_empty_prompts`ï¼šè¦æ›¿æ¢ä¸ºç©ºå­—ç¬¦ä¸²çš„å›¾åƒæç¤ºçš„æ¯”ä¾‹'
- en: '`--timestep_bias_strategy`: where (earlier vs. later) in the timestep to apply
    a bias, which can encourage the model to either learn low or high frequency details'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--timestep_bias_strategy`ï¼šåœ¨æ—¶é—´æ­¥ä¸­åº”ç”¨åå·®çš„ä½ç½®ï¼ˆè¾ƒæ—©è¿˜æ˜¯è¾ƒæ™šï¼‰ï¼Œå¯ä»¥é¼“åŠ±æ¨¡å‹å­¦ä¹ ä½é¢‘æˆ–é«˜é¢‘ç»†èŠ‚'
- en: '`--timestep_bias_multiplier`: the weight of the bias to apply to the timestep'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--timestep_bias_multiplier`ï¼šåº”ç”¨äºæ—¶é—´æ­¥çš„åå·®æƒé‡'
- en: '`--timestep_bias_begin`: the timestep to begin applying the bias'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: -- timestep_bias_beginï¼šå¼€å§‹åº”ç”¨åå·®çš„æ—¶é—´æ­¥
- en: '`--timestep_bias_end`: the timestep to end applying the bias'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--timestep_bias_end`ï¼šç»“æŸåº”ç”¨åå·®çš„æ—¶é—´æ­¥'
- en: '`--timestep_bias_portion`: the proportion of timesteps to apply the bias to'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`--timestep_bias_portion`ï¼šåº”ç”¨åå·®çš„æ—¶é—´æ­¥æ¯”ä¾‹'
- en: Min-SNR weighting
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Min-SNRåŠ æƒ
- en: The [Min-SNR](https://huggingface.co/papers/2303.09556) weighting strategy can
    help with training by rebalancing the loss to achieve faster convergence. The
    training script supports predicting either `epsilon` (noise) or `v_prediction`,
    but Min-SNR is compatible with both prediction types. This weighting strategy
    is only supported by PyTorch and is unavailable in the Flax training script.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '[Min-SNR](https://huggingface.co/papers/2303.09556)åŠ æƒç­–ç•¥å¯ä»¥å¸®åŠ©è®­ç»ƒï¼Œé€šè¿‡é‡æ–°å¹³è¡¡æŸå¤±æ¥å®ç°æ›´å¿«çš„æ”¶æ•›ã€‚è®­ç»ƒè„šæœ¬æ”¯æŒé¢„æµ‹`epsilon`ï¼ˆå™ªå£°ï¼‰æˆ–`v_prediction`ï¼Œä½†Min-SNRä¸ä¸¤ç§é¢„æµ‹ç±»å‹å…¼å®¹ã€‚è¿™ç§åŠ æƒç­–ç•¥ä»…å—PyTorchæ”¯æŒï¼Œåœ¨Flaxè®­ç»ƒè„šæœ¬ä¸­ä¸å¯ç”¨ã€‚'
- en: 'Add the `--snr_gamma` parameter and set it to the recommended value of 5.0:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: æ·»åŠ `--snr_gamma`å‚æ•°ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºæ¨èå€¼5.0ï¼š
- en: '[PRE6]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Training script
  id: totrans-36
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: è®­ç»ƒè„šæœ¬
- en: The training script is also similar to the [Text-to-image](text2image#training-script)
    training guide, but itâ€™s been modified to support SDXL training. This guide will
    focus on the code that is unique to the SDXL training script.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: è®­ç»ƒè„šæœ¬ä¹Ÿç±»ä¼¼äº[æ–‡æœ¬åˆ°å›¾åƒ](text2image#training-script)è®­ç»ƒæŒ‡å—ï¼Œä½†å·²ç»ä¿®æ”¹ä¸ºæ”¯æŒSDXLè®­ç»ƒã€‚æœ¬æŒ‡å—å°†é‡ç‚¹æ”¾åœ¨SDXLè®­ç»ƒè„šæœ¬ä¸­ç‹¬ç‰¹çš„ä»£ç ä¸Šã€‚
- en: It starts by creating functions to [tokenize the prompts](https://github.com/huggingface/diffusers/blob/aab6de22c33cc01fb7bc81c0807d6109e2c998c9/examples/text_to_image/train_text_to_image_sdxl.py#L478)
    to calculate the prompt embeddings, and to compute the image embeddings with the
    [VAE](https://github.com/huggingface/diffusers/blob/aab6de22c33cc01fb7bc81c0807d6109e2c998c9/examples/text_to_image/train_text_to_image_sdxl.py#L519).
    Next, youâ€™ll a function to [generate the timesteps weights](https://github.com/huggingface/diffusers/blob/aab6de22c33cc01fb7bc81c0807d6109e2c998c9/examples/text_to_image/train_text_to_image_sdxl.py#L531)
    depending on the number of timesteps and the timestep bias strategy to apply.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆåˆ›å»ºå‡½æ•°æ¥[å¯¹æç¤ºè¿›è¡Œæ ‡è®°åŒ–](https://github.com/huggingface/diffusers/blob/aab6de22c33cc01fb7bc81c0807d6109e2c998c9/examples/text_to_image/train_text_to_image_sdxl.py#L478)ä»¥è®¡ç®—æç¤ºåµŒå…¥ï¼Œå¹¶ä½¿ç”¨[VAE](https://github.com/huggingface/diffusers/blob/aab6de22c33cc01fb7bc81c0807d6109e2c998c9/examples/text_to_image/train_text_to_image_sdxl.py#L519)è®¡ç®—å›¾åƒåµŒå…¥ã€‚æ¥ä¸‹æ¥ï¼Œæ‚¨å°†åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥[ç”Ÿæˆæ—¶é—´æ­¥æƒé‡](https://github.com/huggingface/diffusers/blob/aab6de22c33cc01fb7bc81c0807d6109e2c998c9/examples/text_to_image/train_text_to_image_sdxl.py#L531)ï¼Œå…·ä½“å–å†³äºæ—¶é—´æ­¥æ•°å’Œè¦åº”ç”¨çš„æ—¶é—´æ­¥åå·®ç­–ç•¥ã€‚
- en: 'Within the [`main()`](https://github.com/huggingface/diffusers/blob/aab6de22c33cc01fb7bc81c0807d6109e2c998c9/examples/text_to_image/train_text_to_image_sdxl.py#L572)
    function, in addition to loading a tokenizer, the script loads a second tokenizer
    and text encoder because the SDXL architecture uses two of each:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 'åœ¨[`main()`](https://github.com/huggingface/diffusers/blob/aab6de22c33cc01fb7bc81c0807d6109e2c998c9/examples/text_to_image/train_text_to_image_sdxl.py#L572)å‡½æ•°ä¸­ï¼Œé™¤äº†åŠ è½½ä¸€ä¸ªåˆ†è¯å™¨å¤–ï¼Œè„šæœ¬è¿˜åŠ è½½äº†ç¬¬äºŒä¸ªåˆ†è¯å™¨å’Œæ–‡æœ¬ç¼–ç å™¨ï¼Œå› ä¸ºSDXLæ¶æ„ä½¿ç”¨äº†ä¸¤ä¸ªï¼š '
- en: '[PRE7]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The [prompt and image embeddings](https://github.com/huggingface/diffusers/blob/aab6de22c33cc01fb7bc81c0807d6109e2c998c9/examples/text_to_image/train_text_to_image_sdxl.py#L857)
    are computed first and kept in memory, which isnâ€™t typically an issue for a smaller
    dataset, but for larger datasets it can lead to memory problems. If this is the
    case, you should save the pre-computed embeddings to disk separately and load
    them into memory during the training process (see this [PR](https://github.com/huggingface/diffusers/pull/4505)
    for more discussion about this topic).
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆè®¡ç®—å¹¶ä¿å­˜[æç¤ºå’Œå›¾åƒåµŒå…¥](https://github.com/huggingface/diffusers/blob/aab6de22c33cc01fb7bc81c0807d6109e2c998c9/examples/text_to_image/train_text_to_image_sdxl.py#L857)ï¼Œè¿™é€šå¸¸å¯¹äºè¾ƒå°çš„æ•°æ®é›†ä¸æ˜¯é—®é¢˜ï¼Œä½†å¯¹äºè¾ƒå¤§çš„æ•°æ®é›†å¯èƒ½ä¼šå¯¼è‡´å†…å­˜é—®é¢˜ã€‚å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œæ‚¨åº”è¯¥å°†é¢„å…ˆè®¡ç®—çš„åµŒå…¥å•ç‹¬ä¿å­˜åˆ°ç£ç›˜ï¼Œå¹¶åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼ˆè¯·å‚é˜…æ­¤[PR](https://github.com/huggingface/diffusers/pull/4505)ä»¥è·å–æœ‰å…³æ­¤ä¸»é¢˜çš„æ›´å¤šè®¨è®ºï¼‰ã€‚
- en: '[PRE8]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'After calculating the embeddings, the text encoder, VAE, and tokenizer are
    deleted to free up some memory:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: è®¡ç®—åµŒå…¥åï¼Œæ–‡æœ¬ç¼–ç å™¨ã€VAEå’Œåˆ†è¯å™¨å°†è¢«åˆ é™¤ä»¥é‡Šæ”¾ä¸€äº›å†…å­˜ï¼š
- en: '[PRE9]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Finally, the [training loop](https://github.com/huggingface/diffusers/blob/aab6de22c33cc01fb7bc81c0807d6109e2c998c9/examples/text_to_image/train_text_to_image_sdxl.py#L943)
    takes care of the rest. If you chose to apply a timestep bias strategy, youâ€™ll
    see the timestep weights are calculated and added as noise:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åï¼Œ[è®­ç»ƒå¾ªç¯](https://github.com/huggingface/diffusers/blob/aab6de22c33cc01fb7bc81c0807d6109e2c998c9/examples/text_to_image/train_text_to_image_sdxl.py#L943)ä¼šå¤„ç†å‰©ä¸‹çš„äº‹æƒ…ã€‚å¦‚æœé€‰æ‹©åº”ç”¨æ—¶é—´æ­¥åå·®ç­–ç•¥ï¼Œæ‚¨å°†çœ‹åˆ°æ—¶é—´æ­¥æƒé‡è¢«è®¡ç®—å¹¶æ·»åŠ ä¸ºå™ªå£°ï¼š
- en: '[PRE10]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: If you want to learn more about how the training loop works, check out the [Understanding
    pipelines, models and schedulers](../using-diffusers/write_own_pipeline) tutorial
    which breaks down the basic pattern of the denoising process.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨æƒ³äº†è§£è®­ç»ƒå¾ªç¯çš„å·¥ä½œåŸç†ï¼Œè¯·æŸ¥çœ‹[ç†è§£ç®¡é“ã€æ¨¡å‹å’Œè°ƒåº¦å™¨](../using-diffusers/write_own_pipeline)æ•™ç¨‹ï¼Œè¯¥æ•™ç¨‹è§£æäº†å»å™ªè¿‡ç¨‹çš„åŸºæœ¬æ¨¡å¼ã€‚
- en: Launch the script
  id: totrans-48
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å¯åŠ¨è„šæœ¬
- en: Once youâ€™ve made all your changes or youâ€™re okay with the default configuration,
    youâ€™re ready to launch the training script! ğŸš€
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸€æ—¦æ‚¨å®Œæˆæ‰€æœ‰æ›´æ”¹æˆ–å¯¹é»˜è®¤é…ç½®æ»¡æ„ï¼Œæ‚¨å°±å¯ä»¥å¯åŠ¨è®­ç»ƒè„šæœ¬äº†ï¼ğŸš€
- en: Letâ€™s train on the [PokÃ©mon BLIP captions](https://huggingface.co/datasets/lambdalabs/pokemon-blip-captions)
    dataset to generate your own PokÃ©mon. Set the environment variables `MODEL_NAME`
    and `DATASET_NAME` to the model and the dataset (either from the Hub or a local
    path). You should also specify a VAE other than the SDXL VAE (either from the
    Hub or a local path) with `VAE_NAME` to avoid numerical instabilities.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬åœ¨[PokÃ©mon BLIPæ ‡é¢˜](https://huggingface.co/datasets/lambdalabs/pokemon-blip-captions)æ•°æ®é›†ä¸Šè®­ç»ƒï¼Œç”Ÿæˆæ‚¨è‡ªå·±çš„
    PokÃ©monã€‚å°†ç¯å¢ƒå˜é‡`MODEL_NAME`å’Œ`DATASET_NAME`è®¾ç½®ä¸ºæ¨¡å‹å’Œæ•°æ®é›†ï¼ˆå¯ä»¥æ¥è‡ªHubæˆ–æœ¬åœ°è·¯å¾„ï¼‰ã€‚æ‚¨è¿˜åº”è¯¥æŒ‡å®šä¸€ä¸ªé™¤SDXL
    VAEä¹‹å¤–çš„VAEï¼ˆå¯ä»¥æ¥è‡ªHubæˆ–æœ¬åœ°è·¯å¾„ï¼‰ï¼Œå¹¶ä½¿ç”¨`VAE_NAME`é¿å…æ•°å€¼ä¸ç¨³å®šã€‚
- en: To monitor training progress with Weights & Biases, add the `--report_to=wandb`
    parameter to the training command. Youâ€™ll also need to add the `--validation_prompt`
    and `--validation_epochs` to the training command to keep track of results. This
    can be really useful for debugging the model and viewing intermediate results.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨Weightsï¼†Biasesç›‘æ§è®­ç»ƒè¿›åº¦ï¼Œå°†`--report_to=wandb`å‚æ•°æ·»åŠ åˆ°è®­ç»ƒå‘½ä»¤ä¸­ã€‚æ‚¨è¿˜éœ€è¦å°†`--validation_prompt`å’Œ`--validation_epochs`æ·»åŠ åˆ°è®­ç»ƒå‘½ä»¤ä¸­ä»¥è·Ÿè¸ªç»“æœã€‚è¿™å¯¹äºè°ƒè¯•æ¨¡å‹å’ŒæŸ¥çœ‹ä¸­é—´ç»“æœéå¸¸æœ‰ç”¨ã€‚
- en: '[PRE11]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: After youâ€™ve finished training, you can use your newly trained SDXL model for
    inference!
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: è®­ç»ƒå®Œæˆåï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ–°è®­ç»ƒçš„SDXLæ¨¡å‹è¿›è¡Œæ¨æ–­ï¼
- en: PyTorchPyTorch XLA
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: PyTorchPyTorch XLA
- en: '[PRE12]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Next steps
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä¸‹ä¸€æ­¥
- en: 'Congratulations on training a SDXL model! To learn more about how to use your
    new model, the following guides may be helpful:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: ç¥è´ºæ‚¨è®­ç»ƒäº†ä¸€ä¸ªSDXLæ¨¡å‹ï¼è¦äº†è§£å¦‚ä½•ä½¿ç”¨æ‚¨çš„æ–°æ¨¡å‹ï¼Œä»¥ä¸‹æŒ‡å—å¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ï¼š
- en: Read the [Stable Diffusion XL](../using-diffusers/sdxl) guide to learn how to
    use it for a variety of different tasks (text-to-image, image-to-image, inpainting),
    how to use itâ€™s refiner model, and the different types of micro-conditionings.
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: é˜…è¯»[Stable Diffusion XL](../using-diffusers/sdxl)æŒ‡å—ï¼Œäº†è§£å¦‚ä½•å°†å…¶ç”¨äºå„ç§ä¸åŒä»»åŠ¡ï¼ˆæ–‡æœ¬åˆ°å›¾åƒï¼Œå›¾åƒåˆ°å›¾åƒï¼Œä¿®å¤ï¼‰ï¼Œå¦‚ä½•ä½¿ç”¨å…¶ç»†åŒ–å™¨æ¨¡å‹ä»¥åŠä¸åŒç±»å‹çš„å¾®è°ƒã€‚
- en: Check out the [DreamBooth](dreambooth) and [LoRA](lora) training guides to learn
    how to train a personalized SDXL model with just a few example images. These two
    training techniques can even be combined!
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æŸ¥çœ‹[DreamBooth](dreambooth)å’Œ[LoRA](lora)åŸ¹è®­æŒ‡å—ï¼Œäº†è§£å¦‚ä½•ä»…ä½¿ç”¨å‡ ä¸ªç¤ºä¾‹å›¾åƒè®­ç»ƒä¸ªæ€§åŒ–çš„SDXLæ¨¡å‹ã€‚è¿™ä¸¤ç§è®­ç»ƒæŠ€æœ¯ç”šè‡³å¯ä»¥ç»“åˆä½¿ç”¨ï¼
