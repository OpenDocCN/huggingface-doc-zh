- en: Improve generation quality with FreeU
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://huggingface.co/docs/diffusers/using-diffusers/freeu](https://huggingface.co/docs/diffusers/using-diffusers/freeu)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: <link href="/docs/diffusers/v0.26.3/en/_app/immutable/assets/0.e3b0c442.css"
    rel="modulepreload"> <link rel="modulepreload" href="/docs/diffusers/v0.26.3/en/_app/immutable/entry/start.99629b4a.js">
    <link rel="modulepreload" href="/docs/diffusers/v0.26.3/en/_app/immutable/chunks/scheduler.182ea377.js">
    <link rel="modulepreload" href="/docs/diffusers/v0.26.3/en/_app/immutable/chunks/singletons.fade7992.js">
    <link rel="modulepreload" href="/docs/diffusers/v0.26.3/en/_app/immutable/chunks/index.1f6d62f6.js">
    <link rel="modulepreload" href="/docs/diffusers/v0.26.3/en/_app/immutable/chunks/paths.108a236d.js">
    <link rel="modulepreload" href="/docs/diffusers/v0.26.3/en/_app/immutable/entry/app.2b3eaeb0.js">
    <link rel="modulepreload" href="/docs/diffusers/v0.26.3/en/_app/immutable/chunks/index.abf12888.js">
    <link rel="modulepreload" href="/docs/diffusers/v0.26.3/en/_app/immutable/nodes/0.3862a335.js">
    <link rel="modulepreload" href="/docs/diffusers/v0.26.3/en/_app/immutable/chunks/each.e59479a4.js">
    <link rel="modulepreload" href="/docs/diffusers/v0.26.3/en/_app/immutable/nodes/168.a8dd8368.js">
    <link rel="modulepreload" href="/docs/diffusers/v0.26.3/en/_app/immutable/chunks/Tip.230e2334.js">
    <link rel="modulepreload" href="/docs/diffusers/v0.26.3/en/_app/immutable/chunks/CodeBlock.57fe6e13.js">
    <link rel="modulepreload" href="/docs/diffusers/v0.26.3/en/_app/immutable/chunks/DocNotebookDropdown.5fa27ace.js">
    <link rel="modulepreload" href="/docs/diffusers/v0.26.3/en/_app/immutable/chunks/globals.7f7f1b26.js">
    <link rel="modulepreload" href="/docs/diffusers/v0.26.3/en/_app/immutable/chunks/Heading.16916d63.js">
  prefs: []
  type: TYPE_NORMAL
- en: 'The UNet is responsible for denoising during the reverse diffusion process,
    and there are two distinct features in its architecture:'
  prefs: []
  type: TYPE_NORMAL
- en: Backbone features primarily contribute to the denoising process
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Skip features mainly introduce high-frequency features into the decoder module
    and can make the network overlook the semantics in the backbone features
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: However, the skip connection can sometimes introduce unnatural image details.
    [FreeU](https://hf.co/papers/2309.11497) is a technique for improving image quality
    by rebalancing the contributions from the UNet’s skip connections and backbone
    feature maps.
  prefs: []
  type: TYPE_NORMAL
- en: FreeU is applied during inference and it does not require any additional training.
    The technique works for different tasks such as text-to-image, image-to-image,
    and text-to-video.
  prefs: []
  type: TYPE_NORMAL
- en: In this guide, you will apply FreeU to the [StableDiffusionPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/stable_diffusion/text2img#diffusers.StableDiffusionPipeline),
    [StableDiffusionXLPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/stable_diffusion/stable_diffusion_xl#diffusers.StableDiffusionXLPipeline),
    and [TextToVideoSDPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/text_to_video#diffusers.TextToVideoSDPipeline).
    You need to install Diffusers from source to run the examples below.
  prefs: []
  type: TYPE_NORMAL
- en: StableDiffusionPipeline
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Load the pipeline:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Then enable the FreeU mechanism with the FreeU-specific hyperparameters. These
    values are scaling factors for the backbone and skip features.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: The values above are from the official FreeU [code repository](https://github.com/ChenyangSi/FreeU)
    where you can also find [reference hyperparameters](https://github.com/ChenyangSi/FreeU#range-for-more-parameters)
    for different models.
  prefs: []
  type: TYPE_NORMAL
- en: Disable the FreeU mechanism by calling `disable_freeu()` on a pipeline.
  prefs: []
  type: TYPE_NORMAL
- en: 'And then run inference:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'The figure below compares non-FreeU and FreeU results respectively for the
    same hyperparameters used above (`prompt` and `seed`):'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/14f4849619dc951e6957a5ba77ca9e0f.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Let’s see how Stable Diffusion 2 results are impacted:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/871db7b4ddca876aa8031f54e2830a97.png)'
  prefs: []
  type: TYPE_IMG
- en: Stable Diffusion XL
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Finally, let’s take a look at how FreeU affects Stable Diffusion XL results:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '![](../Images/f5c6276e60b4304789966e7f79551b89.png)'
  prefs: []
  type: TYPE_IMG
- en: Text-to-video generation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'FreeU can also be used to improve video quality:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: Thanks to [kadirnar](https://github.com/kadirnar/) for helping to integrate
    the feature, and to [justindujardin](https://github.com/justindujardin) for the
    helpful discussions.
  prefs: []
  type: TYPE_NORMAL
