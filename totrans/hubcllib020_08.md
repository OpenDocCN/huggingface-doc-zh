# ä¸Šä¼ æ–‡ä»¶åˆ° Hub

> åŽŸå§‹æ–‡æœ¬ï¼š[`huggingface.co/docs/huggingface_hub/guides/upload`](https://huggingface.co/docs/huggingface_hub/guides/upload)

åˆ†äº«æ‚¨çš„æ–‡ä»¶å’Œå·¥ä½œæ˜¯ Hub çš„é‡è¦æ–¹é¢ã€‚`huggingface_hub`ä¸ºå°†æ–‡ä»¶ä¸Šä¼ åˆ° Hub æä¾›äº†å‡ ç§é€‰é¡¹ã€‚æ‚¨å¯ä»¥ç‹¬ç«‹ä½¿ç”¨è¿™äº›åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥å°†å®ƒä»¬é›†æˆåˆ°æ‚¨çš„åº“ä¸­ï¼Œä½¿ç”¨æˆ·æ›´æ–¹ä¾¿åœ°ä¸Ž Hub äº¤äº’ã€‚æœ¬æŒ‡å—å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•æŽ¨é€æ–‡ä»¶ï¼š

+   ä¸ä½¿ç”¨ Gitã€‚

+   å¯¹äºŽéžå¸¸å¤§çš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨[Git LFS](https://git-lfs.github.com/)ã€‚

+   ä½¿ç”¨`commit`ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚

+   ä½¿ç”¨ push_to_hub()å‡½æ•°ã€‚

æ¯å½“æ‚¨æƒ³è¦å°†æ–‡ä»¶ä¸Šä¼ åˆ° Hub æ—¶ï¼Œæ‚¨éœ€è¦ç™»å½•åˆ°æ‚¨çš„ Hugging Face å¸æˆ·ã€‚æœ‰å…³èº«ä»½éªŒè¯çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æ­¤éƒ¨åˆ†ã€‚

## ä¸Šä¼ æ–‡ä»¶

åˆ›å»ºäº†ä¸€ä¸ªå­˜å‚¨åº“åŽï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ upload_file()å°†æ–‡ä»¶ä¸Šä¼ åˆ°æ‚¨çš„å­˜å‚¨åº“ã€‚

æŒ‡å®šè¦ä¸Šä¼ çš„æ–‡ä»¶çš„è·¯å¾„ï¼Œåœ¨å­˜å‚¨åº“ä¸­è¦ä¸Šä¼ æ–‡ä»¶çš„ä½ç½®ï¼Œä»¥åŠè¦å°†æ–‡ä»¶æ·»åŠ åˆ°çš„å­˜å‚¨åº“çš„åç§°ã€‚æ ¹æ®æ‚¨çš„å­˜å‚¨åº“ç±»åž‹ï¼Œæ‚¨å¯ä»¥é€‰æ‹©å°†å­˜å‚¨åº“ç±»åž‹è®¾ç½®ä¸º`dataset`ã€`model`æˆ–`space`ã€‚

```py
>>> from huggingface_hub import HfApi
>>> api = HfApi()
>>> api.upload_file(
...     path_or_fileobj="/path/to/local/folder/README.md",
...     path_in_repo="README.md",
...     repo_id="username/test-dataset",
...     repo_type="dataset",
... )
```

## ä¸Šä¼ æ–‡ä»¶å¤¹

ä½¿ç”¨ upload_folder()å‡½æ•°å°†æœ¬åœ°æ–‡ä»¶å¤¹ä¸Šä¼ åˆ°çŽ°æœ‰å­˜å‚¨åº“ã€‚æŒ‡å®šè¦ä¸Šä¼ çš„æœ¬åœ°æ–‡ä»¶å¤¹çš„è·¯å¾„ï¼Œåœ¨å­˜å‚¨åº“ä¸­è¦ä¸Šä¼ æ–‡ä»¶å¤¹çš„ä½ç½®ï¼Œä»¥åŠè¦å°†æ–‡ä»¶å¤¹æ·»åŠ åˆ°çš„å­˜å‚¨åº“çš„åç§°ã€‚æ ¹æ®æ‚¨çš„å­˜å‚¨åº“ç±»åž‹ï¼Œæ‚¨å¯ä»¥é€‰æ‹©å°†å­˜å‚¨åº“ç±»åž‹è®¾ç½®ä¸º`dataset`ã€`model`æˆ–`space`ã€‚

```py
>>> from huggingface_hub import HfApi
>>> api = HfApi()

# Upload all the content from the local folder to your remote Space.
# By default, files are uploaded at the root of the repo
>>> api.upload_folder(
...     folder_path="/path/to/local/space",
...     repo_id="username/my-cool-space",
...     repo_type="space",
... )
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†è€ƒè™‘`.gitignore`æ–‡ä»¶ä»¥ç¡®å®šåº”æäº¤å“ªäº›æ–‡ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šæ£€æŸ¥æäº¤ä¸­æ˜¯å¦å­˜åœ¨`.gitignore`æ–‡ä»¶ï¼Œå¦‚æžœæ²¡æœ‰ï¼Œåˆ™ä¼šæ£€æŸ¥ Hub ä¸Šæ˜¯å¦å­˜åœ¨ã€‚è¯·æ³¨æ„ï¼Œåªæœ‰æ ¹ç›®å½•ä¸­å­˜åœ¨çš„`.gitignore`æ–‡ä»¶æ‰ä¼šè¢«ä½¿ç”¨ã€‚æˆ‘ä»¬ä¸ä¼šæ£€æŸ¥å­ç›®å½•ä¸­çš„`.gitignore`æ–‡ä»¶ã€‚

å¦‚æžœæ‚¨ä¸æƒ³ä½¿ç”¨ç¡¬ç¼–ç çš„`.gitignore`æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨`allow_patterns`å’Œ`ignore_patterns`å‚æ•°æ¥è¿‡æ»¤è¦ä¸Šä¼ çš„æ–‡ä»¶ã€‚è¿™äº›å‚æ•°æŽ¥å—å•ä¸ªæ¨¡å¼æˆ–æ¨¡å¼åˆ—è¡¨ã€‚æ¨¡å¼æ˜¯æ ‡å‡†é€šé…ç¬¦ï¼ˆglobbing patternsï¼‰ï¼Œå¦‚[æ­¤å¤„](https://tldp.org/LDP/GNU-Linux-Tools-Summary/html/x11655.htm)æ‰€è¿°ã€‚å¦‚æžœåŒæ—¶æä¾›`allow_patterns`å’Œ`ignore_patterns`ï¼Œåˆ™ä¸¤ä¸ªçº¦æŸéƒ½é€‚ç”¨ã€‚

é™¤äº†`.gitignore`æ–‡ä»¶å’Œå…è®¸/å¿½ç•¥æ¨¡å¼å¤–ï¼Œä»»ä½•å­ç›®å½•ä¸­å­˜åœ¨çš„`.git/`æ–‡ä»¶å¤¹éƒ½å°†è¢«å¿½ç•¥ã€‚

```py
>>> api.upload_folder(
...     folder_path="/path/to/local/folder",
...     path_in_repo="my-dataset/train", # Upload to a specific folder
...     repo_id="username/test-dataset",
...     repo_type="dataset",
...     ignore_patterns="**/logs/*.txt", # Ignore all text logs
... )
```

æ‚¨è¿˜å¯ä»¥ä½¿ç”¨`delete_patterns`å‚æ•°æŒ‡å®šè¦åœ¨åŒä¸€æäº¤ä¸­ä»Žå­˜å‚¨åº“ä¸­åˆ é™¤çš„æ–‡ä»¶ã€‚å¦‚æžœæ‚¨æƒ³è¦åœ¨æŽ¨é€æ–‡ä»¶ä¹‹å‰æ¸…ç†è¿œç¨‹æ–‡ä»¶å¤¹å¹¶ä¸”ä¸çŸ¥é“å“ªäº›æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œè¿™å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚

ä¸‹é¢çš„ç¤ºä¾‹å°†æœ¬åœ°çš„`./logs`æ–‡ä»¶å¤¹ä¸Šä¼ åˆ°è¿œç¨‹çš„`/experiment/logs/`æ–‡ä»¶å¤¹ã€‚åªæœ‰ txt æ–‡ä»¶è¢«ä¸Šä¼ ï¼Œä½†åœ¨æ­¤ä¹‹å‰ï¼Œå­˜å‚¨åº“ä¸­çš„æ‰€æœ‰å…ˆå‰æ—¥å¿—éƒ½è¢«åˆ é™¤ã€‚æ‰€æœ‰è¿™äº›éƒ½åœ¨ä¸€ä¸ªæäº¤ä¸­å®Œæˆã€‚

```py
>>> api.upload_folder(
...     folder_path="/path/to/local/folder/logs",
...     repo_id="username/trained-model",
...     path_in_repo="experiment/logs/",
...     allow_patterns="*.txt", # Upload all local text files
...     delete_patterns="*.txt", # Delete all remote text files before
... )
```

## ä»Ž CLI ä¸Šä¼ 

æ‚¨å¯ä»¥ä½¿ç”¨ç»ˆç«¯ä¸­çš„`huggingface-cli upload`å‘½ä»¤ç›´æŽ¥å°†æ–‡ä»¶ä¸Šä¼ åˆ° Hubã€‚å†…éƒ¨ä½¿ç”¨ä¸Šè¿°æè¿°çš„ç›¸åŒ upload_file()å’Œ upload_folder()åŠ©æ‰‹ã€‚

æ‚¨å¯ä»¥ä¸Šä¼ å•ä¸ªæ–‡ä»¶æˆ–æ•´ä¸ªæ–‡ä»¶å¤¹ï¼š

```py
# Usage:  huggingface-cli upload [repo_id] [local_path] [path_in_repo]
>>> huggingface-cli upload Wauplin/my-cool-model ./models/model.safetensors model.safetensors
https://huggingface.co/Wauplin/my-cool-model/blob/main/model.safetensors

>>> huggingface-cli upload Wauplin/my-cool-model ./models .
https://huggingface.co/Wauplin/my-cool-model/tree/main
```

`local_path`å’Œ`path_in_repo`æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥è¢«éšå¼æŽ¨æ–­ã€‚å¦‚æžœæœªè®¾ç½®`local_path`ï¼Œåˆ™å·¥å…·å°†æ£€æŸ¥æœ¬åœ°æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶æ˜¯å¦ä¸Ž`repo_id`å…·æœ‰ç›¸åŒçš„åç§°ã€‚å¦‚æžœæ˜¯è¿™æ ·ï¼Œå…¶å†…å®¹å°†è¢«ä¸Šä¼ ã€‚å¦åˆ™ï¼Œå°†å¼•å‘å¼‚å¸¸ï¼Œè¦æ±‚ç”¨æˆ·æ˜Žç¡®è®¾ç½®`local_path`ã€‚æ— è®ºå¦‚ä½•ï¼Œå¦‚æžœæœªè®¾ç½®`path_in_repo`ï¼Œæ–‡ä»¶å°†è¢«ä¸Šä¼ åˆ°å­˜å‚¨åº“çš„æ ¹ç›®å½•ã€‚

æœ‰å…³ CLI ä¸Šä¼ å‘½ä»¤çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒ CLI æŒ‡å—ã€‚

## é«˜çº§åŠŸèƒ½

åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨ä¸éœ€è¦æ›´å¤šçš„ upload_file()å’Œ upload_folder()æ¥å°†æ–‡ä»¶ä¸Šä¼ åˆ° Hubã€‚ç„¶è€Œï¼Œ`huggingface_hub`å…·æœ‰æ›´å¤šé«˜çº§åŠŸèƒ½ï¼Œä½¿äº‹æƒ…å˜å¾—æ›´å®¹æ˜“ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒä»¬ï¼

### éžé˜»å¡žä¸Šä¼ 

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¸Œæœ›åœ¨ä¸é˜»å¡žä¸»çº¿ç¨‹çš„æƒ…å†µä¸‹æŽ¨é€æ•°æ®ã€‚è¿™å¯¹äºŽåœ¨ç»§ç»­è®­ç»ƒçš„åŒæ—¶ä¸Šä¼ æ—¥å¿—å’Œå·¥ä»¶ç‰¹åˆ«æœ‰ç”¨ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥åœ¨ upload_file()å’Œ upload_folder()ä¸­ä½¿ç”¨`run_as_future`å‚æ•°ã€‚è¿™å°†è¿”å›žä¸€ä¸ª[`concurrent.futures.Future`](https://docs.python.org/3/library/concurrent.futures.html#future-objects)å¯¹è±¡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥æ£€æŸ¥ä¸Šä¼ çš„çŠ¶æ€ã€‚

```py
>>> from huggingface_hub import HfApi
>>> api = HfApi()
>>> future = api.upload_folder( # Upload in the background (non-blocking action)
...     repo_id="username/my-model",
...     folder_path="checkpoints-001",
...     run_as_future=True,
... )
>>> future
Future(...)
>>> future.done()
False
>>> future.result() # Wait for the upload to complete (blocking action)
...
```

ä½¿ç”¨`run_as_future=True`æ—¶ï¼ŒåŽå°ä½œä¸šå°†è¢«æŽ’é˜Ÿã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥ç¡®ä¿ä½œä¸šå°†æŒ‰æ­£ç¡®çš„é¡ºåºæ‰§è¡Œã€‚

å³ä½¿åŽå°ä½œä¸šå¤§å¤šç”¨äºŽä¸Šä¼ æ•°æ®/åˆ›å»ºæäº¤ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ run_as_future()æ¥æŽ’é˜Ÿä»»ä½•æ‚¨å–œæ¬¢çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒåœ¨åŽå°åˆ›å»ºä¸€ä¸ªå­˜å‚¨åº“ï¼Œç„¶åŽä¸Šä¼ æ•°æ®åˆ°å…¶ä¸­ã€‚ä¸Šä¼ æ–¹æ³•ä¸­å†…ç½®çš„`run_as_future`å‚æ•°åªæ˜¯å®ƒçš„ä¸€ä¸ªåˆ«åã€‚

```py
>>> from huggingface_hub import HfApi
>>> api = HfApi()
>>> api.run_as_future(api.create_repo, "username/my-model", exists_ok=True)
Future(...)
>>> api.upload_file(
...     repo_id="username/my-model",
...     path_in_repo="file.txt",
...     path_or_fileobj=b"file content",
...     run_as_future=True,
... )
Future(...)
```

### æŒ‰å—ä¸Šä¼ æ–‡ä»¶å¤¹

upload_folder()ä½¿å¾—å°†æ•´ä¸ªæ–‡ä»¶å¤¹ä¸Šä¼ åˆ° Hub å˜å¾—å®¹æ˜“ã€‚ç„¶è€Œï¼Œå¯¹äºŽå¤§åž‹æ–‡ä»¶å¤¹ï¼ˆæ•°åƒä¸ªæ–‡ä»¶æˆ–æ•°ç™¾ GBï¼‰ï¼Œä»ç„¶å¯èƒ½å…·æœ‰æŒ‘æˆ˜æ€§ã€‚å¦‚æžœæ‚¨æœ‰ä¸€ä¸ªåŒ…å«å¤§é‡æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å°†å…¶åˆ†æ‰¹ä¸Šä¼ ã€‚å¦‚æžœåœ¨ä¸Šä¼ è¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯æˆ–è¿žæŽ¥é—®é¢˜ï¼Œæ‚¨å°†ä¸å¿…ä»Žå¤´å¼€å§‹æ¢å¤è¯¥è¿‡ç¨‹ã€‚

è¦å°†æ–‡ä»¶å¤¹ä¸Šä¼ åˆ°å¤šä¸ªæäº¤ä¸­ï¼Œåªéœ€å°†`multi_commits=True`ä½œä¸ºå‚æ•°ä¼ é€’ã€‚åœ¨å¹•åŽï¼Œ`huggingface_hub`å°†åˆ—å‡ºè¦ä¸Šä¼ /åˆ é™¤çš„æ–‡ä»¶å¹¶å°†å®ƒä»¬åˆ†æˆå‡ ä¸ªæäº¤ã€‚â€œç­–ç•¥â€ï¼ˆå³å¦‚ä½•åˆ†å‰²æäº¤ï¼‰åŸºäºŽè¦ä¸Šä¼ çš„æ–‡ä»¶æ•°é‡å’Œå¤§å°ã€‚åœ¨ Hub ä¸Šæ‰“å¼€äº†ä¸€ä¸ª PR æ¥æŽ¨é€æ‰€æœ‰æäº¤ã€‚ä¸€æ—¦ PR å‡†å¤‡å°±ç»ªï¼Œæäº¤å°†è¢«åŽ‹ç¼©ä¸ºå•ä¸ªæäº¤ã€‚å¦‚æžœåœ¨å®Œæˆä¹‹å‰ä¸­æ–­äº†è¯¥è¿‡ç¨‹ï¼Œæ‚¨å¯ä»¥é‡æ–°è¿è¡Œè„šæœ¬ä»¥æ¢å¤ä¸Šä¼ ã€‚åˆ›å»ºçš„ PR å°†è¢«è‡ªåŠ¨æ£€æµ‹åˆ°ï¼Œå¹¶ä¸”ä¸Šä¼ å°†ä»Žåœæ­¢çš„åœ°æ–¹ç»§ç»­ã€‚å»ºè®®ä¼ é€’`multi_commits_verbose=True`ä»¥æ›´å¥½åœ°äº†è§£ä¸Šä¼ åŠå…¶è¿›åº¦ã€‚

ä¸‹é¢çš„ç¤ºä¾‹å°†æŠŠæ£€æŸ¥ç‚¹æ–‡ä»¶å¤¹ä¸Šä¼ åˆ°æ•°æ®é›†ä¸­çš„å¤šä¸ªæäº¤ä¸­ã€‚åœ¨ Hub ä¸Šå°†åˆ›å»ºä¸€ä¸ª PRï¼Œå¹¶åœ¨ä¸Šä¼ å®ŒæˆåŽè‡ªåŠ¨åˆå¹¶ã€‚å¦‚æžœæ‚¨å¸Œæœ› PR ä¿æŒæ‰“å¼€çŠ¶æ€å¹¶æ‰‹åŠ¨å®¡æŸ¥å®ƒï¼Œå¯ä»¥ä¼ é€’`create_pr=True`ã€‚

```py
>>> upload_folder(
...     folder_path="local/checkpoints",
...     repo_id="username/my-dataset",
...     repo_type="dataset",
...     multi_commits=True,
...     multi_commits_verbose=True,
... )
```

å¦‚æžœæ‚¨å¸Œæœ›æ›´å¥½åœ°æŽ§åˆ¶ä¸Šä¼ ç­–ç•¥ï¼ˆå³åˆ›å»ºçš„æäº¤ï¼‰ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹ä½Žçº§åˆ«çš„ plan_multi_commits()å’Œ create_commits_on_pr()æ–¹æ³•ã€‚

`multi_commits`ä»ç„¶æ˜¯ä¸€ä¸ªå®žéªŒæ€§åŠŸèƒ½ã€‚å…¶ API å’Œè¡Œä¸ºå¯èƒ½ä¼šåœ¨æœªæ¥å‘ç”Ÿå˜åŒ–ï¼Œæ•ä¸å¦è¡Œé€šçŸ¥ã€‚

### å®šæœŸä¸Šä¼ 

Hugging Face Hub ä½¿ä¿å­˜å’Œç‰ˆæœ¬åŒ–æ•°æ®å˜å¾—ç®€å•ã€‚ç„¶è€Œï¼Œå½“æ›´æ–°åŒä¸€æ–‡ä»¶æ•°åƒæ¬¡æ—¶ä¼šæœ‰ä¸€äº›é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä¿å­˜è®­ç»ƒè¿‡ç¨‹çš„æ—¥å¿—æˆ–ç”¨æˆ·å¯¹éƒ¨ç½²ç©ºé—´çš„åé¦ˆã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå°†æ•°æ®ä½œä¸ºæ•°æ®é›†ä¸Šä¼ åˆ° Hub æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä½†å¯èƒ½å¾ˆéš¾æ­£ç¡®æ‰§è¡Œã€‚ä¸»è¦åŽŸå› æ˜¯æ‚¨ä¸å¸Œæœ›å¯¹æ•°æ®çš„æ¯æ¬¡æ›´æ–°è¿›è¡Œç‰ˆæœ¬åŒ–ï¼Œå› ä¸ºè¿™ä¼šä½¿ git å­˜å‚¨åº“æ— æ³•ä½¿ç”¨ã€‚CommitScheduler ç±»æä¾›äº†è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ã€‚

è¿™ä¸ªæƒ³æ³•æ˜¯è¿è¡Œä¸€ä¸ªå®šæœŸå°†æœ¬åœ°æ–‡ä»¶å¤¹æŽ¨é€åˆ° Hub çš„åŽå°ä½œä¸šã€‚å‡è®¾æ‚¨æœ‰ä¸€ä¸ª Gradio ç©ºé—´ï¼Œè¯¥ç©ºé—´ä»¥ä¸€äº›æ–‡æœ¬ä½œä¸ºè¾“å…¥ï¼Œå¹¶ç”Ÿæˆå…¶ä¸¤ç§ç¿»è¯‘ã€‚ç„¶åŽï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ä»–ä»¬å–œæ¬¢çš„ç¿»è¯‘ã€‚å¯¹äºŽæ¯æ¬¡è¿è¡Œï¼Œæ‚¨å¸Œæœ›ä¿å­˜è¾“å…¥ã€è¾“å‡ºå’Œç”¨æˆ·åå¥½ä»¥åˆ†æžç»“æžœã€‚è¿™æ˜¯ CommitScheduler çš„ä¸€ä¸ªå®Œç¾Žç”¨ä¾‹ï¼›æ‚¨å¸Œæœ›å°†æ•°æ®ä¿å­˜åˆ° Hubï¼ˆå¯èƒ½æ˜¯æ•°ç™¾ä¸‡æ¡ç”¨æˆ·åé¦ˆï¼‰ï¼Œä½†æ‚¨ä¸*éœ€è¦*å®žæ—¶ä¿å­˜æ¯ä¸ªç”¨æˆ·çš„è¾“å…¥ã€‚ç›¸åï¼Œæ‚¨å¯ä»¥å°†æ•°æ®ä¿å­˜åœ¨æœ¬åœ°çš„ JSON æ–‡ä»¶ä¸­ï¼Œå¹¶æ¯ 10 åˆ†é’Ÿä¸Šä¼ ä¸€æ¬¡ã€‚ä¾‹å¦‚ï¼š

```py
>>> import json
>>> import uuid
>>> from pathlib import Path
>>> import gradio as gr
>>> from huggingface_hub import CommitScheduler

# Define the file where to save the data. Use UUID to make sure not to overwrite existing data from a previous run.
>>> feedback_file = Path("user_feedback/") / f"data_{uuid.uuid4()}.json"
>>> feedback_folder = feedback_file.parent

# Schedule regular uploads. Remote repo and local folder are created if they don't already exist.
>>> scheduler = CommitScheduler(
...     repo_id="report-translation-feedback",
...     repo_type="dataset",
...     folder_path=feedback_folder,
...     path_in_repo="data",
...     every=10,
... )

# Define the function that will be called when the user submits its feedback (to be called in Gradio)
>>> def save_feedback(input_text:str, output_1: str, output_2:str, user_choice: int) -> None:
...     """
...     Append input/outputs and user feedback to a JSON Lines file using a thread lock to avoid concurrent writes from different users.
...     """
...     with scheduler.lock:
...         with feedback_file.open("a") as f:
...             f.write(json.dumps({"input": input_text, "output_1": output_1, "output_2": output_2, "user_choice": user_choice}))
...             f.write("\n")

# Start Gradio
>>> with gr.Blocks() as demo:
>>>     ... # define Gradio demo + use `save_feedback`
>>> demo.launch()
```

å°±æ˜¯è¿™æ ·ï¼ç”¨æˆ·è¾“å…¥/è¾“å‡ºå’Œåé¦ˆå°†ä½œä¸º Hub ä¸Šçš„æ•°æ®é›†å¯ç”¨ã€‚é€šè¿‡ä½¿ç”¨å”¯ä¸€çš„ JSON æ–‡ä»¶åï¼Œæ‚¨å¯ä»¥ç¡®ä¿ä¸ä¼šè¦†ç›–ä»¥å‰è¿è¡Œçš„æ•°æ®æˆ–åŒæ—¶æŽ¨é€åˆ°åŒä¸€å­˜å‚¨åº“çš„å…¶ä»–ç©ºé—´/å‰¯æœ¬çš„æ•°æ®ã€‚

æœ‰å…³ CommitScheduler çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·çœ‹ä»¥ä¸‹å†…å®¹ï¼š

+   **ä»…è¿½åŠ :** å‡å®šæ‚¨åªä¼šå‘æ–‡ä»¶å¤¹æ·»åŠ å†…å®¹ã€‚æ‚¨åªèƒ½å‘çŽ°æœ‰æ–‡ä»¶è¿½åŠ æ•°æ®æˆ–åˆ›å»ºæ–°æ–‡ä»¶ã€‚åˆ é™¤æˆ–è¦†ç›–æ–‡ä»¶å¯èƒ½ä¼šæŸåæ‚¨çš„å­˜å‚¨åº“ã€‚

+   **git åŽ†å²è®°å½•:** è°ƒåº¦ç¨‹åºå°†æ¯`every`åˆ†é’Ÿæäº¤ä¸€æ¬¡æ–‡ä»¶å¤¹ã€‚ä¸ºäº†é¿å…è¿‡å¤šåœ°æ±¡æŸ“ git å­˜å‚¨åº“ï¼Œå»ºè®®å°†æœ€å°å€¼è®¾ç½®ä¸º 5 åˆ†é’Ÿã€‚æ­¤å¤–ï¼Œè°ƒåº¦ç¨‹åºæ—¨åœ¨é¿å…ç©ºæäº¤ã€‚å¦‚æžœåœ¨æ–‡ä»¶å¤¹ä¸­æœªæ£€æµ‹åˆ°æ–°å†…å®¹ï¼Œåˆ™è®¡åˆ’çš„æäº¤å°†è¢«ä¸¢å¼ƒã€‚

+   **é”™è¯¯:** è°ƒåº¦ç¨‹åºä½œä¸ºåŽå°çº¿ç¨‹è¿è¡Œã€‚å½“æ‚¨å®žä¾‹åŒ–ç±»æ—¶å¯åŠ¨å®ƒï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šåœæ­¢ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¦‚æžœåœ¨ä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼ˆä¾‹å¦‚ï¼šè¿žæŽ¥é—®é¢˜ï¼‰ï¼Œè°ƒåº¦ç¨‹åºå°†é»˜é»˜åœ°å¿½ç•¥å®ƒï¼Œå¹¶åœ¨ä¸‹ä¸€ä¸ªè®¡åˆ’çš„æäº¤æ—¶é‡è¯•ã€‚

+   **çº¿ç¨‹å®‰å…¨:** åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯ä»¥å®‰å…¨åœ°å‡è®¾å¯ä»¥å†™å…¥æ–‡ä»¶è€Œæ— éœ€æ‹…å¿ƒé”æ–‡ä»¶ã€‚å¦‚æžœåœ¨ä¸Šä¼ æ—¶å‘æ–‡ä»¶å¤¹å†™å…¥å†…å®¹ï¼Œè°ƒåº¦ç¨‹åºä¸ä¼šå´©æºƒæˆ–æŸåã€‚å®žé™…ä¸Šï¼Œå¯¹äºŽè´Ÿè½½è¾ƒé‡çš„åº”ç”¨ç¨‹åºï¼Œå¯èƒ½ä¼šå‘ç”Ÿå¹¶å‘é—®é¢˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨`scheduler.lock`é”æ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚åªæœ‰åœ¨è°ƒåº¦ç¨‹åºæ‰«ææ–‡ä»¶å¤¹ä»¥æŸ¥æ‰¾æ›´æ”¹æ—¶ï¼Œé”æ‰ä¼šè¢«é˜»å¡žï¼Œè€Œåœ¨ä¸Šä¼ æ•°æ®æ—¶ä¸ä¼šã€‚æ‚¨å¯ä»¥æ”¾å¿ƒåœ°è®¤ä¸ºå®ƒä¸ä¼šå½±å“æ‚¨çš„ç©ºé—´ä¸Šçš„ç”¨æˆ·ä½“éªŒã€‚

#### ç©ºé—´æŒä¹…æ€§æ¼”ç¤º

ä»Žç©ºé—´æŒä¹…åŒ–æ•°æ®åˆ° Hub ä¸Šçš„æ•°æ®é›†æ˜¯ CommitScheduler çš„ä¸»è¦ç”¨ä¾‹ã€‚æ ¹æ®ç”¨ä¾‹çš„ä¸åŒï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä»¥ä¸åŒçš„æ–¹å¼ç»“æž„åŒ–æ•°æ®ã€‚ç»“æž„å¿…é¡»å¯¹å¹¶å‘ç”¨æˆ·å’Œé‡æ–°å¯åŠ¨å…·æœ‰é²æ£’æ€§ï¼Œè¿™é€šå¸¸æ„å‘³ç€ç”Ÿæˆ UUIDã€‚é™¤äº†é²æ£’æ€§ï¼Œæ‚¨è¿˜åº”è¯¥ä»¥ðŸ¤— Datasets åº“å¯è¯»çš„æ ¼å¼ä¸Šä¼ æ•°æ®ï¼Œä»¥ä¾¿ä»¥åŽé‡ç”¨ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª[Space](https://huggingface.co/spaces/Wauplin/space_to_dataset_saver)ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä¿å­˜å‡ ç§ä¸åŒçš„æ•°æ®æ ¼å¼ï¼ˆæ‚¨å¯èƒ½éœ€è¦æ ¹æ®è‡ªå·±çš„ç‰¹å®šéœ€æ±‚è¿›è¡Œè°ƒæ•´ï¼‰ã€‚

#### è‡ªå®šä¹‰ä¸Šä¼ 

CommitScheduler å‡å®šæ‚¨çš„æ•°æ®æ˜¯è¿½åŠ çš„ï¼Œå¹¶ä¸”åº”è¯¥æŒ‰åŽŸæ ·ä¸Šä¼ ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯èƒ½å¸Œæœ›è‡ªå®šä¹‰æ•°æ®ä¸Šä¼ æ–¹å¼ã€‚æ‚¨å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªä»Ž CommitScheduler ç»§æ‰¿çš„ç±»ï¼Œå¹¶è¦†ç›–`push_to_hub`æ–¹æ³•ï¼ˆéšæ„ä»¥ä»»ä½•æ–¹å¼è¦†ç›–å®ƒï¼‰æ¥å®žçŽ°ã€‚ä¿è¯å®ƒå°†åœ¨åŽå°çº¿ç¨‹ä¸­æ¯éš”`every`åˆ†é’Ÿè°ƒç”¨ä¸€æ¬¡ã€‚æ‚¨æ— éœ€æ‹…å¿ƒå¹¶å‘å’Œé”™è¯¯ï¼Œä½†å¿…é¡»æ³¨æ„å…¶ä»–æ–¹é¢ï¼Œä¾‹å¦‚æŽ¨é€ç©ºæäº¤æˆ–é‡å¤æ•°æ®ã€‚

åœ¨ä¸‹é¢ï¼ˆç®€åŒ–çš„ï¼‰ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è¦†ç›–`push_to_hub`ä»¥å°†æ‰€æœ‰ PNG æ–‡ä»¶åŽ‹ç¼©åˆ°å•ä¸ªå­˜æ¡£ä¸­ï¼Œä»¥é¿å…åœ¨ Hub ä¸Šè¿‡è½½å­˜å‚¨åº“ï¼š

```py
class ZipScheduler(CommitScheduler):
    def push_to_hub(self):
        # 1\. List PNG files
          png_files = list(self.folder_path.glob("*.png"))
          if len(png_files) == 0:
              return None  # return early if nothing to commit

        # 2\. Zip png files in a single archive
        with tempfile.TemporaryDirectory() as tmpdir:
            archive_path = Path(tmpdir) / "train.zip"
            with zipfile.ZipFile(archive_path, "w", zipfile.ZIP_DEFLATED) as zip:
                for png_file in png_files:
                    zip.write(filename=png_file, arcname=png_file.name)

            # 3\. Upload archive
            self.api.upload_file(..., path_or_fileobj=archive_path)

        # 4\. Delete local png files to avoid re-uploading them later
        for png_file in png_files:
            png_file.unlink()
```

å½“è¦†ç›–`push_to_hub`æ—¶ï¼Œæ‚¨å¯ä»¥è®¿é—® CommitScheduler çš„å±žæ€§ï¼Œç‰¹åˆ«æ˜¯ï¼š

+   HfApi å®¢æˆ·ç«¯ï¼š`api`

+   æ–‡ä»¶å¤¹å‚æ•°ï¼š`folder_path`å’Œ`path_in_repo`

+   ä»“åº“å‚æ•°ï¼š`repo_id`ã€`repo_type`ã€`revision`

+   çº¿ç¨‹é”ï¼š`lock`

æŸ¥çœ‹æˆ‘ä»¬çš„[æ¼”ç¤ºç©ºé—´](https://huggingface.co/spaces/Wauplin/space_to_dataset_saver)ä¸­çš„æ›´å¤šè‡ªå®šä¹‰è°ƒåº¦ç¨‹åºç¤ºä¾‹ï¼Œå…¶ä¸­åŒ…å«æ ¹æ®æ‚¨çš„ç”¨ä¾‹ä¸åŒçš„ä¸åŒå®žçŽ°ã€‚

### create_commit

upload_file()å’Œ upload_folder()å‡½æ•°æ˜¯é€šå¸¸æ–¹ä¾¿ä½¿ç”¨çš„é«˜çº§ APIã€‚å¦‚æžœæ‚¨ä¸éœ€è¦åœ¨è¾ƒä½Žçº§åˆ«å·¥ä½œï¼Œæˆ‘ä»¬å»ºè®®é¦–å…ˆå°è¯•è¿™äº›å‡½æ•°ã€‚ä½†æ˜¯ï¼Œå¦‚æžœæ‚¨æƒ³åœ¨æäº¤çº§åˆ«å·¥ä½œï¼Œå¯ä»¥ç›´æŽ¥ä½¿ç”¨ create_commit()å‡½æ•°ã€‚

create_commit()æ”¯æŒä¸‰ç§ç±»åž‹çš„æ“ä½œï¼š

+   CommitOperationAdd å°†æ–‡ä»¶ä¸Šä¼ åˆ° Hubã€‚å¦‚æžœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™æ–‡ä»¶å†…å®¹å°†è¢«è¦†ç›–ã€‚æ­¤æ“ä½œæŽ¥å—ä¸¤ä¸ªå‚æ•°ï¼š

    +   `path_in_repo`ï¼šè¦ä¸Šä¼ æ–‡ä»¶çš„å­˜å‚¨åº“è·¯å¾„ã€‚

    +   `path_or_fileobj`ï¼šè¦ä¸Šä¼ åˆ° Hub çš„æ–‡ä»¶çš„è·¯å¾„æˆ–ç±»ä¼¼æ–‡ä»¶çš„å¯¹è±¡ã€‚è¿™æ˜¯è¦ä¸Šä¼ åˆ° Hub çš„æ–‡ä»¶å†…å®¹ã€‚

+   CommitOperationDelete ä»Žå­˜å‚¨åº“ä¸­åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ã€‚æ­¤æ“ä½œæŽ¥å—`path_in_repo`ä½œä¸ºå‚æ•°ã€‚

+   CommitOperationCopy åœ¨å­˜å‚¨åº“å†…å¤åˆ¶æ–‡ä»¶ã€‚æ­¤æ“ä½œæŽ¥å—ä¸‰ä¸ªå‚æ•°ï¼š

    +   `src_path_in_repo`ï¼šè¦å¤åˆ¶çš„æ–‡ä»¶çš„å­˜å‚¨åº“è·¯å¾„ã€‚

    +   `path_in_repo`ï¼šåº”å°†æ–‡ä»¶å¤åˆ¶åˆ°çš„å­˜å‚¨åº“è·¯å¾„ã€‚

    +   `src_revision`ï¼šå¯é€‰ - å¦‚æžœè¦ä»Žä¸åŒçš„åˆ†æ”¯/ä¿®è®¢ç‰ˆå¤åˆ¶æ–‡ä»¶ï¼Œåˆ™ä¸ºè¦å¤åˆ¶çš„æ–‡ä»¶çš„ä¿®è®¢ç‰ˆã€‚

ä¾‹å¦‚ï¼Œå¦‚æžœæ‚¨æƒ³è¦åœ¨ Hub å­˜å‚¨åº“ä¸­ä¸Šä¼ ä¸¤ä¸ªæ–‡ä»¶å¹¶åˆ é™¤ä¸€ä¸ªæ–‡ä»¶ï¼š

1.  ä½¿ç”¨é€‚å½“çš„ `CommitOperation` æ¥æ·»åŠ æˆ–åˆ é™¤æ–‡ä»¶ä»¥åŠåˆ é™¤æ–‡ä»¶å¤¹ï¼š

```py
>>> from huggingface_hub import HfApi, CommitOperationAdd, CommitOperationDelete
>>> api = HfApi()
>>> operations = [
...     CommitOperationAdd(path_in_repo="LICENSE.md", path_or_fileobj="~/repo/LICENSE.md"),
...     CommitOperationAdd(path_in_repo="weights.h5", path_or_fileobj="~/repo/weights-final.h5"),
...     CommitOperationDelete(path_in_repo="old-weights.h5"),
...     CommitOperationDelete(path_in_repo="logs/"),
...     CommitOperationCopy(src_path_in_repo="image.png", path_in_repo="duplicate_image.png"),
... ]
```

1.  å°†æ‚¨çš„æ“ä½œä¼ é€’ç»™ create_commit()ï¼š

```py
>>> api.create_commit(
...     repo_id="lysandre/test-model",
...     operations=operations,
...     commit_message="Upload my model weights and license",
... )
```

é™¤äº† upload_file() å’Œ upload_folder() å¤–ï¼Œä»¥ä¸‹åŠŸèƒ½è¿˜åœ¨å†…éƒ¨ä½¿ç”¨ create_commit()ï¼š

+   delete_file() ä»Ž Hub ä¸Šçš„å­˜å‚¨åº“ä¸­åˆ é™¤å•ä¸ªæ–‡ä»¶ã€‚

+   delete_folder() ä»Ž Hub ä¸Šçš„å­˜å‚¨åº“ä¸­åˆ é™¤æ•´ä¸ªæ–‡ä»¶å¤¹ã€‚

+   metadata_update() æ›´æ–°å­˜å‚¨åº“çš„å…ƒæ•°æ®ã€‚

æœ‰å…³æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ HfApi å‚è€ƒã€‚

### åœ¨æäº¤ä¹‹å‰é¢„å…ˆä¸Šä¼  LFS æ–‡ä»¶

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½å¸Œæœ›åœ¨è¿›è¡Œæäº¤è°ƒç”¨ä¹‹å‰å°†å¤§åž‹æ–‡ä»¶ä¸Šä¼ åˆ° S3 **ä¹‹å‰**ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæ‚¨æ­£åœ¨æäº¤ä¸€ä¸ªåœ¨å†…å­˜ä¸­ç”Ÿæˆçš„æ•°æ®é›†çš„å¤šä¸ªåˆ†ç‰‡ï¼Œæ‚¨éœ€è¦é€ä¸ªä¸Šä¼ è¿™äº›åˆ†ç‰‡ä»¥é¿å…å†…å­˜ä¸è¶³é—®é¢˜ã€‚ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯å°†æ¯ä¸ªåˆ†ç‰‡ä½œä¸ºå­˜å‚¨åº“ä¸Šçš„å•ç‹¬æäº¤ä¸Šä¼ ã€‚è™½ç„¶è¿™æ˜¯å®Œå…¨æœ‰æ•ˆçš„ï¼Œä½†è¿™ç§è§£å†³æ–¹æ¡ˆçš„ç¼ºç‚¹æ˜¯å¯èƒ½é€šè¿‡ç”Ÿæˆæ•°åä¸ªæäº¤æ¥æžä¹± git åŽ†å²ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‚¨å¯ä»¥é€ä¸ªå°†æ–‡ä»¶ä¸Šä¼ åˆ° S3ï¼Œç„¶åŽåœ¨æœ€åŽåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æäº¤ã€‚è¿™å¯ä»¥ä½¿ç”¨ preupload_lfs_files() ç»“åˆ create_commit() æ¥å®žçŽ°ã€‚

è¿™æ˜¯ä¸€ç§é«˜çº§ç”¨æˆ·æ–¹æ³•ã€‚åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç›´æŽ¥ä½¿ç”¨ upload_file()ã€upload_folder() æˆ– create_commit() è€Œä¸æ˜¯å¤„ç†é¢„å…ˆä¸Šä¼ æ–‡ä»¶çš„ä½Žçº§é€»è¾‘æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚preupload_lfs_files() çš„ä¸»è¦æ³¨æ„äº‹é¡¹æ˜¯ï¼Œåœ¨å®žé™…è¿›è¡Œæäº¤ä¹‹å‰ï¼Œä¸Šä¼ çš„æ–‡ä»¶åœ¨ Hub ä¸Šçš„å­˜å‚¨åº“ä¸Šæ˜¯ä¸å¯è®¿é—®çš„ã€‚å¦‚æžœæ‚¨æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·éšæ—¶åœ¨æˆ‘ä»¬çš„ Discord æˆ– GitHub é—®é¢˜ä¸­è”ç³»æˆ‘ä»¬ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œè¯´æ˜Žå¦‚ä½•é¢„å…ˆä¸Šä¼ æ–‡ä»¶ï¼š

```py
>>> from huggingface_hub import CommitOperationAdd, preupload_lfs_files, create_commit, create_repo

>>> repo_id = create_repo("test_preupload").repo_id

>>> operations = [] # List of all `CommitOperationAdd` objects that will be generated
>>> for i in range(5):
...     content = ... # generate binary content
...     addition = CommitOperationAdd(path_in_repo=f"shard_{i}_of_5.bin", path_or_fileobj=content)
...     preupload_lfs_files(repo_id, additions=[addition])
...     operations.append(addition)

>>> # Create commit
>>> create_commit(repo_id, operations=operations, commit_message="Commit all shards")
```

é¦–å…ˆï¼Œæˆ‘ä»¬é€ä¸ªåˆ›å»º CommitOperationAdd å¯¹è±¡ã€‚åœ¨å®žé™…ç¤ºä¾‹ä¸­ï¼Œè¿™äº›å¯¹è±¡å°†åŒ…å«ç”Ÿæˆçš„åˆ†ç‰‡ã€‚åœ¨ç”Ÿæˆä¸‹ä¸€ä¸ªæ–‡ä»¶ä¹‹å‰ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½ä¼šè¢«ä¸Šä¼ ã€‚åœ¨ preupload_lfs_files() æ­¥éª¤ä¸­ï¼Œ**`CommitOperationAdd` å¯¹è±¡ä¼šè¢«æ”¹å˜**ã€‚æ‚¨åº”è¯¥åªä½¿ç”¨å®ƒç›´æŽ¥ä¼ é€’ç»™ create_commit()ã€‚å¯¹è±¡çš„ä¸»è¦æ›´æ–°æ˜¯**äºŒè¿›åˆ¶å†…å®¹è¢«ä»Žä¸­åˆ é™¤**ï¼Œè¿™æ„å‘³ç€å¦‚æžœæ‚¨æ²¡æœ‰å­˜å‚¨å¦ä¸€ä¸ªå¼•ç”¨ï¼Œå®ƒå°†è¢«åžƒåœ¾å›žæ”¶ã€‚è¿™æ˜¯é¢„æœŸçš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¸Œæœ›åœ¨å†…å­˜ä¸­ä¿ç•™å·²ç»ä¸Šä¼ çš„å†…å®¹ã€‚æœ€åŽï¼Œé€šè¿‡å°†æ‰€æœ‰æ“ä½œä¼ é€’ç»™ create_commit() æ¥åˆ›å»ºæäº¤ã€‚æ‚¨å¯ä»¥ä¼ é€’å°šæœªå¤„ç†çš„å…¶ä»–æ“ä½œï¼ˆæ·»åŠ ã€åˆ é™¤æˆ–å¤åˆ¶ï¼‰ï¼Œå®ƒä»¬å°†è¢«æ­£ç¡®å¤„ç†ã€‚

## å¤§æ–‡ä»¶ä¸Šä¼ çš„æŠ€å·§å’Œçªé—¨

åœ¨å¤„ç†å­˜å‚¨åº“ä¸­çš„å¤§é‡æ•°æ®æ—¶ï¼Œæœ‰ä¸€äº›é™åˆ¶éœ€è¦æ³¨æ„ã€‚ç”±äºŽæµå¼ä¼ è¾“æ•°æ®æ‰€éœ€çš„æ—¶é—´ï¼Œä½¿å¾—ä¸Šä¼ /æŽ¨é€åœ¨æµç¨‹ç»“æŸæ—¶å¤±è´¥æˆ–é‡åˆ°é™çº§ä½“éªŒï¼Œæ— è®ºæ˜¯åœ¨ hf.co ä¸Šè¿˜æ˜¯åœ¨æœ¬åœ°å·¥ä½œæ—¶ï¼Œéƒ½å¯èƒ½éžå¸¸æ¼äººã€‚

æŸ¥çœ‹æˆ‘ä»¬çš„ [å­˜å‚¨åº“é™åˆ¶å’Œå»ºè®®](https://huggingface.co/docs/hub/repositories-recommendations) æŒ‡å—ï¼Œäº†è§£å¦‚ä½•åœ¨ Hub ä¸Šæž„å»ºå­˜å‚¨åº“çš„æœ€ä½³å®žè·µã€‚æŽ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ç»§ç»­ä¸€äº›å®žç”¨çš„æç¤ºï¼Œä½¿æ‚¨çš„ä¸Šä¼ è¿‡ç¨‹å°½å¯èƒ½é¡ºåˆ©ã€‚

+   **ä»Žå°å¼€å§‹**ï¼šæˆ‘ä»¬å»ºè®®ä»Žå°‘é‡æ•°æ®å¼€å§‹æµ‹è¯•æ‚¨çš„ä¸Šä¼ è„šæœ¬ã€‚å½“å¤±è´¥åªéœ€è¦å¾ˆå°‘çš„æ—¶é—´æ—¶ï¼Œæ›´å®¹æ˜“è¿­ä»£è„šæœ¬ã€‚

+   **æœŸæœ›å¤±è´¥**ï¼šæµå¼ä¼ è¾“å¤§é‡æ•°æ®æ˜¯å…·æœ‰æŒ‘æˆ˜æ€§çš„ã€‚ä½ ä¸çŸ¥é“ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œä½†æœ€å¥½å§‹ç»ˆè€ƒè™‘åˆ°è‡³å°‘ä¼šæœ‰ä¸€æ¬¡å¤±è´¥ - æ— è®ºæ˜¯ç”±äºŽæ‚¨çš„æœºå™¨ã€æ‚¨çš„è¿žæŽ¥è¿˜æ˜¯æˆ‘ä»¬çš„æœåŠ¡å™¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæ‚¨è®¡åˆ’ä¸Šä¼ å¤§é‡æ–‡ä»¶ï¼Œæœ€å¥½åœ¨ä¸Šä¼ ä¸‹ä¸€æ‰¹æ–‡ä»¶ä¹‹å‰åœ¨æœ¬åœ°è·Ÿè¸ªæ‚¨å·²ç»ä¸Šä¼ çš„æ–‡ä»¶ã€‚æ‚¨å¯ä»¥ç¡®ä¿å·²ç»æäº¤çš„ LFS æ–‡ä»¶æ°¸è¿œä¸ä¼šè¢«é‡æ–°ä¸Šä¼ ä¸¤æ¬¡ï¼Œä½†åœ¨å®¢æˆ·ç«¯æ£€æŸ¥å®ƒä»ç„¶å¯ä»¥èŠ‚çœä¸€äº›æ—¶é—´ã€‚

+   **ä½¿ç”¨ `hf_transfer`**ï¼šè¿™æ˜¯ä¸€ä¸ªåŸºäºŽ Rust çš„ [åº“](https://github.com/huggingface/hf_transfer)ï¼Œæ—¨åœ¨åŠ å¿«å…·æœ‰éžå¸¸é«˜å¸¦å®½çš„æœºå™¨ä¸Šçš„ä¸Šä¼ é€Ÿåº¦ã€‚è¦ä½¿ç”¨å®ƒï¼Œæ‚¨å¿…é¡»å®‰è£…å®ƒï¼ˆ`pip install hf_transfer`ï¼‰å¹¶é€šè¿‡å°† `HF_HUB_ENABLE_HF_TRANSFER=1` è®¾ç½®ä¸ºçŽ¯å¢ƒå˜é‡æ¥å¯ç”¨å®ƒã€‚ç„¶åŽæ‚¨å¯ä»¥æ­£å¸¸ä½¿ç”¨ `huggingface_hub`ã€‚å…è´£å£°æ˜Žï¼šè¿™æ˜¯ä¸€ä¸ªé¢å‘é«˜çº§ç”¨æˆ·çš„å·¥å…·ã€‚å®ƒç»è¿‡æµ‹è¯•å¹¶å·²å‡†å¤‡æŠ•å…¥ç”Ÿäº§ï¼Œä½†ç¼ºä¹åƒé«˜çº§é”™è¯¯å¤„ç†æˆ–ä»£ç†ç­‰ç”¨æˆ·å‹å¥½çš„åŠŸèƒ½ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ­¤ [éƒ¨åˆ†](https://huggingface.co/docs/huggingface_hub/hf_transfer)ã€‚

è¿›åº¦æ¡åœ¨ `hf_transfer` ç‰ˆæœ¬ `0.1.4` å¼€å§‹å¾—åˆ°æ”¯æŒã€‚å¦‚æžœæ‚¨è®¡åˆ’å¯ç”¨æ›´å¿«çš„ä¸Šä¼ ï¼Œè¯·è€ƒè™‘å‡çº§ï¼ˆ`pip install -U hf-transfer`ï¼‰ã€‚

## ï¼ˆä¼ ç»Ÿï¼‰ä½¿ç”¨ Git LFS ä¸Šä¼ æ–‡ä»¶

ä¸Šè¿°æ‰€æœ‰æ–¹æ³•éƒ½ä½¿ç”¨ Hub çš„ API æ¥ä¸Šä¼ æ–‡ä»¶ã€‚è¿™æ˜¯ä¸Šä¼ æ–‡ä»¶åˆ° Hub çš„æŽ¨èæ–¹å¼ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜æä¾› Repositoryï¼Œè¿™æ˜¯ä¸€ä¸ªå›´ç»• git å·¥å…·çš„åŒ…è£…å™¨ï¼Œç”¨äºŽç®¡ç†æœ¬åœ°å­˜å‚¨åº“ã€‚

è™½ç„¶ Repository æ²¡æœ‰æ­£å¼å¼ƒç”¨ï¼Œä½†æˆ‘ä»¬å»ºè®®ä½¿ç”¨ä¸Šé¢æè¿°çš„åŸºäºŽ HTTP çš„æ–¹æ³•ã€‚æœ‰å…³æ­¤å»ºè®®çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹è§£é‡ŠåŸºäºŽ HTTP å’ŒåŸºäºŽ Git æ–¹æ³•ä¹‹é—´æ ¸å¿ƒå·®å¼‚çš„æ­¤æŒ‡å—ã€‚

Git LFS ä¼šè‡ªåŠ¨å¤„ç†å¤§äºŽ 10MB çš„æ–‡ä»¶ã€‚ä½†å¯¹äºŽéžå¸¸å¤§çš„æ–‡ä»¶ï¼ˆ>5GBï¼‰ï¼Œæ‚¨éœ€è¦ä¸º Git LFS å®‰è£…è‡ªå®šä¹‰ä¼ è¾“ä»£ç†ï¼š

```py
huggingface-cli lfs-enable-largefiles
```

æ‚¨åº”è¯¥ä¸ºæ¯ä¸ªå…·æœ‰éžå¸¸å¤§æ–‡ä»¶çš„å­˜å‚¨åº“å®‰è£…æ­¤ã€‚å®‰è£…åŽï¼Œæ‚¨å°†èƒ½å¤ŸæŽ¨é€å¤§äºŽ 5GB çš„æ–‡ä»¶ã€‚

### commit ä¸Šä¸‹æ–‡ç®¡ç†å™¨

`commit`ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¤„ç†å››ä¸ªæœ€å¸¸è§çš„ Git å‘½ä»¤ï¼špullã€addã€commit å’Œ pushã€‚`git-lfs`ä¼šè‡ªåŠ¨è·Ÿè¸ªä»»ä½•å¤§äºŽ 10MB çš„æ–‡ä»¶ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ`commit`ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼š

1.  ä»Ž`text-files`å­˜å‚¨åº“ä¸­æ‹‰å–ã€‚

1.  æ·»åŠ å¯¹`file.txt`æ‰€åšçš„æ›´æ”¹ã€‚

1.  æäº¤æ›´æ”¹ã€‚

1.  å°†æ›´æ”¹æŽ¨é€åˆ°`text-files`å­˜å‚¨åº“ã€‚

```py
>>> from huggingface_hub import Repository
>>> with Repository(local_dir="text-files", clone_from="<user>/text-files").commit(commit_message="My first file :)"):
...     with open("file.txt", "w+") as f:
...         f.write(json.dumps({"hey": 8}))
```

ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨`commit`ä¸Šä¸‹æ–‡ç®¡ç†å™¨å°†æ–‡ä»¶ä¿å­˜å¹¶ä¸Šä¼ åˆ°å­˜å‚¨åº“çš„å¦ä¸€ä¸ªç¤ºä¾‹ï¼š

```py
>>> import torch
>>> model = torch.nn.Transformer()
>>> with Repository("torch-model", clone_from="<user>/torch-model", token=True).commit(commit_message="My cool model :)"):
...     torch.save(model.state_dict(), "model.pt")
```

å¦‚æžœè¦å¼‚æ­¥æŽ¨é€æäº¤ï¼Œè¯·è®¾ç½®`blocking=False`ã€‚éžé˜»å¡žè¡Œä¸ºåœ¨æ‚¨å¸Œæœ›åœ¨æäº¤è¢«æŽ¨é€æ—¶ç»§ç»­è¿è¡Œè„šæœ¬æ—¶å¾ˆæœ‰å¸®åŠ©ã€‚

```py
>>> with repo.commit(commit_message="My cool model :)", blocking=False)
```

æ‚¨å¯ä»¥ä½¿ç”¨`command_queue`æ–¹æ³•æ£€æŸ¥æŽ¨é€çš„çŠ¶æ€ï¼š

```py
>>> last_command = repo.command_queue[-1]
>>> last_command.status
```

è¯·å‚è€ƒä¸‹è¡¨ä»¥èŽ·å–å¯èƒ½çš„çŠ¶æ€ï¼š

| çŠ¶æ€ | æè¿° |
| --- | --- |
| -1 | æŽ¨é€æ­£åœ¨è¿›è¡Œä¸­ã€‚ |
| 0 | æŽ¨é€å·²æˆåŠŸå®Œæˆã€‚ |
| éžé›¶ | å‘ç”Ÿäº†é”™è¯¯ã€‚ |

å½“`blocking=False`æ—¶ï¼Œå‘½ä»¤ä¼šè¢«è·Ÿè¸ªï¼Œåªæœ‰å½“æ‰€æœ‰æŽ¨é€å®Œæˆæ—¶ï¼Œæ‚¨çš„è„šæœ¬æ‰ä¼šé€€å‡ºï¼Œå³ä½¿åœ¨è„šæœ¬ä¸­å‘ç”Ÿå…¶ä»–é”™è¯¯ã€‚ç”¨äºŽæ£€æŸ¥æŽ¨é€çŠ¶æ€çš„ä¸€äº›é¢å¤–æœ‰ç”¨çš„å‘½ä»¤åŒ…æ‹¬ï¼š

```py
# Inspect an error.
>>> last_command.stderr

# Check whether a push is completed or ongoing.
>>> last_command.is_done

# Check whether a push command has errored.
>>> last_command.failed
```

### push_to_hub

Repository ç±»æœ‰ä¸€ä¸ª push_to_hub()å‡½æ•°ï¼Œç”¨äºŽæ·»åŠ æ–‡ä»¶ï¼Œè¿›è¡Œæäº¤å¹¶å°†å®ƒä»¬æŽ¨é€åˆ°å­˜å‚¨åº“ã€‚ä¸Ž`commit`ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸åŒï¼Œæ‚¨éœ€è¦å…ˆä»Žå­˜å‚¨åº“ä¸­æ‹‰å–ï¼Œç„¶åŽæ‰èƒ½è°ƒç”¨ push_to_hub()ã€‚

ä¾‹å¦‚ï¼Œå¦‚æžœæ‚¨å·²ç»ä»Ž Hub å…‹éš†äº†ä¸€ä¸ªå­˜å‚¨åº“ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä»Žæœ¬åœ°ç›®å½•åˆå§‹åŒ–`repo`ï¼š

```py
>>> from huggingface_hub import Repository
>>> repo = Repository(local_dir="path/to/local/repo")
```

ä½¿ç”¨ git_pull()æ›´æ–°æœ¬åœ°å…‹éš†ï¼Œç„¶åŽå°†æ–‡ä»¶æŽ¨é€åˆ° Hubï¼š

```py
>>> repo.git_pull()
>>> repo.push_to_hub(commit_message="Commit my-awesome-file to the Hub")
```

ä½†æ˜¯ï¼Œå¦‚æžœæ‚¨è¿˜æ²¡æœ‰å‡†å¤‡å¥½æŽ¨é€æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ git_add()å’Œ git_commit()ä»…æ·»åŠ å’Œæäº¤æ‚¨çš„æ–‡ä»¶ï¼š

```py
>>> repo.git_add("path/to/file")
>>> repo.git_commit(commit_message="add my first model config file :)")
```

å‡†å¤‡å¥½åŽï¼Œä½¿ç”¨ git_push()å°†æ–‡ä»¶æŽ¨é€åˆ°æ‚¨çš„å­˜å‚¨åº“ï¼š

```py
>>> repo.git_push()
```
