- en: Building custom models
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Original text: [https://huggingface.co/docs/transformers/v4.37.2/en/custom_models](https://huggingface.co/docs/transformers/v4.37.2/en/custom_models)'
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: null
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: The ğŸ¤— Transformers library is designed to be easily extensible. Every model
    is fully coded in a given subfolder of the repository with no abstraction, so
    you can easily copy a modeling file and tweak it to your needs.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
- en: If you are writing a brand new model, it might be easier to start from scratch.
    In this tutorial, we will show you how to write a custom model and its configuration
    so it can be used inside Transformers, and how you can share it with the community
    (with the code it relies on) so that anyone can use it, even if itâ€™s not present
    in the ğŸ¤— Transformers library. Weâ€™ll see how to build upon transformers and extend
    the framework with your hooks and custom code.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
- en: We will illustrate all of this on a ResNet model, by wrapping the ResNet class
    of the [timm library](https://github.com/rwightman/pytorch-image-models) into
    a [PreTrainedModel](/docs/transformers/v4.37.2/en/main_classes/model#transformers.PreTrainedModel).
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
- en: Writing a custom configuration
  id: totrans-6
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Before we dive into the model, letâ€™s first write its configuration. The configuration
    of a model is an object that will contain all the necessary information to build
    the model. As we will see in the next section, the model can only take a `config`
    to be initialized, so we really need that object to be as complete as possible.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
- en: In our example, we will take a couple of arguments of the ResNet class that
    we might want to tweak. Different configurations will then give us the different
    types of ResNets that are possible. We then just store those arguments, after
    checking the validity of a few of them.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-9
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The three important things to remember when writing you own configuration are
    the following:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: you have to inherit from `PretrainedConfig`,
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: the `__init__` of your `PretrainedConfig` must accept any kwargs,
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: those `kwargs` need to be passed to the superclass `__init__`.
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The inheritance is to make sure you get all the functionality from the ğŸ¤— Transformers
    library, while the two other constraints come from the fact a `PretrainedConfig`
    has more fields than the ones you are setting. When reloading a config with the
    `from_pretrained` method, those fields need to be accepted by your config and
    then sent to the superclass.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
- en: Defining a `model_type` for your configuration (here `model_type="resnet"`)
    is not mandatory, unless you want to register your model with the auto classes
    (see last section).
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
- en: 'With this done, you can easily create and save your configuration like you
    would do with any other model config of the library. Here is how we can create
    a resnet50d config and save it:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'This will save a file named `config.json` inside the folder `custom-resnet`.
    You can then reload your config with the `from_pretrained` method:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: You can also use any other method of the [PretrainedConfig](/docs/transformers/v4.37.2/en/main_classes/configuration#transformers.PretrainedConfig)
    class, like [push_to_hub()](/docs/transformers/v4.37.2/en/internal/tokenization_utils#transformers.PreTrainedTokenizerBase.push_to_hub)
    to directly upload your config to the Hub.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
- en: Writing a custom model
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Now that we have our ResNet configuration, we can go on writing the model.
    We will actually write two: one that extracts the hidden features from a batch
    of images (like [BertModel](/docs/transformers/v4.37.2/en/model_doc/bert#transformers.BertModel))
    and one that is suitable for image classification (like [BertForSequenceClassification](/docs/transformers/v4.37.2/en/model_doc/bert#transformers.BertForSequenceClassification)).'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
- en: 'As we mentioned before, weâ€™ll only write a loose wrapper of the model to keep
    it simple for this example. The only thing we need to do before writing this class
    is a map between the block types and actual block classes. Then the model is defined
    from the configuration by passing everything to the `ResNet` class:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'For the model that will classify images, we just change the forward method:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹äºå°†å¯¹å›¾åƒè¿›è¡Œåˆ†ç±»çš„æ¨¡å‹ï¼Œæˆ‘ä»¬åªéœ€æ›´æ”¹å‰å‘æ–¹æ³•ï¼š
- en: '[PRE4]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: In both cases, notice how we inherit from `PreTrainedModel` and call the superclass
    initialization with the `config` (a bit like when you write a regular `torch.nn.Module`).
    The line that sets the `config_class` is not mandatory, unless you want to register
    your model with the auto classes (see last section).
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œè¯·æ³¨æ„æˆ‘ä»¬å¦‚ä½•ä»`PreTrainedModel`ç»§æ‰¿å¹¶ä½¿ç”¨`config`è°ƒç”¨è¶…ç±»åˆå§‹åŒ–ï¼ˆæœ‰ç‚¹åƒå½“æ‚¨ç¼–å†™å¸¸è§„`torch.nn.Module`æ—¶ï¼‰ã€‚è®¾ç½®`config_class`çš„è¡Œä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œé™¤éæ‚¨æƒ³å°†æ‚¨çš„æ¨¡å‹æ³¨å†Œåˆ°è‡ªåŠ¨ç±»ï¼ˆè¯·å‚è§æœ€åä¸€èŠ‚ï¼‰ã€‚
- en: If your model is very similar to a model inside the library, you can re-use
    the same configuration as this model.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨çš„æ¨¡å‹ä¸åº“ä¸­çš„æ¨¡å‹éå¸¸ç›¸ä¼¼ï¼Œæ‚¨å¯ä»¥é‡ç”¨ä¸è¯¥æ¨¡å‹ç›¸åŒçš„é…ç½®ã€‚
- en: You can have your model return anything you want, but returning a dictionary
    like we did for `ResnetModelForImageClassification`, with the loss included when
    labels are passed, will make your model directly usable inside the [Trainer](/docs/transformers/v4.37.2/en/main_classes/trainer#transformers.Trainer)
    class. Using another output format is fine as long as you are planning on using
    your own training loop or another library for training.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨å¯ä»¥è®©æ‚¨çš„æ¨¡å‹è¿”å›ä»»ä½•æ‚¨æƒ³è¦çš„å†…å®¹ï¼Œä½†æ˜¯åƒæˆ‘ä»¬ä¸º`ResnetModelForImageClassification`æ‰€åšçš„é‚£æ ·è¿”å›ä¸€ä¸ªåŒ…å«æŸå¤±çš„å­—å…¸ï¼Œå½“ä¼ é€’æ ‡ç­¾æ—¶ï¼Œå°†ä½¿æ‚¨çš„æ¨¡å‹å¯ä»¥ç›´æ¥åœ¨[Trainer](/docs/transformers/v4.37.2/en/main_classes/trainer#transformers.Trainer)ç±»ä¸­ä½¿ç”¨ã€‚åªè¦æ‚¨æ‰“ç®—ä½¿ç”¨è‡ªå·±çš„è®­ç»ƒå¾ªç¯æˆ–å…¶ä»–åº“è¿›è¡Œè®­ç»ƒï¼Œä½¿ç”¨å¦ä¸€ç§è¾“å‡ºæ ¼å¼ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚
- en: 'Now that we have our model class, letâ€™s create one:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬æœ‰äº†æˆ‘ä»¬çš„æ¨¡å‹ç±»ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªï¼š
- en: '[PRE5]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Again, you can use any of the methods of [PreTrainedModel](/docs/transformers/v4.37.2/en/main_classes/model#transformers.PreTrainedModel),
    like [save_pretrained()](/docs/transformers/v4.37.2/en/main_classes/model#transformers.PreTrainedModel.save_pretrained)
    or [push_to_hub()](/docs/transformers/v4.37.2/en/internal/tokenization_utils#transformers.PreTrainedTokenizerBase.push_to_hub).
    We will use the second in the next section, and see how to push the model weights
    with the code of our model. But first, letâ€™s load some pretrained weights inside
    our model.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: åŒæ ·ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨[PreTrainedModel](/docs/transformers/v4.37.2/en/main_classes/model#transformers.PreTrainedModel)çš„ä»»ä½•æ–¹æ³•ï¼Œä¾‹å¦‚[save_pretrained()](/docs/transformers/v4.37.2/en/main_classes/model#transformers.PreTrainedModel.save_pretrained)æˆ–[push_to_hub()](/docs/transformers/v4.37.2/en/internal/tokenization_utils#transformers.PreTrainedTokenizerBase.push_to_hub)ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼Œå¹¶çœ‹çœ‹å¦‚ä½•å°†æ¨¡å‹æƒé‡ä¸æˆ‘ä»¬æ¨¡å‹çš„ä»£ç ä¸€èµ·æ¨é€ã€‚ä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬åœ¨æ¨¡å‹ä¸­åŠ è½½ä¸€äº›é¢„è®­ç»ƒæƒé‡ã€‚
- en: 'In your own use case, you will probably be training your custom model on your
    own data. To go fast for this tutorial, we will use the pretrained version of
    the resnet50d. Since our model is just a wrapper around it, itâ€™s going to be easy
    to transfer those weights:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æ‚¨è‡ªå·±çš„ç”¨ä¾‹ä¸­ï¼Œæ‚¨å¯èƒ½ä¼šåœ¨è‡ªå·±çš„æ•°æ®ä¸Šè®­ç»ƒè‡ªå®šä¹‰æ¨¡å‹ã€‚ä¸ºäº†åœ¨æœ¬æ•™ç¨‹ä¸­å¿«é€Ÿè¿›è¡Œï¼Œæˆ‘ä»¬å°†ä½¿ç”¨resnet50dçš„é¢„è®­ç»ƒç‰ˆæœ¬ã€‚ç”±äºæˆ‘ä»¬çš„æ¨¡å‹åªæ˜¯å®ƒçš„ä¸€ä¸ªåŒ…è£…å™¨ï¼Œæ‰€ä»¥è½¬ç§»è¿™äº›æƒé‡å°†ä¼šå¾ˆå®¹æ˜“ï¼š
- en: '[PRE6]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Now letâ€™s see how to make sure that when we do [save_pretrained()](/docs/transformers/v4.37.2/en/main_classes/model#transformers.PreTrainedModel.save_pretrained)
    or [push_to_hub()](/docs/transformers/v4.37.2/en/internal/tokenization_utils#transformers.PreTrainedTokenizerBase.push_to_hub),
    the code of the model is saved.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ç¡®ä¿åœ¨æ‰§è¡Œ[save_pretrained()](/docs/transformers/v4.37.2/en/main_classes/model#transformers.PreTrainedModel.save_pretrained)æˆ–[push_to_hub()](/docs/transformers/v4.37.2/en/internal/tokenization_utils#transformers.PreTrainedTokenizerBase.push_to_hub)æ—¶ï¼Œæ¨¡å‹çš„ä»£ç è¢«ä¿å­˜ã€‚
- en: Registering a model with custom code to the auto classes
  id: totrans-36
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å°†å¸¦æœ‰è‡ªå®šä¹‰ä»£ç çš„æ¨¡å‹æ³¨å†Œåˆ°è‡ªåŠ¨ç±»
- en: If you are writing a library that extends ğŸ¤— Transformers, you may want to extend
    the auto classes to include your own model. This is different from pushing the
    code to the Hub in the sense that users will need to import your library to get
    the custom models (contrarily to automatically downloading the model code from
    the Hub).
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨æ­£åœ¨ç¼–å†™ä¸€ä¸ªæ‰©å±•ğŸ¤— Transformersçš„åº“ï¼Œæ‚¨å¯èƒ½å¸Œæœ›æ‰©å±•è‡ªåŠ¨ç±»ä»¥åŒ…æ‹¬æ‚¨è‡ªå·±çš„æ¨¡å‹ã€‚è¿™ä¸å°†ä»£ç æ¨é€åˆ°Hubä¸åŒï¼Œç”¨æˆ·éœ€è¦å¯¼å…¥æ‚¨çš„åº“æ‰èƒ½è·å–è‡ªå®šä¹‰æ¨¡å‹ï¼ˆä¸è‡ªåŠ¨ä»Hubä¸‹è½½æ¨¡å‹ä»£ç ç›¸åï¼‰ã€‚
- en: 'As long as your config has a `model_type` attribute that is different from
    existing model types, and that your model classes have the right `config_class`
    attributes, you can just add them to the auto classes like this:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: åªè¦æ‚¨çš„é…ç½®å…·æœ‰ä¸ç°æœ‰æ¨¡å‹ç±»å‹ä¸åŒçš„`model_type`å±æ€§ï¼Œå¹¶ä¸”æ‚¨çš„æ¨¡å‹ç±»å…·æœ‰æ­£ç¡®çš„`config_class`å±æ€§ï¼Œæ‚¨å°±å¯ä»¥åƒè¿™æ ·å°†å®ƒä»¬æ·»åŠ åˆ°è‡ªåŠ¨ç±»ä¸­ï¼š
- en: '[PRE7]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Note that the first argument used when registering your custom config to [AutoConfig](/docs/transformers/v4.37.2/en/model_doc/auto#transformers.AutoConfig)
    needs to match the `model_type` of your custom config, and the first argument
    used when registering your custom models to any auto model class needs to match
    the `config_class` of those models.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: æ³¨æ„ï¼Œåœ¨å°†è‡ªå®šä¹‰é…ç½®æ³¨å†Œåˆ°[AutoConfig](/docs/transformers/v4.37.2/en/model_doc/auto#transformers.AutoConfig)æ—¶ä½¿ç”¨çš„ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦ä¸è‡ªå®šä¹‰é…ç½®çš„`model_type`åŒ¹é…ï¼Œå¹¶ä¸”åœ¨å°†è‡ªå®šä¹‰æ¨¡å‹æ³¨å†Œåˆ°ä»»ä½•è‡ªåŠ¨æ¨¡å‹ç±»æ—¶ä½¿ç”¨çš„ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦ä¸è¿™äº›æ¨¡å‹çš„`config_class`åŒ¹é…ã€‚
- en: Sending the code to the Hub
  id: totrans-41
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å°†ä»£ç å‘é€åˆ°Hub
- en: This API is experimental and may have some slight breaking changes in the next
    releases.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: æ­¤APIæ˜¯å®éªŒæ€§çš„ï¼Œå¯èƒ½åœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬ä¸­æœ‰ä¸€äº›è½»å¾®çš„ç ´åæ€§æ›´æ”¹ã€‚
- en: First, make sure your model is fully defined in a `.py` file. It can rely on
    relative imports to some other files as long as all the files are in the same
    directory (we donâ€™t support submodules for this feature yet). For our example,
    weâ€™ll define a `modeling_resnet.py` file and a `configuration_resnet.py` file
    in a folder of the current working directory named `resnet_model`. The configuration
    file contains the code for `ResnetConfig` and the modeling file contains the code
    of `ResnetModel` and `ResnetModelForImageClassification`.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆï¼Œè¯·ç¡®ä¿æ‚¨çš„æ¨¡å‹åœ¨ä¸€ä¸ª`.py`æ–‡ä»¶ä¸­å®Œå…¨å®šä¹‰ã€‚å®ƒå¯ä»¥ä¾èµ–äºä¸€äº›å…¶ä»–æ–‡ä»¶çš„ç›¸å¯¹å¯¼å…¥ï¼Œåªè¦æ‰€æœ‰æ–‡ä»¶éƒ½åœ¨åŒä¸€ä¸ªç›®å½•ä¸­ï¼ˆæˆ‘ä»¬ç›®å‰è¿˜ä¸æ”¯æŒæ­¤åŠŸèƒ½çš„å­æ¨¡å—ï¼‰ã€‚å¯¹äºæˆ‘ä»¬çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†åœ¨å½“å‰å·¥ä½œç›®å½•ä¸­çš„ä¸€ä¸ªåä¸º`resnet_model`çš„æ–‡ä»¶å¤¹ä¸­å®šä¹‰ä¸€ä¸ª`modeling_resnet.py`æ–‡ä»¶å’Œä¸€ä¸ª`configuration_resnet.py`æ–‡ä»¶ã€‚é…ç½®æ–‡ä»¶åŒ…å«`ResnetConfig`çš„ä»£ç ï¼Œå»ºæ¨¡æ–‡ä»¶åŒ…å«`ResnetModel`å’Œ`ResnetModelForImageClassification`çš„ä»£ç ã€‚
- en: '[PRE8]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The `__init__.py` can be empty, itâ€™s just there so that Python detects `resnet_model`
    can be use as a module.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '`__init__.py`å¯ä»¥ä¸ºç©ºï¼Œåªæ˜¯ä¸ºäº†è®©Pythonæ£€æµ‹`resnet_model`å¯ä»¥ç”¨ä½œæ¨¡å—ã€‚'
- en: If copying a modeling files from the library, you will need to replace all the
    relative imports at the top of the file to import from the `transformers` package.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä»åº“ä¸­å¤åˆ¶å»ºæ¨¡æ–‡ä»¶ï¼Œåˆ™éœ€è¦å°†æ–‡ä»¶é¡¶éƒ¨çš„æ‰€æœ‰ç›¸å¯¹å¯¼å…¥æ›¿æ¢ä¸ºä»`transformers`åŒ…å¯¼å…¥ã€‚
- en: Note that you can re-use (or subclass) an existing configuration/model.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥é‡å¤ä½¿ç”¨ï¼ˆæˆ–å­ç±»åŒ–ï¼‰ç°æœ‰çš„é…ç½®/æ¨¡å‹ã€‚
- en: 'To share your model with the community, follow those steps: first import the
    ResNet model and config from the newly created files:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: è¦ä¸ç¤¾åŒºå…±äº«æ‚¨çš„æ¨¡å‹ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼šé¦–å…ˆä»æ–°åˆ›å»ºçš„æ–‡ä»¶ä¸­å¯¼å…¥ResNetæ¨¡å‹å’Œé…ç½®ï¼š
- en: '[PRE9]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Then you have to tell the library you want to copy the code files of those
    objects when using the `save_pretrained` method and properly register them with
    a given Auto class (especially for models), just run:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œå½“ä½¿ç”¨`save_pretrained`æ–¹æ³•æ—¶ï¼Œæ‚¨å¿…é¡»å‘Šè¯‰åº“æ‚¨è¦å¤åˆ¶è¿™äº›å¯¹è±¡çš„ä»£ç æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ç»™å®šçš„Autoç±»æ­£ç¡®æ³¨å†Œå®ƒä»¬ï¼ˆç‰¹åˆ«æ˜¯å¯¹äºæ¨¡å‹ï¼‰ï¼Œåªéœ€è¿è¡Œï¼š
- en: '[PRE10]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Note that there is no need to specify an auto class for the configuration (there
    is only one auto class for them, [AutoConfig](/docs/transformers/v4.37.2/en/model_doc/auto#transformers.AutoConfig))
    but itâ€™s different for models. Your custom model could be suitable for many different
    tasks, so you have to specify which one of the auto classes is the correct one
    for your model.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ï¼Œæ— éœ€ä¸ºé…ç½®æŒ‡å®šè‡ªåŠ¨ç±»ï¼ˆå®ƒä»¬åªæœ‰ä¸€ä¸ªè‡ªåŠ¨ç±»ï¼Œ[AutoConfig](/docs/transformers/v4.37.2/en/model_doc/auto#transformers.AutoConfig)ï¼‰ï¼Œä½†å¯¹äºæ¨¡å‹æ¥è¯´æƒ…å†µä¸åŒã€‚æ‚¨çš„è‡ªå®šä¹‰æ¨¡å‹å¯èƒ½é€‚ç”¨äºè®¸å¤šä¸åŒçš„ä»»åŠ¡ï¼Œå› æ­¤æ‚¨å¿…é¡»æŒ‡å®šå“ªä¸ªè‡ªåŠ¨ç±»æ˜¯æ‚¨æ¨¡å‹çš„æ­£ç¡®ç±»ã€‚
- en: 'Use `register_for_auto_class()` if you want the code files to be copied. If
    you instead prefer to use code on the Hub from another repo, you donâ€™t need to
    call it. In cases where thereâ€™s more than one auto class, you can modify the `config.json`
    directly using the following structure:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœè¦å°†ä»£ç æ–‡ä»¶å¤åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨`register_for_auto_class()`ã€‚å¦‚æœæ‚¨æ›´å–œæ¬¢ä»å¦ä¸€ä¸ªå­˜å‚¨åº“ä¸­çš„Hubä½¿ç”¨ä»£ç ï¼Œåˆ™æ— éœ€è°ƒç”¨å®ƒã€‚åœ¨å­˜åœ¨å¤šä¸ªè‡ªåŠ¨ç±»çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹`config.json`ï¼Œä½¿ç”¨ä»¥ä¸‹ç»“æ„ï¼š
- en: '[PRE11]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Next, letâ€™s create the config and models as we did before:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åƒä»¥å‰ä¸€æ ·åˆ›å»ºé…ç½®å’Œæ¨¡å‹ï¼š
- en: '[PRE12]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Now to send the model to the Hub, make sure you are logged in. Either run in
    your terminal:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨è¦å°†æ¨¡å‹å‘é€åˆ°Hubï¼Œè¯·ç¡®ä¿æ‚¨å·²ç™»å½•ã€‚åœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼š
- en: '[PRE13]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'or from a notebook:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ–è€…ä»ç¬”è®°æœ¬ä¸­ï¼š
- en: '[PRE14]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'You can then push to your own namespace (or an organization you are a member
    of) like this:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åï¼Œæ‚¨å¯ä»¥åƒè¿™æ ·æ¨é€åˆ°æ‚¨è‡ªå·±çš„å‘½åç©ºé—´ï¼ˆæˆ–æ‚¨æ˜¯å…¶æˆå‘˜çš„ç»„ç»‡ï¼‰ï¼š
- en: '[PRE15]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: On top of the modeling weights and the configuration in json format, this also
    copied the modeling and configuration `.py` files in the folder `custom-resnet50d`
    and uploaded the result to the Hub. You can check the result in this [model repo](https://huggingface.co/sgugger/custom-resnet50d).
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: é™¤äº†ä»¥jsonæ ¼å¼å¤åˆ¶å»ºæ¨¡æƒé‡å’Œé…ç½®å¤–ï¼Œè¿˜å°†å»ºæ¨¡å’Œé…ç½®çš„`.py`æ–‡ä»¶å¤åˆ¶åˆ°`custom-resnet50d`æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶å°†ç»“æœä¸Šä¼ åˆ°Hubã€‚æ‚¨å¯ä»¥åœ¨æ­¤[model
    repo](https://huggingface.co/sgugger/custom-resnet50d)ä¸­æŸ¥çœ‹ç»“æœã€‚
- en: See the [sharing tutorial](model_sharing) for more information on the push to
    Hub method.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: æœ‰å…³å°†æ¨¡å‹æ¨é€åˆ°Hubçš„æ–¹æ³•çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[å…±äº«æ•™ç¨‹](model_sharing)ã€‚
- en: Using a model with custom code
  id: totrans-65
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä½¿ç”¨å…·æœ‰è‡ªå®šä¹‰ä»£ç çš„æ¨¡å‹
- en: 'You can use any configuration, model or tokenizer with custom code files in
    its repository with the auto-classes and the `from_pretrained` method. All files
    and code uploaded to the Hub are scanned for malware (refer to the [Hub security](https://huggingface.co/docs/hub/security#malware-scanning)
    documentation for more information), but you should still review the model code
    and author to avoid executing malicious code on your machine. Set `trust_remote_code=True`
    to use a model with custom code:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨å¯ä»¥åœ¨å…¶å­˜å‚¨åº“ä¸­ä½¿ç”¨ä»»ä½•é…ç½®ã€æ¨¡å‹æˆ–åˆ†è¯å™¨ä¸è‡ªå®šä¹‰ä»£ç æ–‡ä»¶ï¼Œä½¿ç”¨è‡ªåŠ¨ç±»å’Œ`from_pretrained`æ–¹æ³•ã€‚æ‰€æœ‰ä¸Šä¼ åˆ°Hubçš„æ–‡ä»¶å’Œä»£ç éƒ½ä¼šè¢«æ‰«æä»¥æ£€æµ‹æ¶æ„è½¯ä»¶ï¼ˆæœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[Hubå®‰å…¨](https://huggingface.co/docs/hub/security#malware-scanning)æ–‡æ¡£ï¼‰ï¼Œä½†æ‚¨ä»åº”æŸ¥çœ‹æ¨¡å‹ä»£ç å’Œä½œè€…ï¼Œä»¥é¿å…åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šæ‰§è¡Œæ¶æ„ä»£ç ã€‚è®¾ç½®`trust_remote_code=True`ä»¥ä½¿ç”¨å…·æœ‰è‡ªå®šä¹‰ä»£ç çš„æ¨¡å‹ï¼š
- en: '[PRE16]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: It is also strongly encouraged to pass a commit hash as a `revision` to make
    sure the author of the models did not update the code with some malicious new
    lines (unless you fully trust the authors of the models).
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: å¼ºçƒˆå»ºè®®ä¼ é€’æäº¤å“ˆå¸Œä½œä¸º`revision`ï¼Œä»¥ç¡®ä¿æ¨¡å‹çš„ä½œè€…æ²¡æœ‰ä½¿ç”¨ä¸€äº›æ¶æ„çš„æ–°ä»£ç æ›´æ–°ä»£ç ï¼ˆé™¤éæ‚¨å®Œå…¨ä¿¡ä»»æ¨¡å‹çš„ä½œè€…ï¼‰ã€‚
- en: '[PRE17]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Note that when browsing the commit history of the model repo on the Hub, there
    is a button to easily copy the commit hash of any commit.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ï¼Œåœ¨Hubä¸Šæµè§ˆæ¨¡å‹å­˜å‚¨åº“çš„æäº¤å†å²æ—¶ï¼Œæœ‰ä¸€ä¸ªæŒ‰é’®å¯ä»¥è½»æ¾å¤åˆ¶ä»»ä½•æäº¤çš„æäº¤å“ˆå¸Œã€‚
