- en: Load LoRAs for inference
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: åŠ è½½LoRAè¿›è¡Œæ¨ç†
- en: 'Original text: [https://huggingface.co/docs/diffusers/tutorials/using_peft_for_inference](https://huggingface.co/docs/diffusers/tutorials/using_peft_for_inference)'
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸæ–‡é“¾æ¥ï¼š[https://huggingface.co/docs/diffusers/tutorials/using_peft_for_inference](https://huggingface.co/docs/diffusers/tutorials/using_peft_for_inference)
- en: null
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: There are many adapters (with LoRAs being the most common type) trained in different
    styles to achieve different effects. You can even combine multiple adapters to
    create new and unique images. With the ğŸ¤— [PEFT](https://huggingface.co/docs/peft/index)
    integration in ğŸ¤— Diffusers, it is really easy to load and manage adapters for
    inference. In this guide, youâ€™ll learn how to use different adapters with [Stable
    Diffusion XL (SDXL)](../api/pipelines/stable_diffusion/stable_diffusion_xl) for
    inference.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: æœ‰è®¸å¤šé€‚é…å™¨ï¼ˆå…¶ä¸­LoRAæ˜¯æœ€å¸¸è§çš„ç±»å‹ï¼‰ä»¥ä¸åŒçš„é£æ ¼è¿›è¡Œè®­ç»ƒï¼Œä»¥å®ç°ä¸åŒçš„æ•ˆæœã€‚æ‚¨ç”šè‡³å¯ä»¥ç»„åˆå¤šä¸ªé€‚é…å™¨æ¥åˆ›å»ºæ–°çš„ç‹¬ç‰¹å›¾åƒã€‚é€šè¿‡ğŸ¤— [PEFT](https://huggingface.co/docs/peft/index)åœ¨ğŸ¤—
    Diffusersä¸­çš„é›†æˆï¼Œéå¸¸å®¹æ˜“åŠ è½½å’Œç®¡ç†é€‚é…å™¨è¿›è¡Œæ¨ç†ã€‚åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ä¸åŒçš„é€‚é…å™¨ä¸[Stable Diffusion XL (SDXL)](../api/pipelines/stable_diffusion/stable_diffusion_xl)ä¸€èµ·è¿›è¡Œæ¨ç†ã€‚
- en: Throughout this guide, youâ€™ll use LoRA as the main adapter technique, so weâ€™ll
    use the terms LoRA and adapter interchangeably. You should have some familiarity
    with LoRA, and if you donâ€™t, we welcome you to check out the [LoRA guide](https://huggingface.co/docs/peft/conceptual_guides/lora).
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æ•´ä¸ªæŒ‡å—ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨LoRAä½œä¸ºä¸»è¦é€‚é…å™¨æŠ€æœ¯ï¼Œå› æ­¤æˆ‘ä»¬å°†LoRAå’Œé€‚é…å™¨æœ¯è¯­äº’æ¢ä½¿ç”¨ã€‚æ‚¨åº”è¯¥å¯¹LoRAæœ‰ä¸€å®šäº†è§£ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ¬¢è¿æŸ¥çœ‹[LoRAæŒ‡å—](https://huggingface.co/docs/peft/conceptual_guides/lora)ã€‚
- en: Letâ€™s first install all the required libraries.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬é¦–å…ˆå®‰è£…æ‰€æœ‰æ‰€éœ€çš„åº“ã€‚
- en: '[PRE0]'
  id: totrans-6
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Now, letâ€™s load a pipeline with a SDXL checkpoint:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œè®©æˆ‘ä»¬åŠ è½½ä¸€ä¸ªå¸¦æœ‰SDXLæ£€æŸ¥ç‚¹çš„ç®¡é“ï¼š
- en: '[PRE1]'
  id: totrans-8
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Next, load a LoRA checkpoint with the [load_lora_weights()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.StableDiffusionXLLoraLoaderMixin.load_lora_weights)
    method.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: æ¥ä¸‹æ¥ï¼Œä½¿ç”¨[load_lora_weights()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.StableDiffusionXLLoraLoaderMixin.load_lora_weights)æ–¹æ³•åŠ è½½ä¸€ä¸ªLoRAæ£€æŸ¥ç‚¹ã€‚
- en: With the ğŸ¤— PEFT integration, you can assign a specific `adapter_name` to the
    checkpoint, which letâ€™s you easily switch between different LoRA checkpoints.
    Letâ€™s call this adapter `"toy"`.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: é€šè¿‡ğŸ¤— PEFTé›†æˆï¼Œæ‚¨å¯ä»¥ä¸ºæ£€æŸ¥ç‚¹åˆ†é…ç‰¹å®šçš„`adapter_name`ï¼Œè¿™æ ·æ‚¨å¯ä»¥è½»æ¾åœ¨ä¸åŒçš„LoRAæ£€æŸ¥ç‚¹ä¹‹é—´åˆ‡æ¢ã€‚è®©æˆ‘ä»¬å°†æ­¤é€‚é…å™¨å‘½åä¸º`"toy"`ã€‚
- en: '[PRE2]'
  id: totrans-11
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'And then perform inference:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: ç„¶åæ‰§è¡Œæ¨ç†ï¼š
- en: '[PRE3]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '![toy-face](../Images/5113690135aa0bd78ddd1d3e7c53479d.png)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![ç©å…·è„¸](../Images/5113690135aa0bd78ddd1d3e7c53479d.png)'
- en: With the `adapter_name` parameter, it is really easy to use another adapter
    for inference! Load the [nerijs/pixel-art-xl](https://huggingface.co/nerijs/pixel-art-xl)
    adapter that has been fine-tuned to generate pixel art images, and letâ€™s call
    it `"pixel"`.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨`adapter_name`å‚æ•°ï¼Œéå¸¸å®¹æ˜“ä¸ºæ¨ç†ä½¿ç”¨å¦ä¸€ä¸ªé€‚é…å™¨ï¼åŠ è½½å·²ç»å¾®è°ƒä»¥ç”Ÿæˆåƒç´ è‰ºæœ¯å›¾åƒçš„[nerijs/pixel-art-xl](https://huggingface.co/nerijs/pixel-art-xl)é€‚é…å™¨ï¼Œå¹¶å°†å…¶å‘½åä¸º`"pixel"`ã€‚
- en: 'The pipeline automatically sets the first loaded adapter (`"toy"`) as the active
    adapter. But you can activate the `"pixel"` adapter with the [set_adapters()](/docs/diffusers/v0.26.3/en/api/loaders/unet#diffusers.loaders.UNet2DConditionLoadersMixin.set_adapters)
    method as shown below:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: ç®¡é“ä¼šè‡ªåŠ¨å°†ç¬¬ä¸€ä¸ªåŠ è½½çš„é€‚é…å™¨ï¼ˆ`"toy"`ï¼‰è®¾ç½®ä¸ºæ´»åŠ¨é€‚é…å™¨ã€‚ä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨ä¸‹é¢æ˜¾ç¤ºçš„[set_adapters()](/docs/diffusers/v0.26.3/en/api/loaders/unet#diffusers.loaders.UNet2DConditionLoadersMixin.set_adapters)æ–¹æ³•æ¿€æ´»`"pixel"`é€‚é…å™¨ï¼š
- en: '[PRE4]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Letâ€™s now generate an image with the second adapter and check the result:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨ç¬¬äºŒä¸ªé€‚é…å™¨ç”Ÿæˆä¸€å¹…å›¾åƒå¹¶æ£€æŸ¥ç»“æœï¼š
- en: '[PRE5]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![pixel-art](../Images/d01ebc0347358d4583b5ade26b841a6f.png)'
  id: totrans-20
  prefs: []
  type: TYPE_IMG
  zh: '![åƒç´ è‰ºæœ¯](../Images/d01ebc0347358d4583b5ade26b841a6f.png)'
- en: Combine multiple adapters
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç»„åˆå¤šä¸ªé€‚é…å™¨
- en: You can also perform multi-adapter inference where you combine different adapter
    checkpoints for inference.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨è¿˜å¯ä»¥æ‰§è¡Œå¤šé€‚é…å™¨æ¨ç†ï¼Œå…¶ä¸­æ‚¨å°†ç»„åˆä¸åŒçš„é€‚é…å™¨æ£€æŸ¥ç‚¹è¿›è¡Œæ¨ç†ã€‚
- en: Once again, use the [set_adapters()](/docs/diffusers/v0.26.3/en/api/loaders/unet#diffusers.loaders.UNet2DConditionLoadersMixin.set_adapters)
    method to activate two LoRA checkpoints and specify the weight for how the checkpoints
    should be combined.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: å†æ¬¡ä½¿ç”¨[set_adapters()](/docs/diffusers/v0.26.3/en/api/loaders/unet#diffusers.loaders.UNet2DConditionLoadersMixin.set_adapters)æ–¹æ³•æ¿€æ´»ä¸¤ä¸ªLoRAæ£€æŸ¥ç‚¹ï¼Œå¹¶æŒ‡å®šæ£€æŸ¥ç‚¹åº”å¦‚ä½•ç»„åˆçš„æƒé‡ã€‚
- en: '[PRE6]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Now that we have set these two adapters, letâ€™s generate an image from the combined
    adapters!
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æˆ‘ä»¬å·²ç»è®¾ç½®äº†è¿™ä¸¤ä¸ªé€‚é…å™¨ï¼Œè®©æˆ‘ä»¬ä»ç»„åˆé€‚é…å™¨ç”Ÿæˆä¸€å¹…å›¾åƒï¼
- en: LoRA checkpoints in the diffusion community are almost always obtained with
    [DreamBooth](https://huggingface.co/docs/diffusers/main/en/training/dreambooth).
    DreamBooth training often relies on â€œtriggerâ€ words in the input text prompts
    in order for the generation results to look as expected. When you combine multiple
    LoRA checkpoints, itâ€™s important to ensure the trigger words for the corresponding
    LoRA checkpoints are present in the input text prompts.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: æ‰©æ•£ç¤¾åŒºä¸­çš„LoRAæ£€æŸ¥ç‚¹å‡ ä¹æ€»æ˜¯ä½¿ç”¨[DreamBooth](https://huggingface.co/docs/diffusers/main/en/training/dreambooth)è·å¾—çš„ã€‚
    DreamBoothè®­ç»ƒé€šå¸¸ä¾èµ–äºè¾“å…¥æ–‡æœ¬æç¤ºä¸­çš„â€œè§¦å‘â€è¯ï¼Œä»¥ä¾¿ç”Ÿæˆç»“æœçœ‹èµ·æ¥ç¬¦åˆé¢„æœŸã€‚å½“æ‚¨ç»„åˆå¤šä¸ªLoRAæ£€æŸ¥ç‚¹æ—¶ï¼Œé‡è¦çš„æ˜¯ç¡®ä¿ç›¸åº”LoRAæ£€æŸ¥ç‚¹çš„è§¦å‘è¯å­˜åœ¨äºè¾“å…¥æ–‡æœ¬æç¤ºä¸­ã€‚
- en: The trigger words for [CiroN2022/toy-face](https://hf.co/CiroN2022/toy-face)
    and [nerijs/pixel-art-xl](https://hf.co/nerijs/pixel-art-xl) are found in their
    repositories.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: è§¦å‘è¯[CiroN2022/toy-face](https://hf.co/CiroN2022/toy-face)å’Œ[nerijs/pixel-art-xl](https://hf.co/nerijs/pixel-art-xl)å¯ä»¥åœ¨å®ƒä»¬çš„å­˜å‚¨åº“ä¸­æ‰¾åˆ°ã€‚
- en: '[PRE7]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![toy-face-pixel-art](../Images/99de7c335e766f24d86d686716cfbe1c.png)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![ç©å…·è„¸åƒç´ è‰ºæœ¯](../Images/99de7c335e766f24d86d686716cfbe1c.png)'
- en: Impressive! As you can see, the model was able to generate an image that mixes
    the characteristics of both adapters.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: ä»¤äººå°è±¡æ·±åˆ»ï¼æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œæ¨¡å‹èƒ½å¤Ÿç”Ÿæˆæ··åˆä¸¤ä¸ªé€‚é…å™¨ç‰¹å¾çš„å›¾åƒã€‚
- en: 'If you want to go back to using only one adapter, use the [set_adapters()](/docs/diffusers/v0.26.3/en/api/loaders/unet#diffusers.loaders.UNet2DConditionLoadersMixin.set_adapters)
    method to activate the `"toy"` adapter:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœè¦å›åˆ°ä»…ä½¿ç”¨ä¸€ä¸ªé€‚é…å™¨ï¼Œè¯·ä½¿ç”¨[set_adapters()](/docs/diffusers/v0.26.3/en/api/loaders/unet#diffusers.loaders.UNet2DConditionLoadersMixin.set_adapters)æ–¹æ³•æ¿€æ´»`"toy"`é€‚é…å™¨ï¼š
- en: '[PRE8]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![toy-face-again](../Images/c176e32c69a0df1e6ed4b22f5a94350b.png)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![ç©å…·è„¸å†æ¬¡](../Images/c176e32c69a0df1e6ed4b22f5a94350b.png)'
- en: If you want to switch to only the base model, disable all LoRAs with the [disable_lora()](/docs/diffusers/v0.26.3/en/api/loaders/unet#diffusers.loaders.UNet2DConditionLoadersMixin.disable_lora)
    method.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœè¦åˆ‡æ¢åˆ°ä»…ä½¿ç”¨åŸºæœ¬æ¨¡å‹ï¼Œè¯·ä½¿ç”¨[disable_lora()](/docs/diffusers/v0.26.3/en/api/loaders/unet#diffusers.loaders.UNet2DConditionLoadersMixin.disable_lora)æ–¹æ³•ç¦ç”¨æ‰€æœ‰LoRAã€‚
- en: '[PRE9]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![no-lora](../Images/13732666737056b846ce11880fe30289.png)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![no-lora](../Images/13732666737056b846ce11880fe30289.png)'
- en: Monitoring active adapters
  id: totrans-37
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ç›‘è§†æ´»åŠ¨é€‚é…å™¨
- en: 'You have attached multiple adapters in this tutorial, and if youâ€™re feeling
    a bit lost on what adapters have been attached to the pipelineâ€™s components, you
    can easily check the list of active adapters using the [get_active_adapters()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.LoraLoaderMixin.get_active_adapters)
    method:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å·²ç»è¿æ¥äº†å¤šä¸ªé€‚é…å™¨ï¼Œå¦‚æœæ‚¨å¯¹å·²è¿æ¥åˆ°ç®¡é“ç»„ä»¶çš„é€‚é…å™¨æ„Ÿåˆ°æœ‰äº›è¿·èŒ«ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨[get_active_adapters()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.LoraLoaderMixin.get_active_adapters)æ–¹æ³•è½»æ¾æ£€æŸ¥æ´»åŠ¨é€‚é…å™¨çš„åˆ—è¡¨ï¼š
- en: '[PRE10]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'You can also get the active adapters of each pipeline component with [get_list_adapters()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.LoraLoaderMixin.get_list_adapters):'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨è¿˜å¯ä»¥ä½¿ç”¨[get_list_adapters()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.LoraLoaderMixin.get_list_adapters)è·å–æ¯ä¸ªç®¡é“ç»„ä»¶çš„æ´»åŠ¨é€‚é…å™¨ï¼š
- en: '[PRE11]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Fusing adapters into the model
  id: totrans-42
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å°†é€‚é…å™¨èåˆåˆ°æ¨¡å‹ä¸­
- en: You can use PEFT to easily fuse/unfuse multiple adapters directly into the model
    weights (both UNet and text encoder) using the [fuse_lora()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.LoraLoaderMixin.fuse_lora)
    method, which can lead to a speed-up in inference and lower VRAM usage.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨å¯ä»¥ä½¿ç”¨PEFTè½»æ¾åœ°å°†å¤šä¸ªé€‚é…å™¨ç›´æ¥èåˆ/è§£é™¤èåˆåˆ°æ¨¡å‹æƒé‡ä¸­ï¼ˆUNetå’Œæ–‡æœ¬ç¼–ç å™¨å‡å¯ï¼‰ï¼Œä½¿ç”¨[fuse_lora()](/docs/diffusers/v0.26.3/en/api/loaders/lora#diffusers.loaders.LoraLoaderMixin.fuse_lora)æ–¹æ³•ï¼Œè¿™å¯ä»¥åŠ å¿«æ¨ç†é€Ÿåº¦å¹¶é™ä½VRAMä½¿ç”¨ç‡ã€‚
- en: '[PRE12]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'You can also fuse some adapters using `adapter_names` for faster generation:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨è¿˜å¯ä»¥ä½¿ç”¨`adapter_names`æ¥èåˆä¸€äº›é€‚é…å™¨ï¼Œä»¥åŠ å¿«ç”Ÿæˆé€Ÿåº¦ï¼š
- en: '[PRE13]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Saving a pipeline after fusing the adapters
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: åœ¨èåˆé€‚é…å™¨åä¿å­˜ç®¡é“
- en: 'To properly save a pipeline after itâ€™s been loaded with the adapters, it should
    be serialized like so:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨åŠ è½½é€‚é…å™¨åæ­£ç¡®ä¿å­˜ç®¡é“ä¹‹å‰ï¼Œåº”è¯¥åƒè¿™æ ·åºåˆ—åŒ–ï¼š
- en: '[PRE14]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
