# æ–‡æœ¬åˆ°å›¾åƒ

> åŸå§‹æ–‡æœ¬ï¼š[`huggingface.co/docs/diffusers/using-diffusers/conditional_image_generation`](https://huggingface.co/docs/diffusers/using-diffusers/conditional_image_generation)

å½“è°ˆåˆ°æ‰©æ•£æ¨¡å‹æ—¶ï¼Œæ–‡æœ¬åˆ°å›¾åƒé€šå¸¸æ˜¯é¦–å…ˆæƒ³åˆ°çš„ã€‚æ–‡æœ¬åˆ°å›¾åƒä»æ–‡æœ¬æè¿°ï¼ˆä¾‹å¦‚ï¼Œâ€œå¤ªç©ºäººåœ¨ä¸›æ—ä¸­ï¼Œå†·è‰²è°ƒï¼ŒæŸ”å’Œçš„é¢œè‰²ï¼Œè¯¦ç»†ï¼Œ8kâ€ï¼‰ç”Ÿæˆå›¾åƒï¼Œè¿™ä¹Ÿè¢«ç§°ä¸º*æç¤º*ã€‚

ä»ä¸€ä¸ªéå¸¸é«˜çš„å±‚é¢æ¥çœ‹ï¼Œæ‰©æ•£æ¨¡å‹æ¥å—ä¸€ä¸ªæç¤ºå’Œä¸€äº›éšæœºçš„åˆå§‹å™ªå£°ï¼Œå¹¶è¿­ä»£åœ°å»é™¤å™ªå£°ä»¥æ„å»ºå›¾åƒã€‚*å»å™ª*è¿‡ç¨‹ç”±æç¤ºå¼•å¯¼ï¼Œä¸€æ—¦å»å™ªè¿‡ç¨‹åœ¨é¢„å®šæ•°é‡çš„æ—¶é—´æ­¥éª¤ä¹‹åç»“æŸï¼Œå›¾åƒè¡¨ç¤ºå°†è¢«è§£ç æˆå›¾åƒã€‚

é˜…è¯»[ç¨³å®šæ‰©æ•£æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ](https://huggingface.co/blog/stable_diffusion#how-does-stable-diffusion-work)åšæ–‡ï¼Œäº†è§£æ½œåœ¨æ‰©æ•£æ¨¡å‹çš„å·¥ä½œåŸç†ã€‚

æ‚¨å¯ä»¥åœ¨ğŸ¤— Diffusers ä¸­é€šè¿‡ä¸¤ä¸ªæ­¥éª¤ä»æç¤ºç”Ÿæˆå›¾åƒï¼š

1.  å°†æ£€æŸ¥ç‚¹åŠ è½½åˆ° AutoPipelineForText2Image ç±»ä¸­ï¼Œè¯¥ç±»ä¼šæ ¹æ®æ£€æŸ¥ç‚¹è‡ªåŠ¨æ£€æµ‹è¦ä½¿ç”¨çš„é€‚å½“ç®¡é“ç±»ï¼š

```py
from diffusers import AutoPipelineForText2Image
import torch

pipeline = AutoPipelineForText2Image.from_pretrained(
	"runwayml/stable-diffusion-v1-5", torch_dtype=torch.float16, variant="fp16"
).to("cuda")
```

1.  å°†æç¤ºä¼ é€’ç»™ç®¡é“ä»¥ç”Ÿæˆå›¾åƒï¼š

```py
image = pipeline(
	"stained glass of darth vader, backlight, centered composition, masterpiece, photorealistic, 8k"
).images[0]
image
```

![](img/3d5a1c2477f576fbe2f04b0abeeb5cae.png)

## çƒ­é—¨æ¨¡å‹

æœ€å¸¸è§çš„æ–‡æœ¬åˆ°å›¾åƒæ¨¡å‹æ˜¯[ç¨³å®šæ‰©æ•£ v1.5](https://huggingface.co/runwayml/stable-diffusion-v1-5)ã€[ç¨³å®šæ‰©æ•£ XLï¼ˆSDXLï¼‰](https://huggingface.co/stabilityai/stable-diffusion-xl-base-1.0)å’Œ[åä¸æ–¯åŸº 2.2](https://huggingface.co/kandinsky-community/kandinsky-2-2-decoder)ã€‚è¿˜æœ‰ ControlNet æ¨¡å‹æˆ–é€‚é…å™¨ï¼Œå¯ä»¥ä¸æ–‡æœ¬åˆ°å›¾åƒæ¨¡å‹ä¸€èµ·ä½¿ç”¨ï¼Œä»¥æ›´ç›´æ¥åœ°æ§åˆ¶ç”Ÿæˆå›¾åƒã€‚ç”±äºå®ƒä»¬çš„æ¶æ„å’Œè®­ç»ƒè¿‡ç¨‹ä¸åŒï¼Œæ¯ä¸ªæ¨¡å‹çš„ç»“æœç•¥æœ‰ä¸åŒï¼Œä½†æ— è®ºé€‰æ‹©å“ªä¸ªæ¨¡å‹ï¼Œå®ƒä»¬çš„ä½¿ç”¨æ–¹å¼åŸºæœ¬ç›¸åŒã€‚è®©æˆ‘ä»¬ä¸ºæ¯ä¸ªæ¨¡å‹ä½¿ç”¨ç›¸åŒçš„æç¤ºå¹¶æ¯”è¾ƒå®ƒä»¬çš„ç»“æœã€‚

### ç¨³å®šæ‰©æ•£ v1.5

[ç¨³å®šæ‰©æ•£ v1.5](https://huggingface.co/runwayml/stable-diffusion-v1-5)æ˜¯ä¸€ä¸ªä»[ç¨³å®šæ‰©æ•£ v1-4](https://huggingface.co/CompVis/stable-diffusion-v1-4)åˆå§‹åŒ–çš„æ½œåœ¨æ‰©æ•£æ¨¡å‹ï¼Œå¹¶åœ¨ LAION-Aesthetics V2 æ•°æ®é›†çš„ 512x512 å›¾åƒä¸Šè¿›è¡Œäº† 595K æ­¥çš„å¾®è°ƒã€‚æ‚¨å¯ä»¥åƒè¿™æ ·ä½¿ç”¨è¿™ä¸ªæ¨¡å‹ï¼š

```py
from diffusers import AutoPipelineForText2Image
import torch

pipeline = AutoPipelineForText2Image.from_pretrained(
	"runwayml/stable-diffusion-v1-5", torch_dtype=torch.float16, variant="fp16"
).to("cuda")
generator = torch.Generator("cuda").manual_seed(31)
image = pipeline("Astronaut in a jungle, cold color palette, muted colors, detailed, 8k", generator=generator).images[0]
image
```

### ç¨³å®šæ‰©æ•£ XL

SDXL æ˜¯ä¹‹å‰ç¨³å®šæ‰©æ•£æ¨¡å‹çš„ä¸€ä¸ªæ›´å¤§ç‰ˆæœ¬ï¼Œæ¶‰åŠä¸€ä¸ªä¸¤é˜¶æ®µæ¨¡å‹è¿‡ç¨‹ï¼Œä¸ºå›¾åƒæ·»åŠ äº†æ›´å¤šç»†èŠ‚ã€‚å®ƒè¿˜åŒ…æ‹¬ä¸€äº›é¢å¤–çš„*å¾®è°ƒ*æ¥ç”Ÿæˆä»¥ä¸­å¿ƒä¸»é¢˜ä¸ºä¸­å¿ƒçš„é«˜è´¨é‡å›¾åƒã€‚æŸ¥çœ‹æ›´å…¨é¢çš„ SDXL æŒ‡å—ï¼Œäº†è§£å¦‚ä½•ä½¿ç”¨å®ƒã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ‚¨å¯ä»¥åƒè¿™æ ·ä½¿ç”¨ SDXLï¼š

```py
from diffusers import AutoPipelineForText2Image
import torch

pipeline = AutoPipelineForText2Image.from_pretrained(
    "stabilityai/stable-diffusion-xl-base-1.0", torch_dtype=torch.float16, variant="fp16"
).to("cuda")
generator = torch.Generator("cuda").manual_seed(31)
image = pipeline("Astronaut in a jungle, cold color palette, muted colors, detailed, 8k", generator=generator).images[0]
image
```

### åä¸æ–¯åŸº 2.2

åä¸æ–¯åŸºæ¨¡å‹ä¸ç¨³å®šæ‰©æ•£æ¨¡å‹æœ‰äº›ä¸åŒï¼Œå› ä¸ºå®ƒè¿˜ä½¿ç”¨å›¾åƒå…ˆéªŒæ¨¡å‹æ¥åˆ›å»ºåµŒå…¥ï¼Œè¿™äº›åµŒå…¥ç”¨äºæ›´å¥½åœ°å¯¹é½æ‰©æ•£æ¨¡å‹ä¸­çš„æ–‡æœ¬å’Œå›¾åƒã€‚

ä½¿ç”¨åä¸æ–¯åŸº 2.2 çš„æœ€ç®€å•æ–¹æ³•æ˜¯ï¼š

```py
from diffusers import AutoPipelineForText2Image
import torch

pipeline = AutoPipelineForText2Image.from_pretrained(
	"kandinsky-community/kandinsky-2-2-decoder", torch_dtype=torch.float16
).to("cuda")
generator = torch.Generator("cuda").manual_seed(31)
image = pipeline("Astronaut in a jungle, cold color palette, muted colors, detailed, 8k", generator=generator).images[0]
image
```

### ControlNet

ControlNet æ¨¡å‹æ˜¯è¾…åŠ©æ¨¡å‹æˆ–é€‚é…å™¨ï¼Œå®ƒä»¬åœ¨æ–‡æœ¬åˆ°å›¾åƒæ¨¡å‹çš„åŸºç¡€ä¸Šè¿›è¡Œå¾®è°ƒï¼Œä¾‹å¦‚[ç¨³å®šæ‰©æ•£ v1.5](https://huggingface.co/runwayml/stable-diffusion-v1-5)ã€‚å°† ControlNet æ¨¡å‹ä¸æ–‡æœ¬åˆ°å›¾åƒæ¨¡å‹ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥æä¾›æ›´å¤šæ˜ç¡®æ§åˆ¶ç”Ÿæˆå›¾åƒçš„é€‰é¡¹ã€‚ä½¿ç”¨ ControlNetï¼Œæ‚¨å¯ä»¥å‘æ¨¡å‹æ·»åŠ é¢å¤–çš„æ¡ä»¶è¾“å…¥å›¾åƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æä¾›ä¸€ä¸ªäººä½“å§¿åŠ¿çš„å›¾åƒï¼ˆé€šå¸¸è¡¨ç¤ºä¸ºè¿æ¥æˆéª¨æ¶çš„å¤šä¸ªå…³é”®ç‚¹ï¼‰ä½œä¸ºæ¡ä»¶è¾“å…¥ï¼Œæ¨¡å‹å°†ç”Ÿæˆéµå¾ªå›¾åƒå§¿åŠ¿çš„å›¾åƒã€‚æŸ¥çœ‹æ›´è¯¦ç»†çš„ ControlNet æŒ‡å—ï¼Œäº†è§£å…¶ä»–æ¡ä»¶è¾“å…¥ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè®©æˆ‘ä»¬ç”¨ä¸€ä¸ªäººä½“å§¿åŠ¿ä¼°è®¡å›¾åƒæ¥è°ƒèŠ‚ ControlNetã€‚åŠ è½½é¢„è®­ç»ƒçš„ç”¨äºäººä½“å§¿åŠ¿ä¼°è®¡çš„ ControlNet æ¨¡å‹ï¼š

```py
from diffusers import ControlNetModel, AutoPipelineForText2Image
from diffusers.utils import load_image
import torch

controlnet = ControlNetModel.from_pretrained(
	"lllyasviel/control_v11p_sd15_openpose", torch_dtype=torch.float16, variant="fp16"
).to("cuda")
pose_image = load_image("https://huggingface.co/lllyasviel/control_v11p_sd15_openpose/resolve/main/images/control.png")
```

å°†`controlnet`ä¼ é€’ç»™ AutoPipelineForText2Imageï¼Œå¹¶æä¾›æç¤ºå’Œå§¿åŠ¿ä¼°è®¡å›¾åƒï¼š

```py
pipeline = AutoPipelineForText2Image.from_pretrained(
	"runwayml/stable-diffusion-v1-5", controlnet=controlnet, torch_dtype=torch.float16, variant="fp16"
).to("cuda")
generator = torch.Generator("cuda").manual_seed(31)
image = pipeline("Astronaut in a jungle, cold color palette, muted colors, detailed, 8k", image=pose_image, generator=generator).images[0]
image
```

![](img/d2b7e6b0b8516e613654db5d9e482041.png)

ç¨³å®šæ‰©æ•£ v1.5

![](img/47eb848e4e09fd8ca2c920b1f98d089d.png)

ç¨³å®šæ‰©æ•£ XL

![](img/6c09e0df13fba3dbf95d5232315d36eb.png)

åº·å®šæ–¯åŸº 2.2

![](img/3657c31e95dc399792fc8b0ee81679f4.png)

ControlNetï¼ˆå§¿åŠ¿è°ƒèŠ‚ï¼‰

## é…ç½®ç®¡é“å‚æ•°

ç®¡é“ä¸­æœ‰è®¸å¤šå¯ä»¥é…ç½®çš„å‚æ•°ä¼šå½±å“å›¾åƒçš„ç”Ÿæˆæ–¹å¼ã€‚æ‚¨å¯ä»¥æ›´æ”¹å›¾åƒçš„è¾“å‡ºå°ºå¯¸ï¼ŒæŒ‡å®šè´Ÿé¢æç¤ºä»¥æ”¹å–„å›¾åƒè´¨é‡ç­‰ã€‚æœ¬èŠ‚å°†æ·±å…¥æ¢è®¨å¦‚ä½•ä½¿ç”¨è¿™äº›å‚æ•°ã€‚

### é«˜åº¦å’Œå®½åº¦

`height`å’Œ`width`å‚æ•°æ§åˆ¶ç”Ÿæˆå›¾åƒçš„é«˜åº¦å’Œå®½åº¦ï¼ˆä»¥åƒç´ ä¸ºå•ä½ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç¨³å®šæ‰©æ•£ v1.5 æ¨¡å‹è¾“å‡º 512x512 çš„å›¾åƒï¼Œä½†æ‚¨å¯ä»¥å°†å…¶æ›´æ”¹ä¸ºä»»ä½•æ˜¯ 8 çš„å€æ•°çš„å°ºå¯¸ã€‚ä¾‹å¦‚ï¼Œè¦åˆ›å»ºä¸€ä¸ªçŸ©å½¢å›¾åƒï¼š

```py
from diffusers import AutoPipelineForText2Image
import torch

pipeline = AutoPipelineForText2Image.from_pretrained(
	"runwayml/stable-diffusion-v1-5", torch_dtype=torch.float16, variant="fp16"
).to("cuda")
image = pipeline(
	"Astronaut in a jungle, cold color palette, muted colors, detailed, 8k", height=768, width=512
).images[0]
image
```

![](img/84e161b40900b68ec614371d04cb4eb1.png)

å…¶ä»–æ¨¡å‹å¯èƒ½å…·æœ‰ä¸åŒçš„é»˜è®¤å›¾åƒå°ºå¯¸ï¼Œå…·ä½“å–å†³äºè®­ç»ƒæ•°æ®é›†ä¸­çš„å›¾åƒå°ºå¯¸ã€‚ä¾‹å¦‚ï¼ŒSDXL çš„é»˜è®¤å›¾åƒå°ºå¯¸ä¸º 1024x1024ï¼Œä½¿ç”¨è¾ƒä½çš„`height`å’Œ`width`å€¼å¯èƒ½ä¼šå¯¼è‡´å›¾åƒè´¨é‡é™ä½ã€‚ç¡®ä¿æ‚¨é¦–å…ˆæ£€æŸ¥æ¨¡å‹çš„ API å‚è€ƒï¼

### å¼•å¯¼æ¯”ä¾‹

`guidance_scale`å‚æ•°å½±å“æç¤ºå¯¹å›¾åƒç”Ÿæˆçš„å½±å“ç¨‹åº¦ã€‚è¾ƒä½çš„å€¼ä½¿æ¨¡å‹å…·æœ‰â€œåˆ›é€ åŠ›â€ï¼Œç”Ÿæˆä¸æç¤ºæ›´æ¾æ•£ç›¸å…³çš„å›¾åƒã€‚è¾ƒé«˜çš„`guidance_scale`å€¼ä¼šä¿ƒä½¿æ¨¡å‹æ›´ç´§å¯†åœ°éµå¾ªæç¤ºï¼Œå¦‚æœè¿™ä¸ªå€¼å¤ªé«˜ï¼Œæ‚¨å¯èƒ½ä¼šè§‚å¯Ÿåˆ°ç”Ÿæˆå›¾åƒä¸­çš„ä¸€äº›ä¼ªå½±ã€‚

```py
from diffusers import AutoPipelineForText2Image
import torch

pipeline = AutoPipelineForText2Image.from_pretrained(
	"runwayml/stable-diffusion-v1-5", torch_dtype=torch.float16
).to("cuda")
image = pipeline(
	"Astronaut in a jungle, cold color palette, muted colors, detailed, 8k", guidance_scale=3.5
).images[0]
image
```

![](img/d4e1ac912506a0937e8776bcaf804434.png)

guidance_scale = 2.5

![](img/bd6081df4d5f8e0649e3668778fa3eab.png)

guidance_scale = 7.5

![](img/3741374b77d721ec460507012c586ea0.png)

guidance_scale = 10.5

### è´Ÿé¢æç¤º

å°±åƒæç¤ºå¼•å¯¼ç”Ÿæˆä¸€æ ·ï¼Œ*è´Ÿé¢æç¤º*ä¼šå°†æ¨¡å‹å¼•å¯¼è¿œç¦»æ‚¨ä¸å¸Œæœ›æ¨¡å‹ç”Ÿæˆçš„å†…å®¹ã€‚è¿™é€šå¸¸ç”¨äºé€šè¿‡æ¶ˆé™¤â€œä½åˆ†è¾¨ç‡â€æˆ–â€œç³Ÿç³•ç»†èŠ‚â€ç­‰ä¸è‰¯å›¾åƒç‰¹å¾æ¥æé«˜æ•´ä½“å›¾åƒè´¨é‡ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨è´Ÿé¢æç¤ºæ¥åˆ é™¤æˆ–ä¿®æ”¹å›¾åƒçš„å†…å®¹å’Œé£æ ¼ã€‚

```py
from diffusers import AutoPipelineForText2Image
import torch

pipeline = AutoPipelineForText2Image.from_pretrained(
	"runwayml/stable-diffusion-v1-5", torch_dtype=torch.float16
).to("cuda")
image = pipeline(
	prompt="Astronaut in a jungle, cold color palette, muted colors, detailed, 8k",
	negative_prompt="ugly, deformed, disfigured, poor details, bad anatomy",
).images[0]
image
```

![](img/841a0429e6f0e2536bdabb5aa8e25a23.png)

negative_prompt = "ä¸‘é™‹ï¼Œç•¸å½¢ï¼Œæ¯å®¹ï¼Œç»†èŠ‚å·®ï¼Œè§£å‰–ä¸è‰¯"

![](img/9695ff0c8decf5141f5f125a58a6ec4c.png)

negative_prompt = "astronaut"

### ç”Ÿæˆå™¨

[`torch.Generator`](https://pytorch.org/docs/stable/generated/torch.Generator.html#generator)å¯¹è±¡é€šè¿‡è®¾ç½®æ‰‹åŠ¨ç§å­æ¥å®ç°ç®¡é“ä¸­çš„å¯é‡ç°æ€§ã€‚æ‚¨å¯ä»¥ä½¿ç”¨`Generator`ç”Ÿæˆå›¾åƒæ‰¹æ¬¡ï¼Œå¹¶æ ¹æ®ä½¿ç”¨ç¡®å®šæ€§ç”Ÿæˆæ”¹å–„å›¾åƒè´¨é‡æŒ‡å—ä¸­çš„è¯¦ç»†è¯´æ˜é€æ­¥æ”¹è¿›ä»ç§å­ç”Ÿæˆçš„å›¾åƒã€‚

æ‚¨å¯ä»¥è®¾ç½®ä¸€ä¸ªç§å­å’Œ`Generator`å¦‚ä¸‹æ‰€ç¤ºã€‚ä½¿ç”¨`Generator`åˆ›å»ºå›¾åƒåº”è¯¥æ¯æ¬¡è¿”å›ç›¸åŒçš„ç»“æœï¼Œè€Œä¸æ˜¯éšæœºç”Ÿæˆæ–°å›¾åƒã€‚

```py
from diffusers import AutoPipelineForText2Image
import torch

pipeline = AutoPipelineForText2Image.from_pretrained(
	"runwayml/stable-diffusion-v1-5", torch_dtype=torch.float16
).to("cuda")
generator = torch.Generator(device="cuda").manual_seed(30)
image = pipeline(
	"Astronaut in a jungle, cold color palette, muted colors, detailed, 8k",
	generator=generator,
).images[0]
image
```

## æ§åˆ¶å›¾åƒç”Ÿæˆ

é™¤äº†é…ç½®ç®¡é“å‚æ•°å¤–ï¼Œè¿˜æœ‰å‡ ç§æ–¹æ³•å¯ä»¥æ›´å¥½åœ°æ§åˆ¶å›¾åƒç”Ÿæˆï¼Œä¾‹å¦‚æç¤ºåŠ æƒå’Œ ControlNet æ¨¡å‹ã€‚

### Prompt åŠ æƒ

Prompt åŠ æƒæ˜¯ä¸€ç§å¢åŠ æˆ–å‡å°‘æç¤ºä¸­æ¦‚å¿µé‡è¦æ€§çš„æŠ€æœ¯ï¼Œä»¥å¼ºè°ƒæˆ–æœ€å°åŒ–å›¾åƒä¸­çš„æŸäº›ç‰¹å¾ã€‚æˆ‘ä»¬å»ºè®®ä½¿ç”¨[Compel](https://github.com/damian0815/compel)åº“æ¥å¸®åŠ©æ‚¨ç”ŸæˆåŠ æƒçš„æç¤ºåµŒå…¥ã€‚

äº†è§£å¦‚ä½•åœ¨ Prompt åŠ æƒæŒ‡å—ä¸­åˆ›å»ºæç¤ºåµŒå…¥ã€‚æœ¬ä¾‹é‡ç‚¹ä»‹ç»å¦‚ä½•åœ¨ç®¡é“ä¸­ä½¿ç”¨æç¤ºåµŒå…¥ã€‚

åˆ›å»ºåµŒå…¥åï¼Œæ‚¨å¯ä»¥å°†å®ƒä»¬ä¼ é€’ç»™ç®¡é“ä¸­çš„`prompt_embeds`ï¼ˆå¦‚æœæ‚¨ä½¿ç”¨è´Ÿæç¤ºï¼Œåˆ™è¿˜æœ‰`negative_prompt_embeds`å‚æ•°ï¼‰ã€‚

```py
from diffusers import AutoPipelineForText2Image
import torch

pipeline = AutoPipelineForText2Image.from_pretrained(
	"runwayml/stable-diffusion-v1-5", torch_dtype=torch.float16
).to("cuda")
image = pipeline(
	prompt_embeds=prompt_embeds, # generated from Compel
	negative_prompt_embeds=negative_prompt_embeds, # generated from Compel
).images[0]
```

### ControlNet

åœ¨ ControlNet éƒ¨åˆ†ä¸­ï¼Œæ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œè¿™äº›æ¨¡å‹é€šè¿‡å¼•å…¥é¢å¤–çš„æ¡ä»¶å›¾åƒè¾“å…¥ï¼Œæä¾›äº†ä¸€ç§æ›´çµæ´»å’Œå‡†ç¡®çš„ç”Ÿæˆå›¾åƒçš„æ–¹å¼ã€‚æ¯ä¸ª ControlNet æ¨¡å‹éƒ½æ˜¯åœ¨ç‰¹å®šç±»å‹çš„æ¡ä»¶å›¾åƒä¸Šé¢„è®­ç»ƒçš„ï¼Œä»¥ç”Ÿæˆç±»ä¼¼çš„æ–°å›¾åƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ä¸€ä¸ªåœ¨æ·±åº¦å›¾ä¸Šé¢„è®­ç»ƒçš„ ControlNet æ¨¡å‹ï¼Œæ‚¨å¯ä»¥å°†æ·±åº¦å›¾ä½œä¸ºæ¡ä»¶è¾“å…¥ç»™æ¨¡å‹ï¼Œå®ƒå°†ç”Ÿæˆä¿ç•™å…¶ä¸­ç©ºé—´ä¿¡æ¯çš„å›¾åƒã€‚è¿™æ¯”åœ¨æç¤ºä¸­æŒ‡å®šæ·±åº¦ä¿¡æ¯æ›´å¿«æ›´å®¹æ˜“ã€‚æ‚¨ç”šè‡³å¯ä»¥å°†å¤šä¸ªæ¡ä»¶è¾“å…¥ä¸ MultiControlNet ç»“åˆä½¿ç”¨ï¼

æ‚¨å¯ä»¥ä½¿ç”¨è®¸å¤šç±»å‹çš„æ¡ä»¶è¾“å…¥ï¼Œå¹¶ä¸”ğŸ¤— Diffusers æ”¯æŒ Stable Diffusion å’Œ SDXL æ¨¡å‹çš„ ControlNetã€‚æŸ¥çœ‹æ›´å…¨é¢çš„ ControlNet æŒ‡å—ï¼Œäº†è§£å¦‚ä½•ä½¿ç”¨è¿™äº›æ¨¡å‹ã€‚

## ä¼˜åŒ–

æ‰©æ•£æ¨¡å‹å¾ˆå¤§ï¼Œå¯¹å›¾åƒè¿›è¡Œå»å™ªçš„è¿­ä»£æ€§è´¨åœ¨è®¡ç®—ä¸Šæ˜¯æ˜‚è´µä¸”å¯†é›†çš„ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€æ‚¨éœ€è¦è®¿é—®å¼ºå¤§çš„ - æˆ–è€…ç”šè‡³å¾ˆå¤š - GPU æ¥ä½¿ç”¨å®ƒä»¬ã€‚æœ‰è®¸å¤šä¼˜åŒ–æŠ€æœ¯å¯ç”¨äºåœ¨æ¶ˆè´¹è€…å’Œå…è´¹èµ„æºä¸Šè¿è¡Œæ‰©æ•£æ¨¡å‹ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°†æ¨¡å‹æƒé‡åŠ è½½ä¸ºåŠç²¾åº¦ä»¥èŠ‚çœ GPU å†…å­˜å¹¶æé«˜é€Ÿåº¦ï¼Œæˆ–è€…å°†æ•´ä¸ªæ¨¡å‹å¸è½½åˆ° GPU ä»¥èŠ‚çœæ›´å¤šå†…å­˜ã€‚

PyTorch 2.0 è¿˜æ”¯æŒä¸€ç§æ›´èŠ‚çœå†…å­˜çš„æ³¨æ„æœºåˆ¶ï¼Œç§°ä¸º*ç¼©æ”¾ç‚¹ç§¯æ³¨æ„*ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ PyTorch 2.0ï¼Œåˆ™ä¼šè‡ªåŠ¨å¯ç”¨ã€‚æ‚¨å¯ä»¥å°†å…¶ä¸[`torch.compile`](https://pytorch.org/tutorials/intermediate/torch_compile_tutorial.html)ç»“åˆä½¿ç”¨ï¼Œä»¥è¿›ä¸€æ­¥åŠ å¿«ä»£ç é€Ÿåº¦ï¼š

```py
from diffusers import AutoPipelineForText2Image
import torch

pipeline = AutoPipelineForText2Image.from_pretrained("runwayml/stable-diffusion-v1-5", torch_dtype=torch.float16, variant="fp16").to("cuda")
pipeline.unet = torch.compile(pipeline.unet, mode="reduce-overhead", fullgraph=True)
```

æœ‰å…³å¦‚ä½•ä¼˜åŒ–ä»£ç ä»¥èŠ‚çœå†…å­˜å’ŒåŠ å¿«æ¨ç†é€Ÿåº¦çš„æ›´å¤šæç¤ºï¼Œè¯·é˜…è¯»å†…å­˜å’Œé€Ÿåº¦å’Œ Torch 2.0 æŒ‡å—ã€‚
