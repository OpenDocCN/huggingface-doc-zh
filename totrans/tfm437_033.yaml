- en: Object detection
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: ç›®æ ‡æ£€æµ‹
- en: 'Original text: [https://huggingface.co/docs/transformers/v4.37.2/en/tasks/object_detection](https://huggingface.co/docs/transformers/v4.37.2/en/tasks/object_detection)'
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸå§‹æ–‡æœ¬ï¼š[https://huggingface.co/docs/transformers/v4.37.2/en/tasks/object_detection](https://huggingface.co/docs/transformers/v4.37.2/en/tasks/object_detection)
- en: null
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: Object detection is the computer vision task of detecting instances (such as
    humans, buildings, or cars) in an image. Object detection models receive an image
    as input and output coordinates of the bounding boxes and associated labels of
    the detected objects. An image can contain multiple objects, each with its own
    bounding box and a label (e.g. it can have a car and a building), and each object
    can be present in different parts of an image (e.g. the image can have several
    cars). This task is commonly used in autonomous driving for detecting things like
    pedestrians, road signs, and traffic lights. Other applications include counting
    objects in images, image search, and more.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®æ ‡æ£€æµ‹æ˜¯è®¡ç®—æœºè§†è§‰ä»»åŠ¡ï¼Œç”¨äºæ£€æµ‹å›¾åƒä¸­çš„å®ä¾‹ï¼ˆå¦‚äººç±»ã€å»ºç­‘ç‰©æˆ–æ±½è½¦ï¼‰ã€‚ç›®æ ‡æ£€æµ‹æ¨¡å‹æ¥æ”¶å›¾åƒä½œä¸ºè¾“å…¥ï¼Œå¹¶è¾“å‡ºæ£€æµ‹åˆ°çš„å¯¹è±¡çš„è¾¹ç•Œæ¡†çš„åæ ‡å’Œç›¸å…³æ ‡ç­¾ã€‚ä¸€å¹…å›¾åƒå¯ä»¥åŒ…å«å¤šä¸ªå¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰è‡ªå·±çš„è¾¹ç•Œæ¡†å’Œæ ‡ç­¾ï¼ˆä¾‹å¦‚ï¼Œå®ƒå¯ä»¥æœ‰ä¸€è¾†æ±½è½¦å’Œä¸€åº§å»ºç­‘ç‰©ï¼‰ï¼Œæ¯ä¸ªå¯¹è±¡å¯ä»¥å‡ºç°åœ¨å›¾åƒçš„ä¸åŒéƒ¨åˆ†ï¼ˆä¾‹å¦‚ï¼Œå›¾åƒå¯ä»¥æœ‰å‡ è¾†æ±½è½¦ï¼‰ã€‚è¿™ä¸ªä»»åŠ¡é€šå¸¸ç”¨äºè‡ªåŠ¨é©¾é©¶ï¼Œç”¨äºæ£€æµ‹è¡Œäººã€é“è·¯æ ‡å¿—å’Œäº¤é€šç¯ç­‰ã€‚å…¶ä»–åº”ç”¨åŒ…æ‹¬åœ¨å›¾åƒä¸­è®¡æ•°å¯¹è±¡ã€å›¾åƒæœç´¢ç­‰ã€‚
- en: 'In this guide, you will learn how to:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ï¼š
- en: Finetune [DETR](https://huggingface.co/docs/transformers/model_doc/detr), a
    model that combines a convolutional backbone with an encoder-decoder Transformer,
    on the [CPPE-5](https://huggingface.co/datasets/cppe-5) dataset.
  id: totrans-5
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å¯¹[DETR](https://huggingface.co/docs/transformers/model_doc/detr)è¿›è¡Œå¾®è°ƒï¼Œè¿™æ˜¯ä¸€ä¸ªå°†å·ç§¯ä¸»å¹²ä¸ç¼–ç å™¨-è§£ç å™¨Transformerç»“åˆçš„æ¨¡å‹ï¼Œåœ¨[CPPE-5](https://huggingface.co/datasets/cppe-5)æ•°æ®é›†ä¸Šè¿›è¡Œè®­ç»ƒã€‚
- en: Use your finetuned model for inference.
  id: totrans-6
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨æ‚¨å¾®è°ƒçš„æ¨¡å‹è¿›è¡Œæ¨æ–­ã€‚
- en: 'The task illustrated in this tutorial is supported by the following model architectures:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: æœ¬æ•™ç¨‹ä¸­æ‰€ç¤ºçš„ä»»åŠ¡ç”±ä»¥ä¸‹æ¨¡å‹æ¶æ„æ”¯æŒï¼š
- en: '[Conditional DETR](../model_doc/conditional_detr), [Deformable DETR](../model_doc/deformable_detr),
    [DETA](../model_doc/deta), [DETR](../model_doc/detr), [Table Transformer](../model_doc/table-transformer),
    [YOLOS](../model_doc/yolos)'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '[æ¡ä»¶DETR](../model_doc/conditional_detr), [å¯å˜DETR](../model_doc/deformable_detr),
    [DETA](../model_doc/deta), [DETR](../model_doc/detr), [è¡¨æ ¼Transformer](../model_doc/table-transformer),
    [YOLOS](../model_doc/yolos)'
- en: 'Before you begin, make sure you have all the necessary libraries installed:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²å®‰è£…æ‰€æœ‰å¿…è¦çš„åº“ï¼š
- en: '[PRE0]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Youâ€™ll use ğŸ¤— Datasets to load a dataset from the Hugging Face Hub, ğŸ¤— Transformers
    to train your model, and `albumentations` to augment the data. `timm` is currently
    required to load a convolutional backbone for the DETR model.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨å°†ä½¿ç”¨ğŸ¤—æ•°æ®é›†ä»Hugging Face HubåŠ è½½æ•°æ®é›†ï¼ŒğŸ¤—è½¬æ¢å™¨æ¥è®­ç»ƒæ‚¨çš„æ¨¡å‹ï¼Œå¹¶ä½¿ç”¨`albumentations`æ¥å¢å¼ºæ•°æ®ã€‚ç›®å‰éœ€è¦ä½¿ç”¨`timm`æ¥åŠ è½½DETRæ¨¡å‹çš„å·ç§¯ä¸»å¹²ã€‚
- en: 'We encourage you to share your model with the community. Log in to your Hugging
    Face account to upload it to the Hub. When prompted, enter your token to log in:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ‘ä»¬é¼“åŠ±æ‚¨ä¸ç¤¾åŒºåˆ†äº«æ‚¨çš„æ¨¡å‹ã€‚ç™»å½•åˆ°æ‚¨çš„Hugging Faceå¸æˆ·å¹¶å°†å…¶ä¸Šä¼ åˆ°Hubã€‚åœ¨æç¤ºæ—¶ï¼Œè¾“å…¥æ‚¨çš„ä»¤ç‰Œä»¥ç™»å½•ï¼š
- en: '[PRE1]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Load the CPPE-5 dataset
  id: totrans-14
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: åŠ è½½CPPE-5æ•°æ®é›†
- en: The [CPPE-5 dataset](https://huggingface.co/datasets/cppe-5) contains images
    with annotations identifying medical personal protective equipment (PPE) in the
    context of the COVID-19 pandemic.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: '[CPPE-5æ•°æ®é›†](https://huggingface.co/datasets/cppe-5)åŒ…å«å¸¦æœ‰æ³¨é‡Šçš„å›¾åƒï¼Œç”¨äºè¯†åˆ«COVID-19å¤§æµè¡ŒèƒŒæ™¯ä¸‹çš„åŒ»ç–—ä¸ªäººé˜²æŠ¤è£…å¤‡ï¼ˆPPEï¼‰ã€‚'
- en: 'Start by loading the dataset:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆåŠ è½½æ•°æ®é›†ï¼š
- en: '[PRE2]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Youâ€™ll see that this dataset already comes with a training set containing 1000
    images and a test set with 29 images.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨å°†çœ‹åˆ°è¿™ä¸ªæ•°æ®é›†å·²ç»å¸¦æœ‰ä¸€ä¸ªåŒ…å«1000å¼ å›¾åƒçš„è®­ç»ƒé›†å’Œä¸€ä¸ªåŒ…å«29å¼ å›¾åƒçš„æµ‹è¯•é›†ã€‚
- en: To get familiar with the data, explore what the examples look like.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: ç†Ÿæ‚‰æ•°æ®ï¼Œæ¢ç´¢ç¤ºä¾‹çš„å¤–è§‚ã€‚
- en: '[PRE3]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The examples in the dataset have the following fields:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: æ•°æ®é›†ä¸­çš„ç¤ºä¾‹å…·æœ‰ä»¥ä¸‹å­—æ®µï¼š
- en: '`image_id`: the example image id'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`image_id`ï¼šç¤ºä¾‹å›¾åƒid'
- en: '`image`: a `PIL.Image.Image` object containing the image'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`image`ï¼šåŒ…å«å›¾åƒçš„`PIL.Image.Image`å¯¹è±¡'
- en: '`width`: width of the image'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`width`ï¼šå›¾åƒçš„å®½åº¦'
- en: '`height`: height of the image'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`height`ï¼šå›¾åƒçš„é«˜åº¦'
- en: '`objects`: a dictionary containing bounding box metadata for the objects in
    the image:'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`objects`ï¼šåŒ…å«å›¾åƒä¸­å¯¹è±¡çš„è¾¹ç•Œæ¡†å…ƒæ•°æ®çš„å­—å…¸ï¼š'
- en: '`id`: the annotation id'
  id: totrans-27
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`id`ï¼šæ³¨é‡Šid'
- en: '`area`: the area of the bounding box'
  id: totrans-28
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`area`ï¼šè¾¹ç•Œæ¡†çš„é¢ç§¯'
- en: '`bbox`: the objectâ€™s bounding box (in the [COCO format](https://albumentations.ai/docs/getting_started/bounding_boxes_augmentation/#coco)
    )'
  id: totrans-29
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`bbox`ï¼šå¯¹è±¡çš„è¾¹ç•Œæ¡†ï¼ˆä»¥[COCOæ ¼å¼](https://albumentations.ai/docs/getting_started/bounding_boxes_augmentation/#coco)ï¼‰'
- en: '`category`: the objectâ€™s category, with possible values including `Coverall
    (0)`, `Face_Shield (1)`, `Gloves (2)`, `Goggles (3)` and `Mask (4)`'
  id: totrans-30
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`category`ï¼šå¯¹è±¡çš„ç±»åˆ«ï¼Œå¯èƒ½çš„å€¼åŒ…æ‹¬`é˜²æŠ¤æœï¼ˆ0ï¼‰`ã€`é¢ç½©ï¼ˆ1ï¼‰`ã€`æ‰‹å¥—ï¼ˆ2ï¼‰`ã€`æŠ¤ç›®é•œï¼ˆ3ï¼‰`å’Œ`å£ç½©ï¼ˆ4ï¼‰`'
- en: You may notice that the `bbox` field follows the COCO format, which is the format
    that the DETR model expects. However, the grouping of the fields inside `objects`
    differs from the annotation format DETR requires. You will need to apply some
    preprocessing transformations before using this data for training.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°`bbox`å­—æ®µéµå¾ªCOCOæ ¼å¼ï¼Œè¿™æ˜¯DETRæ¨¡å‹æœŸæœ›çš„æ ¼å¼ã€‚ç„¶è€Œï¼Œ`objects`å†…éƒ¨å­—æ®µçš„åˆ†ç»„ä¸DETRæ‰€éœ€çš„æ³¨é‡Šæ ¼å¼ä¸åŒã€‚åœ¨ä½¿ç”¨æ­¤æ•°æ®è¿›è¡Œè®­ç»ƒä¹‹å‰ï¼Œæ‚¨éœ€è¦åº”ç”¨ä¸€äº›é¢„å¤„ç†è½¬æ¢ã€‚
- en: To get an even better understanding of the data, visualize an example in the
    dataset.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: ä¸ºäº†æ›´å¥½åœ°ç†è§£æ•°æ®ï¼Œå¯è§†åŒ–æ•°æ®é›†ä¸­çš„ä¸€ä¸ªç¤ºä¾‹ã€‚
- en: '[PRE4]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![CPPE-5 Image Example](../Images/dc3ce9ec7d52953b62801d6b8b583148.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![CPPE-5å›¾åƒç¤ºä¾‹](../Images/dc3ce9ec7d52953b62801d6b8b583148.png)'
- en: To visualize the bounding boxes with associated labels, you can get the labels
    from the datasetâ€™s metadata, specifically the `category` field. Youâ€™ll also want
    to create dictionaries that map a label id to a label class (`id2label`) and the
    other way around (`label2id`). You can use them later when setting up the model.
    Including these maps will make your model reusable by others if you share it on
    the Hugging Face Hub. Please note that, the part of above code that draws the
    bounding boxes assume that it is in `XYWH` (x,y co-ordinates and width and height
    of the box) format. It might not work for other formats like `(x1, y1, x2, y2)`.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: è¦å¯è§†åŒ–å¸¦æœ‰å…³è”æ ‡ç­¾çš„è¾¹ç•Œæ¡†ï¼Œæ‚¨å¯ä»¥ä»æ•°æ®é›†çš„å…ƒæ•°æ®ä¸­è·å–æ ‡ç­¾ï¼Œç‰¹åˆ«æ˜¯`category`å­—æ®µã€‚æ‚¨è¿˜éœ€è¦åˆ›å»ºæ˜ å°„æ ‡ç­¾idåˆ°æ ‡ç­¾ç±»åˆ«ï¼ˆ`id2label`ï¼‰ä»¥åŠåå‘æ˜ å°„ï¼ˆ`label2id`ï¼‰çš„å­—å…¸ã€‚åœ¨è®¾ç½®æ¨¡å‹æ—¶ï¼Œæ‚¨å¯ä»¥ç¨åä½¿ç”¨å®ƒä»¬ã€‚åŒ…æ‹¬è¿™äº›æ˜ å°„å°†ä½¿æ‚¨çš„æ¨¡å‹åœ¨Hugging
    Face Hubä¸Šå…±äº«æ—¶å¯ä»¥è¢«å…¶ä»–äººé‡å¤ä½¿ç”¨ã€‚è¯·æ³¨æ„ï¼Œä¸Šè¿°ä»£ç ä¸­ç»˜åˆ¶è¾¹ç•Œæ¡†çš„éƒ¨åˆ†å‡å®šå®ƒæ˜¯ä»¥`XYWH`ï¼ˆxï¼Œyåæ ‡å’Œæ¡†çš„å®½åº¦å’Œé«˜åº¦ï¼‰æ ¼å¼ã€‚å¯¹äºå…¶ä»–æ ¼å¼å¦‚`(x1ï¼Œy1ï¼Œx2ï¼Œy2)`å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚
- en: As a final step of getting familiar with the data, explore it for potential
    issues. One common problem with datasets for object detection is bounding boxes
    that â€œstretchâ€ beyond the edge of the image. Such â€œrunawayâ€ bounding boxes can
    raise errors during training and should be addressed at this stage. There are
    a few examples with this issue in this dataset. To keep things simple in this
    guide, we remove these images from the data.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: ä½œä¸ºç†Ÿæ‚‰æ•°æ®çš„æœ€åä¸€æ­¥ï¼Œæ¢ç´¢å¯èƒ½å­˜åœ¨çš„é—®é¢˜ã€‚ç›®æ ‡æ£€æµ‹æ•°æ®é›†çš„ä¸€ä¸ªå¸¸è§é—®é¢˜æ˜¯è¾¹ç•Œæ¡†â€œæ‹‰ä¼¸â€åˆ°å›¾åƒè¾¹ç¼˜ä¹‹å¤–ã€‚è¿™ç§â€œå¤±æ§â€çš„è¾¹ç•Œæ¡†å¯èƒ½ä¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¼•å‘é”™è¯¯ï¼Œåº”åœ¨æ­¤é˜¶æ®µåŠ ä»¥è§£å†³ã€‚åœ¨è¿™ä¸ªæ•°æ®é›†ä¸­æœ‰ä¸€äº›ç¤ºä¾‹å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚ä¸ºäº†ç®€åŒ–æœ¬æŒ‡å—ä¸­çš„æ“ä½œï¼Œæˆ‘ä»¬å°†è¿™äº›å›¾åƒä»æ•°æ®ä¸­åˆ é™¤ã€‚
- en: '[PRE5]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Preprocess the data
  id: totrans-38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: é¢„å¤„ç†æ•°æ®
- en: 'To finetune a model, you must preprocess the data you plan to use to match
    precisely the approach used for the pre-trained model. [AutoImageProcessor](/docs/transformers/v4.37.2/en/model_doc/auto#transformers.AutoImageProcessor)
    takes care of processing image data to create `pixel_values`, `pixel_mask`, and
    `labels` that a DETR model can train with. The image processor has some attributes
    that you wonâ€™t have to worry about:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: è¦å¾®è°ƒæ¨¡å‹ï¼Œæ‚¨å¿…é¡»é¢„å¤„ç†æ‚¨è®¡åˆ’ä½¿ç”¨çš„æ•°æ®ï¼Œä»¥ç²¾ç¡®åŒ¹é…é¢„è®­ç»ƒæ¨¡å‹ä½¿ç”¨çš„æ–¹æ³•ã€‚[AutoImageProcessor](/docs/transformers/v4.37.2/en/model_doc/auto#transformers.AutoImageProcessor)è´Ÿè´£å¤„ç†å›¾åƒæ•°æ®ä»¥åˆ›å»º`pixel_values`ï¼Œ`pixel_mask`å’Œ`labels`ï¼Œä¾›DETRæ¨¡å‹è®­ç»ƒã€‚å›¾åƒå¤„ç†å™¨å…·æœ‰ä¸€äº›å±æ€§ï¼Œæ‚¨æ— éœ€æ‹…å¿ƒï¼š
- en: '`image_mean = [0.485, 0.456, 0.406 ]`'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`image_mean = [0.485, 0.456, 0.406 ]`'
- en: '`image_std = [0.229, 0.224, 0.225]`'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`image_std = [0.229, 0.224, 0.225]`'
- en: These are the mean and standard deviation used to normalize images during the
    model pre-training. These values are crucial to replicate when doing inference
    or finetuning a pre-trained image model.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™äº›æ˜¯ç”¨äºåœ¨æ¨¡å‹é¢„è®­ç»ƒæœŸé—´å¯¹å›¾åƒè¿›è¡Œå½’ä¸€åŒ–çš„å‡å€¼å’Œæ ‡å‡†å·®ã€‚åœ¨è¿›è¡Œæ¨ç†æˆ–å¾®è°ƒé¢„è®­ç»ƒå›¾åƒæ¨¡å‹æ—¶ï¼Œè¿™äº›å€¼è‡³å…³é‡è¦ã€‚
- en: Instantiate the image processor from the same checkpoint as the model you want
    to finetune.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: ä»è¦å¾®è°ƒçš„æ¨¡å‹ç›¸åŒçš„æ£€æŸ¥ç‚¹å®ä¾‹åŒ–å›¾åƒå¤„ç†å™¨ã€‚
- en: '[PRE6]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Before passing the images to the `image_processor`, apply two preprocessing
    transformations to the dataset:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨å°†å›¾åƒä¼ é€’ç»™`image_processor`ä¹‹å‰ï¼Œå¯¹æ•°æ®é›†åº”ç”¨ä¸¤ä¸ªé¢„å¤„ç†è½¬æ¢ï¼š
- en: Augmenting images
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¢å¼ºå›¾åƒ
- en: Reformatting annotations to meet DETR expectations
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: é‡æ–°æ ¼å¼åŒ–æ³¨é‡Šä»¥æ»¡è¶³DETRçš„æœŸæœ›
- en: 'First, to make sure the model does not overfit on the training data, you can
    apply image augmentation with any data augmentation library. Here we use [Albumentations](https://albumentations.ai/docs/)
    â€¦ This library ensures that transformations affect the image and update the bounding
    boxes accordingly. The ğŸ¤— Datasets library documentation has a detailed [guide
    on how to augment images for object detection](https://huggingface.co/docs/datasets/object_detection),
    and it uses the exact same dataset as an example. Apply the same approach here,
    resize each image to (480, 480), flip it horizontally, and brighten it:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: é¦–å…ˆï¼Œä¸ºäº†ç¡®ä¿æ¨¡å‹ä¸ä¼šåœ¨è®­ç»ƒæ•°æ®ä¸Šè¿‡æ‹Ÿåˆï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•æ•°æ®å¢å¼ºåº“è¿›è¡Œå›¾åƒå¢å¼ºã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨[Albumentations](https://albumentations.ai/docs/)...æ­¤åº“ç¡®ä¿è½¬æ¢å½±å“å›¾åƒå¹¶ç›¸åº”æ›´æ–°è¾¹ç•Œæ¡†ã€‚ğŸ¤—æ•°æ®é›†åº“æ–‡æ¡£æœ‰ä¸€ä¸ªè¯¦ç»†çš„[å…³äºå¦‚ä½•ä¸ºç›®æ ‡æ£€æµ‹å¢å¼ºå›¾åƒçš„æŒ‡å—](https://huggingface.co/docs/datasets/object_detection)ï¼Œå®ƒä½¿ç”¨ç›¸åŒçš„æ•°æ®é›†ä½œä¸ºç¤ºä¾‹ã€‚åœ¨è¿™é‡Œåº”ç”¨ç›¸åŒçš„æ–¹æ³•ï¼Œå°†æ¯ä¸ªå›¾åƒè°ƒæ•´ä¸º(480,
    480)ï¼Œæ°´å¹³ç¿»è½¬å¹¶å¢åŠ äº®åº¦ï¼š
- en: '[PRE7]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The `image_processor` expects the annotations to be in the following format:
    `{''image_id'': int, ''annotations'': List[Dict]}`, where each dictionary is a
    COCO object annotation. Letâ€™s add a function to reformat annotations for a single
    example:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '`image_processor`æœŸæœ›æ³¨é‡Šé‡‡ç”¨ä»¥ä¸‹æ ¼å¼ï¼š`{''image_id'': int, ''annotations'': List[Dict]}`ï¼Œå…¶ä¸­æ¯ä¸ªå­—å…¸æ˜¯ä¸€ä¸ªCOCOå¯¹è±¡æ³¨é‡Šã€‚è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå‡½æ•°æ¥ä¸ºå•ä¸ªç¤ºä¾‹é‡æ–°æ ¼å¼åŒ–æ³¨é‡Šï¼š'
- en: '[PRE8]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Now you can combine the image and annotation transformations to use on a batch
    of examples:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨ï¼Œæ‚¨å¯ä»¥å°†å›¾åƒå’Œæ³¨é‡Šè½¬æ¢ç»„åˆåœ¨ä¸€èµ·ï¼Œç”¨äºä¸€æ‰¹ç¤ºä¾‹ï¼š
- en: '[PRE9]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Apply this preprocessing function to the entire dataset using ğŸ¤— Datasets [with_transform](https://huggingface.co/docs/datasets/v2.16.1/en/package_reference/main_classes#datasets.Dataset.with_transform)
    method. This method applies transformations on the fly when you load an element
    of the dataset.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: ä½¿ç”¨ğŸ¤—æ•°æ®é›†çš„[with_transform](https://huggingface.co/docs/datasets/v2.16.1/en/package_reference/main_classes#datasets.Dataset.with_transform)æ–¹æ³•å°†æ­¤é¢„å¤„ç†å‡½æ•°åº”ç”¨äºæ•´ä¸ªæ•°æ®é›†ã€‚æ­¤æ–¹æ³•åœ¨åŠ è½½æ•°æ®é›†å…ƒç´ æ—¶åŠ¨æ€åº”ç”¨è½¬æ¢ã€‚
- en: At this point, you can check what an example from the dataset looks like after
    the transformations. You should see a tensor with `pixel_values`, a tensor with
    `pixel_mask`, and `labels`.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: æ­¤æ—¶ï¼Œæ‚¨å¯ä»¥æ£€æŸ¥æ•°æ®é›†ç»è¿‡è½¬æ¢åçš„ç¤ºä¾‹æ˜¯ä»€ä¹ˆæ ·å­ã€‚æ‚¨åº”è¯¥çœ‹åˆ°ä¸€ä¸ªå¸¦æœ‰`pixel_values`çš„å¼ é‡ï¼Œä¸€ä¸ªå¸¦æœ‰`pixel_mask`çš„å¼ é‡å’Œ`labels`ã€‚
- en: '[PRE10]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: You have successfully augmented the individual images and prepared their annotations.
    However, preprocessing isnâ€™t complete yet. In the final step, create a custom
    `collate_fn` to batch images together. Pad images (which are now `pixel_values`)
    to the largest image in a batch, and create a corresponding `pixel_mask` to indicate
    which pixels are real (1) and which are padding (0).
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨å·²æˆåŠŸå¢å¼ºäº†å•ä¸ªå›¾åƒå¹¶å‡†å¤‡å¥½å®ƒä»¬çš„æ³¨é‡Šã€‚ç„¶è€Œï¼Œé¢„å¤„ç†è¿˜æ²¡æœ‰å®Œæˆã€‚åœ¨æœ€åä¸€æ­¥ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„`collate_fn`æ¥å°†å›¾åƒæ‰¹é‡å¤„ç†åœ¨ä¸€èµ·ã€‚å°†å›¾åƒï¼ˆç°åœ¨æ˜¯`pixel_values`ï¼‰å¡«å……åˆ°æ‰¹æ¬¡ä¸­æœ€å¤§çš„å›¾åƒï¼Œå¹¶åˆ›å»ºä¸€ä¸ªç›¸åº”çš„`pixel_mask`æ¥æŒ‡ç¤ºå“ªäº›åƒç´ æ˜¯çœŸå®çš„ï¼ˆ1ï¼‰ï¼Œå“ªäº›æ˜¯å¡«å……çš„ï¼ˆ0ï¼‰ã€‚
- en: '[PRE11]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Training the DETR model
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: è®­ç»ƒDETRæ¨¡å‹
- en: You have done most of the heavy lifting in the previous sections, so now you
    are ready to train your model! The images in this dataset are still quite large,
    even after resizing. This means that finetuning this model will require at least
    one GPU.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨å‰å‡ èŠ‚ä¸­ï¼Œæ‚¨å·²ç»å®Œæˆäº†å¤§éƒ¨åˆ†ç¹é‡çš„å·¥ä½œï¼Œç°åœ¨æ‚¨å·²ç»å‡†å¤‡å¥½è®­ç»ƒæ‚¨çš„æ¨¡å‹äº†ï¼å³ä½¿åœ¨è°ƒæ•´å¤§å°åï¼Œæ­¤æ•°æ®é›†ä¸­çš„å›¾åƒä»ç„¶ç›¸å½“å¤§ã€‚è¿™æ„å‘³ç€å¾®è°ƒæ­¤æ¨¡å‹å°†éœ€è¦è‡³å°‘ä¸€ä¸ªGPUã€‚
- en: 'Training involves the following steps:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: è®­ç»ƒåŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š
- en: Load the model with [AutoModelForObjectDetection](/docs/transformers/v4.37.2/en/model_doc/auto#transformers.AutoModelForObjectDetection)
    using the same checkpoint as in the preprocessing.
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ä½¿ç”¨ä¸é¢„å¤„ç†ä¸­ç›¸åŒçš„æ£€æŸ¥ç‚¹åŠ è½½æ¨¡å‹[AutoModelForObjectDetection](/docs/transformers/v4.37.2/en/model_doc/auto#transformers.AutoModelForObjectDetection)ã€‚
- en: Define your training hyperparameters in [TrainingArguments](/docs/transformers/v4.37.2/en/main_classes/trainer#transformers.TrainingArguments).
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: åœ¨[TrainingArguments](/docs/transformers/v4.37.2/en/main_classes/trainer#transformers.TrainingArguments)ä¸­å®šä¹‰æ‚¨çš„è®­ç»ƒè¶…å‚æ•°ã€‚
- en: Pass the training arguments to [Trainer](/docs/transformers/v4.37.2/en/main_classes/trainer#transformers.Trainer)
    along with the model, dataset, image processor, and data collator.
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å°†è®­ç»ƒå‚æ•°ä¼ é€’ç»™[Trainer](/docs/transformers/v4.37.2/en/main_classes/trainer#transformers.Trainer)ï¼Œä»¥åŠæ¨¡å‹ã€æ•°æ®é›†ã€å›¾åƒå¤„ç†å™¨å’Œæ•°æ®æ•´ç†å™¨ã€‚
- en: Call [train()](/docs/transformers/v4.37.2/en/main_classes/trainer#transformers.Trainer.train)
    to finetune your model.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: è°ƒç”¨[train()](/docs/transformers/v4.37.2/en/main_classes/trainer#transformers.Trainer.train)æ¥å¾®è°ƒæ‚¨çš„æ¨¡å‹ã€‚
- en: When loading the model from the same checkpoint that you used for the preprocessing,
    remember to pass the `label2id` and `id2label` maps that you created earlier from
    the datasetâ€™s metadata. Additionally, we specify `ignore_mismatched_sizes=True`
    to replace the existing classification head with a new one.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨ä»ç”¨äºé¢„å¤„ç†çš„ç›¸åŒæ£€æŸ¥ç‚¹åŠ è½½æ¨¡å‹æ—¶ï¼Œè¯·è®°ä½ä¼ é€’æ‚¨ä»æ•°æ®é›†å…ƒæ•°æ®ä¸­åˆ›å»ºçš„`label2id`å’Œ`id2label`æ˜ å°„ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æŒ‡å®š`ignore_mismatched_sizes=True`ä»¥ç”¨æ–°çš„æ›¿æ¢ç°æœ‰çš„åˆ†ç±»å¤´ã€‚
- en: '[PRE12]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: In the [TrainingArguments](/docs/transformers/v4.37.2/en/main_classes/trainer#transformers.TrainingArguments)
    use `output_dir` to specify where to save your model, then configure hyperparameters
    as you see fit. It is important you do not remove unused columns because this
    will drop the image column. Without the image column, you canâ€™t create `pixel_values`.
    For this reason, set `remove_unused_columns` to `False`. If you wish to share
    your model by pushing to the Hub, set `push_to_hub` to `True` (you must be signed
    in to Hugging Face to upload your model).
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨[TrainingArguments](/docs/transformers/v4.37.2/en/main_classes/trainer#transformers.TrainingArguments)ä¸­ä½¿ç”¨`output_dir`æŒ‡å®šä¿å­˜æ¨¡å‹çš„ä½ç½®ï¼Œç„¶åæ ¹æ®éœ€è¦é…ç½®è¶…å‚æ•°ã€‚é‡è¦çš„æ˜¯ä¸è¦åˆ é™¤æœªä½¿ç”¨çš„åˆ—ï¼Œå› ä¸ºè¿™å°†åˆ é™¤å›¾åƒåˆ—ã€‚æ²¡æœ‰å›¾åƒåˆ—ï¼Œæ‚¨æ— æ³•åˆ›å»º`pixel_values`ã€‚å› æ­¤ï¼Œå°†`remove_unused_columns`è®¾ç½®ä¸º`False`ã€‚å¦‚æœå¸Œæœ›é€šè¿‡å°†å…¶æ¨é€åˆ°Hubæ¥å…±äº«æ‚¨çš„æ¨¡å‹ï¼Œè¯·å°†`push_to_hub`è®¾ç½®ä¸º`True`ï¼ˆæ‚¨å¿…é¡»ç™»å½•åˆ°Hugging
    Faceæ‰èƒ½ä¸Šä¼ æ‚¨çš„æ¨¡å‹ï¼‰ã€‚
- en: '[PRE13]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Finally, bring everything together, and call [train()](/docs/transformers/v4.37.2/en/main_classes/trainer#transformers.Trainer.train):'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åï¼Œå°†æ‰€æœ‰å†…å®¹æ±‡æ€»ï¼Œå¹¶è°ƒç”¨[train()](/docs/transformers/v4.37.2/en/main_classes/trainer#transformers.Trainer.train)ï¼š
- en: '[PRE14]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: If you have set `push_to_hub` to `True` in the `training_args`, the training
    checkpoints are pushed to the Hugging Face Hub. Upon training completion, push
    the final model to the Hub as well by calling the [push_to_hub()](/docs/transformers/v4.37.2/en/main_classes/trainer#transformers.Trainer.push_to_hub)
    method.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœåœ¨`training_args`ä¸­å°†`push_to_hub`è®¾ç½®ä¸º`True`ï¼Œåˆ™è®­ç»ƒæ£€æŸ¥ç‚¹å°†è¢«æ¨é€åˆ°Hugging Face Hubã€‚åœ¨è®­ç»ƒå®Œæˆåï¼Œé€šè¿‡è°ƒç”¨[push_to_hub()](/docs/transformers/v4.37.2/en/main_classes/trainer#transformers.Trainer.push_to_hub)æ–¹æ³•å°†æœ€ç»ˆæ¨¡å‹ä¹Ÿæ¨é€åˆ°Hubã€‚
- en: '[PRE15]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Evaluate
  id: totrans-74
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: è¯„ä¼°
- en: Object detection models are commonly evaluated with a set of [COCO-style metrics](https://cocodataset.org/#detection-eval).
    You can use one of the existing metrics implementations, but here youâ€™ll use the
    one from `torchvision` to evaluate the final model that you pushed to the Hub.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: ç›®æ ‡æ£€æµ‹æ¨¡å‹é€šå¸¸ä½¿ç”¨ä¸€ç»„[COCOé£æ ¼æŒ‡æ ‡](https://cocodataset.org/#detection-eval)è¿›è¡Œè¯„ä¼°ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ç°æœ‰çš„æŒ‡æ ‡å®ç°ä¹‹ä¸€ï¼Œä½†åœ¨è¿™é‡Œï¼Œæ‚¨å°†ä½¿ç”¨æ¥è‡ª`torchvision`çš„æŒ‡æ ‡æ¥è¯„ä¼°æ¨é€åˆ°Hubçš„æœ€ç»ˆæ¨¡å‹ã€‚
- en: To use the `torchvision` evaluator, youâ€™ll need to prepare a ground truth COCO
    dataset. The API to build a COCO dataset requires the data to be stored in a certain
    format, so youâ€™ll need to save images and annotations to disk first. Just like
    when you prepared your data for training, the annotations from the `cppe5["test"]`
    need to be formatted. However, images should stay as they are.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: è¦ä½¿ç”¨`torchvision`è¯„ä¼°å™¨ï¼Œæ‚¨éœ€è¦å‡†å¤‡ä¸€ä¸ªçœŸå®çš„COCOæ•°æ®é›†ã€‚æ„å»ºCOCOæ•°æ®é›†çš„APIè¦æ±‚æ•°æ®ä»¥ç‰¹å®šæ ¼å¼å­˜å‚¨ï¼Œå› æ­¤æ‚¨éœ€è¦é¦–å…ˆå°†å›¾åƒå’Œæ³¨é‡Šä¿å­˜åˆ°ç£ç›˜ä¸Šã€‚å°±åƒæ‚¨ä¸ºè®­ç»ƒå‡†å¤‡æ•°æ®æ—¶ä¸€æ ·ï¼Œæ¥è‡ª`cppe5["test"]`çš„æ³¨é‡Šéœ€è¦è¿›è¡Œæ ¼å¼åŒ–ã€‚ä½†æ˜¯ï¼Œå›¾åƒåº”ä¿æŒåŸæ ·ã€‚
- en: 'The evaluation step requires a bit of work, but it can be split in three major
    steps. First, prepare the `cppe5["test"]` set: format the annotations and save
    the data to disk.'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: è¯„ä¼°æ­¥éª¤éœ€è¦ä¸€äº›å·¥ä½œï¼Œä½†å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªä¸»è¦æ­¥éª¤ã€‚é¦–å…ˆï¼Œå‡†å¤‡`cppe5["test"]`é›†ï¼šæ ¼å¼åŒ–æ³¨é‡Šå¹¶å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Šã€‚
- en: '[PRE16]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Next, prepare an instance of a `CocoDetection` class that can be used with `cocoevaluator`.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: æ¥ä¸‹æ¥ï¼Œå‡†å¤‡ä¸€ä¸ªå¯ä»¥ä¸`cocoevaluator`ä¸€èµ·ä½¿ç”¨çš„`CocoDetection`ç±»çš„å®ä¾‹ã€‚
- en: '[PRE17]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Finally, load the metrics and run the evaluation.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: æœ€åï¼ŒåŠ è½½æŒ‡æ ‡å¹¶è¿è¡Œè¯„ä¼°ã€‚
- en: '[PRE18]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: These results can be further improved by adjusting the hyperparameters in [TrainingArguments](/docs/transformers/v4.37.2/en/main_classes/trainer#transformers.TrainingArguments).
    Give it a go!
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: é€šè¿‡è°ƒæ•´[TrainingArguments](/docs/transformers/v4.37.2/en/main_classes/trainer#transformers.TrainingArguments)ä¸­çš„è¶…å‚æ•°ï¼Œè¿™äº›ç»“æœå¯ä»¥è¿›ä¸€æ­¥æ”¹å–„ã€‚è¯•ä¸€è¯•å§ï¼
- en: Inference
  id: totrans-84
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ¨æ–­
- en: 'Now that you have finetuned a DETR model, evaluated it, and uploaded it to
    the Hugging Face Hub, you can use it for inference. The simplest way to try out
    your finetuned model for inference is to use it in a [Pipeline](/docs/transformers/v4.37.2/en/main_classes/pipelines#transformers.Pipeline).
    Instantiate a pipeline for object detection with your model, and pass an image
    to it:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: ç°åœ¨æ‚¨å·²ç»å¾®è°ƒäº†ä¸€ä¸ªDETRæ¨¡å‹ï¼Œå¯¹å…¶è¿›è¡Œäº†è¯„ä¼°ï¼Œå¹¶å°†å…¶ä¸Šä¼ åˆ°Hugging Face Hubï¼Œæ‚¨å¯ä»¥å°†å…¶ç”¨äºæ¨æ–­ã€‚å°è¯•ä½¿ç”¨æ‚¨å¾®è°ƒçš„æ¨¡å‹è¿›è¡Œæ¨æ–­çš„æœ€ç®€å•æ–¹æ³•æ˜¯åœ¨[Pipeline](/docs/transformers/v4.37.2/en/main_classes/pipelines#transformers.Pipeline)ä¸­ä½¿ç”¨å®ƒã€‚ä½¿ç”¨æ‚¨çš„æ¨¡å‹å®ä¾‹åŒ–ä¸€ä¸ªç”¨äºç›®æ ‡æ£€æµ‹çš„æµæ°´çº¿ï¼Œå¹¶å°†å›¾åƒä¼ é€’ç»™å®ƒï¼š
- en: '[PRE19]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'You can also manually replicate the results of the pipeline if youâ€™d like:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨æ„¿æ„ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨å¤åˆ¶æµæ°´çº¿çš„ç»“æœï¼š
- en: '[PRE20]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Letâ€™s plot the result:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: è®©æˆ‘ä»¬ç»˜åˆ¶ç»“æœï¼š
- en: '[PRE21]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '![Object detection result on a new image](../Images/b288908d50f68ec172bde6778dc19ead.png)'
  id: totrans-91
  prefs: []
  type: TYPE_IMG
  zh: åœ¨ä¸€å¼ æ–°å›¾ç‰‡ä¸Šçš„ç›®æ ‡æ£€æµ‹ç»“æœ
