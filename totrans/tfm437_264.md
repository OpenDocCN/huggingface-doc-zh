# DINOv2

> åŸå§‹æ–‡æœ¬ï¼š[https://huggingface.co/docs/transformers/v4.37.2/en/model_doc/dinov2](https://huggingface.co/docs/transformers/v4.37.2/en/model_doc/dinov2)

## æ¦‚è¿°

DINOv2æ¨¡å‹æ˜¯ç”±Maxime Oquabã€TimothÃ©e Darcetã€ThÃ©o Moutakanniã€Huy Voã€Marc Szafraniecã€Vasil Khalidovã€Pierre Fernandezã€Daniel Hazizaã€Francisco Massaã€Alaaeldin El-Noubyã€Mahmoud Assranã€Nicolas Ballasã€Wojciech Galubaã€Russell Howesã€Po-Yao Huangã€Shang-Wen Liã€Ishan Misraã€Michael Rabbatã€Vasu Sharmaã€Gabriel Synnaeveã€Hu Xuã€HervÃ© Jegouã€Julien Mairalã€Patrick Labatutã€Armand Joulinã€Piotr Bojanowskiæå‡ºçš„[DINOv2: Learning Robust Visual Features without Supervision](https://arxiv.org/abs/2304.07193)ã€‚DINOv2æ˜¯[DINO](https://arxiv.org/abs/2104.14294)çš„å‡çº§ç‰ˆæœ¬ï¼Œæ˜¯ä¸€ç§åº”ç”¨äº[è§†è§‰Transformer](vit)çš„è‡ªç›‘ç£æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä½¿å¾—å¯ä»¥ç”Ÿæˆé€šç”¨è§†è§‰ç‰¹å¾ï¼Œå³åœ¨ä¸è¿›è¡Œå¾®è°ƒçš„æƒ…å†µä¸‹é€‚ç”¨äºå›¾åƒåˆ†å¸ƒå’Œä»»åŠ¡çš„ç‰¹å¾ã€‚

è¯¥è®ºæ–‡çš„æ‘˜è¦å¦‚ä¸‹ï¼š

*æœ€è¿‘åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä¸­çš„æ¨¡å‹é¢„è®­ç»ƒæ–¹é¢å–å¾—çš„çªç ´ä¸ºè®¡ç®—æœºè§†è§‰ä¸­ç±»ä¼¼çš„åŸºç¡€æ¨¡å‹æ‰“å¼€äº†é“è·¯ã€‚è¿™äº›æ¨¡å‹å¯ä»¥é€šè¿‡ç”Ÿæˆé€šç”¨è§†è§‰ç‰¹å¾ï¼ˆå³åœ¨ä¸è¿›è¡Œå¾®è°ƒçš„æƒ…å†µä¸‹é€‚ç”¨äºå›¾åƒåˆ†å¸ƒå’Œä»»åŠ¡çš„ç‰¹å¾ï¼‰å¤§å¤§ç®€åŒ–ä»»ä½•ç³»ç»Ÿä¸­å›¾åƒçš„ä½¿ç”¨ã€‚è¿™é¡¹å·¥ä½œè¡¨æ˜ï¼Œç°æœ‰çš„é¢„è®­ç»ƒæ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯è‡ªç›‘ç£æ–¹æ³•ï¼Œå¦‚æœåœ¨æ¥è‡ªä¸åŒæ¥æºçš„å……åˆ†ç­›é€‰æ•°æ®ä¸Šè¿›è¡Œè®­ç»ƒï¼Œå¯ä»¥äº§ç”Ÿè¿™æ ·çš„ç‰¹å¾ã€‚æˆ‘ä»¬é‡æ–°å®¡è§†ç°æœ‰æ–¹æ³•ï¼Œå¹¶ç»“åˆä¸åŒæŠ€æœ¯æ¥æ‰©å±•æˆ‘ä»¬çš„é¢„è®­ç»ƒæ•°æ®å’Œæ¨¡å‹è§„æ¨¡ã€‚å¤§éƒ¨åˆ†æŠ€æœ¯è´¡çŒ®æ—¨åœ¨åŠ é€Ÿå’Œç¨³å®šå¤§è§„æ¨¡è®­ç»ƒã€‚åœ¨æ•°æ®æ–¹é¢ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªè‡ªåŠ¨æµæ°´çº¿æ¥æ„å»ºä¸€ä¸ªä¸“é—¨çš„ã€å¤šæ ·åŒ–çš„ã€ç­›é€‰è¿‡çš„å›¾åƒæ•°æ®é›†ï¼Œè€Œä¸æ˜¯åƒè‡ªç›‘ç£æ–‡çŒ®ä¸­é€šå¸¸æ‰€åšçš„é‚£æ ·ä½¿ç”¨æœªç­›é€‰çš„æ•°æ®ã€‚åœ¨æ¨¡å‹æ–¹é¢ï¼Œæˆ‘ä»¬è®­ç»ƒäº†ä¸€ä¸ªå…·æœ‰10äº¿å‚æ•°çš„ViTæ¨¡å‹ï¼ˆDosovitskiyç­‰äººï¼Œ2020å¹´ï¼‰ï¼Œå¹¶å°†å…¶è’¸é¦æˆä¸€ç³»åˆ—æ›´å°çš„æ¨¡å‹ï¼Œè¿™äº›æ¨¡å‹åœ¨å›¾åƒå’Œåƒç´ çº§åˆ«çš„å¤§å¤šæ•°åŸºå‡†æµ‹è¯•ä¸­è¶…è¶Šäº†æœ€ä½³çš„é€šç”¨ç‰¹å¾OpenCLIPï¼ˆIlharcoç­‰äººï¼Œ2021å¹´ï¼‰*

æ­¤æ¨¡å‹ç”±[nielsr](https://huggingface.co/nielsr)è´¡çŒ®ã€‚åŸå§‹ä»£ç å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/facebookresearch/dinov2)æ‰¾åˆ°ã€‚

## ä½¿ç”¨æç¤º

è¯¥æ¨¡å‹å¯ä»¥ä½¿ç”¨`torch.jit.trace`è¿›è¡Œè·Ÿè¸ªï¼Œåˆ©ç”¨JITç¼–è¯‘æ¥ä¼˜åŒ–æ¨¡å‹ï¼Œä½¿å…¶è¿è¡Œæ›´å¿«ã€‚è¯·æ³¨æ„ï¼Œè¿™ä»ç„¶ä¼šäº§ç”Ÿä¸€äº›ä¸åŒ¹é…çš„å…ƒç´ ï¼ŒåŸå§‹æ¨¡å‹å’Œè·Ÿè¸ªæ¨¡å‹ä¹‹é—´çš„å·®å¼‚çº¦ä¸º1e-4çš„æ•°é‡çº§ã€‚

```py
import torch
from transformers import AutoImageProcessor, AutoModel
from PIL import Image
import requests

url = 'http://images.cocodataset.org/val2017/000000039769.jpg'
image = Image.open(requests.get(url, stream=True).raw)

processor = AutoImageProcessor.from_pretrained('facebook/dinov2-base')
model = AutoModel.from_pretrained('facebook/dinov2-base')

inputs = processor(images=image, return_tensors="pt")
outputs = model(**inputs)
last_hidden_states = outputs[0]

# We have to force return_dict=False for tracing
model.config.return_dict = False

with torch.no_grad():
    traced_model = torch.jit.trace(model, [inputs.pixel_values])
    traced_outputs = traced_model(inputs.pixel_values)

print((last_hidden_states - traced_outputs[0]).abs().max())
```

## èµ„æº

å®˜æ–¹Hugging Faceå’Œç¤¾åŒºï¼ˆç”±ğŸŒè¡¨ç¤ºï¼‰èµ„æºåˆ—è¡¨ï¼Œå¯å¸®åŠ©æ‚¨å¼€å§‹ä½¿ç”¨DPTã€‚

+   DINOv2çš„æ¼”ç¤ºç¬”è®°æœ¬å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/NielsRogge/Transformers-Tutorials/tree/master/DINOv2)æ‰¾åˆ°ã€‚ğŸŒ

å›¾åƒåˆ†ç±»

+   [Dinov2ForImageClassification](/docs/transformers/v4.37.2/en/model_doc/dinov2#transformers.Dinov2ForImageClassification)ç”±è¿™ä¸ª[ç¤ºä¾‹è„šæœ¬](https://github.com/huggingface/transformers/tree/main/examples/pytorch/image-classification)å’Œ[ç¬”è®°æœ¬](https://colab.research.google.com/github/huggingface/notebooks/blob/main/examples/image_classification.ipynb)æ”¯æŒã€‚

+   å¦è¯·å‚é˜…ï¼š[å›¾åƒåˆ†ç±»ä»»åŠ¡æŒ‡å—](../tasks/image_classification)

å¦‚æœæ‚¨æœ‰å…´è¶£æäº¤èµ„æºä»¥åŒ…å«åœ¨è¿™é‡Œï¼Œè¯·éšæ—¶æ‰“å¼€ä¸€ä¸ªPull Requestï¼Œæˆ‘ä»¬å°†è¿›è¡Œå®¡æ ¸ï¼èµ„æºåº”è¯¥ç†æƒ³åœ°å±•ç¤ºä¸€äº›æ–°ä¸œè¥¿ï¼Œè€Œä¸æ˜¯é‡å¤ç°æœ‰èµ„æºã€‚

## Dinov2Config

### `class transformers.Dinov2Config`

[<æ¥æº>](https://github.com/huggingface/transformers/blob/v4.37.2/src/transformers/models/dinov2/configuration_dinov2.py#L35)

```py
( hidden_size = 768 num_hidden_layers = 12 num_attention_heads = 12 mlp_ratio = 4 hidden_act = 'gelu' hidden_dropout_prob = 0.0 attention_probs_dropout_prob = 0.0 initializer_range = 0.02 layer_norm_eps = 1e-06 image_size = 224 patch_size = 16 num_channels = 3 qkv_bias = True layerscale_value = 1.0 drop_path_rate = 0.0 use_swiglu_ffn = False out_features = None out_indices = None apply_layernorm = True reshape_hidden_states = True **kwargs )
```

å‚æ•°

+   `hidden_size`ï¼ˆ`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º768ï¼‰â€”ç¼–ç å™¨å±‚å’Œæ± åŒ–å±‚çš„ç»´åº¦ã€‚

+   `num_hidden_layers` (`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 12) â€” Transformer ç¼–ç å™¨ä¸­çš„éšè—å±‚æ•°é‡ã€‚

+   `num_attention_heads` (`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 12) â€” Transformer ç¼–ç å™¨ä¸­æ¯ä¸ªæ³¨æ„åŠ›å±‚çš„æ³¨æ„åŠ›å¤´æ•°ã€‚

+   `mlp_ratio` (`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 4) â€” MLP çš„éšè—å¤§å°ç›¸å¯¹äº `hidden_size` çš„æ¯”ç‡ã€‚

+   `hidden_act` (`str` æˆ– `function`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º `"gelu"`) â€” ç¼–ç å™¨å’Œæ± åŒ–å™¨ä¸­çš„éçº¿æ€§æ¿€æ´»å‡½æ•°ï¼ˆå‡½æ•°æˆ–å­—ç¬¦ä¸²ï¼‰ã€‚å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œæ”¯æŒ `"gelu"`ã€`"relu"`ã€`"selu"` å’Œ `"gelu_new"`ã€‚

+   `hidden_dropout_prob` (`float`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 0.0) â€” åµŒå…¥ã€ç¼–ç å™¨å’Œæ± åŒ–å™¨ä¸­æ‰€æœ‰å…¨è¿æ¥å±‚çš„ä¸¢å¼ƒæ¦‚ç‡ã€‚

+   `attention_probs_dropout_prob` (`float`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 0.0) â€” æ³¨æ„åŠ›æ¦‚ç‡çš„ä¸¢å¼ƒæ¯”ç‡ã€‚

+   `initializer_range` (`float`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 0.02) â€” ç”¨äºåˆå§‹åŒ–æ‰€æœ‰æƒé‡çŸ©é˜µçš„æˆªæ–­æ­£æ€åˆå§‹åŒ–å™¨çš„æ ‡å‡†å·®ã€‚

+   `layer_norm_eps` (`float`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 1e-06) â€” å±‚å½’ä¸€åŒ–å±‚ä½¿ç”¨çš„ epsilonã€‚

+   `image_size` (`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 224) â€” æ¯ä¸ªå›¾åƒçš„å¤§å°ï¼ˆåˆ†è¾¨ç‡ï¼‰ã€‚

+   `patch_size` (`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 16) â€” æ¯ä¸ªè¡¥ä¸çš„å¤§å°ï¼ˆåˆ†è¾¨ç‡ï¼‰ã€‚

+   `num_channels` (`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 3) â€” è¾“å…¥é€šé“æ•°ã€‚

+   `qkv_bias` (`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º `True`) â€” æ˜¯å¦ä¸ºæŸ¥è¯¢ã€é”®å’Œå€¼æ·»åŠ åç½®ã€‚

+   `layerscale_value` (`float`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 1.0) â€” ç”¨äºå±‚ç¼©æ”¾çš„åˆå§‹å€¼ã€‚

+   `drop_path_rate` (`float`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 0.0) â€” æ¯ä¸ªæ ·æœ¬çš„éšæœºæ·±åº¦ç‡ï¼ˆåº”ç”¨äºæ®‹å·®å±‚çš„ä¸»è·¯å¾„æ—¶ï¼‰ã€‚

+   `use_swiglu_ffn` (`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º `False`) â€” æ˜¯å¦ä½¿ç”¨ SwiGLU å‰é¦ˆç¥ç»ç½‘ç»œã€‚

+   `out_features` (`List[str]`ï¼Œ*å¯é€‰*) â€” å¦‚æœç”¨ä½œéª¨å¹²ï¼Œè¦è¾“å‡ºçš„ç‰¹å¾åˆ—è¡¨ã€‚å¯ä»¥æ˜¯ä»»ä½• `"stem"`ã€`"stage1"`ã€`"stage2"` ç­‰ï¼ˆå–å†³äºæ¨¡å‹æœ‰å¤šå°‘é˜¶æ®µï¼‰ã€‚å¦‚æœæœªè®¾ç½®ä¸”è®¾ç½®äº† `out_indices`ï¼Œå°†é»˜è®¤ä¸ºç›¸åº”çš„é˜¶æ®µã€‚å¦‚æœæœªè®¾ç½®ä¸”æœªè®¾ç½® `out_indices`ï¼Œå°†é»˜è®¤ä¸ºæœ€åä¸€ä¸ªé˜¶æ®µã€‚å¿…é¡»æŒ‰ç…§ `stage_names` å±æ€§ä¸­å®šä¹‰çš„é¡ºåºã€‚

+   `out_indices` (`List[int]`ï¼Œ*å¯é€‰*) â€” å¦‚æœç”¨ä½œéª¨å¹²ï¼Œè¦è¾“å‡ºçš„ç‰¹å¾çš„ç´¢å¼•åˆ—è¡¨ã€‚å¯ä»¥æ˜¯ä»»ä½• 0ã€1ã€2 ç­‰ï¼ˆå–å†³äºæ¨¡å‹æœ‰å¤šå°‘é˜¶æ®µï¼‰ã€‚å¦‚æœæœªè®¾ç½®ä¸”è®¾ç½®äº† `out_features`ï¼Œå°†é»˜è®¤ä¸ºç›¸åº”çš„é˜¶æ®µã€‚å¦‚æœæœªè®¾ç½®ä¸”æœªè®¾ç½® `out_features`ï¼Œå°†é»˜è®¤ä¸ºæœ€åä¸€ä¸ªé˜¶æ®µã€‚å¿…é¡»æŒ‰ç…§ `stage_names` å±æ€§ä¸­å®šä¹‰çš„é¡ºåºã€‚

+   `apply_layernorm` (`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º `True`) â€” æ˜¯å¦åœ¨æ¨¡å‹ç”¨ä½œéª¨å¹²æ—¶å¯¹ç‰¹å¾å›¾åº”ç”¨å±‚å½’ä¸€åŒ–ã€‚

+   `reshape_hidden_states` (`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º `True`) â€” æ˜¯å¦å°†ç‰¹å¾å›¾é‡å¡‘ä¸ºå½¢çŠ¶ä¸º `(batch_size, hidden_size, height, width)` çš„4Då¼ é‡ï¼Œä»¥ä¾¿åœ¨æ¨¡å‹ç”¨ä½œéª¨å¹²æ—¶ä½¿ç”¨ã€‚å¦‚æœä¸º `False`ï¼Œç‰¹å¾å›¾å°†æ˜¯å½¢çŠ¶ä¸º `(batch_size, seq_len, hidden_size)` çš„3Då¼ é‡ã€‚

è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œç”¨äºå­˜å‚¨ [Dinov2Model](/docs/transformers/v4.37.2/en/model_doc/dinov2#transformers.Dinov2Model) çš„é…ç½®ã€‚å®ƒç”¨äºæ ¹æ®æŒ‡å®šçš„å‚æ•°å®ä¾‹åŒ– Dinov2 æ¨¡å‹ï¼Œå®šä¹‰æ¨¡å‹æ¶æ„ã€‚ä½¿ç”¨é»˜è®¤å€¼å®ä¾‹åŒ–é…ç½®å°†äº§ç”Ÿç±»ä¼¼äº Dinov2 [google/dinov2-base-patch16-224](https://huggingface.co/google/dinov2-base-patch16-224) æ¶æ„çš„é…ç½®ã€‚

é…ç½®å¯¹è±¡ç»§æ‰¿è‡ª [PretrainedConfig](/docs/transformers/v4.37.2/en/main_classes/configuration#transformers.PretrainedConfig)ï¼Œå¯ç”¨äºæ§åˆ¶æ¨¡å‹è¾“å‡ºã€‚é˜…è¯»æ¥è‡ª [PretrainedConfig](/docs/transformers/v4.37.2/en/main_classes/configuration#transformers.PretrainedConfig) çš„æ–‡æ¡£ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚

ç¤ºä¾‹ï¼š

```py
>>> from transformers import Dinov2Config, Dinov2Model

>>> # Initializing a Dinov2 dinov2-base-patch16-224 style configuration
>>> configuration = Dinov2Config()

>>> # Initializing a model (with random weights) from the dinov2-base-patch16-224 style configuration
>>> model = Dinov2Model(configuration)

>>> # Accessing the model configuration
>>> configuration = model.config
```

## Dinov2Model

### `class transformers.Dinov2Model`

[< source >](https://github.com/huggingface/transformers/blob/v4.37.2/src/transformers/models/dinov2/modeling_dinov2.py#L576)

```py
( config: Dinov2Config )
```

å‚æ•°

+   `config` ([Dinov2Config](/docs/transformers/v4.37.2/en/model_doc/dinov2#transformers.Dinov2Config)) â€” å…·æœ‰æ¨¡å‹æ‰€æœ‰å‚æ•°çš„æ¨¡å‹é…ç½®ç±»ã€‚ä½¿ç”¨é…ç½®æ–‡ä»¶åˆå§‹åŒ–ä¸ä¼šåŠ è½½ä¸æ¨¡å‹å…³è”çš„æƒé‡ï¼ŒåªåŠ è½½é…ç½®ã€‚æŸ¥çœ‹ [from_pretrained()](/docs/transformers/v4.37.2/en/main_classes/model#transformers.PreTrainedModel.from_pretrained) æ–¹æ³•ä»¥åŠ è½½æ¨¡å‹æƒé‡ã€‚

è£¸çš„ DINOv2 æ¨¡å‹å˜å‹å™¨è¾“å‡ºåŸå§‹éšè—çŠ¶æ€ï¼Œæ²¡æœ‰ç‰¹å®šçš„å¤´éƒ¨ã€‚æ­¤æ¨¡å‹æ˜¯ PyTorch [torch.nn.Module](https://pytorch.org/docs/stable/nn.html#torch.nn.Module) çš„å­ç±»ã€‚å°†å…¶ç”¨ä½œå¸¸è§„ PyTorch æ¨¡å—ï¼Œå¹¶å‚è€ƒ PyTorch æ–‡æ¡£ä»¥è·å–æœ‰å…³ä¸€èˆ¬ç”¨æ³•å’Œè¡Œä¸ºçš„æ‰€æœ‰ç›¸å…³ä¿¡æ¯ã€‚

#### `forward`

[< source >](https://github.com/huggingface/transformers/blob/v4.37.2/src/transformers/models/dinov2/modeling_dinov2.py#L604)

```py
( pixel_values: Optional = None bool_masked_pos: Optional = None head_mask: Optional = None output_attentions: Optional = None output_hidden_states: Optional = None return_dict: Optional = None ) â†’ export const metadata = 'undefined';transformers.modeling_outputs.BaseModelOutputWithPooling or tuple(torch.FloatTensor)
```

å‚æ•°

+   `pixel_values` (`torch.FloatTensor`ï¼Œå½¢çŠ¶ä¸º`(batch_size, num_channels, height, width)`) â€” åƒç´ å€¼ã€‚å¯ä»¥ä½¿ç”¨ [AutoImageProcessor](/docs/transformers/v4.37.2/en/model_doc/auto#transformers.AutoImageProcessor) è·å–åƒç´ å€¼ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… [BitImageProcessor.preprocess()](/docs/transformers/v4.37.2/en/model_doc/bit#transformers.BitImageProcessor.preprocess)ã€‚

+   `bool_masked_pos` (`torch.BoolTensor`ï¼Œå½¢çŠ¶ä¸º`(batch_size, sequence_length)`) â€” å¸ƒå°”æ©ç›–ä½ç½®ã€‚æŒ‡ç¤ºå“ªäº›è¡¥ä¸è¢«æ©ç›–ï¼ˆ1ï¼‰å“ªäº›æ²¡æœ‰ï¼ˆ0ï¼‰ã€‚ä»…é€‚ç”¨äºé¢„è®­ç»ƒã€‚

+   `head_mask` (`torch.FloatTensor`ï¼Œå½¢çŠ¶ä¸º`(num_heads,)` æˆ– `(num_layers, num_heads)`ï¼Œ*optional*) â€” ç”¨äºä½¿è‡ªæ³¨æ„åŠ›æ¨¡å—ä¸­é€‰æ‹©çš„å¤´éƒ¨å¤±æ•ˆçš„æ©ç ã€‚æ©ç å€¼é€‰åœ¨ `[0, 1]`ï¼š

    +   1 è¡¨ç¤ºå¤´éƒ¨æœªè¢«æ©ç›–ï¼Œ

    +   0 è¡¨ç¤ºå¤´éƒ¨è¢«æ©ç›–ã€‚

+   `output_attentions` (`bool`, *optional*) â€” æ˜¯å¦è¿”å›æ‰€æœ‰æ³¨æ„åŠ›å±‚çš„æ³¨æ„åŠ›å¼ é‡ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…è¿”å›çš„å¼ é‡ä¸­çš„`attentions`ã€‚

+   `output_hidden_states` (`bool`, *optional*) â€” æ˜¯å¦è¿”å›æ‰€æœ‰å±‚çš„éšè—çŠ¶æ€ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…è¿”å›çš„å¼ é‡ä¸­çš„`hidden_states`ã€‚

+   `return_dict` (`bool`, *optional*) â€” æ˜¯å¦è¿”å› [ModelOutput](/docs/transformers/v4.37.2/en/main_classes/output#transformers.utils.ModelOutput) è€Œä¸æ˜¯æ™®é€šå…ƒç»„ã€‚

è¿”å›

[transformers.modeling_outputs.BaseModelOutputWithPooling](/docs/transformers/v4.37.2/en/main_classes/output#transformers.modeling_outputs.BaseModelOutputWithPooling) æˆ– `tuple(torch.FloatTensor)`

ä¸€ä¸ª [transformers.modeling_outputs.BaseModelOutputWithPooling](/docs/transformers/v4.37.2/en/main_classes/output#transformers.modeling_outputs.BaseModelOutputWithPooling) æˆ–ä¸€ä¸ª `torch.FloatTensor` å…ƒç»„ï¼ˆå¦‚æœä¼ é€’äº†`return_dict=False`æˆ–å½“`config.return_dict=False`æ—¶ï¼‰åŒ…å«æ ¹æ®é…ç½®ï¼ˆ[Dinov2Config](/docs/transformers/v4.37.2/en/model_doc/dinov2#transformers.Dinov2Config)ï¼‰å’Œè¾“å…¥çš„å„ç§å…ƒç´ ã€‚

+   `last_hidden_state` (`torch.FloatTensor`ï¼Œå½¢çŠ¶ä¸º`(batch_size, sequence_length, hidden_size)`) â€” æ¨¡å‹æœ€åä¸€å±‚è¾“å‡ºçš„éšè—çŠ¶æ€åºåˆ—ã€‚

+   `pooler_output` (`torch.FloatTensor`ï¼Œå½¢çŠ¶ä¸º`(batch_size, hidden_size)`) â€” ç»è¿‡è¾…åŠ©é¢„è®­ç»ƒä»»åŠ¡ä¸­ä½¿ç”¨çš„å±‚è¿›ä¸€æ­¥å¤„ç†åçš„åºåˆ—ç¬¬ä¸€ä¸ªæ ‡è®°ï¼ˆåˆ†ç±»æ ‡è®°ï¼‰çš„æœ€åä¸€å±‚éšè—çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œå¯¹äº BERT ç³»åˆ—æ¨¡å‹ï¼Œè¿™å°†è¿”å›ç»è¿‡çº¿æ€§å±‚å’Œ tanh æ¿€æ´»å‡½æ•°å¤„ç†åçš„åˆ†ç±»æ ‡è®°ã€‚çº¿æ€§å±‚çš„æƒé‡æ˜¯ä»é¢„è®­ç»ƒæœŸé—´çš„ä¸‹ä¸€ä¸ªå¥å­é¢„æµ‹ï¼ˆåˆ†ç±»ï¼‰ç›®æ ‡ä¸­è®­ç»ƒçš„ã€‚

+   `hidden_states` (`tuple(torch.FloatTensor)`ï¼Œ*optional*ï¼Œå½“ä¼ é€’`output_hidden_states=True`æˆ–`config.output_hidden_states=True`æ—¶è¿”å›) â€” å½¢çŠ¶ä¸º`(batch_size, sequence_length, hidden_size)`çš„`torch.FloatTensor`å…ƒç»„ï¼ˆå¦‚æœæ¨¡å‹å…·æœ‰åµŒå…¥å±‚ï¼Œåˆ™ä¸ºåµŒå…¥è¾“å‡ºçš„è¾“å‡º+æ¯å±‚çš„è¾“å‡ºï¼‰ã€‚ 

    æ¨¡å‹åœ¨æ¯ä¸€å±‚è¾“å‡ºçš„éšè—çŠ¶æ€ä»¥åŠå¯é€‰çš„åˆå§‹åµŒå…¥è¾“å‡ºã€‚

+   `attentions` (`tuple(torch.FloatTensor)`, *optional*, å½“ä¼ é€’`output_attentions=True`æˆ–`config.output_attentions=True`æ—¶è¿”å›) â€” å½¢çŠ¶ä¸º`(batch_size, num_heads, sequence_length, sequence_length)`çš„`torch.FloatTensor`å…ƒç»„ï¼ˆæ¯å±‚ä¸€ä¸ªï¼‰ã€‚

    åœ¨æ³¨æ„åŠ›softmaxä¹‹åçš„æ³¨æ„åŠ›æƒé‡ï¼Œç”¨äºè®¡ç®—è‡ªæ³¨æ„åŠ›å¤´ä¸­çš„åŠ æƒå¹³å‡å€¼ã€‚

[Dinov2Model](/docs/transformers/v4.37.2/en/model_doc/dinov2#transformers.Dinov2Model)çš„å‰å‘æ–¹æ³•ï¼Œè¦†ç›–`__call__`ç‰¹æ®Šæ–¹æ³•ã€‚

å°½ç®¡å‰å‘ä¼ é€’çš„æ­¥éª¤éœ€è¦åœ¨æ­¤å‡½æ•°å†…å®šä¹‰ï¼Œä½†åº”è¯¥åœ¨æ­¤ä¹‹åè°ƒç”¨`Module`å®ä¾‹ï¼Œè€Œä¸æ˜¯åœ¨æ­¤å¤„è°ƒç”¨ï¼Œå› ä¸ºå‰è€…ä¼šè´Ÿè´£è¿è¡Œé¢„å¤„ç†å’Œåå¤„ç†æ­¥éª¤ï¼Œè€Œåè€…ä¼šé»˜é»˜å¿½ç•¥å®ƒä»¬ã€‚

ç¤ºä¾‹ï¼š

```py
>>> from transformers import AutoImageProcessor, Dinov2Model
>>> import torch
>>> from datasets import load_dataset

>>> dataset = load_dataset("huggingface/cats-image")
>>> image = dataset["test"]["image"][0]

>>> image_processor = AutoImageProcessor.from_pretrained("facebook/dinov2-base")
>>> model = Dinov2Model.from_pretrained("facebook/dinov2-base")

>>> inputs = image_processor(image, return_tensors="pt")

>>> with torch.no_grad():
...     outputs = model(**inputs)

>>> last_hidden_states = outputs.last_hidden_state
>>> list(last_hidden_states.shape)
[1, 257, 768]
```

## Dinov2ForImageClassification

### `class transformers.Dinov2ForImageClassification`

[<æ¥æº>](https://github.com/huggingface/transformers/blob/v4.37.2/src/transformers/models/dinov2/modeling_dinov2.py#L662)

```py
( config: Dinov2Config )
```

å‚æ•°

+   `config` ([Dinov2Config](/docs/transformers/v4.37.2/en/model_doc/dinov2#transformers.Dinov2Config)) â€” å…·æœ‰æ¨¡å‹æ‰€æœ‰å‚æ•°çš„æ¨¡å‹é…ç½®ç±»ã€‚ä½¿ç”¨é…ç½®æ–‡ä»¶åˆå§‹åŒ–ä¸ä¼šåŠ è½½ä¸æ¨¡å‹ç›¸å…³çš„æƒé‡ï¼ŒåªåŠ è½½é…ç½®ã€‚æŸ¥çœ‹[from_pretrained()](/docs/transformers/v4.37.2/en/main_classes/model#transformers.PreTrainedModel.from_pretrained)æ–¹æ³•ä»¥åŠ è½½æ¨¡å‹æƒé‡ã€‚

åœ¨é¡¶éƒ¨å¸¦æœ‰å›¾åƒåˆ†ç±»å¤´çš„Dinov2æ¨¡å‹å˜æ¢å™¨ï¼ˆåœ¨[CLS]æ ‡è®°çš„æœ€ç»ˆéšè—çŠ¶æ€ä¹‹ä¸Šçš„çº¿æ€§å±‚ï¼‰ï¼Œä¾‹å¦‚ç”¨äºImageNetã€‚

æ­¤æ¨¡å‹æ˜¯PyTorch [torch.nn.Module](https://pytorch.org/docs/stable/nn.html#torch.nn.Module)å­ç±»ã€‚å°†å…¶ç”¨ä½œå¸¸è§„PyTorchæ¨¡å—ï¼Œå¹¶å‚è€ƒPyTorchæ–‡æ¡£ä»¥è·å–ä¸ä¸€èˆ¬ç”¨æ³•å’Œè¡Œä¸ºç›¸å…³çš„æ‰€æœ‰äº‹é¡¹ã€‚

#### `forward`

[<æ¥æº>](https://github.com/huggingface/transformers/blob/v4.37.2/src/transformers/models/dinov2/modeling_dinov2.py#L684)

```py
( pixel_values: Optional = None head_mask: Optional = None labels: Optional = None output_attentions: Optional = None output_hidden_states: Optional = None return_dict: Optional = None ) â†’ export const metadata = 'undefined';transformers.modeling_outputs.ImageClassifierOutput or tuple(torch.FloatTensor)
```

å‚æ•°

+   `pixel_values` (`torch.FloatTensor`ï¼Œå½¢çŠ¶ä¸º`(batch_size, num_channels, height, width)`) â€” åƒç´ å€¼ã€‚å¯ä»¥ä½¿ç”¨[AutoImageProcessor](/docs/transformers/v4.37.2/en/model_doc/auto#transformers.AutoImageProcessor)è·å–åƒç´ å€¼ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[BitImageProcessor.preprocess()](/docs/transformers/v4.37.2/en/model_doc/bit#transformers.BitImageProcessor.preprocess)ã€‚

+   `head_mask` (`torch.FloatTensor`ï¼Œå½¢çŠ¶ä¸º`(num_heads,)`æˆ–`(num_layers, num_heads)`ï¼Œ*optional*) â€” ç”¨äºä½¿è‡ªæ³¨æ„åŠ›æ¨¡å—ä¸­é€‰æ‹©çš„å¤´éƒ¨å¤±æ•ˆçš„æ©ç ã€‚æ©ç å€¼é€‰åœ¨`[0, 1]`ä¹‹é—´ï¼š

    +   1è¡¨ç¤ºå¤´éƒ¨æœªè¢«`æ©ç `ï¼Œ

    +   0è¡¨ç¤ºå¤´éƒ¨è¢«`æ©ç `ã€‚

+   `output_attentions` (`bool`, *optional*) â€” æ˜¯å¦è¿”å›æ‰€æœ‰æ³¨æ„åŠ›å±‚çš„æ³¨æ„åŠ›å¼ é‡ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…è¿”å›å¼ é‡ä¸‹çš„`attentions`ã€‚

+   `output_hidden_states` (`bool`, *optional*) â€” æ˜¯å¦è¿”å›æ‰€æœ‰å±‚çš„éšè—çŠ¶æ€ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…è¿”å›å¼ é‡ä¸‹çš„`hidden_states`ã€‚

+   `return_dict` (`bool`, *optional*) â€” æ˜¯å¦è¿”å›[ModelOutput](/docs/transformers/v4.37.2/en/main_classes/output#transformers.utils.ModelOutput)è€Œä¸æ˜¯æ™®é€šå…ƒç»„ã€‚

+   `labels` (`torch.LongTensor`ï¼Œå½¢çŠ¶ä¸º`(batch_size,)`ï¼Œ*optional*) â€” ç”¨äºè®¡ç®—å›¾åƒåˆ†ç±»/å›å½’æŸå¤±çš„æ ‡ç­¾ã€‚ç´¢å¼•åº”åœ¨`[0, ..., config.num_labels - 1]`èŒƒå›´å†…ã€‚å¦‚æœ`config.num_labels == 1`ï¼Œåˆ™è®¡ç®—å›å½’æŸå¤±ï¼ˆå‡æ–¹æŸå¤±ï¼‰ï¼Œå¦‚æœ`config.num_labels > 1`ï¼Œåˆ™è®¡ç®—åˆ†ç±»æŸå¤±ï¼ˆäº¤å‰ç†µï¼‰ã€‚

è¿”å›

[transformers.modeling_outputs.ImageClassifierOutput](/docs/transformers/v4.37.2/en/main_classes/output#transformers.modeling_outputs.ImageClassifierOutput) æˆ– `tuple(torch.FloatTensor)`

[transformers.modeling_outputs.ImageClassifierOutput](/docs/transformers/v4.37.2/en/main_classes/output#transformers.modeling_outputs.ImageClassifierOutput) æˆ–ä¸€ä¸ª`torch.FloatTensor`å…ƒç»„ï¼ˆå¦‚æœä¼ é€’`return_dict=False`æˆ–`config.return_dict=False`ï¼‰åŒ…å«æ ¹æ®é…ç½®ï¼ˆ[Dinov2Config](/docs/transformers/v4.37.2/en/model_doc/dinov2#transformers.Dinov2Config)ï¼‰å’Œè¾“å…¥çš„ä¸åŒå…ƒç´ ã€‚

+   `loss` (`torch.FloatTensor` of shape `(1,)`, *å¯é€‰çš„*, å½“æä¾›`labels`æ—¶è¿”å›) â€” åˆ†ç±»ï¼ˆå¦‚æœconfig.num_labels==1åˆ™ä¸ºå›å½’ï¼‰æŸå¤±ã€‚

+   `logits` (`torch.FloatTensor` of shape `(batch_size, config.num_labels)`) â€” åˆ†ç±»ï¼ˆå¦‚æœconfig.num_labels==1åˆ™ä¸ºå›å½’ï¼‰å¾—åˆ†ï¼ˆSoftMaxä¹‹å‰ï¼‰ã€‚

+   `hidden_states` (`tuple(torch.FloatTensor)`, *å¯é€‰çš„*, å½“ä¼ é€’`output_hidden_states=True`æˆ–`config.output_hidden_states=True`æ—¶è¿”å›) â€” å½¢çŠ¶ä¸º`(batch_size, sequence_length, hidden_size)`çš„`torch.FloatTensor`å…ƒç»„ï¼ˆå¦‚æœæ¨¡å‹æœ‰åµŒå…¥å±‚ï¼Œåˆ™ä¸ºåµŒå…¥è¾“å‡ºçš„ä¸€ä¸ª + æ¯ä¸ªé˜¶æ®µè¾“å‡ºçš„ä¸€ä¸ªï¼‰ã€‚æ¨¡å‹åœ¨æ¯ä¸ªé˜¶æ®µè¾“å‡ºçš„éšè—çŠ¶æ€ï¼ˆä¹Ÿç§°ä¸ºç‰¹å¾å›¾ï¼‰ã€‚

+   `attentions` (`tuple(torch.FloatTensor)`, *å¯é€‰çš„*, å½“ä¼ é€’`output_attentions=True`æˆ–`config.output_attentions=True`æ—¶è¿”å›) â€” å½¢çŠ¶ä¸º`(batch_size, num_heads, patch_size, sequence_length)`çš„`torch.FloatTensor`å…ƒç»„ï¼ˆæ¯ä¸ªå±‚ä¸€ä¸ªï¼‰ã€‚

    æ³¨æ„åŠ›æƒé‡åœ¨æ³¨æ„åŠ›Softmaxä¹‹åï¼Œç”¨äºè®¡ç®—è‡ªæ³¨æ„åŠ›å¤´ä¸­çš„åŠ æƒå¹³å‡å€¼ã€‚

[Dinov2ForImageClassification](/docs/transformers/v4.37.2/en/model_doc/dinov2#transformers.Dinov2ForImageClassification)çš„å‰å‘æ–¹æ³•ï¼Œè¦†ç›–äº†`__call__`ç‰¹æ®Šæ–¹æ³•ã€‚

è™½ç„¶å‰å‘ä¼ é€’çš„æ­¥éª¤éœ€è¦åœ¨æ­¤å‡½æ•°å†…å®šä¹‰ï¼Œä½†åº”è¯¥åœ¨æ­¤ä¹‹åè°ƒç”¨`Module`å®ä¾‹ï¼Œè€Œä¸æ˜¯è¿™ä¸ªï¼Œå› ä¸ºå‰è€…ä¼šå¤„ç†è¿è¡Œå‰åå¤„ç†æ­¥éª¤ï¼Œè€Œåè€…ä¼šé»˜é»˜åœ°å¿½ç•¥å®ƒä»¬ã€‚

ç¤ºä¾‹ï¼š

```py
>>> from transformers import AutoImageProcessor, Dinov2ForImageClassification
>>> import torch
>>> from datasets import load_dataset

>>> dataset = load_dataset("huggingface/cats-image")
>>> image = dataset["test"]["image"][0]

>>> image_processor = AutoImageProcessor.from_pretrained("facebook/dinov2-small-imagenet1k-1-layer")
>>> model = Dinov2ForImageClassification.from_pretrained("facebook/dinov2-small-imagenet1k-1-layer")

>>> inputs = image_processor(image, return_tensors="pt")

>>> with torch.no_grad():
...     logits = model(**inputs).logits

>>> # model predicts one of the 1000 ImageNet classes
>>> predicted_label = logits.argmax(-1).item()
>>> print(model.config.id2label[predicted_label])
tabby, tabby cat
```
