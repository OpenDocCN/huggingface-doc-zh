# AutoPipeline

> åŸæ–‡ï¼š[https://huggingface.co/docs/diffusers/tutorials/autopipeline](https://huggingface.co/docs/diffusers/tutorials/autopipeline)

ğŸ¤— Diffusersèƒ½å¤Ÿå®Œæˆè®¸å¤šä¸åŒçš„ä»»åŠ¡ï¼Œæ‚¨é€šå¸¸å¯ä»¥é‡å¤ä½¿ç”¨ç›¸åŒçš„é¢„è®­ç»ƒæƒé‡æ¥å®Œæˆå¤šä¸ªä»»åŠ¡ï¼Œå¦‚æ–‡æœ¬åˆ°å›¾åƒã€å›¾åƒåˆ°å›¾åƒå’Œä¿®å¤ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å¯¹åº“å’Œæ‰©æ•£æ¨¡å‹ä¸ç†Ÿæ‚‰ï¼Œå¯èƒ½å¾ˆéš¾çŸ¥é“è¦ä¸ºä»»åŠ¡ä½¿ç”¨å“ªä¸ªç®¡é“ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨[runwayml/stable-diffusion-v1-5](https://huggingface.co/runwayml/stable-diffusion-v1-5)æ£€æŸ¥ç‚¹è¿›è¡Œæ–‡æœ¬åˆ°å›¾åƒï¼Œæ‚¨å¯èƒ½ä¸çŸ¥é“æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨[StableDiffusionImg2ImgPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/stable_diffusion/img2img#diffusers.StableDiffusionImg2ImgPipeline)å’Œ[StableDiffusionInpaintPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/stable_diffusion/inpaint#diffusers.StableDiffusionInpaintPipeline)ç±»åˆ†åˆ«åŠ è½½æ£€æŸ¥ç‚¹è¿›è¡Œå›¾åƒåˆ°å›¾åƒå’Œä¿®å¤ã€‚

`AutoPipeline`ç±»æ—¨åœ¨ç®€åŒ–ğŸ¤— Diffusersä¸­å„ç§ç®¡é“ã€‚å®ƒæ˜¯ä¸€ä¸ªé€šç”¨çš„ã€*ä»»åŠ¡ä¼˜å…ˆ*çš„ç®¡é“ï¼Œè®©æ‚¨ä¸“æ³¨äºä»»åŠ¡ã€‚`AutoPipeline`ä¼šè‡ªåŠ¨æ£€æµ‹è¦ä½¿ç”¨çš„æ­£ç¡®ç®¡é“ç±»ï¼Œè¿™ä½¿å¾—åœ¨ä¸çŸ¥é“ç‰¹å®šç®¡é“ç±»åç§°çš„æƒ…å†µä¸‹ä¸ºä»»åŠ¡åŠ è½½æ£€æŸ¥ç‚¹å˜å¾—æ›´å®¹æ˜“ã€‚

æŸ¥çœ‹[AutoPipeline](../api/pipelines/auto_pipeline)å‚è€ƒä»¥æŸ¥çœ‹æ”¯æŒçš„ä»»åŠ¡ã€‚ç›®å‰ï¼Œå®ƒæ”¯æŒæ–‡æœ¬åˆ°å›¾åƒã€å›¾åƒåˆ°å›¾åƒå’Œä¿®å¤ã€‚

æœ¬æ•™ç¨‹å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨`AutoPipeline`è‡ªåŠ¨æ¨æ–­è¦åŠ è½½çš„ç‰¹å®šä»»åŠ¡çš„ç®¡é“ç±»ï¼Œç»™å®šé¢„è®­ç»ƒæƒé‡ã€‚

## ä¸ºæ‚¨çš„ä»»åŠ¡é€‰æ‹©ä¸€ä¸ªAutoPipeline

é¦–å…ˆé€‰æ‹©ä¸€ä¸ªæ£€æŸ¥ç‚¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å¯¹ä½¿ç”¨[runwayml/stable-diffusion-v1-5](https://huggingface.co/runwayml/stable-diffusion-v1-5)æ£€æŸ¥ç‚¹è¿›è¡Œæ–‡æœ¬åˆ°å›¾åƒæ„Ÿå…´è¶£ï¼Œè¯·ä½¿ç”¨[AutoPipelineForText2Image](/docs/diffusers/v0.26.3/en/api/pipelines/auto_pipeline#diffusers.AutoPipelineForText2Image)ï¼š

```py
from diffusers import AutoPipelineForText2Image
import torch

pipeline = AutoPipelineForText2Image.from_pretrained(
    "runwayml/stable-diffusion-v1-5", torch_dtype=torch.float16, use_safetensors=True
).to("cuda")
prompt = "peasant and dragon combat, wood cutting style, viking era, bevel with rune"

image = pipeline(prompt, num_inference_steps=25).images[0]
image
```

![ç”Ÿæˆçš„å†œæ°‘ä¸é¾™åœ¨æœ¨åˆ»é£æ ¼ä¸­æˆ˜æ–—çš„å›¾åƒ](../Images/6b36788d2ba60d3bbff51fcbbb0d71e8.png)

åœ¨å¹•åï¼Œ[AutoPipelineForText2Image](/docs/diffusers/v0.26.3/en/api/pipelines/auto_pipeline#diffusers.AutoPipelineForText2Image)ï¼š

1.  è‡ªåŠ¨ä»[`model_index.json`](https://huggingface.co/runwayml/stable-diffusion-v1-5/blob/main/model_index.json)æ–‡ä»¶ä¸­æ£€æµ‹åˆ°ä¸€ä¸ª`"stable-diffusion"`ç±»

1.  æ ¹æ®`"stable-diffusion"`ç±»ååŠ è½½ç›¸åº”çš„æ–‡æœ¬åˆ°å›¾åƒ[StableDiffusionPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/stable_diffusion/text2img#diffusers.StableDiffusionPipeline)

åŒæ ·ï¼Œå¯¹äºå›¾åƒåˆ°å›¾åƒï¼Œ[AutoPipelineForImage2Image](/docs/diffusers/v0.26.3/en/api/pipelines/auto_pipeline#diffusers.AutoPipelineForImage2Image)ä¼šä»`model_index.json`æ–‡ä»¶ä¸­æ£€æµ‹åˆ°ä¸€ä¸ª`"stable-diffusion"`æ£€æŸ¥ç‚¹ï¼Œå¹¶åœ¨å¹•ååŠ è½½ç›¸åº”çš„[StableDiffusionImg2ImgPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/stable_diffusion/img2img#diffusers.StableDiffusionImg2ImgPipeline)ã€‚æ‚¨è¿˜å¯ä»¥ä¼ é€’ä»»ä½•ç‰¹å®šäºç®¡é“ç±»çš„å…¶ä»–å‚æ•°ï¼Œå¦‚`strength`ï¼Œå®ƒç¡®å®šæ·»åŠ åˆ°è¾“å…¥å›¾åƒçš„å™ªéŸ³æˆ–å˜åŒ–çš„é‡ï¼š

```py
from diffusers import AutoPipelineForImage2Image
import torch
import requests
from PIL import Image
from io import BytesIO

pipeline = AutoPipelineForImage2Image.from_pretrained(
    "runwayml/stable-diffusion-v1-5",
    torch_dtype=torch.float16,
    use_safetensors=True,
).to("cuda")
prompt = "a portrait of a dog wearing a pearl earring"

url = "https://upload.wikimedia.org/wikipedia/commons/thumb/0/0f/1665_Girl_with_a_Pearl_Earring.jpg/800px-1665_Girl_with_a_Pearl_Earring.jpg"

response = requests.get(url)
image = Image.open(BytesIO(response.content)).convert("RGB")
image.thumbnail((768, 768))

image = pipeline(prompt, image, num_inference_steps=200, strength=0.75, guidance_scale=10.5).images[0]
image
```

![ç”Ÿæˆçš„æˆ´çç è€³ç¯çš„ç‹—çš„ç»´æ¢…å°”è‚–åƒ](../Images/324a523572635d35cf0a7729b6276327.png)

å¦‚æœæ‚¨æƒ³è¦è¿›è¡Œä¿®å¤ï¼Œåˆ™[AutoPipelineForInpainting](/docs/diffusers/v0.26.3/en/api/pipelines/auto_pipeline#diffusers.AutoPipelineForInpainting)ä»¥ç›¸åŒçš„æ–¹å¼åŠ è½½åº•å±‚çš„[StableDiffusionInpaintPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/stable_diffusion/inpaint#diffusers.StableDiffusionInpaintPipeline)ç±»ï¼š

```py
from diffusers import AutoPipelineForInpainting
from diffusers.utils import load_image
import torch

pipeline = AutoPipelineForInpainting.from_pretrained(
    "stabilityai/stable-diffusion-xl-base-1.0", torch_dtype=torch.float16, use_safetensors=True
).to("cuda")

img_url = "https://raw.githubusercontent.com/CompVis/latent-diffusion/main/data/inpainting_examples/overture-creations-5sI6fQgYIuo.png"
mask_url = "https://raw.githubusercontent.com/CompVis/latent-diffusion/main/data/inpainting_examples/overture-creations-5sI6fQgYIuo_mask.png"

init_image = load_image(img_url).convert("RGB")
mask_image = load_image(mask_url).convert("RGB")

prompt = "A majestic tiger sitting on a bench"
image = pipeline(prompt, image=init_image, mask_image=mask_image, num_inference_steps=50, strength=0.80).images[0]
image
```

![ç”Ÿæˆçš„è€è™ååœ¨é•¿æ¤…ä¸Šçš„å›¾åƒ](../Images/0a4e68dcc87ca3b2dd1efff748f52b7d.png)

å¦‚æœå°è¯•åŠ è½½ä¸å—æ”¯æŒçš„æ£€æŸ¥ç‚¹ï¼Œå°†ä¼šæŠ›å‡ºé”™è¯¯ï¼š

```py
from diffusers import AutoPipelineForImage2Image
import torch

pipeline = AutoPipelineForImage2Image.from_pretrained(
    "openai/shap-e-img2img", torch_dtype=torch.float16, use_safetensors=True
)
"ValueError: AutoPipeline can't find a pipeline linked to ShapEImg2ImgPipeline for None"
```

## ä½¿ç”¨å¤šä¸ªç®¡é“

å¯¹äºæŸäº›å·¥ä½œæµç¨‹æˆ–è€…å¦‚æœæ‚¨æ­£åœ¨åŠ è½½è®¸å¤šæµæ°´çº¿ï¼Œæ›´èŠ‚çœå†…å­˜çš„æ–¹æ³•æ˜¯é‡å¤ä½¿ç”¨æ¥è‡ªæ£€æŸ¥ç‚¹çš„ç›¸åŒç»„ä»¶ï¼Œè€Œä¸æ˜¯é‡æ–°åŠ è½½å®ƒä»¬ï¼Œè¿™æ ·ä¼šä¸å¿…è¦åœ°æ¶ˆè€—é¢å¤–çš„å†…å­˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªç”¨äºæ–‡æœ¬åˆ°å›¾åƒçš„æ£€æŸ¥ç‚¹ï¼Œå¹¶ä¸”æƒ³è¦å†æ¬¡ç”¨äºå›¾åƒåˆ°å›¾åƒï¼Œå¯ä»¥ä½¿ç”¨[from_pipe()](/docs/diffusers/v0.26.3/en/api/pipelines/auto_pipeline#diffusers.AutoPipelineForImage2Image.from_pipe)æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä»¥é›¶é¢å¤–å†…å­˜æˆæœ¬ä»å…ˆå‰åŠ è½½çš„æµæ°´çº¿çš„ç»„ä»¶åˆ›å»ºä¸€ä¸ªæ–°çš„æµæ°´çº¿ã€‚

[from_pipe()](/docs/diffusers/v0.26.3/en/api/pipelines/auto_pipeline#diffusers.AutoPipelineForImage2Image.from_pipe)æ–¹æ³•æ£€æµ‹åŸå§‹æµæ°´çº¿ç±»ï¼Œå¹¶å°†å…¶æ˜ å°„åˆ°æ‚¨æƒ³è¦æ‰§è¡Œçš„ä»»åŠ¡å¯¹åº”çš„æ–°æµæ°´çº¿ç±»ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åŠ è½½äº†ä¸€ä¸ªç”¨äºæ–‡æœ¬åˆ°å›¾åƒçš„`"stable-diffusion"`ç±»æµæ°´çº¿ï¼š

```py
from diffusers import AutoPipelineForText2Image, AutoPipelineForImage2Image
import torch

pipeline_text2img = AutoPipelineForText2Image.from_pretrained(
    "runwayml/stable-diffusion-v1-5", torch_dtype=torch.float16, use_safetensors=True
)
print(type(pipeline_text2img))
"<class 'diffusers.pipelines.stable_diffusion.pipeline_stable_diffusion.StableDiffusionPipeline'>"
```

ç„¶å[from_pipe()](/docs/diffusers/v0.26.3/en/api/pipelines/auto_pipeline#diffusers.AutoPipelineForImage2Image.from_pipe)å°†åŸå§‹çš„`"stable-diffusion"`æµæ°´çº¿ç±»æ˜ å°„åˆ°[StableDiffusionImg2ImgPipeline](/docs/diffusers/v0.26.3/en/api/pipelines/stable_diffusion/img2img#diffusers.StableDiffusionImg2ImgPipeline)ï¼š

```py
pipeline_img2img = AutoPipelineForImage2Image.from_pipe(pipeline_text2img)
print(type(pipeline_img2img))
"<class 'diffusers.pipelines.stable_diffusion.pipeline_stable_diffusion_img2img.StableDiffusionImg2ImgPipeline'>"
```

å¦‚æœæ‚¨å‘åŸå§‹æµæ°´çº¿ä¼ é€’äº†ä¸€ä¸ªå¯é€‰å‚æ•° - æ¯”å¦‚ç¦ç”¨å®‰å…¨æ£€æŸ¥å™¨ - è¿™ä¸ªå‚æ•°ä¹Ÿä¼šä¼ é€’ç»™æ–°çš„æµæ°´çº¿ï¼š

```py
from diffusers import AutoPipelineForText2Image, AutoPipelineForImage2Image
import torch

pipeline_text2img = AutoPipelineForText2Image.from_pretrained(
    "runwayml/stable-diffusion-v1-5",
    torch_dtype=torch.float16,
    use_safetensors=True,
    requires_safety_checker=False,
).to("cuda")

pipeline_img2img = AutoPipelineForImage2Image.from_pipe(pipeline_text2img)
print(pipeline_img2img.config.requires_safety_checker)
"False"
```

å¦‚æœæ‚¨æƒ³è¦æ›´æ”¹æ–°æµæ°´çº¿çš„è¡Œä¸ºï¼Œå¯ä»¥è¦†ç›–åŸå§‹æµæ°´çº¿çš„ä»»ä½•å‚æ•°ç”šè‡³é…ç½®ã€‚ä¾‹å¦‚ï¼Œè¦é‡æ–°æ‰“å¼€å®‰å…¨æ£€æŸ¥å™¨å¹¶æ·»åŠ `strength`å‚æ•°ï¼š

```py
pipeline_img2img = AutoPipelineForImage2Image.from_pipe(pipeline_text2img, requires_safety_checker=True, strength=0.3)
print(pipeline_img2img.config.requires_safety_checker)
"True"
```
