# éŸ³é¢‘é¢‘è°±å˜æ¢å™¨

> åŸå§‹æ–‡æœ¬ï¼š[https://huggingface.co/docs/transformers/v4.37.2/en/model_doc/audio-spectrogram-transformer](https://huggingface.co/docs/transformers/v4.37.2/en/model_doc/audio-spectrogram-transformer)

## æ¦‚è¿°

éŸ³é¢‘é¢‘è°±å˜æ¢å™¨æ¨¡å‹æ˜¯ç”± Yuan Gongã€Yu-An Chungã€James Glass åœ¨ [AST: éŸ³é¢‘é¢‘è°±å˜æ¢å™¨](https://arxiv.org/abs/2104.01778) ä¸­æå‡ºçš„ã€‚éŸ³é¢‘é¢‘è°±å˜æ¢å™¨å°†è§†è§‰å˜æ¢å™¨åº”ç”¨äºéŸ³é¢‘ï¼Œé€šè¿‡å°†éŸ³é¢‘è½¬æ¢ä¸ºå›¾åƒï¼ˆé¢‘è°±å›¾ï¼‰ã€‚è¯¥æ¨¡å‹åœ¨éŸ³é¢‘åˆ†ç±»æ–¹é¢å–å¾—äº†æœ€å…ˆè¿›çš„ç»“æœã€‚

è¯¥è®ºæ–‡çš„æ‘˜è¦å¦‚ä¸‹ï¼š

*åœ¨è¿‡å»çš„åå¹´ä¸­ï¼Œå·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰å·²è¢«å¹¿æ³›é‡‡ç”¨ä½œä¸ºç«¯åˆ°ç«¯éŸ³é¢‘åˆ†ç±»æ¨¡å‹çš„ä¸»è¦æ„å»ºæ¨¡å—ï¼Œæ—¨åœ¨å­¦ä¹ ä»éŸ³é¢‘é¢‘è°±åˆ°ç›¸åº”æ ‡ç­¾çš„ç›´æ¥æ˜ å°„ã€‚ä¸ºäº†æ›´å¥½åœ°æ•è·é•¿è·ç¦»å…¨å±€ä¸Šä¸‹æ–‡ï¼Œæœ€è¿‘çš„è¶‹åŠ¿æ˜¯åœ¨ CNN ä¹‹ä¸Šæ·»åŠ è‡ªæ³¨æ„æœºåˆ¶ï¼Œå½¢æˆ CNN-æ³¨æ„æ··åˆæ¨¡å‹ã€‚ç„¶è€Œï¼Œç›®å‰å°šä¸æ¸…æ¥šæ˜¯å¦ä¾èµ–äº CNN æ˜¯å¿…è¦çš„ï¼Œä»¥åŠåŸºäºæ³¨æ„åŠ›çš„ç¥ç»ç½‘ç»œæ˜¯å¦è¶³ä»¥åœ¨éŸ³é¢‘åˆ†ç±»ä¸­è·å¾—è‰¯å¥½çš„æ€§èƒ½ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å¼•å…¥éŸ³é¢‘é¢‘è°±å˜æ¢å™¨ï¼ˆASTï¼‰æ¥å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªæ— å·ç§¯ã€çº¯æ³¨æ„åŠ›çš„éŸ³é¢‘åˆ†ç±»æ¨¡å‹ã€‚æˆ‘ä»¬åœ¨å„ç§éŸ³é¢‘åˆ†ç±»åŸºå‡†ä¸Šè¯„ä¼°äº† ASTï¼Œåœ¨è¿™äº›åŸºå‡†ä¸Šå–å¾—äº†æ–°çš„æœ€å…ˆè¿›ç»“æœï¼šåœ¨ AudioSet ä¸Šçš„ 0.485 mAPï¼Œåœ¨ ESC-50 ä¸Šçš„ 95.6% å‡†ç¡®ç‡ï¼Œä»¥åŠåœ¨ Speech Commands V2 ä¸Šçš„ 98.1% å‡†ç¡®ç‡ã€‚*

![drawing](../Images/9126a01e9659aadbacaabc0894d706f6.png) éŸ³é¢‘é¢‘è°±å˜æ¢å™¨æ¶æ„ã€‚æ‘˜è‡ª[åŸå§‹è®ºæ–‡](https://arxiv.org/abs/2104.01778)ã€‚

è¯¥æ¨¡å‹ç”± [nielsr](https://huggingface.co/nielsr) è´¡çŒ®ã€‚åŸå§‹ä»£ç å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/YuanGongND/ast)æ‰¾åˆ°ã€‚

## ä½¿ç”¨æç¤º

+   åœ¨è‡ªå·±çš„æ•°æ®é›†ä¸Šå¾®è°ƒéŸ³é¢‘é¢‘è°±å˜æ¢å™¨ï¼ˆASTï¼‰æ—¶ï¼Œå»ºè®®è¿›è¡Œè¾“å…¥å½’ä¸€åŒ–å¤„ç†ï¼ˆç¡®ä¿è¾“å…¥çš„å‡å€¼ä¸º 0ï¼Œæ ‡å‡†å·®ä¸º 0.5ï¼‰ã€‚[ASTFeatureExtractor](/docs/transformers/v4.37.2/en/model_doc/audio-spectrogram-transformer#transformers.ASTFeatureExtractor) è´Ÿè´£æ­¤æ“ä½œã€‚è¯·æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒä½¿ç”¨ AudioSet çš„å‡å€¼å’Œæ ‡å‡†å·®ã€‚æ‚¨å¯ä»¥æŸ¥çœ‹[`ast/src/get_norm_stats.py`](https://github.com/YuanGongND/ast/blob/master/src/get_norm_stats.py)æ¥æŸ¥çœ‹ä½œè€…å¦‚ä½•è®¡ç®—ä¸‹æ¸¸æ•°æ®é›†çš„ç»Ÿè®¡ä¿¡æ¯ã€‚

+   è¯·æ³¨æ„ï¼ŒAST éœ€è¦ä¸€ä¸ªè¾ƒä½çš„å­¦ä¹ ç‡ï¼ˆä½œè€…ä½¿ç”¨æ¯”ä»–ä»¬åœ¨ [PSLA è®ºæ–‡](https://arxiv.org/abs/2102.01243) ä¸­æå‡ºçš„ CNN æ¨¡å‹å° 10 å€çš„å­¦ä¹ ç‡ï¼‰ï¼Œå¹¶ä¸”æ”¶æ•›é€Ÿåº¦å¾ˆå¿«ï¼Œå› æ­¤è¯·ä¸ºæ‚¨çš„ä»»åŠ¡æœç´¢ä¸€ä¸ªåˆé€‚çš„å­¦ä¹ ç‡å’Œå­¦ä¹ ç‡è°ƒåº¦å™¨ã€‚

## èµ„æº

ä¸€ä»½å®˜æ–¹ Hugging Face å’Œç¤¾åŒºï¼ˆç”± ğŸŒ è¡¨ç¤ºï¼‰èµ„æºåˆ—è¡¨ï¼Œå¯å¸®åŠ©æ‚¨å¼€å§‹ä½¿ç”¨éŸ³é¢‘é¢‘è°±å˜æ¢å™¨ã€‚

éŸ³é¢‘åˆ†ç±»

+   å¯ä»¥åœ¨[æ­¤å¤„](https://github.com/NielsRogge/Transformers-Tutorials/tree/master/AST)æ‰¾åˆ°ç”¨äºéŸ³é¢‘åˆ†ç±»çš„ AST æ¨ç†çš„ç¬”è®°æœ¬ã€‚

+   [ASTForAudioClassification](/docs/transformers/v4.37.2/en/model_doc/audio-spectrogram-transformer#transformers.ASTForAudioClassification) å—åˆ°è¿™ä¸ª[ç¤ºä¾‹è„šæœ¬](https://github.com/huggingface/transformers/tree/main/examples/pytorch/audio-classification)å’Œ[ç¬”è®°æœ¬](https://colab.research.google.com/github/huggingface/notebooks/blob/main/examples/audio_classification.ipynb)çš„æ”¯æŒã€‚

+   å¦è¯·å‚é˜…ï¼š[éŸ³é¢‘åˆ†ç±»](../tasks/audio_classification)ã€‚

å¦‚æœæ‚¨æœ‰å…´è¶£æäº¤èµ„æºä»¥åŒ…å«åœ¨æ­¤å¤„ï¼Œè¯·éšæ—¶æäº¤æ‹‰å–è¯·æ±‚ï¼Œæˆ‘ä»¬å°†è¿›è¡Œå®¡æŸ¥ï¼èµ„æºåº”è¯¥ç†æƒ³åœ°å±•ç¤ºä¸€äº›æ–°å†…å®¹ï¼Œè€Œä¸æ˜¯é‡å¤ç°æœ‰èµ„æºã€‚

## ASTConfig

### `class transformers.ASTConfig`

[<æ¥æº>](https://github.com/huggingface/transformers/blob/v4.37.2/src/transformers/models/audio_spectrogram_transformer/configuration_audio_spectrogram_transformer.py#L31)

```py
( hidden_size = 768 num_hidden_layers = 12 num_attention_heads = 12 intermediate_size = 3072 hidden_act = 'gelu' hidden_dropout_prob = 0.0 attention_probs_dropout_prob = 0.0 initializer_range = 0.02 layer_norm_eps = 1e-12 patch_size = 16 qkv_bias = True frequency_stride = 10 time_stride = 10 max_length = 1024 num_mel_bins = 128 **kwargs )
```

å‚æ•°

+   `hidden_size` (`int`, *optional*, é»˜è®¤ä¸º768) â€” ç¼–ç å™¨å±‚å’Œæ± åŒ–å™¨å±‚çš„ç»´åº¦ã€‚

+   `num_hidden_layers` (`int`, *optional*, é»˜è®¤ä¸º12) â€” Transformerç¼–ç å™¨ä¸­çš„éšè—å±‚æ•°é‡ã€‚

+   `num_attention_heads` (`int`, *optional*, é»˜è®¤ä¸º12) â€” Transformerç¼–ç å™¨ä¸­æ¯ä¸ªæ³¨æ„åŠ›å±‚çš„æ³¨æ„åŠ›å¤´æ•°é‡ã€‚

+   `intermediate_size` (`int`, *optional*, é»˜è®¤ä¸º3072) â€” Transformerç¼–ç å™¨ä¸­â€œä¸­é—´â€ï¼ˆå³å‰é¦ˆï¼‰å±‚çš„ç»´åº¦ã€‚

+   `hidden_act` (`str`æˆ–`function`, *optional*, é»˜è®¤ä¸º`"gelu"`) â€” ç¼–ç å™¨å’Œæ± åŒ–å™¨ä¸­çš„éçº¿æ€§æ¿€æ´»å‡½æ•°ï¼ˆå‡½æ•°æˆ–å­—ç¬¦ä¸²ï¼‰ã€‚å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œæ”¯æŒ`"gelu"`ã€`"relu"`ã€`"selu"`å’Œ`"gelu_new"`ã€‚

+   `hidden_dropout_prob` (`float`, *optional*, é»˜è®¤ä¸º0.0) â€” åµŒå…¥å±‚ã€ç¼–ç å™¨å’Œæ± åŒ–å™¨ä¸­æ‰€æœ‰å…¨è¿æ¥å±‚çš„ä¸¢å¼ƒæ¦‚ç‡ã€‚

+   `attention_probs_dropout_prob` (`float`, *optional*, é»˜è®¤ä¸º0.0) â€” æ³¨æ„åŠ›æ¦‚ç‡çš„ä¸¢å¼ƒæ¯”ä¾‹ã€‚

+   `initializer_range` (`float`, *optional*, é»˜è®¤ä¸º0.02) â€” ç”¨äºåˆå§‹åŒ–æ‰€æœ‰æƒé‡çŸ©é˜µçš„æˆªæ–­æ­£æ€åˆå§‹åŒ–å™¨çš„æ ‡å‡†å·®ã€‚

+   `layer_norm_eps` (`float`, *optional*, é»˜è®¤ä¸º1e-12) â€” å±‚å½’ä¸€åŒ–å±‚ä½¿ç”¨çš„epsilonã€‚

+   `patch_size` (`int`, *optional*, é»˜è®¤ä¸º16) â€” æ¯ä¸ªå—çš„å¤§å°ï¼ˆåˆ†è¾¨ç‡ï¼‰ã€‚

+   `qkv_bias` (`bool`, *optional*, é»˜è®¤ä¸º`True`) â€” æ˜¯å¦ä¸ºæŸ¥è¯¢ã€é”®å’Œå€¼æ·»åŠ åç½®ã€‚

+   `frequency_stride` (`int`, *optional*, é»˜è®¤ä¸º10) â€” åœ¨åˆ¶ä½œé¢‘è°±å›¾å—æ—¶ä½¿ç”¨çš„é¢‘ç‡æ­¥å¹…ã€‚

+   `time_stride` (`int`, *optional*, é»˜è®¤ä¸º10) â€” åœ¨åˆ¶ä½œé¢‘è°±å›¾å—æ—¶ä½¿ç”¨çš„æ—¶é—´æ­¥å¹…ã€‚

+   `max_length` (`int`, *optional*, é»˜è®¤ä¸º1024) â€” é¢‘è°±å›¾çš„æ—¶é—´ç»´åº¦ã€‚

+   `num_mel_bins` (`int`, *optional*, é»˜è®¤ä¸º128) â€” é¢‘è°±å›¾çš„é¢‘ç‡ç»´åº¦ï¼ˆMelé¢‘ç‡ç®±çš„æ•°é‡ï¼‰ã€‚

è¿™æ˜¯ç”¨äºå­˜å‚¨[ASTModel](/docs/transformers/v4.37.2/en/model_doc/audio-spectrogram-transformer#transformers.ASTModel)é…ç½®çš„é…ç½®ç±»ã€‚å®ƒç”¨äºæ ¹æ®æŒ‡å®šçš„å‚æ•°å®ä¾‹åŒ–ASTæ¨¡å‹ï¼Œå®šä¹‰æ¨¡å‹æ¶æ„ã€‚ä½¿ç”¨é»˜è®¤å€¼å®ä¾‹åŒ–é…ç½®å°†äº§ç”Ÿç±»ä¼¼äºAST [MIT/ast-finetuned-audioset-10-10-0.4593](https://huggingface.co/MIT/ast-finetuned-audioset-10-10-0.4593) æ¶æ„çš„é…ç½®ã€‚

é…ç½®å¯¹è±¡ç»§æ‰¿è‡ª[PretrainedConfig](/docs/transformers/v4.37.2/en/main_classes/configuration#transformers.PretrainedConfig)ï¼Œå¯ç”¨äºæ§åˆ¶æ¨¡å‹è¾“å‡ºã€‚é˜…è¯»[PretrainedConfig](/docs/transformers/v4.37.2/en/main_classes/configuration#transformers.PretrainedConfig)çš„æ–‡æ¡£ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚

ç¤ºä¾‹ï¼š

```py
>>> from transformers import ASTConfig, ASTModel

>>> # Initializing a AST MIT/ast-finetuned-audioset-10-10-0.4593 style configuration
>>> configuration = ASTConfig()

>>> # Initializing a model (with random weights) from the MIT/ast-finetuned-audioset-10-10-0.4593 style configuration
>>> model = ASTModel(configuration)

>>> # Accessing the model configuration
>>> configuration = model.config
```

## ASTFeatureExtractor

### `class transformers.ASTFeatureExtractor`

[<æ¥æº>](https://github.com/huggingface/transformers/blob/v4.37.2/src/transformers/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.py#L39)

```py
( feature_size = 1 sampling_rate = 16000 num_mel_bins = 128 max_length = 1024 padding_value = 0.0 do_normalize = True mean = -4.2677393 std = 4.5689974 return_attention_mask = False **kwargs )
```

å‚æ•°

+   `feature_size` (`int`, *optional*, é»˜è®¤ä¸º1) â€” æå–ç‰¹å¾çš„ç‰¹å¾ç»´åº¦ã€‚

+   `sampling_rate` (`int`, *optional*, é»˜è®¤ä¸º16000) â€” éŸ³é¢‘æ–‡ä»¶åº”æ•°å­—åŒ–çš„é‡‡æ ·ç‡ï¼Œä»¥èµ«å…¹ï¼ˆHzï¼‰è¡¨ç¤ºã€‚

+   `num_mel_bins` (`int`, *optional*, é»˜è®¤ä¸º128) â€” Melé¢‘ç‡ç®±çš„æ•°é‡ã€‚

+   `max_length` (`int`, *optional*, é»˜è®¤ä¸º1024) â€” ç”¨äºå¡«å……/æˆªæ–­æå–ç‰¹å¾çš„æœ€å¤§é•¿åº¦ã€‚

+   `do_normalize` (`bool`, *optional*, é»˜è®¤ä¸º`True`) â€” æ˜¯å¦å½’ä¸€åŒ–å¯¹æ•°Melç‰¹å¾ä½¿ç”¨`mean`å’Œ`std`ã€‚

+   `mean` (`float`, *optional*, é»˜è®¤ä¸º-4.2677393) â€” ç”¨äºå½’ä¸€åŒ–å¯¹æ•°Melç‰¹å¾çš„å‡å€¼ã€‚é»˜è®¤ä½¿ç”¨AudioSetçš„å‡å€¼ã€‚

+   `std`ï¼ˆ`float`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º4.5689974ï¼‰â€” ç”¨äºå½’ä¸€åŒ–log-Melç‰¹å¾çš„æ ‡å‡†å·®å€¼ã€‚é»˜è®¤ä½¿ç”¨AudioSetçš„æ ‡å‡†å·®ã€‚

+   `return_attention_mask`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`False`ï¼‰â€” æ˜¯å¦[`call`()](/docs/transformers/v4.37.2/en/model_doc/audio-spectrogram-transformer#transformers.ASTFeatureExtractor.__call__)åº”è¿”å›`attention_mask`ã€‚

æ„å»ºä¸€ä¸ªéŸ³é¢‘é¢‘è°±å˜æ¢å™¨ï¼ˆASTï¼‰ç‰¹å¾æå–å™¨ã€‚

æ­¤ç‰¹å¾æå–å™¨ç»§æ‰¿è‡ª[SequenceFeatureExtractor](/docs/transformers/v4.37.2/en/main_classes/feature_extractor#transformers.SequenceFeatureExtractor)ï¼Œå…¶ä¸­åŒ…å«å¤§éƒ¨åˆ†ä¸»è¦æ–¹æ³•ã€‚ç”¨æˆ·åº”å‚è€ƒæ­¤è¶…ç±»ä»¥è·å–æœ‰å…³è¿™äº›æ–¹æ³•çš„æ›´å¤šä¿¡æ¯ã€‚

è¿™ä¸ªç±»ä»åŸå§‹è¯­éŸ³ä¸­æå–mel-filter bankç‰¹å¾ï¼Œå¦‚æœå®‰è£…äº†TorchAudioï¼Œåˆ™ä½¿ç”¨TorchAudioï¼Œå¦åˆ™ä½¿ç”¨numpyï¼Œç„¶åå¯¹å®ƒä»¬è¿›è¡Œå¡«å……/æˆªæ–­åˆ°å›ºå®šé•¿åº¦ï¼Œå¹¶ä½¿ç”¨å‡å€¼å’Œæ ‡å‡†å·®è¿›è¡Œå½’ä¸€åŒ–ã€‚

#### `__call__`

[<æ¥æº>](https://github.com/huggingface/transformers/blob/v4.37.2/src/transformers/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.py#L161)

```py
( raw_speech: Union sampling_rate: Optional = None return_tensors: Union = None **kwargs )
```

å‚æ•°

+   `raw_speech`ï¼ˆ`np.ndarray`ï¼Œ`List[float]`ï¼Œ`List[np.ndarray]`ï¼Œ`List[List[float]]`ï¼‰â€” è¦å¡«å……çš„åºåˆ—æˆ–æ‰¹å¤„ç†åºåˆ—ã€‚æ¯ä¸ªåºåˆ—å¯ä»¥æ˜¯ä¸€ä¸ªnumpyæ•°ç»„ï¼Œä¸€ä¸ªæµ®ç‚¹å€¼åˆ—è¡¨ï¼Œä¸€ä¸ªnumpyæ•°ç»„åˆ—è¡¨æˆ–ä¸€ä¸ªæµ®ç‚¹å€¼åˆ—è¡¨çš„åˆ—è¡¨ã€‚å¿…é¡»æ˜¯å•å£°é“éŸ³é¢‘ï¼Œä¸æ˜¯ç«‹ä½“å£°ï¼Œå³æ¯ä¸ªæ—¶é—´æ­¥é•¿ä¸€ä¸ªæµ®ç‚¹æ•°ã€‚

+   `sampling_rate`ï¼ˆ`int`ï¼Œ*å¯é€‰*ï¼‰â€” `raw_speech` è¾“å…¥é‡‡æ ·çš„é‡‡æ ·ç‡ã€‚å¼ºçƒˆå»ºè®®åœ¨å‰å‘è°ƒç”¨æ—¶ä¼ é€’`sampling_rate`ä»¥é˜²æ­¢é™é»˜é”™è¯¯ã€‚

+   `return_tensors`ï¼ˆ`str`æˆ–[TensorType](/docs/transformers/v4.37.2/en/internal/file_utils#transformers.TensorType)ï¼Œ*å¯é€‰*ï¼‰â€” å¦‚æœè®¾ç½®ï¼Œå°†è¿”å›å¼ é‡è€Œä¸æ˜¯Pythonæ•´æ•°åˆ—è¡¨ã€‚å¯æ¥å—çš„å€¼ä¸ºï¼š

    +   `'tf'`ï¼šè¿”å›TensorFlow `tf.constant`å¯¹è±¡ã€‚

    +   `'pt'`ï¼šè¿”å›PyTorch `torch.Tensor`å¯¹è±¡ã€‚

    +   `'np'`ï¼šè¿”å›Numpy `np.ndarray`å¯¹è±¡ã€‚

ç”¨äºå¯¹ä¸€ä¸ªæˆ–å¤šä¸ªåºåˆ—è¿›è¡Œç‰¹å¾åŒ–å’Œå‡†å¤‡æ¨¡å‹çš„ä¸»è¦æ–¹æ³•ã€‚

## ASTModel

### `class transformers.ASTModel`

[<æ¥æº>](https://github.com/huggingface/transformers/blob/v4.37.2/src/transformers/models/audio_spectrogram_transformer/modeling_audio_spectrogram_transformer.py#L430)

```py
( config: ASTConfig )
```

å‚æ•°

+   `config`ï¼ˆ[ASTConfig](/docs/transformers/v4.37.2/en/model_doc/audio-spectrogram-transformer#transformers.ASTConfig)ï¼‰â€” å…·æœ‰æ¨¡å‹æ‰€æœ‰å‚æ•°çš„æ¨¡å‹é…ç½®ç±»ã€‚ä½¿ç”¨é…ç½®æ–‡ä»¶åˆå§‹åŒ–ä¸ä¼šåŠ è½½ä¸æ¨¡å‹å…³è”çš„æƒé‡ï¼Œåªä¼šåŠ è½½é…ç½®ã€‚æŸ¥çœ‹[from_pretrained()](/docs/transformers/v4.37.2/en/main_classes/model#transformers.PreTrainedModel.from_pretrained)æ–¹æ³•ä»¥åŠ è½½æ¨¡å‹æƒé‡ã€‚

è£¸ASTæ¨¡å‹è½¬æ¢å™¨è¾“å‡ºåŸå§‹éšè—çŠ¶æ€ï¼Œæ²¡æœ‰ç‰¹å®šçš„å¤´éƒ¨ã€‚æ­¤æ¨¡å‹æ˜¯PyTorch [torch.nn.Module](https://pytorch.org/docs/stable/nn.html#torch.nn.Module)å­ç±»ã€‚å°†å…¶ç”¨ä½œå¸¸è§„PyTorchæ¨¡å—ï¼Œå¹¶å‚è€ƒPyTorchæ–‡æ¡£ä»¥è·å–æœ‰å…³ä¸€èˆ¬ç”¨æ³•å’Œè¡Œä¸ºçš„æ‰€æœ‰ç›¸å…³ä¿¡æ¯ã€‚

#### `forward`

[<æ¥æº>](https://github.com/huggingface/transformers/blob/v4.37.2/src/transformers/models/audio_spectrogram_transformer/modeling_audio_spectrogram_transformer.py#L458)

```py
( input_values: Optional = None head_mask: Optional = None output_attentions: Optional = None output_hidden_states: Optional = None return_dict: Optional = None ) â†’ export const metadata = 'undefined';transformers.modeling_outputs.BaseModelOutputWithPooling or tuple(torch.FloatTensor)
```

å‚æ•°

+   `input_values` (`torch.FloatTensor` of shape `(batch_size, max_length, num_mel_bins)`) â€” ä»åŸå§‹éŸ³é¢‘æ³¢å½¢ä¸­æå–çš„æµ®ç‚¹å€¼ mel ç‰¹å¾ã€‚åŸå§‹éŸ³é¢‘æ³¢å½¢å¯ä»¥é€šè¿‡å°† `.flac` æˆ– `.wav` éŸ³é¢‘æ–‡ä»¶åŠ è½½åˆ° `List[float]` ç±»å‹çš„æ•°ç»„æˆ– `numpy.ndarray` ä¸­è·å¾—ï¼Œä¾‹å¦‚é€šè¿‡å£°éŸ³æ–‡ä»¶åº“ (`pip install soundfile`)ã€‚è¦å‡†å¤‡å¥½æ•°ç»„ä»¥è·å¾— `input_features`ï¼Œåº”ä½¿ç”¨ [AutoFeatureExtractor](/docs/transformers/v4.37.2/en/model_doc/auto#transformers.AutoFeatureExtractor) æå– mel ç‰¹å¾ï¼Œå¡«å……å¹¶è½¬æ¢ä¸º `torch.FloatTensor` ç±»å‹çš„å¼ é‡ã€‚å‚è§ [`call`()](/docs/transformers/v4.37.2/en/model_doc/audio-spectrogram-transformer#transformers.ASTFeatureExtractor.__call__)

+   `head_mask` (`torch.FloatTensor` of shape `(num_heads,)` or `(num_layers, num_heads)`, *optional*) â€” ç”¨äºä½¿è‡ªæ³¨æ„åŠ›æ¨¡å—ä¸­é€‰æ‹©çš„å¤´éƒ¨å¤±æ•ˆçš„æ©ç ã€‚æ©ç å€¼é€‰åœ¨ `[0, 1]`ï¼š

    +   1 è¡¨ç¤ºå¤´éƒ¨æœªè¢« `æ©ç `ã€‚

    +   0 è¡¨ç¤ºå¤´éƒ¨è¢« `æ©ç `ã€‚

+   `output_attentions` (`bool`, *optional*) â€” æ˜¯å¦è¿”å›æ‰€æœ‰æ³¨æ„åŠ›å±‚çš„æ³¨æ„åŠ›å¼ é‡ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…è¿”å›å¼ é‡ä¸­çš„ `attentions`ã€‚

+   `output_hidden_states` (`bool`, *optional*) â€” æ˜¯å¦è¿”å›æ‰€æœ‰å±‚çš„éšè—çŠ¶æ€ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…è¿”å›å¼ é‡ä¸­çš„ `hidden_states`ã€‚

+   `return_dict` (`bool`, *optional*) â€” æ˜¯å¦è¿”å› [ModelOutput](/docs/transformers/v4.37.2/en/main_classes/output#transformers.utils.ModelOutput) è€Œä¸æ˜¯æ™®é€šå…ƒç»„ã€‚

è¿”å›

[transformers.modeling_outputs.BaseModelOutputWithPooling](/docs/transformers/v4.37.2/en/main_classes/output#transformers.modeling_outputs.BaseModelOutputWithPooling) æˆ– `tuple(torch.FloatTensor)`

[transformers.modeling_outputs.BaseModelOutputWithPooling](/docs/transformers/v4.37.2/en/main_classes/output#transformers.modeling_outputs.BaseModelOutputWithPooling) æˆ–ä¸€ä¸ª `torch.FloatTensor` å…ƒç»„ï¼ˆå¦‚æœä¼ é€’äº† `return_dict=False` æˆ–å½“ `config.return_dict=False` æ—¶ï¼‰åŒ…å«æ ¹æ®é…ç½®ï¼ˆ[ASTConfig](/docs/transformers/v4.37.2/en/model_doc/audio-spectrogram-transformer#transformers.ASTConfig)ï¼‰å’Œè¾“å…¥çš„å„ç§å…ƒç´ ã€‚

+   `last_hidden_state` (`torch.FloatTensor` of shape `(batch_size, sequence_length, hidden_size)`) â€” æ¨¡å‹æœ€åä¸€å±‚çš„éšè—çŠ¶æ€åºåˆ—ã€‚

+   `pooler_output` (`torch.FloatTensor` of shape `(batch_size, hidden_size)`) â€” ç»è¿‡ç”¨äºè¾…åŠ©é¢„è®­ç»ƒä»»åŠ¡çš„å±‚è¿›ä¸€æ­¥å¤„ç†åï¼Œåºåˆ—ç¬¬ä¸€ä¸ªæ ‡è®°ï¼ˆåˆ†ç±»æ ‡è®°ï¼‰çš„æœ€åä¸€å±‚éšè—çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œå¯¹äº BERT ç³»åˆ—æ¨¡å‹ï¼Œè¿™è¿”å›ç»è¿‡çº¿æ€§å±‚å’ŒåŒæ›²æ­£åˆ‡æ¿€æ´»å‡½æ•°å¤„ç†åçš„åˆ†ç±»æ ‡è®°ã€‚çº¿æ€§å±‚çš„æƒé‡æ˜¯åœ¨é¢„è®­ç»ƒæœŸé—´ä»ä¸‹ä¸€ä¸ªå¥å­é¢„æµ‹ï¼ˆåˆ†ç±»ï¼‰ç›®æ ‡ä¸­è®­ç»ƒçš„ã€‚

+   `hidden_states` (`tuple(torch.FloatTensor)`, *optional*, returned when `output_hidden_states=True` is passed or when `config.output_hidden_states=True`) â€” Tuple of `torch.FloatTensor` (one for the output of the embeddings, if the model has an embedding layer, + one for the output of each layer) of shape `(batch_size, sequence_length, hidden_size)`ã€‚

    æ¨¡å‹åœ¨æ¯ä¸€å±‚è¾“å‡ºçš„éšè—çŠ¶æ€ä»¥åŠå¯é€‰çš„åˆå§‹åµŒå…¥è¾“å‡ºã€‚

+   `attentions` (`tuple(torch.FloatTensor)`, *optional*, returned when `output_attentions=True` is passed or when `config.output_attentions=True`) â€” Tuple of `torch.FloatTensor` (one for each layer) of shape `(batch_size, num_heads, sequence_length, sequence_length)`ã€‚

    è‡ªæ³¨æ„åŠ›å¤´éƒ¨ä¸­çš„æ³¨æ„åŠ› softmax åçš„æ³¨æ„åŠ›æƒé‡ï¼Œç”¨äºè®¡ç®—è‡ªæ³¨æ„åŠ›å¤´éƒ¨ä¸­çš„åŠ æƒå¹³å‡å€¼ã€‚

[ASTModel](/docs/transformers/v4.37.2/en/model_doc/audio-spectrogram-transformer#transformers.ASTModel) çš„å‰å‘æ–¹æ³•ï¼Œè¦†ç›–äº† `__call__` ç‰¹æ®Šæ–¹æ³•ã€‚

å°½ç®¡å‰å‘ä¼ é€’çš„é…æ–¹éœ€è¦åœ¨æ­¤å‡½æ•°å†…å®šä¹‰ï¼Œä½†åº”è¯¥åœ¨æ­¤ä¹‹åè°ƒç”¨`Module`å®ä¾‹ï¼Œè€Œä¸æ˜¯è¿™ä¸ªï¼Œå› ä¸ºå‰è€…è´Ÿè´£è¿è¡Œå‰å¤„ç†å’Œåå¤„ç†æ­¥éª¤ï¼Œè€Œåè€…åˆ™é»˜é»˜åœ°å¿½ç•¥å®ƒä»¬ã€‚

ç¤ºä¾‹ï¼š

```py
>>> from transformers import AutoProcessor, ASTModel
>>> import torch
>>> from datasets import load_dataset

>>> dataset = load_dataset("hf-internal-testing/librispeech_asr_demo", "clean", split="validation")
>>> dataset = dataset.sort("id")
>>> sampling_rate = dataset.features["audio"].sampling_rate

>>> processor = AutoProcessor.from_pretrained("MIT/ast-finetuned-audioset-10-10-0.4593")
>>> model = ASTModel.from_pretrained("MIT/ast-finetuned-audioset-10-10-0.4593")

>>> # audio file is decoded on the fly
>>> inputs = processor(dataset[0]["audio"]["array"], sampling_rate=sampling_rate, return_tensors="pt")
>>> with torch.no_grad():
...     outputs = model(**inputs)

>>> last_hidden_states = outputs.last_hidden_state
>>> list(last_hidden_states.shape)
[1, 1214, 768]
```

## ASTForAudioClassification

### `class transformers.ASTForAudioClassification`

[< source >](https://github.com/huggingface/transformers/blob/v4.37.2/src/transformers/models/audio_spectrogram_transformer/modeling_audio_spectrogram_transformer.py#L527)

```py
( config: ASTConfig )
```

å‚æ•°

+   `config`ï¼ˆ[ASTConfig](/docs/transformers/v4.37.2/en/model_doc/audio-spectrogram-transformer#transformers.ASTConfig)ï¼‰â€” æ¨¡å‹é…ç½®ç±»ï¼ŒåŒ…å«æ¨¡å‹çš„æ‰€æœ‰å‚æ•°ã€‚ä½¿ç”¨é…ç½®æ–‡ä»¶åˆå§‹åŒ–ä¸ä¼šåŠ è½½ä¸æ¨¡å‹ç›¸å…³çš„æƒé‡ï¼ŒåªåŠ è½½é…ç½®ã€‚æŸ¥çœ‹[from_pretrained()](/docs/transformers/v4.37.2/en/main_classes/model#transformers.PreTrainedModel.from_pretrained)æ–¹æ³•ä»¥åŠ è½½æ¨¡å‹æƒé‡ã€‚

åœ¨é¡¶éƒ¨å¸¦æœ‰éŸ³é¢‘åˆ†ç±»å¤´éƒ¨çš„éŸ³é¢‘é¢‘è°±å˜æ¢å™¨æ¨¡å‹ï¼ˆåœ¨æ± åŒ–è¾“å‡ºçš„é¡¶éƒ¨æœ‰ä¸€ä¸ªçº¿æ€§å±‚ï¼‰ï¼Œä¾‹å¦‚ç”¨äºAudioSetã€Speech Commands v2ç­‰æ•°æ®é›†ã€‚

è¿™ä¸ªæ¨¡å‹æ˜¯PyTorch [torch.nn.Module](https://pytorch.org/docs/stable/nn.html#torch.nn.Module)çš„å­ç±»ã€‚å°†å…¶ç”¨ä½œå¸¸è§„çš„PyTorchæ¨¡å—ï¼Œå¹¶å‚è€ƒPyTorchæ–‡æ¡£ä»¥è·å–ä¸ä¸€èˆ¬ç”¨æ³•å’Œè¡Œä¸ºç›¸å…³çš„æ‰€æœ‰å†…å®¹ã€‚

#### `forward`

[< source >](https://github.com/huggingface/transformers/blob/v4.37.2/src/transformers/models/audio_spectrogram_transformer/modeling_audio_spectrogram_transformer.py#L547)

```py
( input_values: Optional = None head_mask: Optional = None labels: Optional = None output_attentions: Optional = None output_hidden_states: Optional = None return_dict: Optional = None ) â†’ export const metadata = 'undefined';transformers.modeling_outputs.SequenceClassifierOutput or tuple(torch.FloatTensor)
```

å‚æ•°

+   `input_values`ï¼ˆå½¢çŠ¶ä¸º`(batch_size, max_length, num_mel_bins)`çš„`torch.FloatTensor`ï¼‰â€” ä»åŸå§‹éŸ³é¢‘æ³¢å½¢ä¸­æå–çš„æµ®ç‚¹å€¼melç‰¹å¾ã€‚åŸå§‹éŸ³é¢‘æ³¢å½¢å¯ä»¥é€šè¿‡å°†`.flac`æˆ–`.wav`éŸ³é¢‘æ–‡ä»¶åŠ è½½åˆ°`List[float]`ç±»å‹çš„æ•°ç»„æˆ–`numpy.ndarray`ä¸­è·å¾—ï¼Œä¾‹å¦‚é€šè¿‡soundfileåº“ï¼ˆ`pip install soundfile`ï¼‰ã€‚è¦å‡†å¤‡æ•°ç»„ä¸º`input_features`ï¼Œåº”ä½¿ç”¨[AutoFeatureExtractor](/docs/transformers/v4.37.2/en/model_doc/auto#transformers.AutoFeatureExtractor)æ¥æå–melç‰¹å¾ï¼Œå¡«å……å¹¶è½¬æ¢ä¸º`torch.FloatTensor`ç±»å‹çš„å¼ é‡ã€‚æŸ¥çœ‹[`call`()](/docs/transformers/v4.37.2/en/model_doc/audio-spectrogram-transformer#transformers.ASTFeatureExtractor.__call__)

+   `head_mask`ï¼ˆå½¢çŠ¶ä¸º`(num_heads,)`æˆ–`(num_layers, num_heads)`çš„`torch.FloatTensor`ï¼Œ*å¯é€‰*ï¼‰â€” ç”¨äºä½¿è‡ªæ³¨æ„åŠ›æ¨¡å—ä¸­é€‰æ‹©çš„å¤´éƒ¨å¤±æ•ˆçš„æ©ç ã€‚æ©ç å€¼é€‰åœ¨`[0, 1]`èŒƒå›´å†…ï¼š

    +   1è¡¨ç¤ºå¤´éƒ¨æ˜¯`not masked`ï¼Œ

    +   0è¡¨ç¤ºå¤´éƒ¨æ˜¯`masked`ã€‚

+   `output_attentions`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼‰â€” æ˜¯å¦è¿”å›æ‰€æœ‰æ³¨æ„åŠ›å±‚çš„æ³¨æ„åŠ›å¼ é‡ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§è¿”å›å¼ é‡ä¸‹çš„`attentions`ã€‚

+   `output_hidden_states`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼‰â€” æ˜¯å¦è¿”å›æ‰€æœ‰å±‚çš„éšè—çŠ¶æ€ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§è¿”å›å¼ é‡ä¸‹çš„`hidden_states`ã€‚

+   `return_dict`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼‰â€” æ˜¯å¦è¿”å›ä¸€ä¸ª[ModelOutput](/docs/transformers/v4.37.2/en/main_classes/output#transformers.utils.ModelOutput)è€Œä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„å…ƒç»„ã€‚

+   `labels`ï¼ˆ`torch.LongTensor`ï¼Œå½¢çŠ¶ä¸º`(batch_size,)`ï¼Œ*å¯é€‰*ï¼‰â€” ç”¨äºè®¡ç®—éŸ³é¢‘åˆ†ç±»/å›å½’æŸå¤±çš„æ ‡ç­¾ã€‚ç´¢å¼•åº”åœ¨`[0, ..., config.num_labels - 1]`èŒƒå›´å†…ã€‚å¦‚æœ`config.num_labels == 1`ï¼Œåˆ™è®¡ç®—å›å½’æŸå¤±ï¼ˆå‡æ–¹æŸå¤±ï¼‰ï¼Œå¦‚æœ`config.num_labels > 1`ï¼Œåˆ™è®¡ç®—åˆ†ç±»æŸå¤±ï¼ˆäº¤å‰ç†µï¼‰ã€‚

è¿”å›

[transformers.modeling_outputs.SequenceClassifierOutput](/docs/transformers/v4.37.2/en/main_classes/output#transformers.modeling_outputs.SequenceClassifierOutput)æˆ–`tuple(torch.FloatTensor)`

ä¸€ä¸ª[transformers.modeling_outputs.SequenceClassifierOutput](/docs/transformers/v4.37.2/en/main_classes/output#transformers.modeling_outputs.SequenceClassifierOutput)æˆ–ä¸€ä¸ª`torch.FloatTensor`å…ƒç»„ï¼ˆå¦‚æœä¼ é€’äº†`return_dict=False`æˆ–å½“`config.return_dict=False`æ—¶ï¼‰åŒ…å«æ ¹æ®é…ç½®ï¼ˆ[ASTConfig](/docs/transformers/v4.37.2/en/model_doc/audio-spectrogram-transformer#transformers.ASTConfig)ï¼‰å’Œè¾“å…¥çš„ä¸åŒå…ƒç´ ã€‚

+   `loss`ï¼ˆå½¢çŠ¶ä¸º`(1,)`çš„`torch.FloatTensor`ï¼Œ*å¯é€‰*ï¼Œå½“æä¾›`labels`æ—¶è¿”å›ï¼‰ â€” åˆ†ç±»ï¼ˆå¦‚æœ`config.num_labels==1`åˆ™ä¸ºå›å½’ï¼‰æŸå¤±ã€‚

+   `logits`ï¼ˆå½¢çŠ¶ä¸º`(batch_size, config.num_labels)`çš„`torch.FloatTensor`ï¼‰ â€” åˆ†ç±»ï¼ˆå¦‚æœ`config.num_labels==1`åˆ™ä¸ºå›å½’ï¼‰å¾—åˆ†ï¼ˆåœ¨SoftMaxä¹‹å‰ï¼‰ã€‚

+   `hidden_states`ï¼ˆ`tuple(torch.FloatTensor)`ï¼Œ*å¯é€‰*ï¼Œå½“ä¼ é€’`output_hidden_states=True`æˆ–å½“`config.output_hidden_states=True`æ—¶è¿”å›ï¼‰ â€” å½¢çŠ¶ä¸º`(batch_size, sequence_length, hidden_size)`çš„`torch.FloatTensor`å…ƒç»„ï¼ˆå¦‚æœæ¨¡å‹æœ‰åµŒå…¥å±‚ï¼Œåˆ™ä¸ºåµŒå…¥çš„è¾“å‡º+æ¯å±‚çš„è¾“å‡ºï¼‰ã€‚

    æ¨¡å‹åœ¨æ¯ä¸€å±‚è¾“å‡ºçš„éšè—çŠ¶æ€ä»¥åŠå¯é€‰çš„åˆå§‹åµŒå…¥è¾“å‡ºã€‚

+   `attentions`ï¼ˆ`tuple(torch.FloatTensor)`ï¼Œ*å¯é€‰*ï¼Œå½“ä¼ é€’`output_attentions=True`æˆ–å½“`config.output_attentions=True`æ—¶è¿”å›ï¼‰ â€” å½¢çŠ¶ä¸º`(batch_size, num_heads, sequence_length, sequence_length)`çš„`torch.FloatTensor`å…ƒç»„ï¼ˆæ¯å±‚ä¸€ä¸ªï¼‰ã€‚

    æ³¨æ„åŠ›softmaxåçš„æ³¨æ„åŠ›æƒé‡ï¼Œç”¨äºè®¡ç®—è‡ªæ³¨æ„åŠ›å¤´ä¸­çš„åŠ æƒå¹³å‡å€¼ã€‚

[ASTForAudioClassification](/docs/transformers/v4.37.2/en/model_doc/audio-spectrogram-transformer#transformers.ASTForAudioClassification)çš„å‰å‘æ–¹æ³•ï¼Œè¦†ç›–äº†`__call__`ç‰¹æ®Šæ–¹æ³•ã€‚

å°½ç®¡å‰å‘ä¼ é€’çš„é…æ–¹éœ€è¦åœ¨æ­¤å‡½æ•°å†…å®šä¹‰ï¼Œä½†åº”è¯¥åœ¨æ­¤ä¹‹åè°ƒç”¨`Module`å®ä¾‹ï¼Œè€Œä¸æ˜¯è¿™ä¸ªï¼Œå› ä¸ºå‰è€…è´Ÿè´£è¿è¡Œé¢„å¤„ç†å’Œåå¤„ç†æ­¥éª¤ï¼Œè€Œåè€…åˆ™é»˜é»˜åœ°å¿½ç•¥å®ƒä»¬ã€‚

ç¤ºä¾‹ï¼š

```py
>>> from transformers import AutoFeatureExtractor, ASTForAudioClassification
>>> from datasets import load_dataset
>>> import torch

>>> dataset = load_dataset("hf-internal-testing/librispeech_asr_demo", "clean", split="validation")
>>> dataset = dataset.sort("id")
>>> sampling_rate = dataset.features["audio"].sampling_rate

>>> feature_extractor = AutoFeatureExtractor.from_pretrained("MIT/ast-finetuned-audioset-10-10-0.4593")
>>> model = ASTForAudioClassification.from_pretrained("MIT/ast-finetuned-audioset-10-10-0.4593")

>>> # audio file is decoded on the fly
>>> inputs = feature_extractor(dataset[0]["audio"]["array"], sampling_rate=sampling_rate, return_tensors="pt")

>>> with torch.no_grad():
...     logits = model(**inputs).logits

>>> predicted_class_ids = torch.argmax(logits, dim=-1).item()
>>> predicted_label = model.config.id2label[predicted_class_ids]
>>> predicted_label
'Speech'

>>> # compute loss - target_label is e.g. "down"
>>> target_label = model.config.id2label[0]
>>> inputs["labels"] = torch.tensor([model.config.label2id[target_label]])
>>> loss = model(**inputs).loss
>>> round(loss.item(), 2)
0.17
```
