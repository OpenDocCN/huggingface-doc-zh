# VQModel

> åŸæ–‡é“¾æ¥ï¼š[https://huggingface.co/docs/diffusers/api/models/vq](https://huggingface.co/docs/diffusers/api/models/vq)

VQ-VAEæ¨¡å‹æ˜¯ç”±Aaron van den Oordã€Oriol Vinyalså’ŒKoray Kavukcuogluåœ¨[ç¥ç»ç¦»æ•£è¡¨ç¤ºå­¦ä¹ ](https://huggingface.co/papers/1711.00937)ä¸­å¼•å…¥çš„ã€‚è¯¥æ¨¡å‹ç”¨äºåœ¨ğŸ¤— Diffusersä¸­å°†æ½œåœ¨è¡¨ç¤ºè§£ç ä¸ºå›¾åƒã€‚ä¸[AutoencoderKL](/docs/diffusers/v0.26.3/en/api/models/autoencoderkl#diffusers.AutoencoderKL)ä¸åŒï¼Œ[VQModel](/docs/diffusers/v0.26.3/en/api/models/vq#diffusers.VQModel)åœ¨é‡åŒ–çš„æ½œåœ¨ç©ºé—´ä¸­å·¥ä½œã€‚

è®ºæ–‡æ‘˜è¦å¦‚ä¸‹ï¼š

*åœ¨æ²¡æœ‰ç›‘ç£çš„æƒ…å†µä¸‹å­¦ä¹ æœ‰ç”¨çš„è¡¨ç¤ºä»ç„¶æ˜¯æœºå™¨å­¦ä¹ ä¸­çš„ä¸€ä¸ªå…³é”®æŒ‘æˆ˜ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªç®€å•è€Œå¼ºå¤§çš„ç”Ÿæˆæ¨¡å‹ï¼Œç”¨äºå­¦ä¹ è¿™ç§ç¦»æ•£è¡¨ç¤ºã€‚æˆ‘ä»¬çš„æ¨¡å‹ï¼Œå³çŸ¢é‡é‡åŒ–å˜åˆ†è‡ªåŠ¨ç¼–ç å™¨ï¼ˆVQ-VAEï¼‰ï¼Œä¸VAEåœ¨ä¸¤ä¸ªå…³é”®æ–¹é¢ä¸åŒï¼šç¼–ç å™¨ç½‘ç»œè¾“å‡ºç¦»æ•£è€Œä¸æ˜¯è¿ç»­çš„ä»£ç ï¼›å…ˆéªŒæ˜¯å­¦ä¹ è€Œä¸æ˜¯é™æ€çš„ã€‚ä¸ºäº†å­¦ä¹ ç¦»æ•£çš„æ½œåœ¨è¡¨ç¤ºï¼Œæˆ‘ä»¬èå…¥äº†çŸ¢é‡é‡åŒ–ï¼ˆVQï¼‰çš„æ€æƒ³ã€‚ä½¿ç”¨VQæ–¹æ³•ä½¿æ¨¡å‹èƒ½å¤Ÿé¿å¼€â€œåéªŒåç¼©â€çš„é—®é¢˜â€”â€”å³å½“æ½œåœ¨ç©ºé—´ä¸å¼ºå¤§çš„è‡ªå›å½’è§£ç å™¨é…å¯¹æ—¶ï¼Œé€šå¸¸åœ¨VAEæ¡†æ¶ä¸­è§‚å¯Ÿåˆ°çš„é—®é¢˜ã€‚å°†è¿™äº›è¡¨ç¤ºä¸è‡ªå›å½’å…ˆéªŒé…å¯¹ï¼Œæ¨¡å‹å¯ä»¥ç”Ÿæˆé«˜è´¨é‡çš„å›¾åƒã€è§†é¢‘å’Œè¯­éŸ³ï¼Œä»¥åŠè¿›è¡Œé«˜è´¨é‡çš„è¯´è¯äººè½¬æ¢å’Œæ— ç›‘ç£å­¦ä¹ éŸ³ç´ ï¼Œè¿›ä¸€æ­¥è¯æ˜äº†å­¦ä¹ è¡¨ç¤ºçš„å®ç”¨æ€§ã€‚*

## VQModel

### `class diffusers.VQModel`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/vq_model.py#L40)

```py
( in_channels: int = 3 out_channels: int = 3 down_block_types: Tuple = ('DownEncoderBlock2D',) up_block_types: Tuple = ('UpDecoderBlock2D',) block_out_channels: Tuple = (64,) layers_per_block: int = 1 act_fn: str = 'silu' latent_channels: int = 3 sample_size: int = 32 num_vq_embeddings: int = 256 norm_num_groups: int = 32 vq_embed_dim: Optional = None scaling_factor: float = 0.18215 norm_type: str = 'group' mid_block_add_attention = True lookup_from_codebook = False force_upcast = False )
```

å‚æ•°

+   `in_channels`ï¼ˆintï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º3ï¼‰â€” è¾“å…¥å›¾åƒä¸­çš„é€šé“æ•°ã€‚

+   `out_channels`ï¼ˆintï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º3ï¼‰â€” è¾“å‡ºä¸­çš„é€šé“æ•°ã€‚

+   `down_block_types`ï¼ˆ`Tuple[str]`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`("DownEncoderBlock2D",)`ï¼‰â€” ä¸‹é‡‡æ ·å—ç±»å‹çš„å…ƒç»„ã€‚

+   `up_block_types`ï¼ˆ`Tuple[str]`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`("UpDecoderBlock2D",)`ï¼‰â€” ä¸Šé‡‡æ ·å—ç±»å‹çš„å…ƒç»„ã€‚

+   `block_out_channels`ï¼ˆ`Tuple[int]`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`(64,)`ï¼‰â€” å—è¾“å‡ºé€šé“çš„å…ƒç»„ã€‚

+   `layers_per_block`ï¼ˆ`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`1`ï¼‰â€” æ¯ä¸ªå—çš„å±‚æ•°ã€‚

+   `act_fn`ï¼ˆ`str`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`"silu"`ï¼‰â€” è¦ä½¿ç”¨çš„æ¿€æ´»å‡½æ•°ã€‚

+   `latent_channels`ï¼ˆ`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`3`ï¼‰â€” æ½œåœ¨ç©ºé—´ä¸­çš„é€šé“æ•°ã€‚

+   `sample_size`ï¼ˆ`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`32`ï¼‰â€” æ ·æœ¬è¾“å…¥å¤§å°ã€‚

+   `num_vq_embeddings`ï¼ˆ`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`256`ï¼‰â€” VQ-VAEä¸­ç ä¹¦å‘é‡çš„æ•°é‡ã€‚

+   `norm_num_groups`ï¼ˆ`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`32`ï¼‰â€” è§„èŒƒåŒ–å±‚çš„ç»„æ•°ã€‚

+   `vq_embed_dim`ï¼ˆ`int`ï¼Œ*å¯é€‰*ï¼‰â€” VQ-VAEä¸­ç ä¹¦å‘é‡çš„éšè—ç»´åº¦ã€‚

+   `scaling_factor`ï¼ˆ`float`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`0.18215`ï¼‰â€” ä½¿ç”¨è®­ç»ƒé›†çš„ç¬¬ä¸€æ‰¹è®¡ç®—å‡ºçš„è®­ç»ƒæ½œåœ¨ç©ºé—´çš„åˆ†é‡æ ‡å‡†å·®ã€‚è¿™ç”¨äºåœ¨è®­ç»ƒæ‰©æ•£æ¨¡å‹æ—¶å°†æ½œåœ¨ç©ºé—´ç¼©æ”¾ä¸ºå•ä½æ–¹å·®ã€‚åœ¨ä¼ é€’ç»™æ‰©æ•£æ¨¡å‹ä¹‹å‰ï¼Œæ½œåœ¨ç©ºé—´ä¼šæŒ‰ç…§å…¬å¼`z = z * scaling_factor`è¿›è¡Œç¼©æ”¾ã€‚åœ¨è§£ç æ—¶ï¼Œæ½œåœ¨ç©ºé—´ä¼šæŒ‰ç…§å…¬å¼è¿›è¡Œç¼©æ”¾å›åŸå§‹æ¯”ä¾‹ï¼š`z = 1 / scaling_factor * z`ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[å…·æœ‰æ½œåœ¨æ‰©æ•£æ¨¡å‹çš„é«˜åˆ†è¾¨ç‡å›¾åƒåˆæˆ](https://arxiv.org/abs/2112.10752)è®ºæ–‡çš„4.3.2å’ŒD.1èŠ‚ã€‚

+   `norm_type`ï¼ˆ`str`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`"group"`ï¼‰â€” è¦ä½¿ç”¨çš„è§„èŒƒåŒ–å±‚ç±»å‹ã€‚å¯ä»¥æ˜¯`"group"`æˆ–`"spatial"`ä¹‹ä¸€ã€‚

ç”¨äºè§£ç æ½œåœ¨è¡¨ç¤ºçš„VQ-VAEæ¨¡å‹ã€‚

è¿™ä¸ªæ¨¡å‹ç»§æ‰¿è‡ª[ModelMixin](/docs/diffusers/v0.26.3/en/api/models/overview#diffusers.ModelMixin)ã€‚æ£€æŸ¥è¶…ç±»æ–‡æ¡£ä»¥äº†è§£ä¸ºæ‰€æœ‰æ¨¡å‹å®ç°çš„é€šç”¨æ–¹æ³•ï¼ˆå¦‚ä¸‹è½½æˆ–ä¿å­˜ï¼‰ã€‚

#### `forward`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/vq_model.py#L158)

```py
( sample: FloatTensor return_dict: bool = True ) â†’ export const metadata = 'undefined';VQEncoderOutput or tuple
```

å‚æ•°

+   `sample`ï¼ˆ`torch.FloatTensor`ï¼‰â€” è¾“å…¥æ ·æœ¬ã€‚

+   `return_dict`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`True`ï¼‰â€” æ˜¯å¦è¿”å›ä¸€ä¸ª[models.vq_model.VQEncoderOutput](/docs/diffusers/v0.26.3/en/api/models/vq#diffusers.models.vq_model.VQEncoderOutput)è€Œä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„å…ƒç»„ã€‚

è¿”å›

[VQEncoderOutput](/docs/diffusers/v0.26.3/en/api/models/vq#diffusers.models.vq_model.VQEncoderOutput) æˆ– `tuple`

å¦‚æœreturn_dictä¸ºTrueï¼Œåˆ™è¿”å›ä¸€ä¸ª[VQEncoderOutput](/docs/diffusers/v0.26.3/en/api/models/vq#diffusers.models.vq_model.VQEncoderOutput)ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªæ™®é€šçš„`tuple`ã€‚

[VQModel](/docs/diffusers/v0.26.3/en/api/models/vq#diffusers.VQModel)çš„å‰å‘æ–¹æ³•ã€‚

## VQEncoderOutput

### `class diffusers.models.vq_model.VQEncoderOutput`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/models/vq_model.py#L27)

```py
( latents: FloatTensor )
```

å‚æ•°

+   `latents`ï¼ˆå½¢çŠ¶ä¸º`(batch_size, num_channels, height, width)`çš„`torch.FloatTensor`ï¼‰â€” æ¨¡å‹æœ€åä¸€å±‚çš„ç¼–ç è¾“å‡ºæ ·æœ¬ã€‚

VQModelç¼–ç æ–¹æ³•çš„è¾“å‡ºã€‚
