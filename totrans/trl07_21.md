# ç¤ºä¾‹

> åŸå§‹æ–‡æœ¬ï¼š[`huggingface.co/docs/trl/example_overview`](https://huggingface.co/docs/trl/example_overview)

## ä»‹ç»

è¿™äº›ç¤ºä¾‹åº”è¯¥åœ¨ä»¥ä¸‹ä»»ä½•è®¾ç½®ä¸­è¿è¡Œï¼ˆä½¿ç”¨ç›¸åŒçš„è„šæœ¬ï¼‰ï¼š

+   å• GPU

+   å¤š GPUï¼ˆä½¿ç”¨ PyTorch åˆ†å¸ƒå¼æ¨¡å¼ï¼‰

+   å¤š GPUï¼ˆä½¿ç”¨ DeepSpeed ZeRO-Offload é˜¶æ®µ 1ã€2 å’Œ 3ï¼‰

+   fp16ï¼ˆæ··åˆç²¾åº¦ï¼‰ï¼Œfp32ï¼ˆæ­£å¸¸ç²¾åº¦ï¼‰æˆ– bf16ï¼ˆbfloat16 ç²¾åº¦ï¼‰

è¦åœ¨è¿™äº›ä¸åŒæ¨¡å¼ä¸­è¿è¡Œå®ƒï¼Œè¯·é¦–å…ˆä½¿ç”¨`accelerate config`åˆå§‹åŒ–åŠ é€Ÿé…ç½®

**æ³¨æ„ï¼šè¦è®­ç»ƒ 4 ä½æˆ– 8 ä½æ¨¡å‹ï¼Œè¯·è¿è¡Œ**

```py
pip install --upgrade trl[quantization]
```

## åŠ é€Ÿé…ç½®

å¯¹äºæ‰€æœ‰ç¤ºä¾‹ï¼Œæ‚¨éœ€è¦ç”Ÿæˆä¸€ä¸ªğŸ¤— Accelerate é…ç½®æ–‡ä»¶ï¼š

```py
accelerate config # will prompt you to define the training configuration
```

ç„¶åï¼Œé¼“åŠ±ä½¿ç”¨`accelerate launch`å¯åŠ¨ä½œä¸šï¼

# ç»´æŠ¤çš„ç¤ºä¾‹

| æ–‡ä»¶ | æè¿° |
| --- | --- |
| [`examples/scripts/sft.py`](https://github.com/huggingface/trl/blob/main/examples/scripts/sft.py) | æ­¤è„šæœ¬å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨`SFTTrainer`æ¥å¾®è°ƒæ¨¡å‹æˆ–é€‚é…å™¨ä»¥é€‚åº”ç›®æ ‡æ•°æ®é›†ã€‚ |
| [`examples/scripts/reward_modeling.py`](https://github.com/huggingface/trl/blob/main/examples/scripts/reward_modeling.py) | æ­¤è„šæœ¬å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨`RewardTrainer`æ¥åœ¨æ‚¨è‡ªå·±çš„æ•°æ®é›†ä¸Šè®­ç»ƒå¥–åŠ±æ¨¡å‹ã€‚ |
| [`examples/scripts/ppo.py`](https://github.com/huggingface/trl/blob/main/examples/scripts/ppo.py) | æ­¤è„šæœ¬å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨`PPOTrainer`æ¥ä½¿ç”¨ IMDB æ•°æ®é›†å¾®è°ƒæƒ…æ„Ÿåˆ†ææ¨¡å‹ |
| [`examples/scripts/ppo_multi_adapter.py`](https://github.com/huggingface/trl/blob/main/examples/scripts/ppo_multi_adapter.py) | æ­¤è„šæœ¬å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨`PPOTrainer`æ¥è®­ç»ƒä¸€ä¸ªå¸¦æœ‰å¤šä¸ªé€‚é…å™¨çš„å•ä¸ªåŸºç¡€æ¨¡å‹ã€‚éœ€è¦æ‚¨å…ˆè¿è¡Œå¥–åŠ±æ¨¡å‹è®­ç»ƒçš„ç¤ºä¾‹è„šæœ¬ã€‚ |
| [`examples/scripts/stable_diffusion_tuning_example.py`](https://github.com/huggingface/trl/blob/main/examples/scripts/stable_diffusion_tuning_example.py) | æ­¤è„šæœ¬å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ DDPOTrainer æ¥ä½¿ç”¨å¼ºåŒ–å­¦ä¹ å¾®è°ƒç¨³å®šæ‰©æ•£æ¨¡å‹ã€‚ |

è¿™é‡Œè¿˜æœ‰ä¸€äº›æ›´å®¹æ˜“è¿è¡Œçš„ colab ç¬”è®°æœ¬ï¼Œæ‚¨å¯ä»¥ç”¨æ¥å¼€å§‹ä½¿ç”¨ TRLï¼š

| æ–‡ä»¶ | æè¿° |
| --- | --- |
| [`examples/notebooks/best_of_n.ipynb`](https://github.com/huggingface/trl/tree/main/examples/notebooks/best_of_n.ipynb) | è¯¥ç¬”è®°æœ¬æ¼”ç¤ºäº†åœ¨ä½¿ç”¨ PPO å¾®è°ƒæ¨¡å‹æ—¶å¦‚ä½•ä½¿ç”¨ TRL çš„â€œæœ€ä½³ Nâ€æŠ½æ ·ç­–ç•¥ã€‚ |
| [`examples/notebooks/gpt2-sentiment.ipynb`](https://github.com/huggingface/trl/tree/main/examples/notebooks/gpt2-sentiment.ipynb) | è¯¥ç¬”è®°æœ¬æ¼”ç¤ºäº†å¦‚ä½•åœ¨ jupyter ç¬”è®°æœ¬ä¸Šé‡ç° GPT2 imdb æƒ…æ„Ÿè°ƒæ•´ç¤ºä¾‹ã€‚ |
| [`examples/notebooks/gpt2-control.ipynb`](https://github.com/huggingface/trl/tree/main/examples/notebooks/gpt2-control.ipynb) | è¯¥ç¬”è®°æœ¬æ¼”ç¤ºäº†å¦‚ä½•åœ¨ jupyter ç¬”è®°æœ¬ä¸Šé‡ç° GPT2 æƒ…æ„Ÿæ§åˆ¶ç¤ºä¾‹ã€‚ |

æˆ‘ä»¬è¿˜æœ‰ä¸€äº›å…¶ä»–ç¤ºä¾‹ï¼Œè™½ç„¶ç»´æŠ¤è¾ƒå°‘ï¼Œä½†å¯ä»¥ç”¨ä½œå‚è€ƒï¼š

1.  [research_projects](https://github.com/huggingface/trl/tree/main/examples/research_projects)ï¼šæŸ¥çœ‹æ­¤æ–‡ä»¶å¤¹ä»¥æ‰¾åˆ°ç”¨äºä½¿ç”¨ TRL çš„ä¸€äº›ç ”ç©¶é¡¹ç›®çš„è„šæœ¬ï¼ˆLM å»æ¯’åŒ–ï¼ŒStack-Llama ç­‰ï¼‰

## åˆ†å¸ƒå¼è®­ç»ƒ

é€šè¿‡åœ¨è°ƒç”¨`accelerate launch`æ—¶æä¾›ğŸ¤— Accelerate é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œæ‰€æœ‰è„šæœ¬éƒ½å¯ä»¥åœ¨å¤šä¸ª GPU ä¸Šè¿è¡Œã€‚è¦åœ¨ä¸€ä¸ªæˆ–å¤šä¸ª GPU ä¸Šå¯åŠ¨å…¶ä¸­ä¸€ä¸ªï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆå°†`{NUM_GPUS}`æ›¿æ¢ä¸ºæ‚¨æœºå™¨ä¸Šçš„ GPU æ•°é‡ï¼Œå°†`--all_arguments_of_the_script`æ›¿æ¢ä¸ºæ‚¨çš„å‚æ•°ã€‚ï¼‰

```py
accelerate launch --config_file=examples/accelerate_configs/multi_gpu.yaml --num_processes {NUM_GPUS} path_to_script.py --all_arguments_of_the_script
```

æ‚¨è¿˜å¯ä»¥è°ƒæ•´ğŸ¤— Accelerate é…ç½®æ–‡ä»¶çš„å‚æ•°ä»¥æ»¡è¶³æ‚¨çš„éœ€æ±‚ï¼ˆä¾‹å¦‚åœ¨æ··åˆç²¾åº¦ä¸‹è®­ç»ƒï¼‰ã€‚

### ä½¿ç”¨ DeepSpeed è¿›è¡Œåˆ†å¸ƒå¼è®­ç»ƒ

å¤§å¤šæ•°è„šæœ¬å¯ä»¥ä¸ DeepSpeed ZeRO-{1,2,3}ä¸€èµ·åœ¨å¤šä¸ª GPU ä¸Šè¿è¡Œï¼Œä»¥å®ç°ä¼˜åŒ–å™¨çŠ¶æ€ã€æ¢¯åº¦å’Œæ¨¡å‹æƒé‡çš„æœ‰æ•ˆåˆ†ç‰‡ã€‚è¦è¿™æ ·åšï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆå°†`{NUM_GPUS}`æ›¿æ¢ä¸ºæ‚¨æœºå™¨ä¸Šçš„ GPU æ•°é‡ï¼Œå°†`--all_arguments_of_the_script`æ›¿æ¢ä¸ºæ‚¨çš„å‚æ•°ï¼Œå°†`--deepspeed_config`æ›¿æ¢ä¸º DeepSpeed é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œä¾‹å¦‚`examples/deepspeed_configs/deepspeed_zero1.yaml`ï¼‰ï¼š

```py
accelerate launch --config_file=examples/accelerate_configs/deepspeed_zero{1,2,3}.yaml --num_processes {NUM_GPUS} path_to_script.py --all_arguments_of_the_script
```
