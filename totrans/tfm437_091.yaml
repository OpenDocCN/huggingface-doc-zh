- en: Checks on a Pull Request
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: æ‹‰å–è¯·æ±‚ä¸Šçš„æ£€æŸ¥
- en: 'Original text: [https://huggingface.co/docs/transformers/v4.37.2/en/pr_checks](https://huggingface.co/docs/transformers/v4.37.2/en/pr_checks)'
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: åŸå§‹æ–‡æœ¬ï¼š[https://huggingface.co/docs/transformers/v4.37.2/en/pr_checks](https://huggingface.co/docs/transformers/v4.37.2/en/pr_checks)
- en: null
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: 'When you open a pull request on ğŸ¤— Transformers, a fair number of checks will
    be run to make sure the patch you are adding is not breaking anything existing.
    Those checks are of four types:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: å½“æ‚¨åœ¨ğŸ¤— Transformersä¸Šæ‰“å¼€æ‹‰å–è¯·æ±‚æ—¶ï¼Œå°†è¿è¡Œç›¸å½“å¤šçš„æ£€æŸ¥ï¼Œä»¥ç¡®ä¿æ‚¨æ·»åŠ çš„è¡¥ä¸ä¸ä¼šç ´åä»»ä½•ç°æœ‰å†…å®¹ã€‚è¿™äº›æ£€æŸ¥æœ‰å››ç§ç±»å‹ï¼š
- en: regular tests
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å¸¸è§„æµ‹è¯•
- en: documentation build
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ–‡æ¡£æ„å»º
- en: code and documentation style
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä»£ç å’Œæ–‡æ¡£æ ·å¼
- en: general repository consistency
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ä¸€èˆ¬å­˜å‚¨åº“ä¸€è‡´æ€§
- en: In this document, we will take a stab at explaining what those various checks
    are and the reason behind them, as well as how to debug them locally if one of
    them fails on your PR.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ä»½æ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬å°†å°è¯•è§£é‡Šè¿™äº›å„ç§æ£€æŸ¥æ˜¯ä»€ä¹ˆï¼Œä»¥åŠèƒŒåçš„åŸå› ï¼Œä»¥åŠå¦‚æœå…¶ä¸­ä¸€ä¸ªåœ¨æ‚¨çš„PRä¸Šå¤±è´¥æ—¶å¦‚ä½•åœ¨æœ¬åœ°è°ƒè¯•å®ƒä»¬ã€‚
- en: 'Note that, ideally, they require you to have a dev install:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œå®ƒä»¬è¦æ±‚æ‚¨è¿›è¡Œå¼€å‘å®‰è£…ï¼š
- en: '[PRE0]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'or for an editable install:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ–è€…è¿›è¡Œå¯ç¼–è¾‘å®‰è£…ï¼š
- en: '[PRE1]'
  id: totrans-12
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: inside the Transformers repo. Since the number of optional dependencies of Transformers
    has grown a lot, itâ€™s possible you donâ€™t manage to get all of them. If the dev
    install fails, make sure to install the Deep Learning framework you are working
    with (PyTorch, TensorFlow and/or Flax) then do
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨Transformerså­˜å‚¨åº“å†…ã€‚ç”±äºTransformersçš„å¯é€‰ä¾èµ–é¡¹æ•°é‡å¤§å¤§å¢åŠ ï¼Œæ‚¨å¯èƒ½æ— æ³•è·å¾—æ‰€æœ‰ä¾èµ–é¡¹ã€‚å¦‚æœå¼€å‘å®‰è£…å¤±è´¥ï¼Œè¯·ç¡®ä¿å®‰è£…æ‚¨æ­£åœ¨ä½¿ç”¨çš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼ˆPyTorchã€TensorFlowå’Œ/æˆ–Flaxï¼‰ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
- en: '[PRE2]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'or for an editable install:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: æˆ–è€…è¿›è¡Œå¯ç¼–è¾‘å®‰è£…ï¼š
- en: '[PRE3]'
  id: totrans-16
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Tests
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æµ‹è¯•
- en: 'All the jobs that begin with `ci/circleci: run_tests_` run parts of the Transformers
    testing suite. Each of those jobs focuses on a part of the library in a certain
    environment: for instance `ci/circleci: run_tests_pipelines_tf` runs the pipelines
    test in an environment where TensorFlow only is installed.'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 'æ‰€æœ‰ä»¥`ci/circleci: run_tests_`å¼€å¤´çš„ä½œä¸šéƒ½è¿è¡ŒTransformersæµ‹è¯•å¥—ä»¶çš„éƒ¨åˆ†ã€‚è¿™äº›ä½œä¸šä¸­çš„æ¯ä¸€ä¸ªéƒ½ä¸“æ³¨äºåº“çš„æŸä¸ªéƒ¨åˆ†åœ¨ç‰¹å®šç¯å¢ƒä¸­è¿è¡Œï¼šä¾‹å¦‚ï¼Œ`ci/circleci:
    run_tests_pipelines_tf`åœ¨ä»…å®‰è£…TensorFlowçš„ç¯å¢ƒä¸­è¿è¡Œpipelinesæµ‹è¯•ã€‚'
- en: 'Note that to avoid running tests when there is no real change in the modules
    they are testing, only part of the test suite is run each time: a utility is run
    to determine the differences in the library between before and after the PR (what
    GitHub shows you in the â€œFiles changesâ€ tab) and picks the tests impacted by that
    diff. That utility can be run locally with:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ï¼Œä¸ºäº†é¿å…åœ¨æµ‹è¯•çš„æ¨¡å—ä¸­æ²¡æœ‰çœŸæ­£æ›´æ”¹æ—¶è¿è¡Œæµ‹è¯•ï¼Œæ¯æ¬¡åªè¿è¡Œæµ‹è¯•å¥—ä»¶çš„ä¸€éƒ¨åˆ†ï¼šè¿è¡Œä¸€ä¸ªå®ç”¨ç¨‹åºæ¥ç¡®å®šåº“ä¸­çš„å·®å¼‚åœ¨PRä¹‹å‰å’Œä¹‹åï¼ˆGitHubåœ¨â€œæ–‡ä»¶æ›´æ”¹â€é€‰é¡¹å¡ä¸­æ˜¾ç¤ºç»™æ‚¨çš„å†…å®¹ï¼‰ï¼Œå¹¶é€‰æ‹©å—è¯¥å·®å¼‚å½±å“çš„æµ‹è¯•ã€‚è¯¥å®ç”¨ç¨‹åºå¯ä»¥åœ¨æœ¬åœ°è¿è¡Œï¼š
- en: '[PRE4]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'from the root of the Transformers repo. It will:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: ä»Transformerså­˜å‚¨åº“çš„æ ¹ç›®å½•å¼€å§‹ã€‚å®ƒå°†ï¼š
- en: Check for each file in the diff if the changes are in the code or only in comments
    or docstrings. Only the files with real code changes are kept.
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ£€æŸ¥å·®å¼‚ä¸­çš„æ¯ä¸ªæ–‡ä»¶ï¼Œçœ‹çœ‹æ›´æ”¹æ˜¯åœ¨ä»£ç ä¸­è¿˜æ˜¯ä»…åœ¨æ³¨é‡Šæˆ–æ–‡æ¡£å­—ç¬¦ä¸²ä¸­ã€‚åªä¿ç•™å…·æœ‰çœŸå®ä»£ç æ›´æ”¹çš„æ–‡ä»¶ã€‚
- en: Build an internal map that gives for each file of the source code of the library
    all the files it recursively impacts. Module A is said to impact module B if module
    B imports module A. For the recursive impact, we need a chain of modules going
    from module A to module B in which each module imports the previous one.
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: æ„å»ºä¸€ä¸ªå†…éƒ¨æ˜ å°„ï¼Œä¸ºåº“æºä»£ç çš„æ¯ä¸ªæ–‡ä»¶æä¾›é€’å½’å½±å“çš„æ‰€æœ‰æ–‡ä»¶åˆ—è¡¨ã€‚å¦‚æœæ¨¡å—Bå¯¼å…¥æ¨¡å—Aï¼Œåˆ™æ¨¡å—Aè¢«è®¤ä¸ºå½±å“æ¨¡å—Bã€‚å¯¹äºé€’å½’å½±å“ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªä»æ¨¡å—Aåˆ°æ¨¡å—Bçš„æ¨¡å—é“¾ï¼Œå…¶ä¸­æ¯ä¸ªæ¨¡å—å¯¼å…¥å‰ä¸€ä¸ªæ¨¡å—ã€‚
- en: Apply this map on the files gathered in step 1, which gives us the list of model
    files impacted by the PR.
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å°†æ­¤æ˜ å°„åº”ç”¨äºç¬¬1æ­¥ä¸­æ”¶é›†çš„æ–‡ä»¶ï¼Œè¿™ç»™å‡ºäº†PRå½±å“çš„æ¨¡å‹æ–‡ä»¶åˆ—è¡¨ã€‚
- en: Map each of those files to their corresponding test file(s) and get the list
    of tests to run.
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: å°†è¿™äº›æ–‡ä»¶æ˜ å°„åˆ°å®ƒä»¬å¯¹åº”çš„æµ‹è¯•æ–‡ä»¶ï¼Œå¹¶è·å–è¦è¿è¡Œçš„æµ‹è¯•åˆ—è¡¨ã€‚
- en: 'When executing the script locally, you should get the results of step 1, 3
    and 4 printed and thus know which tests are run. The script will also create a
    file named `test_list.txt` which contains the list of tests to run, and you can
    run them locally with the following command:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨æœ¬åœ°æ‰§è¡Œè„šæœ¬æ—¶ï¼Œæ‚¨åº”è¯¥å¾—åˆ°æ­¥éª¤1ã€3å’Œ4çš„ç»“æœæ‰“å°å‡ºæ¥ï¼Œä»è€ŒçŸ¥é“è¿è¡Œå“ªäº›æµ‹è¯•ã€‚è¯¥è„šæœ¬è¿˜å°†åˆ›å»ºä¸€ä¸ªåä¸º`test_list.txt`çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«è¦è¿è¡Œçš„æµ‹è¯•åˆ—è¡¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨æœ¬åœ°è¿è¡Œå®ƒä»¬ï¼š
- en: '[PRE5]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Just in case anything slipped through the cracks, the full test suite is also
    run daily.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: ä»¥é˜²æœ‰ä»»ä½•é—æ¼ï¼Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶ä¹Ÿä¼šæ¯å¤©è¿è¡Œã€‚
- en: Documentation build
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: æ–‡æ¡£æ„å»º
- en: The `build_pr_documentation` job builds and generates a preview of the documentation
    to make sure everything looks okay once your PR is merged. A bot will add a link
    to preview the documentation in your PR. Any changes you make to the PR are automatically
    updated in the preview. If the documentation fails to build, click on **Details**
    next to the failed job to see where things went wrong. Often, the error is as
    simple as a missing file in the `toctree`.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '`build_pr_documentation`ä½œä¸šæ„å»ºå¹¶ç”Ÿæˆæ–‡æ¡£é¢„è§ˆï¼Œä»¥ç¡®ä¿ä¸€åˆ‡åœ¨åˆå¹¶æ‚¨çš„PRåçœ‹èµ·æ¥éƒ½æ²¡é—®é¢˜ã€‚æœºå™¨äººå°†åœ¨æ‚¨çš„PRä¸­æ·»åŠ ä¸€ä¸ªé¢„è§ˆæ–‡æ¡£çš„é“¾æ¥ã€‚æ‚¨å¯¹PRæ‰€åšçš„ä»»ä½•æ›´æ”¹éƒ½ä¼šè‡ªåŠ¨æ›´æ–°åˆ°é¢„è§ˆä¸­ã€‚å¦‚æœæ–‡æ¡£æ„å»ºå¤±è´¥ï¼Œè¯·ç‚¹å‡»å¤±è´¥ä½œä¸šæ—è¾¹çš„**è¯¦ç»†ä¿¡æ¯**ï¼ŒæŸ¥çœ‹å‡ºäº†ä»€ä¹ˆé—®é¢˜ã€‚é€šå¸¸ï¼Œé”™è¯¯å¯èƒ½åªæ˜¯`toctree`ä¸­ç¼ºå°‘æ–‡ä»¶ã€‚'
- en: If youâ€™re interested in building or previewing the documentation locally, take
    a look at the [`README.md`](https://github.com/huggingface/transformers/tree/main/docs)
    in the docs folder.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ‚¨æœ‰å…´è¶£åœ¨æœ¬åœ°æ„å»ºæˆ–é¢„è§ˆæ–‡æ¡£ï¼Œè¯·æŸ¥çœ‹æ–‡æ¡£æ–‡ä»¶å¤¹ä¸­çš„[`README.md`](https://github.com/huggingface/transformers/tree/main/docs)ã€‚
- en: Code and documentation style
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: ä»£ç å’Œæ–‡æ¡£æ ·å¼
- en: Code formatting is applied to all the source files, the examples and the tests
    using `black` and `ruff`. We also have a custom tool taking care of the formatting
    of docstrings and `rst` files (`utils/style_doc.py`), as well as the order of
    the lazy imports performed in the Transformers `__init__.py` files (`utils/custom_init_isort.py`).
    All of this can be launched by executing
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: å¯¹æ‰€æœ‰æºæ–‡ä»¶ã€ç¤ºä¾‹å’Œæµ‹è¯•åº”ç”¨ä»£ç æ ¼å¼åŒ–ï¼Œä½¿ç”¨`black`å’Œ`ruff`ã€‚æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªè‡ªå®šä¹‰å·¥å…·è´Ÿè´£æ ¼å¼åŒ–æ–‡æ¡£å­—ç¬¦ä¸²å’Œ`rst`æ–‡ä»¶ï¼ˆ`utils/style_doc.py`ï¼‰ï¼Œä»¥åŠTransformers
    `__init__.py`æ–‡ä»¶ä¸­æ‰§è¡Œçš„å»¶è¿Ÿå¯¼å…¥é¡ºåºï¼ˆ`utils/custom_init_isort.py`ï¼‰ã€‚æ‰€æœ‰è¿™äº›éƒ½å¯ä»¥é€šè¿‡æ‰§è¡Œæ¥å¯åŠ¨
- en: '[PRE6]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The CI checks those have been applied inside the `ci/circleci: check_code_quality`
    check. It also runs `ruff`, that will have a basic look at your code and will
    complain if it finds an undefined variable, or one that is not used. To run that
    check locally, use'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 'CIæ£€æŸ¥è¿™äº›å·²åº”ç”¨äº`ci/circleci: check_code_quality`æ£€æŸ¥ä¸­ã€‚å®ƒè¿˜è¿è¡Œ`ruff`ï¼Œå®ƒå°†åŸºæœ¬æŸ¥çœ‹æ‚¨çš„ä»£ç ï¼Œå¹¶åœ¨æ‰¾åˆ°æœªå®šä¹‰çš„å˜é‡æˆ–æœªä½¿ç”¨çš„å˜é‡æ—¶å‘å‡ºæŠ•è¯‰ã€‚è¦åœ¨æœ¬åœ°è¿è¡Œè¯¥æ£€æŸ¥ï¼Œè¯·ä½¿ç”¨'
- en: '[PRE7]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: This can take a lot of time, so to run the same thing on only the files you
    modified in the current branch, run
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™å¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œå› æ­¤è¦ä»…å¯¹å½“å‰åˆ†æ”¯ä¸­ä¿®æ”¹çš„æ–‡ä»¶è¿è¡Œç›¸åŒçš„æ“ä½œï¼Œè¯·è¿è¡Œ
- en: '[PRE8]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: This last command will also run all the additional checks for the repository
    consistency. Letâ€™s have a look at them.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªæœ€åçš„å‘½ä»¤ä¹Ÿå°†è¿è¡Œæ‰€æœ‰é¢å¤–çš„æ£€æŸ¥ï¼Œä»¥ç¡®ä¿å­˜å‚¨åº“çš„ä¸€è‡´æ€§ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒä»¬ã€‚
- en: Repository consistency
  id: totrans-40
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: å­˜å‚¨åº“çš„ä¸€è‡´æ€§
- en: 'This regroups all the tests to make sure your PR leaves the repository in a
    good state, and is performed by the `ci/circleci: check_repository_consistency`
    check. You can locally run that check by executing the following:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 'è¿™å°†æ±‡æ€»æ‰€æœ‰æµ‹è¯•ï¼Œä»¥ç¡®ä¿æ‚¨çš„PRä½¿å­˜å‚¨åº“ä¿æŒè‰¯å¥½çŠ¶æ€ï¼Œå¹¶ç”±`ci/circleci: check_repository_consistency`æ£€æŸ¥æ‰§è¡Œã€‚æ‚¨å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹æ“ä½œåœ¨æœ¬åœ°è¿è¡Œè¯¥æ£€æŸ¥ï¼š'
- en: '[PRE9]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'This checks that:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™äº›æ£€æŸ¥åŒ…æ‹¬ï¼š
- en: All objects added to the init are documented (performed by `utils/check_repo.py`)
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ‰€æœ‰æ·»åŠ åˆ°initä¸­çš„å¯¹è±¡éƒ½æœ‰æ–‡æ¡£è®°å½•ï¼ˆç”±`utils/check_repo.py`æ‰§è¡Œï¼‰
- en: All `__init__.py` files have the same content in their two sections (performed
    by `utils/check_inits.py`)
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ‰€æœ‰`__init__.py`æ–‡ä»¶åœ¨å…¶ä¸¤ä¸ªéƒ¨åˆ†ä¸­å…·æœ‰ç›¸åŒçš„å†…å®¹ï¼ˆç”±`utils/check_inits.py`æ‰§è¡Œï¼‰
- en: All code identified as a copy from another module is consistent with the original
    (performed by `utils/check_copies.py`)
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ‰€æœ‰è¢«è¯†åˆ«ä¸ºä»å¦ä¸€ä¸ªæ¨¡å—å¤åˆ¶çš„ä»£ç ä¸åŸå§‹ä»£ç ä¸€è‡´ï¼ˆç”±`utils/check_copies.py`æ‰§è¡Œï¼‰
- en: All configuration classes have at least one valid checkpoint mentioned in their
    docstrings (performed by `utils/check_config_docstrings.py`)
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ‰€æœ‰é…ç½®ç±»åœ¨å…¶docstringsä¸­è‡³å°‘æåˆ°ä¸€ä¸ªæœ‰æ•ˆçš„æ£€æŸ¥ç‚¹ï¼ˆç”±`utils/check_config_docstrings.py`æ‰§è¡Œï¼‰
- en: All configuration classes only contain attributes that are used in corresponding
    modeling files (performed by `utils/check_config_attributes.py`)
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ‰€æœ‰é…ç½®ç±»åªåŒ…å«åœ¨ç›¸åº”å»ºæ¨¡æ–‡ä»¶ä¸­ä½¿ç”¨çš„å±æ€§ï¼ˆç”±`utils/check_config_attributes.py`æ‰§è¡Œï¼‰
- en: The translations of the READMEs and the index of the doc have the same model
    list as the main README (performed by `utils/check_copies.py`)
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: READMEå’Œæ–‡æ¡£ç´¢å¼•çš„ç¿»è¯‘ä¸ä¸»READMEä¸­çš„æ¨¡å‹åˆ—è¡¨ç›¸åŒï¼ˆç”±`utils/check_copies.py`æ‰§è¡Œï¼‰
- en: The auto-generated tables in the documentation are up to date (performed by
    `utils/check_table.py`)
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ–‡æ¡£ä¸­çš„è‡ªåŠ¨ç”Ÿæˆè¡¨æ˜¯æœ€æ–°çš„ï¼ˆç”±`utils/check_table.py`æ‰§è¡Œï¼‰
- en: The library has all objects available even if not all optional dependencies
    are installed (performed by `utils/check_dummies.py`)
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: å³ä½¿æ²¡æœ‰å®‰è£…æ‰€æœ‰å¯é€‰ä¾èµ–é¡¹ï¼Œåº“ä¸­ä»æœ‰æ‰€æœ‰å¯¹è±¡å¯ç”¨ï¼ˆç”±`utils/check_dummies.py`æ‰§è¡Œï¼‰
- en: All docstrings properly document the arguments in the signature of the object
    (performed by `utils/check_docstrings.py`)
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ‰€æœ‰docstringséƒ½æ­£ç¡®è®°å½•äº†å¯¹è±¡ç­¾åä¸­çš„å‚æ•°ï¼ˆç”±`utils/check_docstrings.py`æ‰§è¡Œï¼‰
- en: Should this check fail, the first two items require manual fixing, the last
    four can be fixed automatically for you by running the command
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ­¤æ£€æŸ¥å¤±è´¥ï¼Œå‰ä¸¤é¡¹éœ€è¦æ‰‹åŠ¨ä¿®å¤ï¼Œæœ€åå››é¡¹å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤è‡ªåŠ¨ä¿®å¤
- en: '[PRE10]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Additional checks concern PRs that add new models, mainly that:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: é¢å¤–çš„æ£€æŸ¥æ¶‰åŠæ·»åŠ æ–°æ¨¡å‹çš„PRï¼Œä¸»è¦æ˜¯ï¼š
- en: All models added are in an Auto-mapping (performed by `utils/check_repo.py`)
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ‰€æœ‰æ·»åŠ çš„æ¨¡å‹éƒ½åœ¨Auto-mappingä¸­ï¼ˆç”±`utils/check_repo.py`æ‰§è¡Œï¼‰
- en: All models are properly tested (performed by `utils/check_repo.py`)
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: æ‰€æœ‰æ¨¡å‹éƒ½ç»è¿‡é€‚å½“çš„æµ‹è¯•ï¼ˆç”±`utils/check_repo.py`æ‰§è¡Œï¼‰
- en: Check copies
  id: totrans-58
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: æ£€æŸ¥å‰¯æœ¬
- en: Since the Transformers library is very opinionated with respect to model code,
    and each model should fully be implemented in a single file without relying on
    other models, we have added a mechanism that checks whether a copy of the code
    of a layer of a given model stays consistent with the original. This way, when
    there is a bug fix, we can see all other impacted models and choose to trickle
    down the modification or break the copy.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: ç”±äºTransformersåº“åœ¨æ¨¡å‹ä»£ç æ–¹é¢éå¸¸æœ‰ä¸»è§ï¼Œæ¯ä¸ªæ¨¡å‹åº”è¯¥å®Œå…¨åœ¨å•ä¸ªæ–‡ä»¶ä¸­å®ç°ï¼Œè€Œä¸ä¾èµ–äºå…¶ä»–æ¨¡å‹ï¼Œå› æ­¤æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªæœºåˆ¶ï¼Œæ£€æŸ¥ç»™å®šæ¨¡å‹çš„å±‚çš„ä»£ç å‰¯æœ¬æ˜¯å¦ä¸åŸå§‹ä»£ç ä¿æŒä¸€è‡´ã€‚è¿™æ ·ï¼Œå½“æœ‰bugä¿®å¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰€æœ‰å…¶ä»–å—å½±å“çš„æ¨¡å‹ï¼Œå¹¶é€‰æ‹©å°†ä¿®æ”¹ä¼ é€’ä¸‹å»æˆ–æ‰“ç ´å‰¯æœ¬ã€‚
- en: If a file is a full copy of another file, you should register it in the constant
    `FULL_COPIES` of `utils/check_copies.py`.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœä¸€ä¸ªæ–‡ä»¶æ˜¯å¦ä¸€ä¸ªæ–‡ä»¶çš„å®Œå…¨å‰¯æœ¬ï¼Œæ‚¨åº”è¯¥åœ¨`utils/check_copies.py`çš„å¸¸é‡`FULL_COPIES`ä¸­æ³¨å†Œå®ƒã€‚
- en: 'This mechanism relies on comments of the form `# Copied from xxx`. The `xxx`
    should contain the whole path to the class of function which is being copied below.
    For instance, `RobertaSelfOutput` is a direct copy of the `BertSelfOutput` class,
    so you can see [here](https://github.com/huggingface/transformers/blob/2bd7a27a671fd1d98059124024f580f8f5c0f3b5/src/transformers/models/roberta/modeling_roberta.py#L289)
    it has a comment:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: è¿™ä¸ªæœºåˆ¶ä¾èµ–äºå½¢å¼ä¸º`# Copied from xxx`çš„æ³¨é‡Šã€‚`xxx`åº”åŒ…å«è¢«å¤åˆ¶çš„ç±»æˆ–å‡½æ•°çš„å®Œæ•´è·¯å¾„ï¼Œè¯¥ç±»æˆ–å‡½æ•°è¢«å¤åˆ¶åœ¨ä¸‹é¢ã€‚ä¾‹å¦‚ï¼Œ`RobertaSelfOutput`æ˜¯`BertSelfOutput`ç±»çš„ç›´æ¥å‰¯æœ¬ï¼Œå› æ­¤æ‚¨å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/huggingface/transformers/blob/2bd7a27a671fd1d98059124024f580f8f5c0f3b5/src/transformers/models/roberta/modeling_roberta.py#L289)çœ‹åˆ°å®ƒæœ‰ä¸€ä¸ªæ³¨é‡Šï¼š
- en: '[PRE11]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Note that instead of applying this to a whole class, you can apply it to the
    relevant methods that are copied from. For instance [here](https://github.com/huggingface/transformers/blob/2bd7a27a671fd1d98059124024f580f8f5c0f3b5/src/transformers/models/roberta/modeling_roberta.py#L598)
    you can see how `RobertaPreTrainedModel._init_weights` is copied from the same
    method in `BertPreTrainedModel` with the comment:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥å°†æ­¤åº”ç”¨äºæ•´ä¸ªç±»ï¼Œä¹Ÿå¯ä»¥å°†å…¶åº”ç”¨äºä»ä¸­å¤åˆ¶çš„ç›¸å…³æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œåœ¨[è¿™é‡Œ](https://github.com/huggingface/transformers/blob/2bd7a27a671fd1d98059124024f580f8f5c0f3b5/src/transformers/models/roberta/modeling_roberta.py#L598)ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°`RobertaPreTrainedModel._init_weights`æ˜¯ä»`BertPreTrainedModel`ä¸­çš„ç›¸åŒæ–¹æ³•å¤åˆ¶çš„ï¼Œå¹¶å¸¦æœ‰æ³¨é‡Šï¼š
- en: '[PRE12]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Sometimes the copy is exactly the same except for names: for instance in `RobertaAttention`,
    we use `RobertaSelfAttention` insted of `BertSelfAttention` but other than that,
    the code is exactly the same. This is why `# Copied from` supports simple string
    replacements with the follwoing syntax: `Copied from xxx with foo->bar`. This
    means the code is copied with all instances of `foo` being replaced by `bar`.
    You can see how it used [here](https://github.com/huggingface/transformers/blob/2bd7a27a671fd1d98059124024f580f8f5c0f3b5/src/transformers/models/roberta/modeling_roberta.py#L304C1-L304C86)
    in `RobertaAttention` with the comment:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: æœ‰æ—¶å‰¯æœ¬å®Œå…¨ç›¸åŒï¼Œé™¤äº†åç§°ï¼šä¾‹å¦‚ï¼Œåœ¨`RobertaAttention`ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`RobertaSelfAttention`è€Œä¸æ˜¯`BertSelfAttention`ï¼Œä½†é™¤æ­¤ä¹‹å¤–ï¼Œä»£ç å®Œå…¨ç›¸åŒã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ`#
    Copied from`æ”¯æŒç®€å•çš„å­—ç¬¦ä¸²æ›¿æ¢ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š`Copied from xxx with foo->bar`ã€‚è¿™æ„å‘³ç€ä»£ç è¢«å¤åˆ¶ï¼Œæ‰€æœ‰`foo`çš„å®ä¾‹éƒ½è¢«æ›¿æ¢ä¸º`bar`ã€‚æ‚¨å¯ä»¥åœ¨`RobertaAttention`ä¸­çœ‹åˆ°å®ƒæ˜¯å¦‚ä½•ä½¿ç”¨çš„[è¿™é‡Œ](https://github.com/huggingface/transformers/blob/2bd7a27a671fd1d98059124024f580f8f5c0f3b5/src/transformers/models/roberta/modeling_roberta.py#L304C1-L304C86)ã€‚
- en: '[PRE13]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Note that there shouldnâ€™t be any spaces around the arrow (unless that space
    is part of the pattern to replace of course).
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: è¯·æ³¨æ„ç®­å¤´å‘¨å›´ä¸åº”è¯¥æœ‰ä»»ä½•ç©ºæ ¼ï¼ˆé™¤éè¯¥ç©ºæ ¼æ˜¯è¦æ›¿æ¢çš„æ¨¡å¼çš„ä¸€éƒ¨åˆ†ï¼‰ã€‚
- en: 'You can add several patterns separated by a comma. For instance here `CamemberForMaskedLM`
    is a direct copy of `RobertaForMaskedLM` with two replacements: `Roberta` to `Camembert`
    and `ROBERTA` to `CAMEMBERT`. You can see [here](https://github.com/huggingface/transformers/blob/15082a9dc6950ecae63a0d3e5060b2fc7f15050a/src/transformers/models/camembert/modeling_camembert.py#L929)
    this is done with the comment:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: æ‚¨å¯ä»¥æ·»åŠ å‡ ä¸ªç”¨é€—å·åˆ†éš”çš„æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨è¿™é‡Œ`CamemberForMaskedLM`æ˜¯`RobertaForMaskedLM`çš„ç›´æ¥å‰¯æœ¬ï¼Œæœ‰ä¸¤ä¸ªæ›¿æ¢ï¼š`Roberta`æ›¿æ¢ä¸º`Camembert`å’Œ`ROBERTA`æ›¿æ¢ä¸º`CAMEMBERT`ã€‚æ‚¨å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/huggingface/transformers/blob/15082a9dc6950ecae63a0d3e5060b2fc7f15050a/src/transformers/models/camembert/modeling_camembert.py#L929)çœ‹åˆ°è¿™æ˜¯å¦‚ä½•å®Œæˆçš„ï¼Œå¸¦æœ‰æ³¨é‡Šï¼š
- en: '[PRE14]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: If the order matters (because one of the replacements might conflict with a
    previous one), the replacements are executed from left to right.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœé¡ºåºå¾ˆé‡è¦ï¼ˆå› ä¸ºå…¶ä¸­ä¸€ä¸ªæ›¿æ¢å¯èƒ½ä¸å…ˆå‰çš„æ›¿æ¢å†²çªï¼‰ï¼Œåˆ™æ›¿æ¢ä»å·¦åˆ°å³æ‰§è¡Œã€‚
- en: If the replacements change the formatting (if you replace a short name by a
    very long name for instance), the copy is checked after applying the auto-formatter.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: å¦‚æœæ›¿æ¢æ”¹å˜äº†æ ¼å¼ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœæ‚¨ç”¨ä¸€ä¸ªéå¸¸é•¿çš„åç§°æ›¿æ¢ä¸€ä¸ªçŸ­åç§°ï¼‰ï¼Œåˆ™åœ¨åº”ç”¨è‡ªåŠ¨æ ¼å¼åŒ–ç¨‹åºåä¼šæ£€æŸ¥å‰¯æœ¬ã€‚
- en: 'Another way when the patterns are just different casings of the same replacement
    (with an uppercased and a lowercased variants) is just to add the option `all-casing`.
    [Here](https://github.com/huggingface/transformers/blob/15082a9dc6950ecae63a0d3e5060b2fc7f15050a/src/transformers/models/mobilebert/modeling_mobilebert.py#L1237)
    is an example in `MobileBertForSequenceClassification` with the comment:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: å½“æ¨¡å¼åªæ˜¯ç›¸åŒæ›¿æ¢çš„ä¸åŒå¤§å°å†™å½¢å¼ï¼ˆå…·æœ‰å¤§å†™å’Œå°å†™å˜ä½“ï¼‰æ—¶ï¼Œå¦ä¸€ç§æ–¹æ³•å°±æ˜¯æ·»åŠ é€‰é¡¹`all-casing`ã€‚[è¿™é‡Œ](https://github.com/huggingface/transformers/blob/15082a9dc6950ecae63a0d3e5060b2fc7f15050a/src/transformers/models/mobilebert/modeling_mobilebert.py#L1237)æ˜¯`MobileBertForSequenceClassification`ä¸­çš„ä¸€ä¸ªç¤ºä¾‹ï¼Œå¸¦æœ‰æ³¨é‡Šï¼š
- en: '[PRE15]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'In this case, the code is copied from `BertForSequenceClassification` by replacing:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»£ç æ˜¯é€šè¿‡æ›¿æ¢`BertForSequenceClassification`å¤åˆ¶çš„ï¼š
- en: '`Bert` by `MobileBert` (for instance when using `MobileBertModel` in the init)'
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`Bert`æ›¿æ¢ä¸º`MobileBert`ï¼ˆä¾‹å¦‚ï¼Œåœ¨initä¸­ä½¿ç”¨`MobileBertModel`æ—¶ï¼‰'
- en: '`bert` by `mobilebert` (for instance when defining `self.mobilebert`)'
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`bert`æ›¿æ¢ä¸º`mobilebert`ï¼ˆä¾‹å¦‚åœ¨å®šä¹‰`self.mobilebert`æ—¶ï¼‰'
- en: '`BERT` by `MOBILEBERT` (in the constant `MOBILEBERT_INPUTS_DOCSTRING`)'
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`BERT`æ›¿æ¢ä¸º`MOBILEBERT`ï¼ˆåœ¨å¸¸é‡`MOBILEBERT_INPUTS_DOCSTRING`ä¸­ï¼‰'
