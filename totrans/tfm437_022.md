# é®è”½è¯­è¨€å»ºæ¨¡

> åŸå§‹æ–‡æœ¬ï¼š[`huggingface.co/docs/transformers/v4.37.2/en/tasks/masked_language_modeling`](https://huggingface.co/docs/transformers/v4.37.2/en/tasks/masked_language_modeling)

[`www.youtube-nocookie.com/embed/mqElG5QJWUg`](https://www.youtube-nocookie.com/embed/mqElG5QJWUg)

é®è”½è¯­è¨€å»ºæ¨¡é¢„æµ‹åºåˆ—ä¸­çš„ä¸€ä¸ªé®è”½æ ‡è®°ï¼Œæ¨¡å‹å¯ä»¥åŒå‘å…³æ³¨æ ‡è®°ã€‚è¿™æ„å‘³ç€æ¨¡å‹å¯ä»¥å®Œå…¨è®¿é—®å·¦ä¾§å’Œå³ä¾§çš„æ ‡è®°ã€‚é®è”½è¯­è¨€å»ºæ¨¡éå¸¸é€‚åˆéœ€è¦å¯¹æ•´ä¸ªåºåˆ—è¿›è¡Œè‰¯å¥½ä¸Šä¸‹æ–‡ç†è§£çš„ä»»åŠ¡ã€‚BERT å°±æ˜¯ä¸€ä¸ªé®è”½è¯­è¨€æ¨¡å‹çš„ä¾‹å­ã€‚

æœ¬æŒ‡å—å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ï¼š

1.  åœ¨[r/askscience](https://www.reddit.com/r/askscience/) ELI5 æ•°æ®é›†çš„å­é›†ä¸Šå¯¹[DistilRoBERTa](https://huggingface.co/distilroberta-base)è¿›è¡Œå¾®è°ƒã€‚

1.  ä½¿ç”¨æ‚¨å¾®è°ƒçš„æ¨¡å‹è¿›è¡Œæ¨æ–­ã€‚

æ‚¨å¯ä»¥æŒ‰ç…§æœ¬æŒ‡å—ä¸­çš„ç›¸åŒæ­¥éª¤å¯¹å…¶ä»–æ¶æ„è¿›è¡Œé®è”½è¯­è¨€å»ºæ¨¡çš„å¾®è°ƒã€‚é€‰æ‹©ä»¥ä¸‹æ¶æ„ä¹‹ä¸€ï¼š

ALBERT, BART, BERT, BigBird, CamemBERT, ConvBERT, Data2VecText, DeBERTa, DeBERTa-v2, DistilBERT, ELECTRA, ERNIE, ESM, FlauBERT, FNet, Funnel Transformer, I-BERT, LayoutLM, Longformer, LUKE, mBART, MEGA, Megatron-BERT, MobileBERT, MPNet, MRA, MVP, Nezha, NystrÃ¶mformer, Perceiver, QDQBert, Reformer, RemBERT, RoBERTa, RoBERTa-PreLayerNorm, RoCBert, RoFormer, SqueezeBERT, TAPAS, Wav2Vec2, XLM, XLM-RoBERTa, XLM-RoBERTa-XL, X-MOD, YOSO

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²å®‰è£…æ‰€æœ‰å¿…è¦çš„åº“ï¼š

```py
pip install transformers datasets evaluate
```

æˆ‘ä»¬é¼“åŠ±æ‚¨ç™»å½•æ‚¨çš„ Hugging Face å¸æˆ·ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥ä¸Šä¼ å’Œä¸ç¤¾åŒºåˆ†äº«æ‚¨çš„æ¨¡å‹ã€‚åœ¨æç¤ºæ—¶ï¼Œè¾“å…¥æ‚¨çš„ä»¤ç‰Œä»¥ç™»å½•ï¼š

```py
>>> from huggingface_hub import notebook_login

>>> notebook_login()
```

## åŠ è½½ ELI5 æ•°æ®é›†

é¦–å…ˆåŠ è½½æ¥è‡ªğŸ¤—æ•°æ®é›†åº“çš„ ELI5 æ•°æ®é›†çš„ r/askscience å­é›†çš„è¾ƒå°å­é›†ã€‚è¿™å°†è®©æ‚¨æœ‰æœºä¼šè¿›è¡Œå®éªŒï¼Œå¹¶ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ï¼Œç„¶åå†èŠ±æ›´å¤šæ—¶é—´åœ¨å®Œæ•´æ•°æ®é›†ä¸Šè¿›è¡Œè®­ç»ƒã€‚

```py
>>> from datasets import load_dataset

>>> eli5 = load_dataset("eli5", split="train_asks[:5000]")
```

ä½¿ç”¨[train_test_split](https://huggingface.co/docs/datasets/v2.16.1/en/package_reference/main_classes#datasets.Dataset.train_test_split)æ–¹æ³•å°†æ•°æ®é›†çš„`train_asks`åˆ†å‰²ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼š

```py
>>> eli5 = eli5.train_test_split(test_size=0.2)
```

ç„¶åçœ‹ä¸€ä¸ªä¾‹å­ï¼š

```py
>>> eli5["train"][0]
{'answers': {'a_id': ['c3d1aib', 'c3d4lya'],
  'score': [6, 3],
  'text': ["The velocity needed to remain in orbit is equal to the square root of Newton's constant times the mass of earth divided by the distance from the center of the earth. I don't know the altitude of that specific mission, but they're usually around 300 km. That means he's going 7-8 km/s.\n\nIn space there are no other forces acting on either the shuttle or the guy, so they stay in the same position relative to each other. If he were to become unable to return to the ship, he would presumably run out of oxygen, or slowly fall into the atmosphere and burn up.",
   "Hope you don't mind me asking another question, but why aren't there any stars visible in this photo?"]},
 'answers_urls': {'url': []},
 'document': '',
 'q_id': 'nyxfp',
 'selftext': '_URL_0_\n\nThis was on the front page earlier and I have a few questions about it. Is it possible to calculate how fast the astronaut would be orbiting the earth? Also how does he stay close to the shuttle so that he can return safely, i.e is he orbiting at the same speed and can therefore stay next to it? And finally if his propulsion system failed, would he eventually re-enter the atmosphere and presumably die?',
 'selftext_urls': {'url': ['http://apod.nasa.gov/apod/image/1201/freeflyer_nasa_3000.jpg']},
 'subreddit': 'askscience',
 'title': 'Few questions about this space walk photograph.',
 'title_urls': {'url': []}}
```

è™½ç„¶è¿™çœ‹èµ·æ¥å¾ˆå¤šï¼Œä½†æ‚¨å®é™…ä¸Šåªå¯¹`text`å­—æ®µæ„Ÿå…´è¶£ã€‚è¯­è¨€å»ºæ¨¡ä»»åŠ¡çš„æœ‰è¶£ä¹‹å¤„åœ¨äºæ‚¨ä¸éœ€è¦æ ‡ç­¾ï¼ˆä¹Ÿç§°ä¸ºæ— ç›‘ç£ä»»åŠ¡ï¼‰ï¼Œå› ä¸ºä¸‹ä¸€ä¸ªè¯*å°±æ˜¯*æ ‡ç­¾ã€‚

## é¢„å¤„ç†

[`www.youtube-nocookie.com/embed/8PmhEIXhBvI`](https://www.youtube-nocookie.com/embed/8PmhEIXhBvI)

å¯¹äºé®è”½è¯­è¨€å»ºæ¨¡ï¼Œä¸‹ä¸€æ­¥æ˜¯åŠ è½½ä¸€ä¸ª DistilRoBERTa åˆ†è¯å™¨æ¥å¤„ç†`text`å­å­—æ®µï¼š

```py
>>> from transformers import AutoTokenizer

>>> tokenizer = AutoTokenizer.from_pretrained("distilroberta-base")
```

ä»ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°`text`å­—æ®µå®é™…ä¸Šæ˜¯åµŒå¥—åœ¨`answers`å†…éƒ¨çš„ã€‚è¿™æ„å‘³ç€æ‚¨éœ€è¦ä½¿ç”¨[`flatten`](https://huggingface.co/docs/datasets/process#flatten)æ–¹æ³•ä»å…¶åµŒå¥—ç»“æ„ä¸­æå–`text`å­å­—æ®µï¼š

```py
>>> eli5 = eli5.flatten()
>>> eli5["train"][0]
{'answers.a_id': ['c3d1aib', 'c3d4lya'],
 'answers.score': [6, 3],
 'answers.text': ["The velocity needed to remain in orbit is equal to the square root of Newton's constant times the mass of earth divided by the distance from the center of the earth. I don't know the altitude of that specific mission, but they're usually around 300 km. That means he's going 7-8 km/s.\n\nIn space there are no other forces acting on either the shuttle or the guy, so they stay in the same position relative to each other. If he were to become unable to return to the ship, he would presumably run out of oxygen, or slowly fall into the atmosphere and burn up.",
  "Hope you don't mind me asking another question, but why aren't there any stars visible in this photo?"],
 'answers_urls.url': [],
 'document': '',
 'q_id': 'nyxfp',
 'selftext': '_URL_0_\n\nThis was on the front page earlier and I have a few questions about it. Is it possible to calculate how fast the astronaut would be orbiting the earth? Also how does he stay close to the shuttle so that he can return safely, i.e is he orbiting at the same speed and can therefore stay next to it? And finally if his propulsion system failed, would he eventually re-enter the atmosphere and presumably die?',
 'selftext_urls.url': ['http://apod.nasa.gov/apod/image/1201/freeflyer_nasa_3000.jpg'],
 'subreddit': 'askscience',
 'title': 'Few questions about this space walk photograph.',
 'title_urls.url': []}
```

ç°åœ¨ï¼Œæ¯ä¸ªå­å­—æ®µéƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„åˆ—ï¼Œç”±`answers`å‰ç¼€æŒ‡ç¤ºï¼Œè€Œ`text`å­—æ®µç°åœ¨æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚ä¸è¦å•ç‹¬å¯¹æ¯ä¸ªå¥å­è¿›è¡Œæ ‡è®°åŒ–ï¼Œè€Œæ˜¯å°†åˆ—è¡¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œä»¥ä¾¿å¯ä»¥è”åˆå¯¹å®ƒä»¬è¿›è¡Œæ ‡è®°åŒ–ã€‚

è¿™æ˜¯ä¸€ä¸ªç¬¬ä¸€ä¸ªé¢„å¤„ç†å‡½æ•°ï¼Œç”¨äºè¿æ¥æ¯ä¸ªç¤ºä¾‹çš„å­—ç¬¦ä¸²åˆ—è¡¨å¹¶å¯¹ç»“æœè¿›è¡Œæ ‡è®°åŒ–ï¼š

```py
>>> def preprocess_function(examples):
...     return tokenizer([" ".join(x) for x in examples["answers.text"]])
```

è¦åœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šåº”ç”¨æ­¤é¢„å¤„ç†å‡½æ•°ï¼Œè¯·ä½¿ç”¨ğŸ¤—æ•°æ®é›†[map](https://huggingface.co/docs/datasets/v2.16.1/en/package_reference/main_classes#datasets.Dataset.map)æ–¹æ³•ã€‚é€šè¿‡è®¾ç½®`batched=True`ä»¥ä¸€æ¬¡å¤„ç†æ•°æ®é›†çš„å¤šä¸ªå…ƒç´ ï¼Œå¹¶ä½¿ç”¨`num_proc`å¢åŠ è¿›ç¨‹æ•°é‡æ¥åŠ é€Ÿ`map`å‡½æ•°ã€‚åˆ é™¤æ‚¨ä¸éœ€è¦çš„ä»»ä½•åˆ—ï¼š

```py
>>> tokenized_eli5 = eli5.map(
...     preprocess_function,
...     batched=True,
...     num_proc=4,
...     remove_columns=eli5["train"].column_names,
... )
```

æ­¤æ•°æ®é›†åŒ…å«æ ‡è®°åºåˆ—ï¼Œä½†å…¶ä¸­ä¸€äº›åºåˆ—æ¯”æ¨¡å‹çš„æœ€å¤§è¾“å…¥é•¿åº¦æ›´é•¿ã€‚

ç°åœ¨å¯ä»¥ä½¿ç”¨ç¬¬äºŒä¸ªé¢„å¤„ç†å‡½æ•°

+   è¿æ¥æ‰€æœ‰åºåˆ—

+   å°†è¿æ¥çš„åºåˆ—æ‹†åˆ†æˆç”±`block_size`å®šä¹‰çš„è¾ƒçŸ­å—ï¼Œè¯¥å—åº”è¯¥æ—¢æ¯”æœ€å¤§è¾“å…¥é•¿åº¦çŸ­ï¼Œåˆè¶³å¤ŸçŸ­ä»¥é€‚åº”æ‚¨çš„ GPU RAMã€‚

```py
>>> block_size = 128

>>> def group_texts(examples):
...     # Concatenate all texts.
...     concatenated_examples = {k: sum(examples[k], []) for k in examples.keys()}
...     total_length = len(concatenated_examples[list(examples.keys())[0]])
...     # We drop the small remainder, we could add padding if the model supported it instead of this drop, you can
...     # customize this part to your needs.
...     if total_length >= block_size:
...         total_length = (total_length // block_size) * block_size
...     # Split by chunks of block_size.
...     result = {
...         k: [t[i : i + block_size] for i in range(0, total_length, block_size)]
...         for k, t in concatenated_examples.items()
...     }
...     return result
```

åœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šåº”ç”¨`group_texts`å‡½æ•°ï¼š

```py
>>> lm_dataset = tokenized_eli5.map(group_texts, batched=True, num_proc=4)
```

ç°åœ¨ä½¿ç”¨ DataCollatorForLanguageModeling åˆ›å»ºä¸€æ‰¹ç¤ºä¾‹ã€‚åœ¨æ•´ç†è¿‡ç¨‹ä¸­ï¼Œæœ€å¥½*åŠ¨æ€å¡«å……*å¥å­åˆ°æ‰¹æ¬¡ä¸­çš„æœ€é•¿é•¿åº¦ï¼Œè€Œä¸æ˜¯å°†æ•´ä¸ªæ•°æ®é›†å¡«å……åˆ°æœ€å¤§é•¿åº¦ã€‚

Pytorch éšè— Pytorch å†…å®¹

ä½¿ç”¨ç»“æŸåºåˆ—æ ‡è®°ä½œä¸ºå¡«å……æ ‡è®°ï¼Œå¹¶æŒ‡å®š`mlm_probability`ä»¥åœ¨æ¯æ¬¡è¿­ä»£æ•°æ®æ—¶éšæœºå±è”½æ ‡è®°ï¼š

```py
>>> from transformers import DataCollatorForLanguageModeling

>>> tokenizer.pad_token = tokenizer.eos_token
>>> data_collator = DataCollatorForLanguageModeling(tokenizer=tokenizer, mlm_probability=0.15)
```

TensorFlow éšè— TensorFlow å†…å®¹

ä½¿ç”¨ç»“æŸåºåˆ—æ ‡è®°ä½œä¸ºå¡«å……æ ‡è®°ï¼Œå¹¶æŒ‡å®š`mlm_probability`ä»¥åœ¨æ¯æ¬¡è¿­ä»£æ•°æ®æ—¶éšæœºå±è”½æ ‡è®°ï¼š

```py
>>> from transformers import DataCollatorForLanguageModeling

>>> data_collator = DataCollatorForLanguageModeling(tokenizer=tokenizer, mlm_probability=0.15, return_tensors="tf")
```

## è®­ç»ƒ

Pytorch éšè— Pytorch å†…å®¹

å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰ä½¿ç”¨ Trainer å¾®è°ƒæ¨¡å‹ï¼Œè¯·æŸ¥çœ‹åŸºæœ¬æ•™ç¨‹è¿™é‡Œï¼

æ‚¨ç°åœ¨å¯ä»¥å¼€å§‹è®­ç»ƒæ‚¨çš„æ¨¡å‹äº†ï¼ä½¿ç”¨ AutoModelForMaskedLM åŠ è½½ DistilRoBERTaï¼š

```py
>>> from transformers import AutoModelForMaskedLM

>>> model = AutoModelForMaskedLM.from_pretrained("distilroberta-base")
```

æ­¤æ—¶ï¼Œåªå‰©ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š

1.  åœ¨ TrainingArguments ä¸­å®šä¹‰æ‚¨çš„è®­ç»ƒè¶…å‚æ•°ã€‚å”¯ä¸€å¿…éœ€çš„å‚æ•°æ˜¯`output_dir`ï¼Œå®ƒæŒ‡å®šä¿å­˜æ¨¡å‹çš„ä½ç½®ã€‚é€šè¿‡è®¾ç½®`push_to_hub=True`å°†æ­¤æ¨¡å‹æ¨é€åˆ° Hubï¼ˆæ‚¨éœ€è¦ç™»å½• Hugging Face æ‰èƒ½ä¸Šä¼ æ¨¡å‹ï¼‰ã€‚

1.  å°†è®­ç»ƒå‚æ•°ä¼ é€’ç»™ Trainerï¼Œä»¥åŠæ¨¡å‹ã€æ•°æ®é›†å’Œæ•°æ®æ•´ç†å™¨ã€‚

1.  è°ƒç”¨ train()æ¥å¾®è°ƒæ‚¨çš„æ¨¡å‹ã€‚

```py
>>> training_args = TrainingArguments(
...     output_dir="my_awesome_eli5_mlm_model",
...     evaluation_strategy="epoch",
...     learning_rate=2e-5,
...     num_train_epochs=3,
...     weight_decay=0.01,
...     push_to_hub=True,
... )

>>> trainer = Trainer(
...     model=model,
...     args=training_args,
...     train_dataset=lm_dataset["train"],
...     eval_dataset=lm_dataset["test"],
...     data_collator=data_collator,
... )

>>> trainer.train()
```

è®­ç»ƒå®Œæˆåï¼Œä½¿ç”¨ evaluate()æ–¹æ³•è¯„ä¼°æ‚¨çš„æ¨¡å‹å¹¶è·å¾—å…¶å›°æƒ‘åº¦ï¼š

```py
>>> import math

>>> eval_results = trainer.evaluate()
>>> print(f"Perplexity: {math.exp(eval_results['eval_loss']):.2f}")
Perplexity: 8.76
```

ç„¶åä½¿ç”¨ push_to_hub()æ–¹æ³•å°†æ‚¨çš„æ¨¡å‹å…±äº«åˆ° Hubï¼Œè¿™æ ·æ¯ä¸ªäººéƒ½å¯ä»¥ä½¿ç”¨æ‚¨çš„æ¨¡å‹ï¼š

```py
>>> trainer.push_to_hub()
```

TensorFlow éšè— TensorFlow å†…å®¹

å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰ä½¿ç”¨ Keras å¾®è°ƒæ¨¡å‹ï¼Œè¯·æŸ¥çœ‹åŸºæœ¬æ•™ç¨‹è¿™é‡Œï¼

è¦åœ¨ TensorFlow ä¸­å¾®è°ƒæ¨¡å‹ï¼Œè¯·é¦–å…ˆè®¾ç½®ä¼˜åŒ–å™¨å‡½æ•°ã€å­¦ä¹ ç‡è°ƒåº¦å’Œä¸€äº›è®­ç»ƒè¶…å‚æ•°ï¼š

```py
>>> from transformers import create_optimizer, AdamWeightDecay

>>> optimizer = AdamWeightDecay(learning_rate=2e-5, weight_decay_rate=0.01)
```

ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ TFAutoModelForMaskedLM åŠ è½½ DistilRoBERTaï¼š

```py
>>> from transformers import TFAutoModelForMaskedLM

>>> model = TFAutoModelForMaskedLM.from_pretrained("distilroberta-base")
```

ä½¿ç”¨ prepare_tf_dataset()å°†æ‚¨çš„æ•°æ®é›†è½¬æ¢ä¸º`tf.data.Dataset`æ ¼å¼ï¼š

```py
>>> tf_train_set = model.prepare_tf_dataset(
...     lm_dataset["train"],
...     shuffle=True,
...     batch_size=16,
...     collate_fn=data_collator,
... )

>>> tf_test_set = model.prepare_tf_dataset(
...     lm_dataset["test"],
...     shuffle=False,
...     batch_size=16,
...     collate_fn=data_collator,
... )
```

ä½¿ç”¨[`compile`](https://keras.io/api/models/model_training_apis/#compile-method)é…ç½®æ¨¡å‹è¿›è¡Œè®­ç»ƒã€‚è¯·æ³¨æ„ï¼ŒTransformers æ¨¡å‹éƒ½æœ‰ä¸€ä¸ªé»˜è®¤çš„ä¸ä»»åŠ¡ç›¸å…³çš„æŸå¤±å‡½æ•°ï¼Œå› æ­¤é™¤éæ‚¨æƒ³è¦æŒ‡å®šä¸€ä¸ªï¼Œå¦åˆ™ä¸éœ€è¦æŒ‡å®šä¸€ä¸ªï¼š 

```py
>>> import tensorflow as tf

>>> model.compile(optimizer=optimizer)  # No loss argument!
```

è¿™å¯ä»¥é€šè¿‡åœ¨ PushToHubCallback ä¸­æŒ‡å®šå°†æ¨¡å‹å’Œæ ‡è®°å™¨æ¨é€åˆ°ä½•å¤„æ¥å®Œæˆï¼š

```py
>>> from transformers.keras_callbacks import PushToHubCallback

>>> callback = PushToHubCallback(
...     output_dir="my_awesome_eli5_mlm_model",
...     tokenizer=tokenizer,
... )
```

æœ€åï¼Œæ‚¨å·²ç»å‡†å¤‡å¥½å¼€å§‹è®­ç»ƒæ‚¨çš„æ¨¡å‹äº†ï¼ä½¿ç”¨æ‚¨çš„è®­ç»ƒå’ŒéªŒè¯æ•°æ®é›†ã€æ—¶ä»£æ•°å’Œå›è°ƒæ¥å¾®è°ƒæ¨¡å‹ï¼Œè°ƒç”¨[`fit`](https://keras.io/api/models/model_training_apis/#fit-method)ï¼š

```py
>>> model.fit(x=tf_train_set, validation_data=tf_test_set, epochs=3, callbacks=[callback])
```

ä¸€æ—¦è®­ç»ƒå®Œæˆï¼Œæ‚¨çš„æ¨¡å‹å°†è‡ªåŠ¨ä¸Šä¼ åˆ° Hubï¼Œä»¥ä¾¿æ¯ä¸ªäººéƒ½å¯ä»¥ä½¿ç”¨å®ƒï¼

è¦äº†è§£å¦‚ä½•ä¸ºæ©ç è¯­è¨€å»ºæ¨¡å¾®è°ƒæ¨¡å‹çš„æ›´æ·±å…¥ç¤ºä¾‹ï¼Œè¯·æŸ¥çœ‹ç›¸åº”çš„[PyTorch ç¬”è®°æœ¬](https://colab.research.google.com/github/huggingface/notebooks/blob/main/examples/language_modeling.ipynb)æˆ–[TensorFlow ç¬”è®°æœ¬](https://colab.research.google.com/github/huggingface/notebooks/blob/main/examples/language_modeling-tf.ipynb)ã€‚

## æ¨ç†

å¾ˆå¥½ï¼Œç°åœ¨æ‚¨å·²ç»å¾®è°ƒäº†ä¸€ä¸ªæ¨¡å‹ï¼Œå¯ä»¥ç”¨å®ƒè¿›è¡Œæ¨ç†äº†ï¼

æƒ³å‡ºä¸€äº›æ‚¨å¸Œæœ›æ¨¡å‹ç”¨æ¥å¡«å……ç©ºç™½çš„æ–‡æœ¬ï¼Œå¹¶ä½¿ç”¨ç‰¹æ®Šçš„`<mask>`æ ‡è®°æ¥æŒ‡ç¤ºç©ºç™½ï¼š

```py
>>> text = "The Milky Way is a <mask> galaxy."
```

å°è¯•ä½¿ç”¨æ‚¨å¾®è°ƒè¿‡çš„æ¨¡å‹è¿›è¡Œæ¨ç†çš„æœ€ç®€å•æ–¹æ³•æ˜¯åœ¨ pipeline()ä¸­ä½¿ç”¨å®ƒã€‚ä¸ºå¡«å……æ©ç å®ä¾‹åŒ–ä¸€ä¸ª`pipeline`ï¼Œå¹¶å°†æ–‡æœ¬ä¼ é€’ç»™å®ƒã€‚å¦‚æœéœ€è¦ï¼Œå¯ä»¥ä½¿ç”¨`top_k`å‚æ•°æŒ‡å®šè¦è¿”å›å¤šå°‘é¢„æµ‹ï¼š

```py
>>> from transformers import pipeline

>>> mask_filler = pipeline("fill-mask", "stevhliu/my_awesome_eli5_mlm_model")
>>> mask_filler(text, top_k=3)
[{'score': 0.5150994658470154,
  'token': 21300,
  'token_str': ' spiral',
  'sequence': 'The Milky Way is a spiral galaxy.'},
 {'score': 0.07087188959121704,
  'token': 2232,
  'token_str': ' massive',
  'sequence': 'The Milky Way is a massive galaxy.'},
 {'score': 0.06434620916843414,
  'token': 650,
  'token_str': ' small',
  'sequence': 'The Milky Way is a small galaxy.'}]
```

Pytorch éšè— Pytorch å†…å®¹

å¯¹æ–‡æœ¬è¿›è¡Œæ ‡è®°åŒ–ï¼Œå¹¶å°†`input_ids`ä½œä¸º PyTorch å¼ é‡è¿”å›ã€‚æ‚¨è¿˜éœ€è¦æŒ‡å®š`<mask>`æ ‡è®°çš„ä½ç½®ï¼š

```py
>>> from transformers import AutoTokenizer

>>> tokenizer = AutoTokenizer.from_pretrained("stevhliu/my_awesome_eli5_mlm_model")
>>> inputs = tokenizer(text, return_tensors="pt")
>>> mask_token_index = torch.where(inputs["input_ids"] == tokenizer.mask_token_id)[1]
```

å°†æ‚¨çš„è¾“å…¥ä¼ é€’ç»™æ¨¡å‹ï¼Œå¹¶è¿”å›æ©ç æ ‡è®°çš„`logits`ï¼š

```py
>>> from transformers import AutoModelForMaskedLM

>>> model = AutoModelForMaskedLM.from_pretrained("stevhliu/my_awesome_eli5_mlm_model")
>>> logits = model(**inputs).logits
>>> mask_token_logits = logits[0, mask_token_index, :]
```

ç„¶åè¿”å›æ¦‚ç‡æœ€é«˜çš„ä¸‰ä¸ªæ©ç æ ‡è®°å¹¶å°†å®ƒä»¬æ‰“å°å‡ºæ¥ï¼š

```py
>>> top_3_tokens = torch.topk(mask_token_logits, 3, dim=1).indices[0].tolist()

>>> for token in top_3_tokens:
...     print(text.replace(tokenizer.mask_token, tokenizer.decode([token])))
The Milky Way is a spiral galaxy.
The Milky Way is a massive galaxy.
The Milky Way is a small galaxy.
```

TensorFlow éšè— TensorFlow å†…å®¹

å¯¹æ–‡æœ¬è¿›è¡Œæ ‡è®°åŒ–ï¼Œå¹¶å°†`input_ids`ä½œä¸º TensorFlow å¼ é‡è¿”å›ã€‚æ‚¨è¿˜éœ€è¦æŒ‡å®š`<mask>`æ ‡è®°çš„ä½ç½®ï¼š

```py
>>> from transformers import AutoTokenizer

>>> tokenizer = AutoTokenizer.from_pretrained("stevhliu/my_awesome_eli5_mlm_model")
>>> inputs = tokenizer(text, return_tensors="tf")
>>> mask_token_index = tf.where(inputs["input_ids"] == tokenizer.mask_token_id)[0, 1]
```

å°†æ‚¨çš„è¾“å…¥ä¼ é€’ç»™æ¨¡å‹ï¼Œå¹¶è¿”å›æ©ç æ ‡è®°çš„`logits`ï¼š

```py
>>> from transformers import TFAutoModelForMaskedLM

>>> model = TFAutoModelForMaskedLM.from_pretrained("stevhliu/my_awesome_eli5_mlm_model")
>>> logits = model(**inputs).logits
>>> mask_token_logits = logits[0, mask_token_index, :]
```

ç„¶åè¿”å›æ¦‚ç‡æœ€é«˜çš„ä¸‰ä¸ªæ©ç æ ‡è®°å¹¶å°†å®ƒä»¬æ‰“å°å‡ºæ¥ï¼š

```py
>>> top_3_tokens = tf.math.top_k(mask_token_logits, 3).indices.numpy()

>>> for token in top_3_tokens:
...     print(text.replace(tokenizer.mask_token, tokenizer.decode([token])))
The Milky Way is a spiral galaxy.
The Milky Way is a massive galaxy.
The Milky Way is a small galaxy.
```
