# å®‰è£…

> åŸæ–‡ï¼š[`huggingface.co/docs/transformers/v4.37.2/en/installation`](https://huggingface.co/docs/transformers/v4.37.2/en/installation)

ä¸ºæ‚¨æ­£åœ¨ä½¿ç”¨çš„ä»»ä½•æ·±åº¦å­¦ä¹ åº“å®‰è£…ğŸ¤— Transformersï¼Œè®¾ç½®æ‚¨çš„ç¼“å­˜ï¼Œå¹¶å¯é€‰æ‹©é…ç½®ğŸ¤— Transformers ä»¥ç¦»çº¿è¿è¡Œã€‚

ğŸ¤— Transformers åœ¨ Python 3.6+ã€PyTorch 1.1.0+ã€TensorFlow 2.0+å’Œ Flax ä¸Šè¿›è¡Œäº†æµ‹è¯•ã€‚æŒ‰ç…§ä¸‹é¢çš„å®‰è£…è¯´æ˜ä¸ºæ‚¨æ­£åœ¨ä½¿ç”¨çš„æ·±åº¦å­¦ä¹ åº“å®‰è£…ï¼š

+   [PyTorch](https://pytorch.org/get-started/locally/)å®‰è£…è¯´æ˜ã€‚

+   [TensorFlow 2.0](https://www.tensorflow.org/install/pip)å®‰è£…è¯´æ˜ã€‚

+   [Flax](https://flax.readthedocs.io/en/latest/)å®‰è£…è¯´æ˜ã€‚

## ä½¿ç”¨ pip å®‰è£…

æ‚¨åº”è¯¥åœ¨[virtual environment](https://docs.python.org/3/library/venv.html)ä¸­å®‰è£…ğŸ¤— Transformersã€‚å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰ Python è™šæ‹Ÿç¯å¢ƒï¼Œè¯·æŸ¥çœ‹è¿™ä¸ª[guide](https://packaging.python.org/guides/installing-using-pip-and-virtual-environments/)ã€‚è™šæ‹Ÿç¯å¢ƒä½¿å¾—ç®¡ç†ä¸åŒé¡¹ç›®æ›´å®¹æ˜“ï¼Œå¹¶é¿å…ä¾èµ–é¡¹ä¹‹é—´çš„å…¼å®¹æ€§é—®é¢˜ã€‚

é¦–å…ˆåœ¨é¡¹ç›®ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼š

```py
python -m venv .env
```

æ¿€æ´»è™šæ‹Ÿç¯å¢ƒã€‚åœ¨ Linux å’Œ MacOs ä¸Šï¼š

```py
source .env/bin/activate
```

åœ¨ Windows ä¸Šæ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

```py
.env/Scripts/activate
```

ç°åœ¨æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ğŸ¤— Transformersï¼š

```py
pip install transformers
```

ä»…æ”¯æŒ CPU çš„æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥æ–¹ä¾¿åœ°åœ¨ä¸€è¡Œä¸­å®‰è£…ğŸ¤— Transformers å’Œä¸€ä¸ªæ·±åº¦å­¦ä¹ åº“ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ğŸ¤— Transformers å’Œ PyTorchï¼š

```py
pip install 'transformers[torch]'
```

ğŸ¤— Transformers å’Œ TensorFlow 2.0ï¼š

```py
pip install 'transformers[tf-cpu]'
```

M1 / ARM ç”¨æˆ·

åœ¨å®‰è£… TensorFLow 2.0 ä¹‹å‰ï¼Œæ‚¨éœ€è¦å®‰è£…ä»¥ä¸‹å†…å®¹

```py
brew install cmake
brew install pkg-config
```

ğŸ¤— Transformers å’Œ Flaxï¼š

```py
pip install 'transformers[flax]'
```

æœ€åï¼Œé€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ğŸ¤— Transformers æ˜¯å¦å·²æ­£ç¡®å®‰è£…ã€‚å®ƒå°†ä¸‹è½½ä¸€ä¸ªé¢„è®­ç»ƒæ¨¡å‹ï¼š

```py
python -c "from transformers import pipeline; print(pipeline('sentiment-analysis')('we love you'))"
```

ç„¶åæ‰“å°æ ‡ç­¾å’Œåˆ†æ•°ï¼š

```py
[{'label': 'POSITIVE', 'score': 0.9998704791069031}]
```

## ä»æºä»£ç å®‰è£…

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä»æºä»£ç å®‰è£…ğŸ¤— Transformersï¼š

```py
pip install git+https://github.com/huggingface/transformers
```

æ­¤å‘½ä»¤å®‰è£…æœ€æ–°çš„`stable`ç‰ˆæœ¬è€Œä¸æ˜¯æœ€æ–°çš„`main`ç‰ˆæœ¬ã€‚`main`ç‰ˆæœ¬å¯¹äºä¿æŒä¸æœ€æ–°å‘å±•ä¿æŒæœ€æ–°æ˜¯æœ‰ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè‡ªä¸Šæ¬¡å®˜æ–¹å‘å¸ƒä»¥æ¥ä¿®å¤äº†é”™è¯¯ä½†å°šæœªæ¨å‡ºæ–°ç‰ˆæœ¬ã€‚ä½†æ˜¯ï¼Œè¿™æ„å‘³ç€`main`ç‰ˆæœ¬å¯èƒ½ä¸æ€»æ˜¯ç¨³å®šçš„ã€‚æˆ‘ä»¬åŠªåŠ›ä¿æŒ`main`ç‰ˆæœ¬çš„è¿è¡Œï¼Œå¹¶ä¸”å¤§å¤šæ•°é—®é¢˜é€šå¸¸åœ¨å‡ ä¸ªå°æ—¶æˆ–ä¸€å¤©å†…è§£å†³ã€‚å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ‰“å¼€ä¸€ä¸ª[Issue](https://github.com/huggingface/transformers/issues)ï¼Œä»¥ä¾¿æˆ‘ä»¬æ›´å¿«åœ°è§£å†³ï¼

é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ğŸ¤— Transformers æ˜¯å¦å·²æ­£ç¡®å®‰è£…ï¼š

```py
python -c "from transformers import pipeline; print(pipeline('sentiment-analysis')('I love you'))"
```

## å¯ç¼–è¾‘å®‰è£…

å¦‚æœæ‚¨æƒ³è¦ï¼Œæ‚¨å°†éœ€è¦ä¸€ä¸ªå¯ç¼–è¾‘çš„å®‰è£…ï¼š

+   ä½¿ç”¨æºä»£ç çš„`main`ç‰ˆæœ¬ã€‚

+   ä¸ºğŸ¤— Transformers åšå‡ºè´¡çŒ®å¹¶éœ€è¦æµ‹è¯•ä»£ç æ›´æ”¹ã€‚

å…‹éš†å­˜å‚¨åº“å¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ğŸ¤— Transformersï¼š

```py
git clone https://github.com/huggingface/transformers.git
cd transformers
pip install -e .
```

è¿™äº›å‘½ä»¤å°†é“¾æ¥æ‚¨å…‹éš†å­˜å‚¨åº“çš„æ–‡ä»¶å¤¹å’Œæ‚¨çš„ Python åº“è·¯å¾„ã€‚ç°åœ¨ Python å°†åœ¨æ‚¨å…‹éš†åˆ°çš„æ–‡ä»¶å¤¹ä¸­æŸ¥æ‰¾ï¼Œé™¤äº†æ­£å¸¸çš„åº“è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„ Python åŒ…é€šå¸¸å®‰è£…åœ¨`~/anaconda3/envs/main/lib/python3.7/site-packages/`ä¸­ï¼ŒPython è¿˜å°†æœç´¢æ‚¨å…‹éš†åˆ°çš„æ–‡ä»¶å¤¹ï¼š`~/transformers/`ã€‚

å¦‚æœè¦ç»§ç»­ä½¿ç”¨è¯¥åº“ï¼Œå¿…é¡»ä¿ç•™`transformers`æ–‡ä»¶å¤¹ã€‚

ç°åœ¨æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è½»æ¾å°†å…‹éš†æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬çš„ğŸ¤— Transformersï¼š

```py
cd ~/transformers/
git pull
```

æ‚¨çš„ Python ç¯å¢ƒå°†åœ¨ä¸‹ä¸€æ¬¡è¿è¡Œæ—¶æ‰¾åˆ°ğŸ¤— Transformers çš„`main`ç‰ˆæœ¬ã€‚

## ä½¿ç”¨ conda å®‰è£…

ä» conda é¢‘é“`conda-forge`å®‰è£…ï¼š

```py
conda install conda-forge::transformers
```

## ç¼“å­˜è®¾ç½®

é¢„è®­ç»ƒæ¨¡å‹å°†è¢«ä¸‹è½½å¹¶åœ¨`~/.cache/huggingface/hub`ä¸­æœ¬åœ°ç¼“å­˜ã€‚è¿™æ˜¯ç”± shell ç¯å¢ƒå˜é‡`TRANSFORMERS_CACHE`ç»™å‡ºçš„é»˜è®¤ç›®å½•ã€‚åœ¨ Windows ä¸Šï¼Œé»˜è®¤ç›®å½•ç”±`C:\Users\username\.cache\huggingface\hub`ç»™å‡ºã€‚æ‚¨å¯ä»¥æ›´æ”¹ä¸‹é¢æ˜¾ç¤ºçš„ shell ç¯å¢ƒå˜é‡ - ä»¥ä¼˜å…ˆé¡ºåºåˆ—å‡º - ä»¥æŒ‡å®šä¸åŒçš„ç¼“å­˜ç›®å½•ï¼š

1.  Shell ç¯å¢ƒå˜é‡ï¼ˆé»˜è®¤ï¼‰ï¼š`HUGGINGFACE_HUB_CACHE`æˆ–`TRANSFORMERS_CACHE`ã€‚

1.  Shell ç¯å¢ƒå˜é‡ï¼š`HF_HOME`ã€‚

1.  Shell ç¯å¢ƒå˜é‡ï¼š`XDG_CACHE_HOME` + `/huggingface`ã€‚

ğŸ¤— Transformers å°†ä½¿ç”¨ shell ç¯å¢ƒå˜é‡`PYTORCH_TRANSFORMERS_CACHE`æˆ–`PYTORCH_PRETRAINED_BERT_CACHE`ï¼Œå¦‚æœæ‚¨æ¥è‡ªæ­¤åº“çš„æ—©æœŸç‰ˆæœ¬å¹¶è®¾ç½®äº†è¿™äº›ç¯å¢ƒå˜é‡ï¼Œé™¤éæ‚¨æŒ‡å®š shell ç¯å¢ƒå˜é‡`TRANSFORMERS_CACHE`ã€‚

## ç¦»çº¿æ¨¡å¼

é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡`TRANSFORMERS_OFFLINE=1`åœ¨é˜²ç«å¢™æˆ–ç¦»çº¿ç¯å¢ƒä¸­è¿è¡ŒğŸ¤— Transformersï¼Œå¹¶ä½¿ç”¨æœ¬åœ°ç¼“å­˜æ–‡ä»¶ã€‚

é€šè¿‡ç¯å¢ƒå˜é‡`HF_DATASETS_OFFLINE=1`å°†[ğŸ¤— Datasets](https://huggingface.co/docs/datasets/)æ·»åŠ åˆ°æ‚¨çš„ç¦»çº¿è®­ç»ƒå·¥ä½œæµç¨‹ã€‚

```py
HF_DATASETS_OFFLINE=1 TRANSFORMERS_OFFLINE=1 \
python examples/pytorch/translation/run_translation.py --model_name_or_path t5-small --dataset_name wmt16 --dataset_config ro-en ...
```

æ­¤è„šæœ¬åº”è¯¥å¯ä»¥åœ¨ä¸æŒ‚èµ·æˆ–ç­‰å¾…è¶…æ—¶çš„æƒ…å†µä¸‹è¿è¡Œï¼Œå› ä¸ºå®ƒä¸ä¼šå°è¯•ä» Hub ä¸‹è½½æ¨¡å‹ã€‚

æ‚¨è¿˜å¯ä»¥é€šè¿‡`local_files_only`å‚æ•°åœ¨æ¯ä¸ª from_pretrained()è°ƒç”¨ä¸­ç»•è¿‡ä» Hub åŠ è½½æ¨¡å‹ã€‚å½“è®¾ç½®ä¸º`True`æ—¶ï¼ŒåªåŠ è½½æœ¬åœ°æ–‡ä»¶ï¼š

```py
from transformers import T5Model

model = T5Model.from_pretrained("./path/to/local/directory", local_files_only=True)
```

### è·å–æ¨¡å‹å’Œåˆ†è¯å™¨ä»¥ç¦»çº¿ä½¿ç”¨

å¦ä¸€ç§ç¦»çº¿ä½¿ç”¨ğŸ¤— Transformers çš„é€‰é¡¹æ˜¯æå‰ä¸‹è½½æ–‡ä»¶ï¼Œç„¶ååœ¨éœ€è¦ç¦»çº¿ä½¿ç”¨æ—¶æŒ‡å‘å®ƒä»¬çš„æœ¬åœ°è·¯å¾„ã€‚æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼š

+   é€šè¿‡ç‚¹å‡»â†“å›¾æ ‡åœ¨[Model Hub](https://huggingface.co/models)ä¸Šçš„ç”¨æˆ·ç•Œé¢ä¸‹è½½æ–‡ä»¶ã€‚

    ![download-icon](img/454f62526609aa00b3e6e8a4acfbc9bc.png)

+   ä½¿ç”¨ PreTrainedModel.from_pretrained()å’Œ PreTrainedModel.save_pretrained()å·¥ä½œæµç¨‹ï¼š

    1.  ä½¿ç”¨ PreTrainedModel.from_pretrained()æå‰ä¸‹è½½æ‚¨çš„æ–‡ä»¶ï¼š

        ```py
        >>> from transformers import AutoTokenizer, AutoModelForSeq2SeqLM

        >>> tokenizer = AutoTokenizer.from_pretrained("bigscience/T0_3B")
        >>> model = AutoModelForSeq2SeqLM.from_pretrained("bigscience/T0_3B")
        ```

    1.  ä½¿ç”¨ PreTrainedModel.save_pretrained()å°†æ–‡ä»¶ä¿å­˜åˆ°æŒ‡å®šç›®å½•ï¼š

        ```py
        >>> tokenizer.save_pretrained("./your/path/bigscience_t0")
        >>> model.save_pretrained("./your/path/bigscience_t0")
        ```

    1.  ç°åœ¨å½“æ‚¨ç¦»çº¿æ—¶ï¼Œé€šè¿‡ä»æŒ‡å®šç›®å½•é‡æ–°åŠ è½½æ‚¨çš„æ–‡ä»¶ä½¿ç”¨ PreTrainedModel.from_pretrained()ï¼š

        ```py
        >>> tokenizer = AutoTokenizer.from_pretrained("./your/path/bigscience_t0")
        >>> model = AutoModel.from_pretrained("./your/path/bigscience_t0")
        ```

+   ä½¿ç”¨[huggingface_hub](https://github.com/huggingface/huggingface_hub/tree/main/src/huggingface_hub)åº“ä»¥ç¼–ç¨‹æ–¹å¼ä¸‹è½½æ–‡ä»¶ï¼š

    1.  åœ¨æ‚¨çš„è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…`huggingface_hub`åº“ï¼š

        ```py
        python -m pip install huggingface_hub
        ```

    1.  ä½¿ç”¨[`hf_hub_download`](https://huggingface.co/docs/hub/adding-a-library#download-files-from-the-hub)å‡½æ•°å°†æ–‡ä»¶ä¸‹è½½åˆ°ç‰¹å®šè·¯å¾„ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å°†ä»[T0](https://huggingface.co/bigscience/T0_3B)æ¨¡å‹ä¸‹è½½`config.json`æ–‡ä»¶åˆ°æ‚¨æƒ³è¦çš„è·¯å¾„ï¼š

        ```py
        >>> from huggingface_hub import hf_hub_download

        >>> hf_hub_download(repo_id="bigscience/T0_3B", filename="config.json", cache_dir="./your/path/bigscience_t0")
        ```

ä¸€æ—¦æ‚¨çš„æ–‡ä»¶è¢«ä¸‹è½½å¹¶æœ¬åœ°ç¼“å­˜ï¼ŒæŒ‡å®šå®ƒçš„æœ¬åœ°è·¯å¾„ä»¥åŠ è½½å’Œä½¿ç”¨å®ƒï¼š

```py
>>> from transformers import AutoConfig

>>> config = AutoConfig.from_pretrained("./your/path/bigscience_t0/config.json")
```

æŸ¥çœ‹[å¦‚ä½•ä» Hub ä¸‹è½½æ–‡ä»¶](https://huggingface.co/docs/hub/how-to-downstream)éƒ¨åˆ†ï¼Œäº†è§£æœ‰å…³ä¸‹è½½å­˜å‚¨åœ¨ Hub ä¸Šçš„æ–‡ä»¶çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚
