# ç¨³å®šæ‰©æ•£ XL

> åŸå§‹æ–‡æœ¬ï¼š[`huggingface.co/docs/diffusers/api/pipelines/stable_diffusion/stable_diffusion_xl`](https://huggingface.co/docs/diffusers/api/pipelines/stable_diffusion/stable_diffusion_xl)

ç¨³å®šæ‰©æ•£ XLï¼ˆSDXLï¼‰ç”± Dustin Podellã€Zion Englishã€Kyle Laceyã€Andreas Blattmannã€Tim Dockhornã€Jonas MÃ¼llerã€Joe Penna å’Œ Robin Rombach åœ¨[SDXL: Improving Latent Diffusion Models for High-Resolution Image Synthesis](https://huggingface.co/papers/2307.01952)ä¸­æå‡ºã€‚

è®ºæ–‡æ‘˜è¦å¦‚ä¸‹ï¼š

*æˆ‘ä»¬æå‡ºäº† SDXLï¼Œä¸€ä¸ªç”¨äºæ–‡æœ¬åˆ°å›¾åƒåˆæˆçš„æ½œåœ¨æ‰©æ•£æ¨¡å‹ã€‚ä¸ä¹‹å‰çš„ç¨³å®šæ‰©æ•£ç‰ˆæœ¬ç›¸æ¯”ï¼ŒSDXL åˆ©ç”¨äº†ä¸€ä¸ªä¸‰å€å¤§çš„ UNet ä¸»å¹²ï¼šæ¨¡å‹å‚æ•°çš„å¢åŠ ä¸»è¦æ˜¯ç”±äºæ›´å¤šçš„æ³¨æ„åŠ›å—å’Œæ›´å¤§çš„äº¤å‰æ³¨æ„åŠ›ä¸Šä¸‹æ–‡ï¼Œå› ä¸º SDXL ä½¿ç”¨äº†ç¬¬äºŒä¸ªæ–‡æœ¬ç¼–ç å™¨ã€‚æˆ‘ä»¬è®¾è®¡äº†å¤šç§æ–°é¢–çš„æ¡ä»¶æ–¹æ¡ˆï¼Œå¹¶åœ¨å¤šä¸ªçºµæ¨ªæ¯”ä¸Šè®­ç»ƒäº† SDXLã€‚æˆ‘ä»¬è¿˜å¼•å…¥äº†ä¸€ä¸ªç»†åŒ–æ¨¡å‹ï¼Œç”¨äºé€šè¿‡åå¤„ç†çš„å›¾åƒåˆ°å›¾åƒæŠ€æœ¯æ”¹è¿› SDXL ç”Ÿæˆçš„æ ·æœ¬çš„è§†è§‰ä¿çœŸåº¦ã€‚æˆ‘ä»¬è¯æ˜ï¼Œä¸ä¹‹å‰ç‰ˆæœ¬çš„ç¨³å®šæ‰©æ•£ç›¸æ¯”ï¼ŒSDXL è¡¨ç°å‡ºäº†æ˜¾è‘—æ”¹è¿›çš„æ€§èƒ½ï¼Œå¹¶ä¸”å–å¾—äº†ä¸é»‘ç›’æœ€å…ˆè¿›å›¾åƒç”Ÿæˆå™¨ç›¸åª²ç¾çš„ç»“æœã€‚*

## æç¤º

+   å·²çŸ¥ä½¿ç”¨ DPM++è°ƒåº¦ç¨‹åºè¿›è¡Œå°‘äº 50 æ­¥çš„ SDXL ä¼šäº§ç”Ÿ[è§†è§‰ä¼ªå½±](https://github.com/huggingface/diffusers/issues/5433)ï¼Œå› ä¸ºæ±‚è§£å™¨å˜å¾—æ•°å€¼ä¸ç¨³å®šã€‚è¦è§£å†³æ­¤é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ­¤[PR](https://github.com/huggingface/diffusers/pull/5541)ï¼Œè¯¥ PR å»ºè®® ODE/SDE æ±‚è§£å™¨ï¼š

    +   è®¾ç½®`use_karras_sigmas=True`æˆ–`lu_lambdas=True`ä»¥æé«˜å›¾åƒè´¨é‡ã€‚

    +   å¦‚æœä½¿ç”¨å…·æœ‰å‡åŒ€æ­¥é•¿çš„æ±‚è§£å™¨ï¼ˆDPM++2M æˆ– DPM++2M SDEï¼‰ï¼Œè¯·è®¾ç½®`euler_at_final=True`ã€‚

+   å¤§å¤šæ•° SDXL æ£€æŸ¥ç‚¹åœ¨å›¾åƒå°ºå¯¸ä¸º 1024x1024 æ—¶æ•ˆæœæœ€ä½³ã€‚æ”¯æŒ 768x768 å’Œ 512x512 çš„å›¾åƒå°ºå¯¸ï¼Œä½†ç»“æœä¸å¤ªå¥½ã€‚ä½äº 512x512 çš„ä»»ä½•å°ºå¯¸éƒ½ä¸å»ºè®®ä½¿ç”¨ï¼Œå¹¶ä¸”é»˜è®¤æ£€æŸ¥ç‚¹å¦‚[stabilityai/stable-diffusion-xl-base-1.0](https://huggingface.co/stabilityai/stable-diffusion-xl-base-1.0)å¯èƒ½ä¸é€‚ç”¨ã€‚

+   SDXL å¯ä»¥ä¸ºå…¶è®­ç»ƒçš„æ¯ä¸ªæ–‡æœ¬ç¼–ç å™¨ä¼ é€’ä¸åŒçš„æç¤ºã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥å°†åŒä¸€æç¤ºçš„ä¸åŒéƒ¨åˆ†ä¼ é€’ç»™æ–‡æœ¬ç¼–ç å™¨ã€‚

+   SDXL è¾“å‡ºçš„å›¾åƒå¯ä»¥é€šè¿‡åœ¨å›¾åƒåˆ°å›¾åƒè®¾ç½®ä¸­åˆ©ç”¨ä¸€ä¸ªç»†åŒ–æ¨¡å‹æ¥æ”¹è¿›ã€‚

+   SDXL æä¾›`negative_original_size`ã€`negative_crops_coords_top_left`å’Œ`negative_target_size`ï¼Œä»¥åœ¨å›¾åƒåˆ†è¾¨ç‡å’Œè£å‰ªå‚æ•°ä¸Šå¯¹æ¨¡å‹è¿›è¡Œè´Ÿé¢æ¡ä»¶ã€‚

è¦äº†è§£å¦‚ä½•åœ¨å„ç§ä»»åŠ¡ä¸­ä½¿ç”¨ SDXLï¼Œå¦‚ä½•ä¼˜åŒ–æ€§èƒ½ä»¥åŠå…¶ä»–ç”¨æ³•ç¤ºä¾‹ï¼Œè¯·æŸ¥çœ‹ Stable Diffusion XL æŒ‡å—ã€‚

æŸ¥çœ‹[Stability AI](https://huggingface.co/stabilityai) Hub ç»„ç»‡ä»¥è·å–å®˜æ–¹åŸºç¡€å’Œç»†åŒ–æ¨¡å‹æ£€æŸ¥ç‚¹ï¼

## StableDiffusionXLPipeline

`class diffusers.StableDiffusionXLPipeline`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl.py#L149)

```py
( vae: AutoencoderKL text_encoder: CLIPTextModel text_encoder_2: CLIPTextModelWithProjection tokenizer: CLIPTokenizer tokenizer_2: CLIPTokenizer unet: UNet2DConditionModel scheduler: KarrasDiffusionSchedulers image_encoder: CLIPVisionModelWithProjection = None feature_extractor: CLIPImageProcessor = None force_zeros_for_empty_prompt: bool = True add_watermarker: Optional = None )
```

å‚æ•°

+   `vae`ï¼ˆAutoencoderKL çš„æ–‡æœ¬éƒ¨åˆ†ï¼Œå…·ä½“æ˜¯[clip-vit-large-patch14](https://huggingface.co/openai/clip-vit-large-patch14)å˜ä½“ã€‚

+   `text_encoder_2`ï¼ˆ`CLIPTextModelWithProjection`ï¼‰- ç¬¬äºŒä¸ªå†»ç»“çš„æ–‡æœ¬ç¼–ç å™¨ã€‚Stable Diffusion XL ä½¿ç”¨[CLIP](https://huggingface.co/docs/transformers/model_doc/clip#transformers.CLIPTextModelWithProjection)çš„æ–‡æœ¬å’Œæ± éƒ¨åˆ†ï¼Œå…·ä½“æ˜¯[laion/CLIP-ViT-bigG-14-laion2B-39B-b160k](https://huggingface.co/laion/CLIP-ViT-bigG-14-laion2B-39B-b160k)å˜ä½“ã€‚

+   `tokenizer`ï¼ˆCLIPTokenizerï¼‰- ç±»çš„åˆ†è¯å™¨ CLIPTokenizerã€‚

+   `tokenizer_2`ï¼ˆCLIPTokenizerï¼‰- ç±»çš„ç¬¬äºŒä¸ªåˆ†è¯å™¨ CLIPTokenizerã€‚

+   `unet`ï¼ˆUNet2DConditionModelï¼‰- æœ‰æ¡ä»¶çš„ U-Net æ¶æ„ï¼Œç”¨äºå»å™ªç¼–ç å›¾åƒæ½œåœ¨ç‰¹å¾ã€‚

+   `scheduler`ï¼ˆSchedulerMixinï¼‰- ä¸`unet`ä¸€èµ·ç”¨äºå»å™ªç¼–ç å›¾åƒæ½œåœ¨ç‰¹å¾çš„è°ƒåº¦ç¨‹åºã€‚å¯ä»¥æ˜¯ DDIMSchedulerã€LMSDiscreteScheduler æˆ– PNDMScheduler ä¹‹ä¸€ã€‚

+   `force_zeros_for_empty_prompt`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`"True"`ï¼‰- æ˜¯å¦å¼ºåˆ¶å°†è´Ÿæç¤ºåµŒå…¥å§‹ç»ˆè®¾ç½®ä¸º 0ã€‚è¿˜è¯·å‚é˜…`stabilityai/stable-diffusion-xl-base-1-0`çš„é…ç½®ã€‚

+   `add_watermarker`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼‰- æ˜¯å¦ä½¿ç”¨ invisible_watermark åº“å¯¹è¾“å‡ºå›¾åƒè¿›è¡Œæ°´å°å¤„ç†ã€‚å¦‚æœæœªå®šä¹‰ï¼Œå¦‚æœå®‰è£…äº†è¯¥è½¯ä»¶åŒ…ï¼Œåˆ™é»˜è®¤ä¸º Trueï¼Œå¦åˆ™å°†ä¸ä½¿ç”¨æ°´å°ã€‚

ç”¨äºä½¿ç”¨ Stable Diffusion XL è¿›è¡Œæ–‡æœ¬åˆ°å›¾åƒç”Ÿæˆçš„ç®¡é“ã€‚

è¯¥æ¨¡å‹ç»§æ‰¿è‡ª DiffusionPipelineã€‚æŸ¥çœ‹è¶…ç±»æ–‡æ¡£ä»¥äº†è§£åº“ä¸ºæ‰€æœ‰ç®¡é“å®ç°çš„é€šç”¨æ–¹æ³•ï¼ˆä¾‹å¦‚ä¸‹è½½æˆ–ä¿å­˜ï¼Œåœ¨ç‰¹å®šè®¾å¤‡ä¸Šè¿è¡Œç­‰ï¼‰ã€‚

è¯¥ç®¡é“è¿˜ç»§æ‰¿ä»¥ä¸‹åŠ è½½æ–¹æ³•ï¼š

+   åŠ è½½æ–‡æœ¬åæ¼”åµŒå…¥

+   ç”¨äºåŠ è½½`.ckpt`æ–‡ä»¶

+   åŠ è½½ LoRA æƒé‡

+   ä¿å­˜ LoRA æƒé‡

+   åŠ è½½ IP é€‚é…å™¨

`__call__`

æ¥æº

```py
( prompt: Union = None prompt_2: Union = None height: Optional = None width: Optional = None num_inference_steps: int = 50 timesteps: List = None denoising_end: Optional = None guidance_scale: float = 5.0 negative_prompt: Union = None negative_prompt_2: Union = None num_images_per_prompt: Optional = 1 eta: float = 0.0 generator: Union = None latents: Optional = None prompt_embeds: Optional = None negative_prompt_embeds: Optional = None pooled_prompt_embeds: Optional = None negative_pooled_prompt_embeds: Optional = None ip_adapter_image: Union = None output_type: Optional = 'pil' return_dict: bool = True cross_attention_kwargs: Optional = None guidance_rescale: float = 0.0 original_size: Optional = None crops_coords_top_left: Tuple = (0, 0) target_size: Optional = None negative_original_size: Optional = None negative_crops_coords_top_left: Tuple = (0, 0) negative_target_size: Optional = None clip_skip: Optional = None callback_on_step_end: Optional = None callback_on_step_end_tensor_inputs: List = ['latents'] **kwargs ) â†’ export const metadata = 'undefined';~pipelines.stable_diffusion_xl.StableDiffusionXLPipelineOutput or tuple
```

å‚æ•°

+   `prompt`ï¼ˆ`str`æˆ–`List[str]`ï¼Œ*å¯é€‰*ï¼‰- ç”¨äºæŒ‡å¯¼å›¾åƒç”Ÿæˆçš„æç¤ºã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™å¿…é¡»ä¼ é€’`prompt_embeds`ã€‚

+   `prompt_2`ï¼ˆ`str`æˆ–`List[str]`ï¼Œ*å¯é€‰*ï¼‰- è¦å‘é€åˆ°`tokenizer_2`å’Œ`text_encoder_2`çš„æç¤ºã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™åœ¨ä¸¤ä¸ªæ–‡æœ¬ç¼–ç å™¨ä¸­éƒ½ä½¿ç”¨`prompt`ã€‚

+   `height`ï¼ˆ`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º self.unet.config.sample_size * self.vae_scale_factorï¼‰- ç”Ÿæˆå›¾åƒçš„åƒç´ é«˜åº¦ã€‚é»˜è®¤æƒ…å†µä¸‹è®¾ç½®ä¸º 1024 ä»¥è·å¾—æœ€ä½³ç»“æœã€‚ä½äº 512 åƒç´ çš„ä»»ä½•å†…å®¹å¯¹äº stabilityai/stable-diffusion-xl-base-1.0 å’Œæœªç»ä¸“é—¨è°ƒæ•´ä»¥é€‚åº”ä½åˆ†è¾¨ç‡çš„æ£€æŸ¥ç‚¹æ•ˆæœä¸ä½³ã€‚

+   `width` (`int`, *optional*, é»˜è®¤ä¸º self.unet.config.sample_size * self.vae_scale_factor) â€” ç”Ÿæˆå›¾åƒçš„åƒç´ å®½åº¦ã€‚é»˜è®¤è®¾ç½®ä¸º 1024 ä»¥è·å¾—æœ€ä½³ç»“æœã€‚ä½äº 512 åƒç´ çš„ä»»ä½•å†…å®¹éƒ½ä¸é€‚ç”¨äº[stabilityai/stable-diffusion-xl-base-1.0](https://huggingface.co/stabilityai/stable-diffusion-xl-base-1.0)å’Œæœªç»ä¸“é—¨è°ƒæ•´ä»¥é€‚åº”ä½åˆ†è¾¨ç‡çš„æ£€æŸ¥ç‚¹ã€‚

+   `num_inference_steps` (`int`, *optional*, é»˜è®¤ä¸º 50) â€” é™å™ªæ­¥éª¤çš„æ•°é‡ã€‚æ›´å¤šçš„é™å™ªæ­¥éª¤é€šå¸¸ä¼šå¯¼è‡´æ›´é«˜è´¨é‡çš„å›¾åƒï¼Œä½†æ¨ç†é€Ÿåº¦è¾ƒæ…¢ã€‚

+   `timesteps` (`List[int]`, *optional*) â€” ç”¨äºå…·æœ‰åœ¨å…¶`set_timesteps`æ–¹æ³•ä¸­æ”¯æŒ`timesteps`å‚æ•°çš„è°ƒåº¦å™¨çš„é™å™ªè¿‡ç¨‹çš„è‡ªå®šä¹‰æ—¶é—´æ­¥ã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™å°†ä½¿ç”¨ä¼ é€’`num_inference_steps`æ—¶çš„é»˜è®¤è¡Œä¸ºã€‚å¿…é¡»æŒ‰é™åºæ’åˆ—ã€‚

+   `denoising_end` (`float`, *optional*) â€” å½“æŒ‡å®šæ—¶ï¼Œç¡®å®šåœ¨æ„å›¾æå‰ç»ˆæ­¢ä¹‹å‰å®Œæˆçš„æ€»é™å™ªè¿‡ç¨‹çš„æ¯”ä¾‹ï¼ˆä»‹äº 0.0 å’Œ 1.0 ä¹‹é—´ï¼‰ã€‚å› æ­¤ï¼Œè¿”å›çš„æ ·æœ¬ä»å°†ä¿ç•™ç”±è°ƒåº¦å™¨é€‰æ‹©çš„ç¦»æ•£æ—¶é—´æ­¥ç¡®å®šçš„å¤§é‡å™ªéŸ³ã€‚å½“æ­¤ç®¡é“å½¢æˆâ€œå»å™ªå™¨æ··åˆâ€å¤šç®¡é“è®¾ç½®çš„ä¸€éƒ¨åˆ†æ—¶ï¼Œåº”ç†æƒ³åœ°åˆ©ç”¨`denoising_end`å‚æ•°ï¼Œå¦‚[`Refining the Image Output`](https://huggingface.co/docs/diffusers/api/pipelines/stable_diffusion/stable_diffusion_xl#refining-the-image-output)ä¸­æ‰€è¿°ã€‚

+   `guidance_scale` (`float`, *optional*, é»˜è®¤ä¸º 5.0) â€” å¦‚[Classifier-Free Diffusion Guidance](https://arxiv.org/abs/2207.12598)ä¸­å®šä¹‰çš„æŒ‡å¯¼æ¯”ä¾‹ã€‚`guidance_scale`è¢«å®šä¹‰ä¸º[Imagen Paper](https://arxiv.org/pdf/2205.11487.pdf)ä¸­æ–¹ç¨‹å¼ 2 çš„`w`ã€‚é€šè¿‡è®¾ç½®`guidance_scale > 1`å¯ç”¨æŒ‡å¯¼æ¯”ä¾‹ã€‚æ›´é«˜çš„æŒ‡å¯¼æ¯”ä¾‹é¼“åŠ±ç”Ÿæˆä¸æ–‡æœ¬`prompt`å¯†åˆ‡ç›¸å…³çš„å›¾åƒï¼Œé€šå¸¸ä»¥é™ä½å›¾åƒè´¨é‡ä¸ºä»£ä»·ã€‚

+   `negative_prompt` (`str` æˆ– `List[str]`, *optional*) â€” ä¸æŒ‡å¯¼å›¾åƒç”Ÿæˆçš„æç¤ºæˆ–æç¤ºã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™å¿…é¡»ä¼ é€’`negative_prompt_embeds`ã€‚åœ¨ä¸ä½¿ç”¨æŒ‡å¯¼æ—¶è¢«å¿½ç•¥ï¼ˆå³å¦‚æœ`guidance_scale`å°äº`1`ï¼Œåˆ™è¢«å¿½ç•¥ï¼‰ã€‚

+   `negative_prompt_2` (`str` æˆ– `List[str]`, *optional*) â€” ä¸æŒ‡å¯¼å›¾åƒç”Ÿæˆçš„æç¤ºæˆ–æç¤ºï¼Œå°†å‘é€åˆ°`tokenizer_2`å’Œ`text_encoder_2`ã€‚å¦‚æœæœªå®šä¹‰ï¼Œ`negative_prompt`å°†åœ¨ä¸¤ä¸ªæ–‡æœ¬ç¼–ç å™¨ä¸­ä½¿ç”¨ã€‚

+   `num_images_per_prompt` (`int`, *optional*, é»˜è®¤ä¸º 1) â€” æ¯ä¸ªæç¤ºç”Ÿæˆçš„å›¾åƒæ•°é‡ã€‚

+   `eta` (`float`, *optional*, é»˜è®¤ä¸º 0.0) â€” å¯¹åº”äº DDIM è®ºæ–‡ä¸­çš„å‚æ•° eta (Î·)ï¼š[`arxiv.org/abs/2010.02502`](https://arxiv.org/abs/2010.02502)ã€‚ä»…é€‚ç”¨äº schedulers.DDIMSchedulerï¼Œå¯¹äºå…¶ä»–æƒ…å†µå°†è¢«å¿½ç•¥ã€‚

+   `generator` (`torch.Generator` æˆ– `List[torch.Generator]`, *optional*) â€” ä¸€ä¸ªæˆ–å¤šä¸ª[torch ç”Ÿæˆå™¨](https://pytorch.org/docs/stable/generated/torch.Generator.html)ï¼Œç”¨äºä½¿ç”Ÿæˆè¿‡ç¨‹ç¡®å®šæ€§ã€‚

+   `latents` (`torch.FloatTensor`, *optional*) â€” é¢„ç”Ÿæˆçš„å˜ˆæ‚æ½œå˜é‡ï¼Œä»é«˜æ–¯åˆ†å¸ƒä¸­é‡‡æ ·ï¼Œç”¨ä½œå›¾åƒç”Ÿæˆçš„è¾“å…¥ã€‚å¯ç”¨äºä½¿ç”¨ä¸åŒæç¤ºè°ƒæ•´ç›¸åŒç”Ÿæˆã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä½¿ç”¨æä¾›çš„éšæœº`generator`è¿›è¡Œé‡‡æ ·ç”Ÿæˆæ½œå˜é‡å¼ é‡ã€‚

+   `prompt_embeds` (`torch.FloatTensor`, *optional*) â€” é¢„ç”Ÿæˆçš„æ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œä¾‹å¦‚æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œæ–‡æœ¬åµŒå…¥å°†ä»`prompt`è¾“å…¥å‚æ•°ç”Ÿæˆã€‚

+   `negative_prompt_embeds` (`torch.FloatTensor`, *optional*) â€” é¢„ç”Ÿæˆçš„è´Ÿæ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œä¾‹å¦‚æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä»`negative_prompt`è¾“å…¥å‚æ•°ç”Ÿæˆ`negative_prompt_embeds`ã€‚

+   `pooled_prompt_embeds` (`torch.FloatTensor`, *optional*) â€” é¢„ç”Ÿæˆçš„æ± åŒ–æ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œä¾‹å¦‚æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä» `prompt` è¾“å…¥å‚æ•°ç”Ÿæˆæ± åŒ–æ–‡æœ¬åµŒå…¥ã€‚

+   `negative_pooled_prompt_embeds` (`torch.FloatTensor`, *optional*) â€” é¢„ç”Ÿæˆçš„è´Ÿé¢æ± åŒ–æ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œä¾‹å¦‚æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä» `negative_prompt` è¾“å…¥å‚æ•°ç”Ÿæˆè´Ÿé¢æ± åŒ–æ–‡æœ¬åµŒå…¥ã€‚ip_adapter_image â€” (`PipelineImageInput`, *optional*): å¯é€‰çš„å›¾åƒè¾“å…¥ï¼Œç”¨äºä¸ IP é€‚é…å™¨ä¸€èµ·ä½¿ç”¨ã€‚

+   `output_type` (`str`, *optional*, é»˜è®¤ä¸º `"pil"`) â€” ç”Ÿæˆå›¾åƒçš„è¾“å‡ºæ ¼å¼ã€‚å¯é€‰æ‹© [PIL](https://pillow.readthedocs.io/en/stable/)ï¼š`PIL.Image.Image` æˆ– `np.array`ã€‚

+   `return_dict` (`bool`, *optional*, é»˜è®¤ä¸º `True`) â€” æ˜¯å¦è¿”å› `~pipelines.stable_diffusion_xl.StableDiffusionXLPipelineOutput` è€Œä¸æ˜¯æ™®é€šå…ƒç»„ã€‚

+   `cross_attention_kwargs` (`dict`, *optional*) â€” å¦‚æœæŒ‡å®šï¼Œå°†ä¼ é€’ç»™ `AttentionProcessor` ä¸­å®šä¹‰çš„ `self.processor` ä¸‹çš„ kwargs å­—å…¸ï¼Œè¯¦è§ [diffusers.models.attention_processor](https://github.com/huggingface/diffusers/blob/main/src/diffusers/models/attention_processor.py)ã€‚

+   `guidance_rescale` (`float`, *optional*, é»˜è®¤ä¸º 0.0) â€” [Common Diffusion Noise Schedules and Sample Steps are Flawed](https://arxiv.org/pdf/2305.08891.pdf) æå‡ºçš„æŒ‡å¯¼ç¼©æ”¾å› å­ã€‚`guidance_scale` åœ¨æ–¹ç¨‹å¼ 16 ä¸­å®šä¹‰ä¸º `Ï†`ã€‚æŒ‡å¯¼ç¼©æ”¾å› å­åº”è¯¥åœ¨ä½¿ç”¨é›¶ç»ˆç«¯ä¿¡å™ªæ¯”æ—¶ä¿®å¤è¿‡æ›å…‰é—®é¢˜ã€‚

+   `original_size` (`Tuple[int]`, *optional*, é»˜è®¤ä¸º (1024, 1024)) â€” å¦‚æœ `original_size` ä¸ `target_size` ä¸åŒï¼Œå›¾åƒå°†å‘ˆç°ä¸ºç¼©å°æˆ–æ”¾å¤§ã€‚å¦‚æœæœªæŒ‡å®šï¼Œ`original_size` é»˜è®¤ä¸º `(height, width)`ã€‚è¿™æ˜¯ SDXL çš„å¾®è°ƒèŠ‚çš„ä¸€éƒ¨åˆ†ï¼Œè¯¦è§ [`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952) çš„ç¬¬ 2.2 èŠ‚ã€‚

+   `crops_coords_top_left` (`Tuple[int]`, *optional*, é»˜è®¤ä¸º (0, 0)) â€” `crops_coords_top_left` å¯ç”¨äºç”Ÿæˆä¸€ä¸ªçœ‹èµ·æ¥è¢«â€œè£å‰ªâ€åˆ°ä½ç½® `crops_coords_top_left` ä¸‹æ–¹çš„å›¾åƒã€‚é€šå¸¸é€šè¿‡å°† `crops_coords_top_left` è®¾ç½®ä¸º (0, 0) å¯ä»¥å®ç°æœ‰åˆ©ä¸”å±…ä¸­çš„å›¾åƒã€‚è¿™æ˜¯ SDXL çš„å¾®è°ƒèŠ‚çš„ä¸€éƒ¨åˆ†ï¼Œè¯¦è§ [`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952) çš„ç¬¬ 2.2 èŠ‚ã€‚

+   `target_size` (`Tuple[int]`, *optional*, é»˜è®¤ä¸º (1024, 1024)) â€” å¯¹äºå¤§å¤šæ•°æƒ…å†µï¼Œ`target_size` åº”è®¾ç½®ä¸ºç”Ÿæˆå›¾åƒçš„æœŸæœ›é«˜åº¦å’Œå®½åº¦ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†é»˜è®¤ä¸º `(height, width)`ã€‚è¿™æ˜¯ SDXL çš„å¾®è°ƒèŠ‚çš„ä¸€éƒ¨åˆ†ï¼Œè¯¦è§ [`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952) çš„ç¬¬ 2.2 èŠ‚ã€‚

+   `negative_original_size` (`Tuple[int]`, *optional*, é»˜è®¤ä¸º (1024, 1024)) â€” åŸºäºç‰¹å®šå›¾åƒåˆ†è¾¨ç‡å¯¹ç”Ÿæˆè¿‡ç¨‹è¿›è¡Œè´Ÿé¢è°ƒèŠ‚ã€‚è¿™æ˜¯ SDXL çš„å¾®è°ƒèŠ‚çš„ä¸€éƒ¨åˆ†ï¼Œè¯¦è§ [`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952) çš„ç¬¬ 2.2 èŠ‚ã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒæ­¤é—®é¢˜çº¿ç¨‹ï¼š[`github.com/huggingface/diffusers/issues/4208`](https://github.com/huggingface/diffusers/issues/4208)ã€‚

+   `negative_crops_coords_top_left` (`Tuple[int]`, *optional*, é»˜è®¤ä¸º (0, 0)) â€” åŸºäºç‰¹å®šè£å‰ªåæ ‡å¯¹ç”Ÿæˆè¿‡ç¨‹è¿›è¡Œè´Ÿé¢è°ƒèŠ‚ã€‚è¿™æ˜¯ SDXL çš„å¾®è°ƒèŠ‚çš„ä¸€éƒ¨åˆ†ï¼Œè¯¦è§ [`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952) çš„ç¬¬ 2.2 èŠ‚ã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒæ­¤é—®é¢˜çº¿ç¨‹ï¼š[`github.com/huggingface/diffusers/issues/4208`](https://github.com/huggingface/diffusers/issues/4208)ã€‚

+   `negative_target_size` (`Tuple[int]`, *å¯é€‰*, é»˜è®¤ä¸º (1024, 1024)) â€” åŸºäºç›®æ ‡å›¾åƒåˆ†è¾¨ç‡å¯¹ç”Ÿæˆè¿‡ç¨‹è¿›è¡Œè´Ÿæ¡ä»¶åŒ–ã€‚å¯¹äºå¤§å¤šæ•°æƒ…å†µï¼Œå®ƒåº”ä¸ `target_size` ç›¸åŒã€‚ä½œä¸º SDXL çš„å¾®æ¡ä»¶åŒ–çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚ [`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952) ç¬¬ 2.2 èŠ‚ä¸­æ‰€è§£é‡Šçš„ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒæ­¤é—®é¢˜çº¿ç¨‹ï¼š[`github.com/huggingface/diffusers/issues/4208`](https://github.com/huggingface/diffusers/issues/4208)ã€‚

+   `callback_on_step_end` (`Callable`, *å¯é€‰*) â€” åœ¨æ¨æ–­æœŸé—´æ¯ä¸ªå»å™ªæ­¥éª¤ç»“æŸæ—¶è°ƒç”¨çš„å‡½æ•°ã€‚è¯¥å‡½æ•°å°†ä½¿ç”¨ä»¥ä¸‹å‚æ•°è°ƒç”¨ï¼š`callback_on_step_end(self: DiffusionPipeline, step: int, timestep: int, callback_kwargs: Dict)`ã€‚`callback_kwargs` å°†åŒ…æ‹¬ç”± `callback_on_step_end_tensor_inputs` æŒ‡å®šçš„æ‰€æœ‰å¼ é‡çš„åˆ—è¡¨ã€‚

+   `callback_on_step_end_tensor_inputs` (`List`, *å¯é€‰*) â€” `callback_on_step_end` å‡½æ•°çš„å¼ é‡è¾“å…¥åˆ—è¡¨ã€‚åˆ—è¡¨ä¸­æŒ‡å®šçš„å¼ é‡å°†ä½œä¸º `callback_kwargs` å‚æ•°ä¼ é€’ã€‚æ‚¨åªèƒ½åŒ…å«åœ¨ç®¡é“ç±»çš„ `._callback_tensor_inputs` å±æ€§ä¸­åˆ—å‡ºçš„å˜é‡ã€‚

è¿”å›

`~pipelines.stable_diffusion_xl.StableDiffusionXLPipelineOutput` æˆ– `tuple`

`~pipelines.stable_diffusion_xl.StableDiffusionXLPipelineOutput` å¦‚æœ `return_dict` ä¸º Trueï¼Œåˆ™è¿”å›ä¸€ä¸ª `tuple`ã€‚å½“è¿”å›ä¸€ä¸ª `tuple` æ—¶ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªåŒ…å«ç”Ÿæˆå›¾åƒçš„åˆ—è¡¨ã€‚

åœ¨è°ƒç”¨ç”Ÿæˆç®¡é“æ—¶è°ƒç”¨çš„å‡½æ•°ã€‚

ç¤ºä¾‹ï¼š

```py
>>> import torch
>>> from diffusers import StableDiffusionXLPipeline

>>> pipe = StableDiffusionXLPipeline.from_pretrained(
...     "stabilityai/stable-diffusion-xl-base-1.0", torch_dtype=torch.float16
... )
>>> pipe = pipe.to("cuda")

>>> prompt = "a photo of an astronaut riding a horse on mars"
>>> image = pipe(prompt).images[0]
```

#### `disable_freeu`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl.py#L758)

```py
( )
```

å¦‚æœå·²å¯ç”¨ FreeU æœºåˆ¶ï¼Œåˆ™ç¦ç”¨å®ƒã€‚

#### `disable_vae_slicing`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl.py#L269)

```py
( )
```

ç¦ç”¨åˆ‡ç‰‡ VAE è§£ç ã€‚å¦‚æœä¹‹å‰å¯ç”¨äº† `enable_vae_slicing`ï¼Œåˆ™æ­¤æ–¹æ³•å°†è¿”å›åˆ°ä¸€æ­¥è®¡ç®—è§£ç ã€‚

#### `disable_vae_tiling`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl.py#L286)

```py
( )
```

ç¦ç”¨å¹³é“º VAE è§£ç ã€‚å¦‚æœä¹‹å‰å¯ç”¨äº† `enable_vae_tiling`ï¼Œåˆ™æ­¤æ–¹æ³•å°†è¿”å›åˆ°ä¸€æ­¥è®¡ç®—è§£ç ã€‚

#### `enable_freeu`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl.py#L735)

```py
( s1: float s2: float b1: float b2: float )
```

å‚æ•°

+   `s1` (`float`) â€” é˜¶æ®µ 1 çš„ç¼©æ”¾å› å­ï¼Œç”¨äºå‡å¼±è·³è¿‡ç‰¹å¾çš„è´¡çŒ®ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†å‡è½»å¢å¼ºå»å™ªè¿‡ç¨‹ä¸­çš„â€œè¿‡åº¦å¹³æ»‘æ•ˆæœâ€ã€‚

+   `s2` (`float`) â€” é˜¶æ®µ 2 çš„ç¼©æ”¾å› å­ï¼Œç”¨äºå‡å¼±è·³è¿‡ç‰¹å¾çš„è´¡çŒ®ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†å‡è½»å¢å¼ºå»å™ªè¿‡ç¨‹ä¸­çš„â€œè¿‡åº¦å¹³æ»‘æ•ˆæœâ€ã€‚

+   `b1` (`float`) â€” é˜¶æ®µ 1 çš„ç¼©æ”¾å› å­ï¼Œç”¨äºæ”¾å¤§ä¸»å¹²ç‰¹å¾çš„è´¡çŒ®ã€‚

+   `b2` (`float`) â€” é˜¶æ®µ 2 çš„ç¼©æ”¾å› å­ï¼Œç”¨äºæ”¾å¤§ä¸»å¹²ç‰¹å¾çš„è´¡çŒ®ã€‚

å¯ç”¨ FreeU æœºåˆ¶ï¼Œå¦‚ [`arxiv.org/abs/2309.11497`](https://arxiv.org/abs/2309.11497) ä¸­æ‰€è¿°ã€‚

ç¼©æ”¾å› å­åç¼€è¡¨ç¤ºå®ƒä»¬è¢«åº”ç”¨çš„é˜¶æ®µã€‚

è¯·å‚è€ƒ[å®˜æ–¹å­˜å‚¨åº“](https://github.com/ChenyangSi/FreeU)ï¼Œäº†è§£å·²çŸ¥é€‚ç”¨äºä¸åŒç®¡é“ï¼ˆå¦‚ Stable Diffusion v1ã€v2 å’Œ Stable Diffusion XLï¼‰çš„å€¼ç»„åˆã€‚

#### `enable_vae_slicing`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl.py#L261)

```py
( )
```

å¯ç”¨åˆ‡ç‰‡ VAE è§£ç ã€‚å¯ç”¨æ­¤é€‰é¡¹æ—¶ï¼ŒVAE å°†å°†è¾“å…¥å¼ é‡åˆ†å‰²æˆç‰‡æ®µï¼Œä»¥ä¾¿åœ¨å¤šä¸ªæ­¥éª¤ä¸­è®¡ç®—è§£ç ã€‚è¿™å¯¹äºèŠ‚çœä¸€äº›å†…å­˜å¹¶å…è®¸æ›´å¤§çš„æ‰¹é‡å¤§å°éå¸¸æœ‰ç”¨ã€‚

#### `enable_vae_tiling`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl.py#L277)

```py
( )
```

å¯ç”¨å¹³é“ºçš„ VAE è§£ç ã€‚å¯ç”¨æ­¤é€‰é¡¹æ—¶ï¼ŒVAE å°†å°†è¾“å…¥å¼ é‡åˆ†å‰²æˆç“¦ç‰‡ï¼Œä»¥ä¾¿åœ¨å‡ ä¸ªæ­¥éª¤ä¸­è®¡ç®—è§£ç å’Œç¼–ç ã€‚è¿™å¯¹äºèŠ‚çœå¤§é‡å†…å­˜å¹¶å…è®¸å¤„ç†æ›´å¤§çš„å›¾åƒéå¸¸æœ‰ç”¨ã€‚

#### `encode_prompt`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl.py#L293)

```py
( prompt: str prompt_2: Optional = None device: Optional = None num_images_per_prompt: int = 1 do_classifier_free_guidance: bool = True negative_prompt: Optional = None negative_prompt_2: Optional = None prompt_embeds: Optional = None negative_prompt_embeds: Optional = None pooled_prompt_embeds: Optional = None negative_pooled_prompt_embeds: Optional = None lora_scale: Optional = None clip_skip: Optional = None )
```

å‚æ•°

+   `prompt` (`str` æˆ– `List[str]`, *å¯é€‰*) â€” è¦ç¼–ç çš„æç¤º

+   `prompt_2` (`str` æˆ– `List[str]`, *å¯é€‰*) â€” å‘é€åˆ° `tokenizer_2` å’Œ `text_encoder_2` çš„æç¤ºæˆ–æç¤ºã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™åœ¨ä¸¤ä¸ªæ–‡æœ¬ç¼–ç å™¨ä¸­ä½¿ç”¨ `prompt`ã€‚è®¾å¤‡ â€” (`torch.device`): torch è®¾å¤‡

+   `num_images_per_prompt` (`int`) â€” æ¯ä¸ªæç¤ºåº”ç”Ÿæˆçš„å›¾åƒæ•°é‡

+   `do_classifier_free_guidance` (`bool`) â€” æ˜¯å¦ä½¿ç”¨æ— åˆ†ç±»å™¨æŒ‡å¯¼

+   `negative_prompt` (`str` æˆ– `List[str]`, *å¯é€‰*) â€” ä¸æŒ‡å¯¼å›¾åƒç”Ÿæˆçš„æç¤ºæˆ–æç¤ºã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™å¿…é¡»ä¼ é€’ `negative_prompt_embeds`ã€‚å½“ä¸ä½¿ç”¨æŒ‡å¯¼æ—¶ï¼ˆå³ï¼Œå¦‚æœ `guidance_scale` å°äº `1`ï¼Œåˆ™å¿½ç•¥ï¼‰ã€‚

+   `negative_prompt_2` (`str` æˆ– `List[str]`, *å¯é€‰*) â€” ä¸æŒ‡å¯¼å›¾åƒç”Ÿæˆçš„æç¤ºæˆ–æç¤ºï¼Œå‘é€åˆ° `tokenizer_2` å’Œ `text_encoder_2`ã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™åœ¨ä¸¤ä¸ªæ–‡æœ¬ç¼–ç å™¨ä¸­ä½¿ç”¨ `negative_prompt`ã€‚

+   `prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„ç”Ÿæˆçš„æ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œ*ä¾‹å¦‚*æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œæ–‡æœ¬åµŒå…¥å°†ä» `prompt` è¾“å…¥å‚æ•°ç”Ÿæˆã€‚

+   `negative_prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„ç”Ÿæˆçš„è´Ÿæ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œ*ä¾‹å¦‚*æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä» `negative_prompt` è¾“å…¥å‚æ•°ç”Ÿæˆè´Ÿçš„æ–‡æœ¬åµŒå…¥ã€‚

+   `pooled_prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„ç”Ÿæˆçš„æ± åŒ–æ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œ*ä¾‹å¦‚*æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä» `prompt` è¾“å…¥å‚æ•°ç”Ÿæˆæ± åŒ–æ–‡æœ¬åµŒå…¥ã€‚

+   `negative_pooled_prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„ç”Ÿæˆçš„è´Ÿæ± åŒ–æ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œ*ä¾‹å¦‚*æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä» `negative_prompt` è¾“å…¥å‚æ•°ç”Ÿæˆè´Ÿçš„æ± åŒ–æ–‡æœ¬åµŒå…¥ã€‚

+   `lora_scale` (`float`, *å¯é€‰*) â€” å¦‚æœåŠ è½½äº† LoRA å±‚ï¼Œåˆ™å°†åº”ç”¨äºæ–‡æœ¬ç¼–ç å™¨çš„æ‰€æœ‰ LoRA å±‚çš„ lora æ¯”ä¾‹ã€‚

+   `clip_skip` (`int`, *å¯é€‰*) â€” åœ¨è®¡ç®—æç¤ºåµŒå…¥æ—¶è¦è·³è¿‡çš„å±‚æ•°ã€‚å€¼ä¸º 1 è¡¨ç¤ºå°†ä½¿ç”¨é¢„ç»ˆå±‚çš„è¾“å‡ºæ¥è®¡ç®—æç¤ºåµŒå…¥ã€‚

å°†æç¤ºç¼–ç ä¸ºæ–‡æœ¬ç¼–ç å™¨éšè—çŠ¶æ€ã€‚

#### `fuse_qkv_projections`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl.py#L762)

```py
( unet: bool = True vae: bool = True )
```

å‚æ•°

+   `unet` (`bool`, é»˜è®¤ä¸º `True`) â€” åœ¨ UNet ä¸Šåº”ç”¨èåˆã€‚

+   `vae` (`bool`, é»˜è®¤ä¸º `True`) â€” åœ¨ VAE ä¸Šåº”ç”¨èåˆã€‚

å¯ç”¨èåˆçš„ QKV æŠ•å½±ã€‚å¯¹äºè‡ªæ³¨æ„åŠ›æ¨¡å—ï¼Œæ‰€æœ‰æŠ•å½±çŸ©é˜µï¼ˆå³æŸ¥è¯¢ã€é”®ã€å€¼ï¼‰éƒ½è¢«èåˆã€‚å¯¹äºäº¤å‰æ³¨æ„åŠ›æ¨¡å—ï¼Œé”®å’Œå€¼æŠ•å½±çŸ©é˜µè¢«èåˆã€‚

æ­¤ API ä¸ºğŸ§ªå®éªŒæ€§è´¨ã€‚

#### `get_guidance_scale_embedding`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl.py#L822)

```py
( w embedding_dim = 512 dtype = torch.float32 ) â†’ export const metadata = 'undefined';torch.FloatTensor
```

å‚æ•°

+   `timesteps` (`torch.Tensor`) â€” åœ¨è¿™äº›æ—¶é—´æ­¥ç”ŸæˆåµŒå…¥å‘é‡

+   `embedding_dim` (`int`, *å¯é€‰*, é»˜è®¤ä¸º 512) â€” è¦ç”Ÿæˆçš„åµŒå…¥çš„ç»´åº¦ dtype â€” ç”Ÿæˆçš„åµŒå…¥çš„æ•°æ®ç±»å‹

è¿”å›

`torch.FloatTensor`

å½¢çŠ¶ä¸º`(len(timesteps), embedding_dim)`çš„åµŒå…¥å‘é‡

è¯·å‚é˜…[`github.com/google-research/vdm/blob/dc27b98a554f65cdc654b800da5aa1846545d41b/model_vdm.py#L298`](https://github.com/google-research/vdm/blob/dc27b98a554f65cdc654b800da5aa1846545d41b/model_vdm.py#L298)

#### `unfuse_qkv_projections`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl.py#L793)

```py
( unet: bool = True vae: bool = True )
```

å‚æ•°

+   `unet`ï¼ˆ`bool`ï¼Œé»˜è®¤ä¸º`True`ï¼‰- åœ¨ UNet ä¸Šåº”ç”¨èåˆã€‚

+   `vae`ï¼ˆ`bool`ï¼Œé»˜è®¤ä¸º`True`ï¼‰- åœ¨ VAE ä¸Šåº”ç”¨èåˆã€‚

å¦‚æœå¯ç”¨ï¼Œåˆ™ç¦ç”¨ QKV æŠ•å½±èåˆã€‚

æ­¤ API ä¸ºğŸ§ªå®éªŒæ€§è´¨ã€‚

## StableDiffusionXLImg2ImgPipeline

### `class diffusers.StableDiffusionXLImg2ImgPipeline`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_img2img.py#L167)

```py
( vae: AutoencoderKL text_encoder: CLIPTextModel text_encoder_2: CLIPTextModelWithProjection tokenizer: CLIPTokenizer tokenizer_2: CLIPTokenizer unet: UNet2DConditionModel scheduler: KarrasDiffusionSchedulers image_encoder: CLIPVisionModelWithProjection = None feature_extractor: CLIPImageProcessor = None requires_aesthetics_score: bool = False force_zeros_for_empty_prompt: bool = True add_watermarker: Optional = None )
```

å‚æ•°

+   `vae`ï¼ˆAutoencoderKLï¼‰- å˜åˆ†è‡ªåŠ¨ç¼–ç å™¨ï¼ˆVAEï¼‰æ¨¡å‹ï¼Œç”¨äºå¯¹å›¾åƒè¿›è¡Œç¼–ç å’Œè§£ç ï¼Œä»¥åŠä»æ½œåœ¨è¡¨ç¤ºä¸­è§£ç å›¾åƒã€‚

+   `text_encoder`ï¼ˆ`CLIPTextModel`ï¼‰- å†»ç»“çš„æ–‡æœ¬ç¼–ç å™¨ã€‚ Stable Diffusion XL ä½¿ç”¨[CLIP](https://huggingface.co/docs/transformers/model_doc/clip#transformers.CLIPTextModel)çš„æ–‡æœ¬éƒ¨åˆ†ï¼Œå…·ä½“æ¥è¯´æ˜¯[clip-vit-large-patch14](https://huggingface.co/openai/clip-vit-large-patch14)å˜ä½“ã€‚

+   `text_encoder_2`ï¼ˆ`CLIPTextModelWithProjection`ï¼‰- ç¬¬äºŒä¸ªå†»ç»“çš„æ–‡æœ¬ç¼–ç å™¨ã€‚ Stable Diffusion XL ä½¿ç”¨[CLIP](https://huggingface.co/docs/transformers/model_doc/clip#transformers.CLIPTextModelWithProjection)çš„æ–‡æœ¬å’Œæ± éƒ¨åˆ†ï¼Œå…·ä½“æ¥è¯´æ˜¯[laion/CLIP-ViT-bigG-14-laion2B-39B-b160k](https://huggingface.co/laion/CLIP-ViT-bigG-14-laion2B-39B-b160k)å˜ä½“ã€‚

+   `tokenizer`ï¼ˆ`CLIPTokenizer`ï¼‰- ç±»[CLIPTokenizer](https://huggingface.co/docs/transformers/v4.21.0/en/model_doc/clip#transformers.CLIPTokenizer)çš„åˆ†è¯å™¨ã€‚

+   `tokenizer_2`ï¼ˆ`CLIPTokenizer`ï¼‰- ç±»[CLIPTokenizer](https://huggingface.co/docs/transformers/v4.21.0/en/model_doc/clip#transformers.CLIPTokenizer)çš„ç¬¬äºŒä¸ªåˆ†è¯å™¨ã€‚

+   `unet`ï¼ˆUNet2DConditionModelï¼‰- ç”¨äºå»å™ªç¼–ç å›¾åƒæ½œå˜é‡çš„æ¡ä»¶ U-Net æ¶æ„ã€‚

+   `scheduler`ï¼ˆSchedulerMixinï¼‰- ä¸`unet`ç»“åˆä½¿ç”¨ä»¥å»å™ªç¼–ç å›¾åƒæ½œå˜é‡çš„è°ƒåº¦ç¨‹åºã€‚å¯ä»¥æ˜¯ DDIMSchedulerï¼ŒLMSDiscreteSchedulerï¼Œæˆ– PNDMScheduler ä¹‹ä¸€ã€‚

+   `requires_aesthetics_score`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`"False"`ï¼‰- åœ¨æ¨æ–­æœŸé—´ï¼Œ`unet`æ˜¯å¦éœ€è¦ä¼ é€’`aesthetic_score`æ¡ä»¶ã€‚è¿˜è¯·å‚é˜…`stabilityai/stable-diffusion-xl-refiner-1-0`çš„é…ç½®ã€‚

+   `force_zeros_for_empty_prompt`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º`"True"`ï¼‰- æ˜¯å¦å¼ºåˆ¶å°†è´Ÿæç¤ºåµŒå…¥å§‹ç»ˆè®¾ç½®ä¸º 0ã€‚è¿˜è¯·å‚é˜…`stabilityai/stable-diffusion-xl-base-1-0`çš„é…ç½®ã€‚

+   `add_watermarker`ï¼ˆ`bool`ï¼Œ*å¯é€‰*ï¼‰- æ˜¯å¦ä½¿ç”¨[invisible_watermark åº“](https://github.com/ShieldMnt/invisible-watermark/)æ¥ç»™è¾“å‡ºå›¾åƒæ·»åŠ æ°´å°ã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™å¦‚æœå®‰è£…äº†è¯¥è½¯ä»¶åŒ…ï¼Œåˆ™é»˜è®¤ä¸º Trueï¼Œå¦åˆ™å°†ä¸ä½¿ç”¨æ°´å°ã€‚

ä½¿ç”¨ Stable Diffusion XL è¿›è¡Œæ–‡æœ¬åˆ°å›¾åƒç”Ÿæˆçš„ç®¡é“ã€‚

æ­¤æ¨¡å‹ç»§æ‰¿è‡ª DiffusionPipelineã€‚æ£€æŸ¥åº“ä¸ºæ‰€æœ‰ç®¡é“å®ç°çš„é€šç”¨æ–¹æ³•ï¼ˆå¦‚ä¸‹è½½æˆ–ä¿å­˜ï¼Œè¿è¡Œåœ¨ç‰¹å®šè®¾å¤‡ä¸Šç­‰ï¼‰çš„è¶…ç±»æ–‡æ¡£ã€‚

è¯¥ç®¡é“è¿˜ç»§æ‰¿ä»¥ä¸‹åŠ è½½æ–¹æ³•ï¼š

+   load_textual_inversion() ç”¨äºåŠ è½½æ–‡æœ¬åæ¼”åµŒå…¥

+   from_single_file() ç”¨äºåŠ è½½`.ckpt`æ–‡ä»¶

+   load_lora_weights() ç”¨äºåŠ è½½ LoRA æƒé‡

+   `save_lora_weights()` ç”¨äºä¿å­˜ LoRA æƒé‡

+   load_ip_adapter() ç”¨äºåŠ è½½ IP é€‚é…å™¨

#### `__call__`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_img2img.py#L1026)

```py
( prompt: Union = None prompt_2: Union = None image: Union = None strength: float = 0.3 num_inference_steps: int = 50 timesteps: List = None denoising_start: Optional = None denoising_end: Optional = None guidance_scale: float = 5.0 negative_prompt: Union = None negative_prompt_2: Union = None num_images_per_prompt: Optional = 1 eta: float = 0.0 generator: Union = None latents: Optional = None prompt_embeds: Optional = None negative_prompt_embeds: Optional = None pooled_prompt_embeds: Optional = None negative_pooled_prompt_embeds: Optional = None ip_adapter_image: Union = None output_type: Optional = 'pil' return_dict: bool = True cross_attention_kwargs: Optional = None guidance_rescale: float = 0.0 original_size: Tuple = None crops_coords_top_left: Tuple = (0, 0) target_size: Tuple = None negative_original_size: Optional = None negative_crops_coords_top_left: Tuple = (0, 0) negative_target_size: Optional = None aesthetic_score: float = 6.0 negative_aesthetic_score: float = 2.5 clip_skip: Optional = None callback_on_step_end: Optional = None callback_on_step_end_tensor_inputs: List = ['latents'] **kwargs ) â†’ export const metadata = 'undefined';~pipelines.stable_diffusion.StableDiffusionXLPipelineOutput or tuple
```

å‚æ•°

+   `prompt` (`str` or `List[str]`, *optional*) â€” ç”¨äºå¼•å¯¼å›¾åƒç”Ÿæˆçš„æç¤ºæˆ–æç¤ºã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™å¿…é¡»ä¼ é€’`prompt_embeds`ã€‚

+   `prompt_2` (`str` or `List[str]`, *optional*) â€” è¦å‘é€åˆ°`tokenizer_2`å’Œ`text_encoder_2`çš„æç¤ºæˆ–æç¤ºã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™`prompt`å°†åœ¨ä¸¤ä¸ªæ–‡æœ¬ç¼–ç å™¨ä¸­ä½¿ç”¨ã€‚

+   `image` (`torch.FloatTensor` or `PIL.Image.Image` or `np.ndarray` or `List[torch.FloatTensor]` or `List[PIL.Image.Image]` or `List[np.ndarray]`) â€” è¦ä½¿ç”¨ç®¡é“ä¿®æ”¹çš„å›¾åƒã€‚

+   `strength` (`float`, *optional*, é»˜è®¤ä¸º 0.3) â€” åœ¨æ¦‚å¿µä¸Šï¼ŒæŒ‡ç¤ºè¦å¦‚ä½•è½¬æ¢å‚è€ƒ`image`çš„ç¨‹åº¦ã€‚å¿…é¡»ä»‹äº 0 å’Œ 1 ä¹‹é—´ã€‚`image`å°†è¢«ç”¨ä½œèµ·ç‚¹ï¼Œæ·»åŠ æ›´å¤šçš„å™ªéŸ³ï¼Œ`strength`è¶Šå¤§ã€‚å»å™ªæ­¥éª¤çš„æ•°é‡å–å†³äºæœ€åˆæ·»åŠ çš„å™ªéŸ³é‡ã€‚å½“`strength`ä¸º 1 æ—¶ï¼Œæ·»åŠ çš„å™ªéŸ³å°†è¾¾åˆ°æœ€å¤§å€¼ï¼Œå¹¶ä¸”å»å™ªè¿‡ç¨‹å°†è¿è¡ŒæŒ‡å®šçš„`num_inference_steps`çš„å®Œæ•´è¿­ä»£æ¬¡æ•°ã€‚å› æ­¤ï¼Œå€¼ä¸º 1 åŸºæœ¬ä¸Šå¿½ç•¥`image`ã€‚è¯·æ³¨æ„ï¼Œåœ¨å°†`denoising_start`å£°æ˜ä¸ºæ•´æ•°çš„æƒ…å†µä¸‹ï¼Œå°†å¿½ç•¥`strength`çš„å€¼ã€‚

+   `num_inference_steps` (`int`, *optional*, é»˜è®¤ä¸º 50) â€” å»å™ªæ­¥éª¤çš„æ•°é‡ã€‚æ›´å¤šçš„å»å™ªæ­¥éª¤é€šå¸¸ä¼šå¯¼è‡´å›¾åƒè´¨é‡æ›´é«˜ï¼Œä½†æ¨ç†é€Ÿåº¦è¾ƒæ…¢ã€‚

+   `timesteps` (`List[int]`, *optional*) â€” ç”¨äºå…·æœ‰æ”¯æŒ`timesteps`å‚æ•°çš„è°ƒåº¦å™¨çš„å»å™ªè¿‡ç¨‹çš„è‡ªå®šä¹‰æ—¶é—´æ­¥é•¿ï¼Œåœ¨å…¶`set_timesteps`æ–¹æ³•ä¸­ã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™å°†ä½¿ç”¨ä¼ é€’`num_inference_steps`æ—¶çš„é»˜è®¤è¡Œä¸ºã€‚å¿…é¡»æŒ‰é™åºæ’åˆ—ã€‚

+   `denoising_start` (`float`, *optional*) â€” å½“æŒ‡å®šæ—¶ï¼ŒæŒ‡ç¤ºåœ¨å¯åŠ¨ä¹‹å‰è¦ç»•è¿‡çš„æ€»å»å™ªè¿‡ç¨‹çš„æ¯”ä¾‹ï¼ˆä»‹äº 0.0 å’Œ 1.0 ä¹‹é—´ï¼‰ã€‚å› æ­¤ï¼Œå°†è·³è¿‡å»å™ªè¿‡ç¨‹çš„åˆå§‹éƒ¨åˆ†ï¼Œå¹¶å‡å®šä¼ é€’çš„`image`æ˜¯éƒ¨åˆ†å»å™ªçš„å›¾åƒã€‚è¯·æ³¨æ„ï¼Œå½“æŒ‡å®šæ­¤å‚æ•°æ—¶ï¼Œå°†å¿½ç•¥å¼ºåº¦ã€‚å½“æ­¤ç®¡é“è¢«é›†æˆåˆ°â€œå»å™ªå™¨æ··åˆâ€å¤šç®¡é“è®¾ç½®ä¸­æ—¶ï¼Œ`denoising_start`å‚æ•°ç‰¹åˆ«æœ‰ç›Šï¼Œå¦‚[`Refine Image Quality`](https://huggingface.co/docs/diffusers/using-diffusers/sdxl#refine-image-quality)ä¸­æ‰€è¿°ã€‚

+   `denoising_end` (`float`, *optional*) â€” å½“æŒ‡å®šæ—¶ï¼Œç¡®å®šåœ¨æ•…æ„æå‰ç»ˆæ­¢ä¹‹å‰å®Œæˆçš„å»å™ªè¿‡ç¨‹çš„æ¯”ä¾‹ï¼ˆä»‹äº 0.0 å’Œ 1.0 ä¹‹é—´ï¼‰ã€‚å› æ­¤ï¼Œè¿”å›çš„æ ·æœ¬ä»å°†ä¿ç•™ç›¸å½“å¤šçš„å™ªéŸ³ï¼ˆçº¦å‰©ä½™ 20%çš„æ—¶é—´æ­¥ä»ç„¶éœ€è¦ï¼‰ï¼Œåº”ç”±åç»­ç®¡é“è¿›è¡Œå»å™ªï¼Œè¯¥ç®¡é“çš„`denoising_start`è®¾ç½®ä¸º 0.8ï¼Œä»¥ä¾¿ä»…å¯¹è°ƒåº¦ç¨‹åºçš„æœ€å 20%è¿›è¡Œå»å™ªã€‚å½“æ­¤ç®¡é“ä½œä¸ºâ€œå»å™ªå™¨æ··åˆâ€å¤šç®¡é“è®¾ç½®çš„ä¸€éƒ¨åˆ†æ—¶ï¼Œåº”ç†æƒ³åœ°åˆ©ç”¨`denoising_end`å‚æ•°ï¼Œå¦‚[`Refine Image Quality`](https://huggingface.co/docs/diffusers/using-diffusers/sdxl#refine-image-quality)ä¸­æ‰€è¿°ã€‚

+   `guidance_scale` (`float`, *å¯é€‰*, é»˜è®¤ä¸º 7.5) â€” åœ¨[æ— åˆ†ç±»å™¨æ‰©æ•£æŒ‡å¯¼](https://arxiv.org/abs/2207.12598)ä¸­å®šä¹‰çš„æŒ‡å¯¼å°ºåº¦ã€‚`guidance_scale`è¢«å®šä¹‰ä¸º[Imagen Paper](https://arxiv.org/pdf/2205.11487.pdf)ä¸­æ–¹ç¨‹ 2 çš„`w`ã€‚é€šè¿‡è®¾ç½®`guidance_scale > 1`å¯ç”¨æŒ‡å¯¼å°ºåº¦ã€‚æ›´é«˜çš„æŒ‡å¯¼å°ºåº¦é¼“åŠ±ç”Ÿæˆä¸æ–‡æœ¬`prompt`å¯†åˆ‡ç›¸å…³çš„å›¾åƒï¼Œé€šå¸¸ä»¥é™ä½å›¾åƒè´¨é‡ä¸ºä»£ä»·ã€‚

+   `negative_prompt` (`str` æˆ– `List[str]`, *å¯é€‰*) â€” ä¸ç”¨æ¥æŒ‡å¯¼å›¾åƒç”Ÿæˆçš„æç¤ºæˆ–æç¤ºã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™å¿…é¡»ä¼ é€’`negative_prompt_embeds`ã€‚åœ¨ä¸ä½¿ç”¨æŒ‡å¯¼æ—¶è¢«å¿½ç•¥ï¼ˆå³å¦‚æœ`guidance_scale`å°äº`1`ï¼Œåˆ™è¢«å¿½ç•¥ï¼‰ã€‚

+   `negative_prompt_2` (`str` æˆ– `List[str]`, *å¯é€‰*) â€” ç”¨äºæŒ‡å¯¼å‘é€åˆ°`tokenizer_2`å’Œ`text_encoder_2`çš„å›¾åƒç”Ÿæˆçš„æç¤ºæˆ–æç¤ºã€‚å¦‚æœæœªå®šä¹‰ï¼Œå°†åœ¨ä¸¤ä¸ªæ–‡æœ¬ç¼–ç å™¨ä¸­ä½¿ç”¨`negative_prompt`ã€‚

+   `num_images_per_prompt` (`int`, *å¯é€‰*, é»˜è®¤ä¸º 1) â€” æ¯ä¸ªæç¤ºç”Ÿæˆçš„å›¾åƒæ•°é‡ã€‚

+   `eta` (`float`, *å¯é€‰*, é»˜è®¤ä¸º 0.0) â€” å¯¹åº”äº DDIM è®ºæ–‡ä¸­çš„å‚æ•° eta (Î·)ï¼š[`arxiv.org/abs/2010.02502`](https://arxiv.org/abs/2010.02502)ã€‚ä»…é€‚ç”¨äº schedulers.DDIMSchedulerï¼Œå¯¹å…¶ä»–æƒ…å†µå°†è¢«å¿½ç•¥ã€‚

+   `generator` (`torch.Generator` æˆ– `List[torch.Generator]`, *å¯é€‰*) â€” ä¸€ä¸ªæˆ–å¤šä¸ª [torch ç”Ÿæˆå™¨](https://pytorch.org/docs/stable/generated/torch.Generator.html)ï¼Œç”¨äºä½¿ç”Ÿæˆè¿‡ç¨‹ç¡®å®šæ€§ã€‚

+   `latents` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„ç”Ÿæˆçš„å˜ˆæ‚æ½œå˜é‡ï¼Œä»é«˜æ–¯åˆ†å¸ƒä¸­é‡‡æ ·ï¼Œç”¨ä½œå›¾åƒç”Ÿæˆçš„è¾“å…¥ã€‚å¯ç”¨äºä½¿ç”¨ä¸åŒæç¤ºè°ƒæ•´ç›¸åŒç”Ÿæˆã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä½¿ç”¨æä¾›çš„éšæœº`generator`è¿›è¡Œé‡‡æ ·ç”Ÿæˆæ½œå˜é‡å¼ é‡ã€‚

+   `prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„ç”Ÿæˆçš„æ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œä¾‹å¦‚æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä»`prompt`è¾“å…¥å‚æ•°ç”Ÿæˆæ–‡æœ¬åµŒå…¥ã€‚

+   `negative_prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„ç”Ÿæˆçš„è´Ÿé¢æ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œä¾‹å¦‚æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä»`negative_prompt`è¾“å…¥å‚æ•°ç”Ÿæˆ negative_prompt_embedsã€‚

+   `pooled_prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„ç”Ÿæˆçš„æ± åŒ–æ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œä¾‹å¦‚æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä»`prompt`è¾“å…¥å‚æ•°ç”Ÿæˆæ± åŒ–çš„æ–‡æœ¬åµŒå…¥ã€‚

+   `negative_pooled_prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„ç”Ÿæˆçš„è´Ÿé¢æ± åŒ–æ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œä¾‹å¦‚æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä»`negative_prompt`è¾“å…¥å‚æ•°ç”Ÿæˆæ± åŒ–çš„ negative_prompt_embedsã€‚

+   `output_type` (`str`, *å¯é€‰*, é»˜è®¤ä¸º`"pil"`) â€” ç”Ÿæˆå›¾åƒçš„è¾“å‡ºæ ¼å¼ã€‚åœ¨ [PIL](https://pillow.readthedocs.io/en/stable/) ä¸­é€‰æ‹©ï¼š`PIL.Image.Image` æˆ– `np.array`ã€‚

+   `return_dict` (`bool`, *å¯é€‰*, é»˜è®¤ä¸º `True`) â€” æ˜¯å¦è¿”å›`~pipelines.stable_diffusion.StableDiffusionXLPipelineOutput`è€Œä¸æ˜¯æ™®é€šå…ƒç»„ã€‚

+   `cross_attention_kwargs` (`dict`, *å¯é€‰*) â€” å¦‚æœæŒ‡å®šï¼Œå°†ä¼ é€’ç»™`AttentionProcessor`çš„ kwargs å­—å…¸ï¼Œå¦‚åœ¨ [diffusers.models.attention_processor](https://github.com/huggingface/diffusers/blob/main/src/diffusers/models/attention_processor.py) ä¸­çš„`self.processor`ä¸­å®šä¹‰çš„é‚£æ ·ã€‚

+   `guidance_rescale` (`float`, *optional*, defaults to 0.0) â€” [Common Diffusion Noise Schedules and Sample Steps are Flawed](https://arxiv.org/pdf/2305.08891.pdf)æå‡ºçš„æŒ‡å¯¼ç¼©æ”¾å› å­ã€‚`guidance_scale`åœ¨[Common Diffusion Noise Schedules and Sample Steps are Flawed](https://arxiv.org/pdf/2305.08891.pdf)çš„æ–¹ç¨‹å¼ 16 ä¸­å®šä¹‰ä¸º`Ï†`ã€‚æŒ‡å¯¼ç¼©æ”¾å› å­åº”åœ¨ä½¿ç”¨é›¶ç»ˆç«¯ä¿¡å™ªæ¯”æ—¶ä¿®å¤è¿‡æ›å…‰é—®é¢˜ã€‚

+   `original_size` (`Tuple[int]`, *optional*, defaults to (1024, 1024)) â€” å¦‚æœ`original_size`ä¸`target_size`ä¸åŒï¼Œå›¾åƒå°†å‘ˆç°ä¸ºç¼©å°æˆ–æ”¾å¤§ã€‚å¦‚æœæœªæŒ‡å®šï¼Œ`original_size`é»˜è®¤ä¸º`(height, width)`ã€‚è¿™æ˜¯ SDXL å¾®è°ƒçš„ä¸€éƒ¨åˆ†ï¼Œå¦‚[`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952)ç¬¬ 2.2 èŠ‚æ‰€è¿°ã€‚

+   `crops_coords_top_left` (`Tuple[int]`, *optional*, defaults to (0, 0)) â€” `crops_coords_top_left`å¯ç”¨äºç”Ÿæˆä¸€ä¸ªçœ‹èµ·æ¥ä»ä½ç½®`crops_coords_top_left`å‘ä¸‹â€œè£å‰ªâ€çš„å›¾åƒã€‚é€šå¸¸é€šè¿‡å°†`crops_coords_top_left`è®¾ç½®ä¸º(0, 0)æ¥å®ç°ä»¤äººæ»¡æ„ã€å±…ä¸­çš„å›¾åƒã€‚è¿™æ˜¯ SDXL å¾®è°ƒçš„ä¸€éƒ¨åˆ†ï¼Œå¦‚[`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952)ç¬¬ 2.2 èŠ‚æ‰€è¿°ã€‚

+   `target_size` (`Tuple[int]`, *optional*, defaults to (1024, 1024)) â€” å¯¹äºå¤§å¤šæ•°æƒ…å†µï¼Œ`target_size`åº”è®¾ç½®ä¸ºç”Ÿæˆå›¾åƒçš„æœŸæœ›é«˜åº¦å’Œå®½åº¦ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå®ƒå°†é»˜è®¤ä¸º`(height, width)`ã€‚è¿™æ˜¯ SDXL å¾®è°ƒçš„ä¸€éƒ¨åˆ†ï¼Œå¦‚[`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952)ç¬¬ 2.2 èŠ‚æ‰€è¿°ã€‚

+   `negative_original_size` (`Tuple[int]`, *optional*, defaults to (1024, 1024)) â€” åŸºäºç‰¹å®šå›¾åƒåˆ†è¾¨ç‡å¯¹ç”Ÿæˆè¿‡ç¨‹è¿›è¡Œè´Ÿé¢è°ƒèŠ‚ã€‚è¿™æ˜¯ SDXL å¾®è°ƒçš„ä¸€éƒ¨åˆ†ï¼Œå¦‚[`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952)ç¬¬ 2.2 èŠ‚æ‰€è¿°ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒæ­¤é—®é¢˜çº¿ç¨‹ï¼š[`github.com/huggingface/diffusers/issues/4208`](https://github.com/huggingface/diffusers/issues/4208)ã€‚

+   `negative_crops_coords_top_left` (`Tuple[int]`, *optional*, defaults to (0, 0)) â€” åŸºäºç‰¹å®šè£å‰ªåæ ‡å¯¹ç”Ÿæˆè¿‡ç¨‹è¿›è¡Œè´Ÿé¢è°ƒèŠ‚ã€‚è¿™æ˜¯ SDXL å¾®è°ƒçš„ä¸€éƒ¨åˆ†ï¼Œå¦‚[`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952)ç¬¬ 2.2 èŠ‚æ‰€è¿°ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒæ­¤é—®é¢˜çº¿ç¨‹ï¼š[`github.com/huggingface/diffusers/issues/4208`](https://github.com/huggingface/diffusers/issues/4208)ã€‚

+   `negative_target_size` (`Tuple[int]`, *optional*, defaults to (1024, 1024)) â€” åŸºäºç›®æ ‡å›¾åƒåˆ†è¾¨ç‡å¯¹ç”Ÿæˆè¿‡ç¨‹è¿›è¡Œè´Ÿé¢è°ƒèŠ‚ã€‚å¯¹äºå¤§å¤šæ•°æƒ…å†µï¼Œå®ƒåº”ä¸`target_size`ç›¸åŒã€‚è¿™æ˜¯ SDXL å¾®è°ƒçš„ä¸€éƒ¨åˆ†ï¼Œå¦‚[`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952)ç¬¬ 2.2 èŠ‚æ‰€è¿°ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒæ­¤é—®é¢˜çº¿ç¨‹ï¼š[`github.com/huggingface/diffusers/issues/4208`](https://github.com/huggingface/diffusers/issues/4208)ã€‚

+   `aesthetic_score` (`float`, *optional*, defaults to 6.0) â€” é€šè¿‡å½±å“æ­£æ–‡æœ¬æ¡ä»¶æ¥æ¨¡æ‹Ÿç”Ÿæˆå›¾åƒçš„å®¡ç¾è¯„åˆ†ã€‚è¿™æ˜¯ SDXL å¾®è°ƒçš„ä¸€éƒ¨åˆ†ï¼Œå¦‚[`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952)ç¬¬ 2.2 èŠ‚æ‰€è¿°ã€‚

+   `negative_aesthetic_score` (`float`, *optional*, defaults to 2.5) â€” è¿™æ˜¯ SDXL å¾®è°ƒçš„ä¸€éƒ¨åˆ†ï¼Œå¦‚[`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952)ç¬¬ 2.2 èŠ‚æ‰€è¿°ã€‚å¯ç”¨äºé€šè¿‡å½±å“è´Ÿæ–‡æœ¬æ¡ä»¶æ¥æ¨¡æ‹Ÿç”Ÿæˆå›¾åƒçš„å®¡ç¾è¯„åˆ†ã€‚

+   `clip_skip` (`int`, *å¯é€‰*) â€” åœ¨è®¡ç®—æç¤ºåµŒå…¥æ—¶è¦ä» CLIP ä¸­è·³è¿‡çš„å±‚æ•°ã€‚å€¼ä¸º 1 æ„å‘³ç€å°†ä½¿ç”¨é¢„æœ€ç»ˆå±‚çš„è¾“å‡ºæ¥è®¡ç®—æç¤ºåµŒå…¥ã€‚

+   `callback_on_step_end` (`Callable`, *å¯é€‰*) â€” åœ¨æ¨æ–­æœŸé—´æ¯ä¸ªå»å™ªæ­¥éª¤ç»“æŸæ—¶è°ƒç”¨çš„å‡½æ•°ã€‚è¯¥å‡½æ•°å°†ä½¿ç”¨ä»¥ä¸‹å‚æ•°è°ƒç”¨ï¼š`callback_on_step_end(self: DiffusionPipeline, step: int, timestep: int, callback_kwargs: Dict)`ã€‚`callback_kwargs`å°†åŒ…æ‹¬ç”±`callback_on_step_end_tensor_inputs`æŒ‡å®šçš„æ‰€æœ‰å¼ é‡çš„åˆ—è¡¨ã€‚

+   `callback_on_step_end_tensor_inputs` (`List`, *å¯é€‰*) â€” `callback_on_step_end`å‡½æ•°çš„å¼ é‡è¾“å…¥åˆ—è¡¨ã€‚åˆ—è¡¨ä¸­æŒ‡å®šçš„å¼ é‡å°†ä½œä¸º`callback_kwargs`å‚æ•°ä¼ é€’ã€‚æ‚¨åªèƒ½åŒ…å«åœ¨æ‚¨çš„ç®¡é“ç±»çš„`._callback_tensor_inputs`å±æ€§ä¸­åˆ—å‡ºçš„å˜é‡ã€‚

è¿”å›

`~pipelines.stable_diffusion.StableDiffusionXLPipelineOutput` æˆ– `tuple`

`~pipelines.stable_diffusion.StableDiffusionXLPipelineOutput` å¦‚æœ`return_dict`ä¸º Trueï¼Œå¦åˆ™ä¸º`tuple`ã€‚å½“è¿”å›ä¸€ä¸ªå…ƒç»„æ—¶ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯åŒ…å«ç”Ÿæˆå›¾åƒçš„åˆ—è¡¨ã€‚

è°ƒç”¨ç®¡é“ç”Ÿæˆæ—¶è°ƒç”¨çš„å‡½æ•°ã€‚

ç¤ºä¾‹ï¼š

```py
>>> import torch
>>> from diffusers import StableDiffusionXLImg2ImgPipeline
>>> from diffusers.utils import load_image

>>> pipe = StableDiffusionXLImg2ImgPipeline.from_pretrained(
...     "stabilityai/stable-diffusion-xl-refiner-1.0", torch_dtype=torch.float16
... )
>>> pipe = pipe.to("cuda")
>>> url = "https://huggingface.co/datasets/patrickvonplaten/images/resolve/main/aa_xl/000000009.png"

>>> init_image = load_image(url).convert("RGB")
>>> prompt = "a photo of an astronaut riding a horse on mars"
>>> image = pipe(prompt, image=init_image).images[0]
```

#### `disable_freeu`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_img2img.py#L893)

```py
( )
```

å¦‚æœå·²å¯ç”¨ï¼Œåˆ™ç¦ç”¨ FreeU æœºåˆ¶ã€‚

#### `disable_vae_slicing`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_img2img.py#L290)

```py
( )
```

ç¦ç”¨åˆ‡ç‰‡ VAE è§£ç ã€‚å¦‚æœä¹‹å‰å¯ç”¨äº†`enable_vae_slicing`ï¼Œåˆ™æ­¤æ–¹æ³•å°†è¿”å›åˆ°ä¸€æ­¥è®¡ç®—è§£ç ã€‚

#### `disable_vae_tiling`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_img2img.py#L307)

```py
( )
```

ç¦ç”¨å¹³é“º VAE è§£ç ã€‚å¦‚æœä¹‹å‰å¯ç”¨äº†`enable_vae_tiling`ï¼Œåˆ™æ­¤æ–¹æ³•å°†è¿”å›åˆ°ä¸€æ­¥è®¡ç®—è§£ç ã€‚

#### `enable_freeu`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_img2img.py#L870)

```py
( s1: float s2: float b1: float b2: float )
```

å‚æ•°

+   `s1` (`float`) â€” é˜¶æ®µ 1 çš„ç¼©æ”¾å› å­ï¼Œç”¨äºå‡å¼±è·³è·ƒç‰¹å¾çš„è´¡çŒ®ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†å‡è½»å¢å¼ºå»å™ªè¿‡ç¨‹ä¸­çš„â€œè¿‡åº¦å¹³æ»‘æ•ˆæœâ€ã€‚

+   `s2` (`float`) â€” é˜¶æ®µ 2 çš„ç¼©æ”¾å› å­ï¼Œç”¨äºå‡å¼±è·³è·ƒç‰¹å¾çš„è´¡çŒ®ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†å‡è½»å¢å¼ºå»å™ªè¿‡ç¨‹ä¸­çš„â€œè¿‡åº¦å¹³æ»‘æ•ˆæœâ€ã€‚

+   `b1` (`float`) â€” é˜¶æ®µ 1 çš„ç¼©æ”¾å› å­ï¼Œç”¨äºæ”¾å¤§éª¨å¹²ç‰¹å¾çš„è´¡çŒ®ã€‚

+   `b2` (`float`) â€” é˜¶æ®µ 2 çš„ç¼©æ”¾å› å­ï¼Œç”¨äºæ”¾å¤§éª¨å¹²ç‰¹å¾çš„è´¡çŒ®ã€‚

å¯ç”¨ FreeU æœºåˆ¶ï¼Œå¦‚[`arxiv.org/abs/2309.11497`](https://arxiv.org/abs/2309.11497)ä¸­æ‰€è¿°ã€‚

ç¼©æ”¾å› å­åç¼€è¡¨ç¤ºå®ƒä»¬è¢«åº”ç”¨çš„é˜¶æ®µã€‚

è¯·å‚è€ƒ[å®˜æ–¹å­˜å‚¨åº“](https://github.com/ChenyangSi/FreeU)ï¼Œäº†è§£å·²çŸ¥é€‚ç”¨äºä¸åŒç®¡é“ï¼ˆå¦‚ Stable Diffusion v1ã€v2 å’Œ Stable Diffusion XLï¼‰çš„å€¼ç»„åˆã€‚

#### `enable_vae_slicing`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_img2img.py#L282)

```py
( )
```

å¯ç”¨åˆ‡ç‰‡ VAE è§£ç ã€‚å½“å¯ç”¨æ­¤é€‰é¡¹æ—¶ï¼ŒVAE å°†å°†è¾“å…¥å¼ é‡åˆ†å‰²æˆç‰‡æ®µï¼Œä»¥ä¾¿åœ¨å¤šä¸ªæ­¥éª¤ä¸­è®¡ç®—è§£ç ã€‚è¿™å¯¹äºèŠ‚çœä¸€äº›å†…å­˜å¹¶å…è®¸æ›´å¤§çš„æ‰¹é‡å¤§å°å¾ˆæœ‰ç”¨ã€‚

#### `enable_vae_tiling`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_img2img.py#L298)

```py
( )
```

å¯ç”¨å¹³é“ºçš„ VAE è§£ç ã€‚å½“å¯ç”¨æ­¤é€‰é¡¹æ—¶ï¼ŒVAE å°†å°†è¾“å…¥å¼ é‡åˆ†å‰²æˆç“¦ç‰‡ï¼Œä»¥ä¾¿åœ¨å‡ ä¸ªæ­¥éª¤ä¸­è®¡ç®—è§£ç å’Œç¼–ç ã€‚è¿™å¯¹äºèŠ‚çœå¤§é‡å†…å­˜å¹¶å…è®¸å¤„ç†æ›´å¤§çš„å›¾åƒéå¸¸æœ‰ç”¨ã€‚

#### `encode_prompt`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_img2img.py#L315)

```py
( prompt: str prompt_2: Optional = None device: Optional = None num_images_per_prompt: int = 1 do_classifier_free_guidance: bool = True negative_prompt: Optional = None negative_prompt_2: Optional = None prompt_embeds: Optional = None negative_prompt_embeds: Optional = None pooled_prompt_embeds: Optional = None negative_pooled_prompt_embeds: Optional = None lora_scale: Optional = None clip_skip: Optional = None )
```

å‚æ•°

+   `prompt` (`str`æˆ–`List[str]`ï¼Œ*å¯é€‰*) â€” è¦ç¼–ç çš„æç¤º

+   `prompt_2` (`str`æˆ–`List[str]`ï¼Œ*å¯é€‰*) â€” è¦å‘é€åˆ°`tokenizer_2`å’Œ`text_encoder_2`çš„æç¤ºæˆ–æç¤ºã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™åœ¨ä¸¤ä¸ªæ–‡æœ¬ç¼–ç å™¨ä¸­éƒ½ä½¿ç”¨`prompt`è®¾å¤‡ â€” (`torch.device`): torch è®¾å¤‡

+   `num_images_per_prompt` (`int`) â€” æ¯ä¸ªæç¤ºåº”ç”Ÿæˆçš„å›¾åƒæ•°é‡

+   `do_classifier_free_guidance` (`bool`) â€” æ˜¯å¦ä½¿ç”¨æ— åˆ†ç±»å™¨æŒ‡å¯¼

+   `negative_prompt` (`str`æˆ–`List[str]`ï¼Œ*å¯é€‰*) â€” ä¸æŒ‡å¯¼å›¾åƒç”Ÿæˆçš„æç¤ºæˆ–æç¤ºã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™å¿…é¡»ä¼ é€’`negative_prompt_embeds`ã€‚å½“ä¸ä½¿ç”¨æŒ‡å¯¼æ—¶ï¼ˆå³ï¼Œå¦‚æœ`guidance_scale`å°äº`1`ï¼Œåˆ™å¿½ç•¥ï¼‰ã€‚

+   `negative_prompt_2` (`str`æˆ–`List[str]`ï¼Œ*å¯é€‰*) â€” ä¸æŒ‡å¯¼å›¾åƒç”Ÿæˆçš„æç¤ºæˆ–æç¤ºï¼Œè¦å‘é€åˆ°`tokenizer_2`å’Œ`text_encoder_2`ã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™åœ¨ä¸¤ä¸ªæ–‡æœ¬ç¼–ç å™¨ä¸­éƒ½ä½¿ç”¨`negative_prompt`

+   `prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„ç”Ÿæˆçš„æ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œ*ä¾‹å¦‚*æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä»`prompt`è¾“å…¥å‚æ•°ç”Ÿæˆæ–‡æœ¬åµŒå…¥ã€‚

+   `negative_prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„ç”Ÿæˆçš„è´Ÿæ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œ*ä¾‹å¦‚*æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä»`negative_prompt`è¾“å…¥å‚æ•°ç”Ÿæˆè´Ÿæ–‡æœ¬åµŒå…¥ã€‚

+   `pooled_prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„ç”Ÿæˆçš„æ±‡æ€»æ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œ*ä¾‹å¦‚*æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä»`prompt`è¾“å…¥å‚æ•°ç”Ÿæˆæ±‡æ€»æ–‡æœ¬åµŒå…¥ã€‚

+   `negative_pooled_prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„ç”Ÿæˆçš„è´Ÿæ±‡æ€»æ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œ*ä¾‹å¦‚*æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä»`negative_prompt`è¾“å…¥å‚æ•°ç”Ÿæˆè´Ÿæ±‡æ€»æ–‡æœ¬åµŒå…¥ã€‚

+   `lora_scale` (`float`ï¼Œ*å¯é€‰*) â€” å¦‚æœåŠ è½½äº† LoRA å±‚ï¼Œåˆ™å°†åº”ç”¨äºæ–‡æœ¬ç¼–ç å™¨çš„æ‰€æœ‰ LoRA å±‚çš„ lora æ¯”ä¾‹ã€‚

+   `clip_skip` (`int`ï¼Œ*å¯é€‰*) â€” åœ¨è®¡ç®—æç¤ºåµŒå…¥æ—¶è¦ä» CLIP ä¸­è·³è¿‡çš„å±‚æ•°ã€‚å€¼ä¸º 1 æ„å‘³ç€å°†ä½¿ç”¨é¢„æœ€ç»ˆå±‚çš„è¾“å‡ºæ¥è®¡ç®—æç¤ºåµŒå…¥ã€‚

å°†æç¤ºç¼–ç ä¸ºæ–‡æœ¬ç¼–ç å™¨éšè—çŠ¶æ€ã€‚

#### `fuse_qkv_projections`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_img2img.py#L898)

```py
( unet: bool = True vae: bool = True )
```

å‚æ•°

+   `unet` (`bool`ï¼Œé»˜è®¤ä¸º`True`) â€” åœ¨ UNet ä¸Šåº”ç”¨èåˆã€‚

+   `vae` (`bool`ï¼Œé»˜è®¤ä¸º`True`) â€” åœ¨ VAE ä¸Šåº”ç”¨èåˆã€‚

å¯ç”¨èåˆçš„ QKV æŠ•å½±ã€‚å¯¹äºè‡ªæ³¨æ„åŠ›æ¨¡å—ï¼Œæ‰€æœ‰æŠ•å½±çŸ©é˜µï¼ˆå³æŸ¥è¯¢ã€é”®ã€å€¼ï¼‰éƒ½è¢«èåˆã€‚å¯¹äºäº¤å‰æ³¨æ„åŠ›æ¨¡å—ï¼Œé”®å’Œå€¼æŠ•å½±çŸ©é˜µè¢«èåˆã€‚

æ­¤ API ä¸ºğŸ§ªå®éªŒæ€§è´¨ã€‚

#### `get_guidance_scale_embedding`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_img2img.py#L959)

```py
( w embedding_dim = 512 dtype = torch.float32 ) â†’ export const metadata = 'undefined';torch.FloatTensor
```

å‚æ•°

+   `timesteps` (`torch.Tensor`) â€” åœ¨è¿™äº›æ—¶é—´æ­¥ç”ŸæˆåµŒå…¥å‘é‡

+   `embedding_dim` (`int`ï¼Œ*å¯é€‰*ï¼Œé»˜è®¤ä¸º 512) â€” è¦ç”Ÿæˆçš„åµŒå…¥çš„ç»´åº¦ dtype â€” ç”Ÿæˆçš„åµŒå…¥çš„æ•°æ®ç±»å‹

è¿”å›

`torch.FloatTensor`

å½¢çŠ¶ä¸º`(len(timesteps), embedding_dim)`çš„åµŒå…¥å‘é‡

å‚è§[`github.com/google-research/vdm/blob/dc27b98a554f65cdc654b800da5aa1846545d41b/model_vdm.py#L298`](https://github.com/google-research/vdm/blob/dc27b98a554f65cdc654b800da5aa1846545d41b/model_vdm.py#L298)

#### `unfuse_qkv_projections`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_img2img.py#L930)

```py
( unet: bool = True vae: bool = True )
```

å‚æ•°

+   `unet` (`bool`, é»˜è®¤ä¸º `True`) â€” å¯¹ UNet åº”ç”¨èåˆã€‚

+   `vae` (`bool`, é»˜è®¤ä¸º `True`) â€” å¯¹ VAE åº”ç”¨èåˆã€‚

å¦‚æœå¯ç”¨ï¼Œåˆ™ç¦ç”¨ QKV æŠ•å½±èåˆã€‚

æ­¤ API ä¸ºğŸ§ªå®éªŒæ€§è´¨ã€‚

## StableDiffusionXLInpaintPipeline

### `class diffusers.StableDiffusionXLInpaintPipeline`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_inpaint.py#L312)

```py
( vae: AutoencoderKL text_encoder: CLIPTextModel text_encoder_2: CLIPTextModelWithProjection tokenizer: CLIPTokenizer tokenizer_2: CLIPTokenizer unet: UNet2DConditionModel scheduler: KarrasDiffusionSchedulers image_encoder: CLIPVisionModelWithProjection = None feature_extractor: CLIPImageProcessor = None requires_aesthetics_score: bool = False force_zeros_for_empty_prompt: bool = True add_watermarker: Optional = None )
```

å‚æ•°

+   `vae` (AutoencoderKL) â€” å˜åˆ†è‡ªåŠ¨ç¼–ç å™¨ï¼ˆVAEï¼‰æ¨¡å‹ï¼Œç”¨äºå¯¹å›¾åƒè¿›è¡Œç¼–ç å’Œè§£ç ä»¥åŠä»æ½œåœ¨è¡¨ç¤ºä¸­è§£ç å›¾åƒã€‚

+   `text_encoder` (`CLIPTextModel`) â€” å†»ç»“çš„æ–‡æœ¬ç¼–ç å™¨ã€‚Stable Diffusion XL ä½¿ç”¨[CLIP](https://huggingface.co/docs/transformers/model_doc/clip#transformers.CLIPTextModel)çš„æ–‡æœ¬éƒ¨åˆ†ï¼Œå…·ä½“æ¥è¯´æ˜¯[clip-vit-large-patch14](https://huggingface.co/openai/clip-vit-large-patch14)å˜ä½“ã€‚

+   `text_encoder_2` (`CLIPTextModelWithProjection`) â€” ç¬¬äºŒä¸ªå†»ç»“çš„æ–‡æœ¬ç¼–ç å™¨ã€‚Stable Diffusion XL ä½¿ç”¨[CLIP](https://huggingface.co/docs/transformers/model_doc/clip#transformers.CLIPTextModelWithProjection)çš„æ–‡æœ¬å’Œæ± éƒ¨åˆ†ï¼Œå…·ä½“æ¥è¯´æ˜¯[laion/CLIP-ViT-bigG-14-laion2B-39B-b160k](https://huggingface.co/laion/CLIP-ViT-bigG-14-laion2B-39B-b160k)å˜ä½“ã€‚

+   `tokenizer` (`CLIPTokenizer`) â€” ç±»[CLIPTokenizer](https://huggingface.co/docs/transformers/v4.21.0/en/model_doc/clip#transformers.CLIPTokenizer)çš„ Tokenizerã€‚

+   `tokenizer_2` (`CLIPTokenizer`) â€” ç¬¬äºŒä¸ª Tokenizer çš„ç±»[CLIPTokenizer](https://huggingface.co/docs/transformers/v4.21.0/en/model_doc/clip#transformers.CLIPTokenizer)ã€‚

+   `unet` (UNet2DConditionModel) â€” ç”¨äºå»å™ªç¼–ç å›¾åƒæ½œåœ¨ç‰¹å¾çš„æ¡ä»¶ U-Net æ¶æ„ã€‚

+   `scheduler` (SchedulerMixin) â€” ç”¨äºä¸`unet`ç»“åˆä½¿ç”¨ä»¥å»å™ªç¼–ç å›¾åƒæ½œåœ¨ç‰¹å¾çš„è°ƒåº¦å™¨ã€‚å¯ä»¥æ˜¯ DDIMSchedulerã€LMSDiscreteScheduler æˆ– PNDMScheduler ä¹‹ä¸€ã€‚

+   `requires_aesthetics_score` (`bool`, *å¯é€‰*, é»˜è®¤ä¸º `"False"`) â€” `unet`åœ¨æ¨æ–­è¿‡ç¨‹ä¸­æ˜¯å¦éœ€è¦é€šè¿‡å®¡ç¾åˆ†æ•°æ¡ä»¶ã€‚è¿˜è¯·å‚é˜…`stabilityai/stable-diffusion-xl-refiner-1-0`çš„é…ç½®ã€‚

+   `force_zeros_for_empty_prompt` (`bool`, *å¯é€‰*, é»˜è®¤ä¸º `"True"`) â€” æ˜¯å¦å¼ºåˆ¶å°†è´Ÿæç¤ºåµŒå…¥å§‹ç»ˆè®¾ç½®ä¸º 0ã€‚è¿˜è¯·å‚é˜…`stabilityai/stable-diffusion-xl-base-1-0`çš„é…ç½®ã€‚

+   `add_watermarker` (`bool`, *å¯é€‰*) â€” æ˜¯å¦ä½¿ç”¨[invisible_watermark åº“](https://github.com/ShieldMnt/invisible-watermark/)æ¥ç»™è¾“å‡ºå›¾åƒæ·»åŠ æ°´å°ã€‚å¦‚æœæœªå®šä¹‰ï¼Œä¸”è¯¥è½¯ä»¶åŒ…å·²å®‰è£…ï¼Œåˆ™é»˜è®¤ä¸º Trueï¼Œå¦åˆ™å°†ä¸ä½¿ç”¨æ°´å°ã€‚

ä½¿ç”¨ Stable Diffusion XL è¿›è¡Œæ–‡æœ¬åˆ°å›¾åƒç”Ÿæˆçš„ç®¡é“ã€‚

è¯¥æ¨¡å‹ç»§æ‰¿è‡ª DiffusionPipelineã€‚æŸ¥çœ‹è¶…ç±»æ–‡æ¡£ä»¥äº†è§£åº“ä¸ºæ‰€æœ‰ç®¡é“å®ç°çš„é€šç”¨æ–¹æ³•ï¼ˆå¦‚ä¸‹è½½æˆ–ä¿å­˜ã€åœ¨ç‰¹å®šè®¾å¤‡ä¸Šè¿è¡Œç­‰ï¼‰ã€‚

è¯¥ç®¡é“è¿˜ç»§æ‰¿äº†ä»¥ä¸‹åŠ è½½æ–¹æ³•ï¼š

+   ç”¨äºåŠ è½½æ–‡æœ¬åæ¼”åµŒå…¥çš„ load_textual_inversion()

+   ç”¨äºåŠ è½½ `.ckpt` æ–‡ä»¶çš„ from_single_file()

+   åŠ è½½ LoRA æƒé‡çš„ load_lora_weights()

+   ç”¨äºä¿å­˜ LoRA æƒé‡çš„ `save_lora_weights()`

+   ç”¨äºåŠ è½½ IP é€‚é…å™¨çš„ load_ip_adapter()

#### `__call__`

[< source >](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_inpaint.py#L1262)

```py
( prompt: Union = None prompt_2: Union = None image: Union = None mask_image: Union = None masked_image_latents: FloatTensor = None height: Optional = None width: Optional = None padding_mask_crop: Optional = None strength: float = 0.9999 num_inference_steps: int = 50 timesteps: List = None denoising_start: Optional = None denoising_end: Optional = None guidance_scale: float = 7.5 negative_prompt: Union = None negative_prompt_2: Union = None num_images_per_prompt: Optional = 1 eta: float = 0.0 generator: Union = None latents: Optional = None prompt_embeds: Optional = None negative_prompt_embeds: Optional = None pooled_prompt_embeds: Optional = None negative_pooled_prompt_embeds: Optional = None ip_adapter_image: Union = None output_type: Optional = 'pil' return_dict: bool = True cross_attention_kwargs: Optional = None guidance_rescale: float = 0.0 original_size: Tuple = None crops_coords_top_left: Tuple = (0, 0) target_size: Tuple = None negative_original_size: Optional = None negative_crops_coords_top_left: Tuple = (0, 0) negative_target_size: Optional = None aesthetic_score: float = 6.0 negative_aesthetic_score: float = 2.5 clip_skip: Optional = None callback_on_step_end: Optional = None callback_on_step_end_tensor_inputs: List = ['latents'] **kwargs ) â†’ export const metadata = 'undefined';~pipelines.stable_diffusion.StableDiffusionXLPipelineOutput or tuple
```

å‚æ•°

+   `prompt` (`str` æˆ– `List[str]`, *å¯é€‰*) â€” ç”¨äºæŒ‡å¯¼å›¾åƒç”Ÿæˆçš„æç¤ºæˆ–æç¤ºã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™å¿…é¡»ä¼ é€’ `prompt_embeds`ã€‚

+   `prompt_2` (`str` æˆ– `List[str]`, *å¯é€‰*) â€” å‘é€åˆ° `tokenizer_2` å’Œ `text_encoder_2` çš„æç¤ºæˆ–æç¤ºã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™åœ¨ä¸¤ä¸ªæ–‡æœ¬ç¼–ç å™¨ä¸­ä½¿ç”¨ `prompt`ã€‚

+   `image` (`PIL.Image.Image`) â€” å°†è¢«ä¿®å¤çš„å›¾åƒï¼Œæˆ–è¡¨ç¤ºå°†è¢«é®ç½©å¹¶æ ¹æ® `prompt` é‡æ–°ç»˜åˆ¶éƒ¨åˆ†çš„å›¾åƒæ‰¹æ¬¡çš„å¼ é‡ã€‚

+   `mask_image` (`PIL.Image.Image`) â€” ç”¨äºé®ç½© `image` çš„ `Image` æˆ–è¡¨ç¤ºå›¾åƒæ‰¹æ¬¡çš„å¼ é‡ã€‚é®ç½©ä¸­çš„ç™½è‰²åƒç´ å°†è¢«é‡æ–°ç»˜åˆ¶ï¼Œè€Œé»‘è‰²åƒç´ å°†è¢«ä¿ç•™ã€‚å¦‚æœ `mask_image` æ˜¯ PIL å›¾åƒï¼Œåˆ™åœ¨ä½¿ç”¨ä¹‹å‰å°†å…¶è½¬æ¢ä¸ºå•é€šé“ï¼ˆäº®åº¦ï¼‰ã€‚å¦‚æœæ˜¯å¼ é‡ï¼Œåˆ™åº”è¯¥åŒ…å«ä¸€ä¸ªé¢œè‰²é€šé“ï¼ˆLï¼‰è€Œä¸æ˜¯ 3ï¼Œå› æ­¤é¢„æœŸå½¢çŠ¶å°†æ˜¯ `(B, H, W, 1)`ã€‚

+   `height` (`int`, *å¯é€‰*, é»˜è®¤ä¸º self.unet.config.sample_size * self.vae_scale_factor) â€” ç”Ÿæˆå›¾åƒçš„åƒç´ é«˜åº¦ã€‚é»˜è®¤è®¾ç½®ä¸º 1024 ä»¥è·å¾—æœ€ä½³ç»“æœã€‚ä½äº 512 åƒç´ çš„ä»»ä½•å†…å®¹éƒ½ä¸é€‚ç”¨äº [stabilityai/stable-diffusion-xl-base-1.0](https://huggingface.co/stabilityai/stable-diffusion-xl-base-1.0) å’Œæœªç»ä¸“é—¨è°ƒæ•´ä½åˆ†è¾¨ç‡çš„æ£€æŸ¥ç‚¹ã€‚

+   `width` (`int`, *å¯é€‰*, é»˜è®¤ä¸º self.unet.config.sample_size * self.vae_scale_factor) â€” ç”Ÿæˆå›¾åƒçš„åƒç´ å®½åº¦ã€‚é»˜è®¤è®¾ç½®ä¸º 1024 ä»¥è·å¾—æœ€ä½³ç»“æœã€‚ä½äº 512 åƒç´ çš„ä»»ä½•å†…å®¹éƒ½ä¸é€‚ç”¨äº [stabilityai/stable-diffusion-xl-base-1.0](https://huggingface.co/stabilityai/stable-diffusion-xl-base-1.0) å’Œæœªç»ä¸“é—¨è°ƒæ•´ä½åˆ†è¾¨ç‡çš„æ£€æŸ¥ç‚¹ã€‚

+   `padding_mask_crop` (`int`, *å¯é€‰*, é»˜è®¤ä¸º `None`) â€” ç”¨äºåœ¨å›¾åƒå’Œé®ç½©ä¸Šåº”ç”¨çš„è£å‰ªè¾¹ç¼˜å¤§å°ã€‚å¦‚æœä¸º `None`ï¼Œåˆ™ä¸å¯¹å›¾åƒå’Œ mask_image åº”ç”¨è£å‰ªã€‚å¦‚æœ `padding_mask_crop` ä¸æ˜¯ `None`ï¼Œå®ƒå°†é¦–å…ˆæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰ä¸å›¾åƒç›¸åŒçºµæ¨ªæ¯”ä¸”åŒ…å«æ‰€æœ‰é®ç½©åŒºåŸŸçš„çŸ©å½¢åŒºåŸŸï¼Œç„¶åæ ¹æ® `padding_mask_crop` æ‰©å±•è¯¥åŒºåŸŸã€‚ç„¶åæ ¹æ®æ‰©å±•åŒºåŸŸå¯¹å›¾åƒå’Œ mask_image è¿›è¡Œè£å‰ªï¼Œç„¶åå°†å…¶è°ƒæ•´ä¸ºä¿®å¤å›¾åƒçš„åŸå§‹å¤§å°ã€‚å½“é®ç½©åŒºåŸŸè¾ƒå°è€Œå›¾åƒè¾ƒå¤§ä¸”åŒ…å«ä¸ä¿®å¤æ— å…³çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚èƒŒæ™¯ï¼‰æ—¶ï¼Œè¿™æ˜¯æœ‰ç”¨çš„ã€‚

+   `strength` (`float`, *optional*, defaults to 0.9999) â€” åœ¨æ¦‚å¿µä¸Šï¼ŒæŒ‡ç¤ºè¦è½¬æ¢å‚è€ƒ`image`çš„é®ç½©éƒ¨åˆ†çš„ç¨‹åº¦ã€‚å¿…é¡»åœ¨ 0 å’Œ 1 ä¹‹é—´ã€‚`image`å°†è¢«ç”¨ä½œèµ·ç‚¹ï¼Œæ·»åŠ çš„å™ªéŸ³è¶Šå¤šï¼Œ`strength`è¶Šå¤§ã€‚é™å™ªæ­¥éª¤çš„æ•°é‡å–å†³äºæœ€åˆæ·»åŠ çš„å™ªéŸ³é‡ã€‚å½“`strength`ä¸º 1 æ—¶ï¼Œæ·»åŠ çš„å™ªéŸ³å°†è¾¾åˆ°æœ€å¤§å€¼ï¼Œå¹¶ä¸”é™å™ªè¿‡ç¨‹å°†è¿è¡ŒæŒ‡å®šçš„`num_inference_steps`ä¸­çš„å…¨éƒ¨è¿­ä»£æ¬¡æ•°ã€‚å› æ­¤ï¼Œå€¼ä¸º 1 çš„æƒ…å†µä¸‹ï¼ŒåŸºæœ¬ä¸Šå¿½ç•¥äº†å‚è€ƒ`image`çš„é®ç½©éƒ¨åˆ†ã€‚è¯·æ³¨æ„ï¼Œåœ¨å°†`denoising_start`å£°æ˜ä¸ºæ•´æ•°çš„æƒ…å†µä¸‹ï¼Œå°†å¿½ç•¥`strength`çš„å€¼ã€‚

+   `num_inference_steps` (`int`, *optional*, defaults to 50) â€” é™å™ªæ­¥éª¤çš„æ•°é‡ã€‚æ›´å¤šçš„é™å™ªæ­¥éª¤é€šå¸¸ä¼šå¯¼è‡´å›¾åƒè´¨é‡æ›´é«˜ï¼Œä½†æ¨ç†é€Ÿåº¦è¾ƒæ…¢ã€‚

+   `timesteps` (`List[int]`, *optional*) â€” ç”¨äºå…·æœ‰æ”¯æŒ`timesteps`å‚æ•°çš„è°ƒåº¦å™¨çš„è‡ªå®šä¹‰æ—¶é—´æ­¥é•¿ï¼Œå…¶åœ¨å…¶`set_timesteps`æ–¹æ³•ä¸­æ”¯æŒã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™å°†ä½¿ç”¨ä¼ é€’`num_inference_steps`æ—¶çš„é»˜è®¤è¡Œä¸ºã€‚å¿…é¡»æŒ‰é™åºæ’åˆ—ã€‚

+   `denoising_start` (`float`, *optional*) â€” å½“æŒ‡å®šæ—¶ï¼ŒæŒ‡ç¤ºåœ¨å¯åŠ¨ä¹‹å‰è¦ç»•è¿‡çš„æ€»é™å™ªè¿‡ç¨‹çš„éƒ¨åˆ†æ¯”ä¾‹ï¼ˆä»‹äº 0.0 å’Œ 1.0 ä¹‹é—´ï¼‰ã€‚å› æ­¤ï¼Œè·³è¿‡é™å™ªè¿‡ç¨‹çš„åˆå§‹éƒ¨åˆ†ï¼Œå¹¶å‡å®šä¼ é€’çš„`image`æ˜¯éƒ¨åˆ†é™å™ªçš„å›¾åƒã€‚è¯·æ³¨æ„ï¼Œå½“æŒ‡å®šæ­¤å‚æ•°æ—¶ï¼Œå°†å¿½ç•¥`strength`ã€‚å½“æ­¤ç®¡é“é›†æˆåˆ°â€œæ··åˆé™å™ªå™¨â€å¤šç®¡é“è®¾ç½®ä¸­æ—¶ï¼Œ`denoising_start`å‚æ•°ç‰¹åˆ«æœ‰ç›Šï¼Œå¦‚[`Refining the Image Output`](https://huggingface.co/docs/diffusers/api/pipelines/stable_diffusion/stable_diffusion_xl#refining-the-image-output)ä¸­è¯¦ç»†è¯´æ˜çš„é‚£æ ·ã€‚

+   `denoising_end` (`float`, *optional*) â€” å½“æŒ‡å®šæ—¶ï¼Œç¡®å®šåœ¨æ•…æ„æå‰ç»ˆæ­¢ä¹‹å‰è¦å®Œæˆçš„æ€»é™å™ªè¿‡ç¨‹çš„éƒ¨åˆ†æ¯”ä¾‹ï¼ˆä»‹äº 0.0 å’Œ 1.0 ä¹‹é—´ï¼‰ã€‚å› æ­¤ï¼Œè¿”å›çš„æ ·æœ¬ä»å°†ä¿ç•™ç›¸å½“æ•°é‡çš„å™ªéŸ³ï¼ˆçº¦è¿˜éœ€è¦æœ€å 20%çš„æ—¶é—´æ­¥ï¼‰ï¼Œå¹¶ä¸”åº”ç”±å…·æœ‰`denoising_start`è®¾ç½®ä¸º 0.8 çš„åç»­ç®¡é“è¿›è¡Œé™å™ªï¼Œä»¥ä¾¿ä»…å¯¹è°ƒåº¦å™¨çš„æœ€å 20%è¿›è¡Œé™å™ªã€‚å½“æ­¤ç®¡é“å½¢æˆâ€œæ··åˆé™å™ªå™¨â€å¤šç®¡é“è®¾ç½®çš„ä¸€éƒ¨åˆ†æ—¶ï¼Œåº”ç†æƒ³åœ°åˆ©ç”¨`denoising_end`å‚æ•°ï¼Œå¦‚[`Refining the Image Output`](https://huggingface.co/docs/diffusers/api/pipelines/stable_diffusion/stable_diffusion_xl#refining-the-image-output)ä¸­è¯¦ç»†è¯´æ˜çš„é‚£æ ·ã€‚

+   `guidance_scale` (`float`, *optional*, defaults to 7.5) â€” å¦‚[Classifier-Free Diffusion Guidance](https://arxiv.org/abs/2207.12598)ä¸­å®šä¹‰çš„æŒ‡å¯¼æ¯”ä¾‹ã€‚`guidance_scale`è¢«å®šä¹‰ä¸º[Imagen Paper](https://arxiv.org/pdf/2205.11487.pdf)ä¸­æ–¹ç¨‹ 2 çš„`w`ã€‚é€šè¿‡è®¾ç½®`guidance_scale > 1`æ¥å¯ç”¨æŒ‡å¯¼æ¯”ä¾‹ã€‚æ›´é«˜çš„æŒ‡å¯¼æ¯”ä¾‹é¼“åŠ±ç”Ÿæˆä¸æ–‡æœ¬`prompt`å¯†åˆ‡ç›¸å…³çš„å›¾åƒï¼Œé€šå¸¸ä»¥é™ä½å›¾åƒè´¨é‡ä¸ºä»£ä»·ã€‚

+   `negative_prompt` (`str` or `List[str]`, *optional*) â€” ä¸æŒ‡å¯¼å›¾åƒç”Ÿæˆçš„æç¤ºæˆ–æç¤ºã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™å¿…é¡»ä¼ é€’`negative_prompt_embeds`ã€‚å¦‚æœä¸ä½¿ç”¨æŒ‡å¯¼ï¼ˆå³ï¼Œå¦‚æœ`guidance_scale`å°äº`1`ï¼Œåˆ™å¿½ç•¥ï¼‰ã€‚

+   `negative_prompt_2` (`str` or `List[str]`, *optional*) â€” ä¸æŒ‡å¯¼å›¾åƒç”Ÿæˆçš„æç¤ºæˆ–æç¤ºï¼Œå°†å‘é€åˆ°`tokenizer_2`å’Œ`text_encoder_2`ã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™`negative_prompt`å°†åœ¨ä¸¤ä¸ªæ–‡æœ¬ç¼–ç å™¨ä¸­ä½¿ç”¨ã€‚

+   `prompt_embeds` (`torch.FloatTensor`, *optional*) â€” é¢„ç”Ÿæˆçš„æ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œä¾‹å¦‚æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œæ–‡æœ¬åµŒå…¥å°†ä»`prompt`è¾“å…¥å‚æ•°ç”Ÿæˆã€‚

+   `negative_prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„å…ˆç”Ÿæˆçš„è´Ÿæ–‡æœ¬åµŒå…¥ã€‚å¯ä»¥ç”¨æ¥è½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œä¾‹å¦‚æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä»`negative_prompt`è¾“å…¥å‚æ•°ç”Ÿæˆ negative_prompt_embedsã€‚

+   `pooled_prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„å…ˆç”Ÿæˆçš„æ± åŒ–æ–‡æœ¬åµŒå…¥ã€‚å¯ä»¥ç”¨æ¥è½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œä¾‹å¦‚æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä»`prompt`è¾“å…¥å‚æ•°ç”Ÿæˆæ± åŒ–æ–‡æœ¬åµŒå…¥ã€‚

+   `negative_pooled_prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„å…ˆç”Ÿæˆçš„è´Ÿæ± åŒ–æ–‡æœ¬åµŒå…¥ã€‚å¯ä»¥ç”¨æ¥è½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œä¾‹å¦‚æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä»`negative_prompt`è¾“å…¥å‚æ•°ç”Ÿæˆæ± åŒ–çš„ negative_prompt_embedsã€‚ip_adapter_image â€” (`PipelineImageInput`, *å¯é€‰*): å¯é€‰çš„å›¾åƒè¾“å…¥ï¼Œç”¨äºä¸ IP é€‚é…å™¨ä¸€èµ·ä½¿ç”¨ã€‚

+   `num_images_per_prompt` (`int`, *å¯é€‰*, é»˜è®¤ä¸º 1) â€” æ¯ä¸ªæç¤ºç”Ÿæˆçš„å›¾åƒæ•°é‡ã€‚

+   `eta` (`float`, *å¯é€‰*, é»˜è®¤ä¸º 0.0) â€” å¯¹åº”äº DDIM è®ºæ–‡ä¸­çš„å‚æ•° eta (Î·)ï¼š[`arxiv.org/abs/2010.02502`](https://arxiv.org/abs/2010.02502)ã€‚ä»…é€‚ç”¨äº schedulers.DDIMSchedulerï¼Œå¯¹å…¶ä»–æƒ…å†µå°†è¢«å¿½ç•¥ã€‚

+   `generator` (`torch.Generator`, *å¯é€‰*) â€” ä¸€ä¸ªæˆ–å¤šä¸ª[torch ç”Ÿæˆå™¨](https://pytorch.org/docs/stable/generated/torch.Generator.html)ï¼Œç”¨äºä½¿ç”Ÿæˆè¿‡ç¨‹ç¡®å®šæ€§ã€‚

+   `latents` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„å…ˆç”Ÿæˆçš„å™ªå£°æ½œå˜é‡ï¼Œä»é«˜æ–¯åˆ†å¸ƒä¸­é‡‡æ ·ï¼Œç”¨ä½œå›¾åƒç”Ÿæˆçš„è¾“å…¥ã€‚å¯ä»¥ç”¨æ¥é€šè¿‡ä¸åŒæç¤ºå¾®è°ƒç›¸åŒçš„ç”Ÿæˆã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä½¿ç”¨æä¾›çš„éšæœº`generator`è¿›è¡Œé‡‡æ ·ç”Ÿæˆæ½œå˜é‡å¼ é‡ã€‚

+   `output_type` (`str`, *å¯é€‰*, é»˜è®¤ä¸º`"pil"`) â€” ç”Ÿæˆå›¾åƒçš„è¾“å‡ºæ ¼å¼ã€‚åœ¨[PIL](https://pillow.readthedocs.io/en/stable/)ä¹‹é—´é€‰æ‹©ï¼š`PIL.Image.Image`æˆ–`np.array`ã€‚

+   `return_dict` (`bool`, *å¯é€‰*, é»˜è®¤ä¸º`True`) â€” æ˜¯å¦è¿”å› StableDiffusionPipelineOutput è€Œä¸æ˜¯æ™®é€šå…ƒç»„ã€‚

+   `cross_attention_kwargs` (`dict`, *å¯é€‰*) â€” å¦‚æœæŒ‡å®šï¼Œå°†ä½œä¸º kwargs å­—å…¸ä¼ é€’ç»™`AttentionProcessor`ï¼Œå¦‚[diffusers.models.attention_processor](https://github.com/huggingface/diffusers/blob/main/src/diffusers/models/attention_processor.py)ä¸­çš„`self.processor`ä¸­å®šä¹‰çš„é‚£æ ·ã€‚

+   `original_size` (`Tuple[int]`, *å¯é€‰*, é»˜è®¤ä¸º(1024, 1024)) â€” å¦‚æœ`original_size`ä¸`target_size`ä¸åŒï¼Œå›¾åƒå°†å‘ˆç°ä¸ºç¼©å°æˆ–æ”¾å¤§ã€‚å¦‚æœæœªæŒ‡å®šï¼Œ`original_size`é»˜è®¤ä¸º`(height, width)`ã€‚ä½œä¸º SDXL å¾®è°ƒçš„ä¸€éƒ¨åˆ†ï¼Œå¦‚[`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952)ç¬¬ 2.2 èŠ‚ä¸­æ‰€è¿°ã€‚

+   `crops_coords_top_left` (`Tuple[int]`, *å¯é€‰*, é»˜è®¤ä¸º(0, 0)) â€” `crops_coords_top_left`å¯ç”¨äºç”Ÿæˆä¸€ä¸ªçœ‹èµ·æ¥ä»ä½ç½®`crops_coords_top_left`å‘ä¸‹â€œè£å‰ªâ€çš„å›¾åƒã€‚é€šå¸¸é€šè¿‡å°†`crops_coords_top_left`è®¾ç½®ä¸º(0, 0)æ¥å®ç°æœ‰åˆ©çš„ã€å±…ä¸­çš„å›¾åƒã€‚ä½œä¸º SDXL å¾®è°ƒçš„ä¸€éƒ¨åˆ†ï¼Œå¦‚[`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952)ç¬¬ 2.2 èŠ‚ä¸­æ‰€è¿°ã€‚

+   `target_size` (`Tuple[int]`, *å¯é€‰*, é»˜è®¤ä¸º(1024, 1024)) â€” å¯¹äºå¤§å¤šæ•°æƒ…å†µï¼Œ`target_size`åº”è®¾ç½®ä¸ºç”Ÿæˆå›¾åƒçš„æœŸæœ›é«˜åº¦å’Œå®½åº¦ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå®ƒå°†é»˜è®¤ä¸º`(height, width)`ã€‚ä½œä¸º SDXL å¾®è°ƒçš„ä¸€éƒ¨åˆ†ï¼Œå¦‚[`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952)ç¬¬ 2.2 èŠ‚ä¸­æ‰€è¿°ã€‚

+   `negative_original_size` (`Tuple[int]`, *optional*, é»˜è®¤ä¸º (1024, 1024)) â€” æ ¹æ®ç‰¹å®šå›¾åƒåˆ†è¾¨ç‡å¯¹ç”Ÿæˆè¿‡ç¨‹è¿›è¡Œè´Ÿé¢æ¡ä»¶ã€‚ä½œä¸º SDXL çš„å¾®è°ƒèŠ‚çš„ä¸€éƒ¨åˆ†ï¼Œè¯¦è§ [`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952) çš„ç¬¬ 2.2 èŠ‚ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒæ­¤é—®é¢˜çº¿ç¨‹ï¼š[`github.com/huggingface/diffusers/issues/4208`](https://github.com/huggingface/diffusers/issues/4208)ã€‚

+   `negative_crops_coords_top_left` (`Tuple[int]`, *optional*, é»˜è®¤ä¸º (0, 0)) â€” æ ¹æ®ç‰¹å®šè£å‰ªåæ ‡å¯¹ç”Ÿæˆè¿‡ç¨‹è¿›è¡Œè´Ÿé¢æ¡ä»¶ã€‚ä½œä¸º SDXL çš„å¾®è°ƒèŠ‚çš„ä¸€éƒ¨åˆ†ï¼Œè¯¦è§ [`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952) çš„ç¬¬ 2.2 èŠ‚ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒæ­¤é—®é¢˜çº¿ç¨‹ï¼š[`github.com/huggingface/diffusers/issues/4208`](https://github.com/huggingface/diffusers/issues/4208)ã€‚

+   `negative_target_size` (`Tuple[int]`, *optional*, é»˜è®¤ä¸º (1024, 1024)) â€” æ ¹æ®ç›®æ ‡å›¾åƒåˆ†è¾¨ç‡å¯¹ç”Ÿæˆè¿‡ç¨‹è¿›è¡Œè´Ÿé¢æ¡ä»¶ã€‚å¯¹äºå¤§å¤šæ•°æƒ…å†µï¼Œå®ƒåº”è¯¥ä¸ `target_size` ç›¸åŒã€‚ä½œä¸º SDXL çš„å¾®è°ƒèŠ‚çš„ä¸€éƒ¨åˆ†ï¼Œè¯¦è§ [`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952) çš„ç¬¬ 2.2 èŠ‚ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒæ­¤é—®é¢˜çº¿ç¨‹ï¼š[`github.com/huggingface/diffusers/issues/4208`](https://github.com/huggingface/diffusers/issues/4208)ã€‚

+   `aesthetic_score` (`float`, *optional*, é»˜è®¤ä¸º 6.0) â€” ç”¨äºé€šè¿‡å½±å“æ­£é¢æ–‡æœ¬æ¡ä»¶æ¥æ¨¡æ‹Ÿç”Ÿæˆå›¾åƒçš„ç¾å­¦è¯„åˆ†ã€‚ä½œä¸º SDXL çš„å¾®è°ƒèŠ‚çš„ä¸€éƒ¨åˆ†ï¼Œè¯¦è§ [`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952) çš„ç¬¬ 2.2 èŠ‚ã€‚

+   `negative_aesthetic_score` (`float`, *optional*, é»˜è®¤ä¸º 2.5) â€” ä½œä¸º SDXL çš„å¾®è°ƒèŠ‚çš„ä¸€éƒ¨åˆ†ï¼Œè¯¦è§ [`huggingface.co/papers/2307.01952`](https://huggingface.co/papers/2307.01952) çš„ç¬¬ 2.2 èŠ‚ã€‚å¯ç”¨äºé€šè¿‡å½±å“è´Ÿé¢æ–‡æœ¬æ¡ä»¶æ¥æ¨¡æ‹Ÿç”Ÿæˆå›¾åƒçš„ç¾å­¦è¯„åˆ†ã€‚

+   `clip_skip` (`int`, *optional*) â€” åœ¨è®¡ç®—æç¤ºåµŒå…¥æ—¶è¦è·³è¿‡çš„ CLIP å±‚çš„æ•°é‡ã€‚å€¼ä¸º 1 è¡¨ç¤ºå°†ä½¿ç”¨å‰ä¸€å±‚çš„è¾“å‡ºæ¥è®¡ç®—æç¤ºåµŒå…¥ã€‚

+   `callback_on_step_end` (`Callable`, *optional*) â€” åœ¨æ¨ç†æœŸé—´æ¯ä¸ªå»å™ªæ­¥éª¤ç»“æŸæ—¶è°ƒç”¨çš„å‡½æ•°ã€‚è¯¥å‡½æ•°å°†ä½¿ç”¨ä»¥ä¸‹å‚æ•°è°ƒç”¨ï¼š`callback_on_step_end(self: DiffusionPipeline, step: int, timestep: int, callback_kwargs: Dict)`ã€‚`callback_kwargs` å°†åŒ…å«ç”± `callback_on_step_end_tensor_inputs` æŒ‡å®šçš„æ‰€æœ‰å¼ é‡çš„åˆ—è¡¨ã€‚

+   `callback_on_step_end_tensor_inputs` (`List`, *optional*) â€” ç”¨äº `callback_on_step_end` å‡½æ•°çš„å¼ é‡è¾“å…¥åˆ—è¡¨ã€‚åˆ—è¡¨ä¸­æŒ‡å®šçš„å¼ é‡å°†ä½œä¸º `callback_kwargs` å‚æ•°ä¼ é€’ã€‚æ‚¨åªèƒ½åŒ…å«åœ¨ç®¡é“ç±»çš„ `._callback_tensor_inputs` å±æ€§ä¸­åˆ—å‡ºçš„å˜é‡ã€‚

è¿”å›

`~pipelines.stable_diffusion.StableDiffusionXLPipelineOutput` æˆ– `tuple`

å¦‚æœ `return_dict` ä¸º Trueï¼Œåˆ™è¿”å› `~pipelines.stable_diffusion.StableDiffusionXLPipelineOutput`ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ª `tuple`ã€‚è¿”å›å…ƒç»„æ—¶ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯åŒ…å«ç”Ÿæˆå›¾åƒçš„åˆ—è¡¨ã€‚

è°ƒç”¨ç®¡é“ç”Ÿæˆæ—¶è°ƒç”¨çš„å‡½æ•°ã€‚

ç¤ºä¾‹ï¼š

```py
>>> import torch
>>> from diffusers import StableDiffusionXLInpaintPipeline
>>> from diffusers.utils import load_image

>>> pipe = StableDiffusionXLInpaintPipeline.from_pretrained(
...     "stabilityai/stable-diffusion-xl-base-1.0",
...     torch_dtype=torch.float16,
...     variant="fp16",
...     use_safetensors=True,
... )
>>> pipe.to("cuda")

>>> img_url = "https://raw.githubusercontent.com/CompVis/latent-diffusion/main/data/inpainting_examples/overture-creations-5sI6fQgYIuo.png"
>>> mask_url = "https://raw.githubusercontent.com/CompVis/latent-diffusion/main/data/inpainting_examples/overture-creations-5sI6fQgYIuo_mask.png"

>>> init_image = load_image(img_url).convert("RGB")
>>> mask_image = load_image(mask_url).convert("RGB")

>>> prompt = "A majestic tiger sitting on a bench"
>>> image = pipe(
...     prompt=prompt, image=init_image, mask_image=mask_image, num_inference_steps=50, strength=0.80
... ).images[0]
```

#### `disable_freeu`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_inpaint.py#L1129)

```py
( )
```

å¦‚æœå¯ç”¨ï¼Œå°†ç¦ç”¨ FreeU æœºåˆ¶ã€‚

#### `disable_vae_slicing`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_inpaint.py#L441)

```py
( )
```

ç¦ç”¨åˆ‡ç‰‡ VAE è§£ç ã€‚å¦‚æœä¹‹å‰å¯ç”¨äº† `enable_vae_slicing`ï¼Œåˆ™æ­¤æ–¹æ³•å°†è¿”å›åˆ°ä¸€æ­¥è®¡ç®—è§£ç ã€‚

#### `disable_vae_tiling`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_inpaint.py#L458)

```py
( )
```

ç¦ç”¨å¹³é“º VAE è§£ç ã€‚å¦‚æœä¹‹å‰å¯ç”¨äº† `enable_vae_tiling`ï¼Œåˆ™æ­¤æ–¹æ³•å°†è¿”å›åˆ°ä¸€æ­¥è®¡ç®—è§£ç ã€‚

#### `enable_freeu`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_inpaint.py#L1106)

```py
( s1: float s2: float b1: float b2: float )
```

å‚æ•°

+   `s1` (`float`) â€” ç¬¬ 1 é˜¶æ®µçš„ç¼©æ”¾å› å­ï¼Œç”¨äºå‡å¼±è·³è¿‡ç‰¹å¾çš„è´¡çŒ®ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†å‡è½»å¢å¼ºå»å™ªè¿‡ç¨‹ä¸­çš„â€œè¿‡åº¦å¹³æ»‘æ•ˆåº”â€ã€‚

+   `s2` (`float`) â€” ç¬¬ 2 é˜¶æ®µçš„ç¼©æ”¾å› å­ï¼Œç”¨äºå‡å¼±è·³è¿‡ç‰¹å¾çš„è´¡çŒ®ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†å‡è½»å¢å¼ºå»å™ªè¿‡ç¨‹ä¸­çš„â€œè¿‡åº¦å¹³æ»‘æ•ˆåº”â€ã€‚

+   `b1` (`float`) â€” ç¬¬ 1 é˜¶æ®µçš„ç¼©æ”¾å› å­ï¼Œç”¨äºæ”¾å¤§éª¨å¹²ç‰¹å¾çš„è´¡çŒ®ã€‚

+   `b2` (`float`) â€” ç¬¬ 2 é˜¶æ®µçš„ç¼©æ”¾å› å­ï¼Œç”¨äºæ”¾å¤§éª¨å¹²ç‰¹å¾çš„è´¡çŒ®ã€‚

å¯ç”¨ FreeU æœºåˆ¶ï¼Œå¦‚ [`arxiv.org/abs/2309.11497`](https://arxiv.org/abs/2309.11497)ã€‚

ç¼©æ”¾å› å­åç¼€è¡¨ç¤ºå®ƒä»¬è¢«åº”ç”¨çš„é˜¶æ®µã€‚

è¯·å‚è€ƒ[å®˜æ–¹å­˜å‚¨åº“](https://github.com/ChenyangSi/FreeU)ï¼Œäº†è§£å·²çŸ¥é€‚ç”¨äºä¸åŒç®¡é“ï¼ˆå¦‚ Stable Diffusion v1ã€v2 å’Œ Stable Diffusion XLï¼‰çš„å€¼ç»„åˆã€‚

#### `enable_vae_slicing`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_inpaint.py#L433)

```py
( )
```

å¯ç”¨åˆ‡ç‰‡ VAE è§£ç ã€‚å¯ç”¨æ­¤é€‰é¡¹æ—¶ï¼ŒVAE å°†åˆ†å‰²è¾“å…¥å¼ é‡ä»¥åœ¨å¤šä¸ªæ­¥éª¤ä¸­è®¡ç®—è§£ç ã€‚è¿™å¯¹äºèŠ‚çœä¸€äº›å†…å­˜å¹¶å…è®¸æ›´å¤§çš„æ‰¹é‡å¤§å°éå¸¸æœ‰ç”¨ã€‚

#### `enable_vae_tiling`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_inpaint.py#L449)

```py
( )
```

å¯ç”¨å¹³é“º VAE è§£ç ã€‚å¯ç”¨æ­¤é€‰é¡¹æ—¶ï¼ŒVAE å°†å°†è¾“å…¥å¼ é‡åˆ†å‰²æˆç“¦ç‰‡ä»¥åœ¨å¤šä¸ªæ­¥éª¤ä¸­è®¡ç®—è§£ç å’Œç¼–ç ã€‚è¿™å¯¹äºèŠ‚çœå¤§é‡å†…å­˜å¹¶å…è®¸å¤„ç†æ›´å¤§çš„å›¾åƒéå¸¸æœ‰ç”¨ã€‚

#### `encode_prompt`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_inpaint.py#L520)

```py
( prompt: str prompt_2: Optional = None device: Optional = None num_images_per_prompt: int = 1 do_classifier_free_guidance: bool = True negative_prompt: Optional = None negative_prompt_2: Optional = None prompt_embeds: Optional = None negative_prompt_embeds: Optional = None pooled_prompt_embeds: Optional = None negative_pooled_prompt_embeds: Optional = None lora_scale: Optional = None clip_skip: Optional = None )
```

å‚æ•°

+   `prompt` (`str` æˆ– `List[str]`, *å¯é€‰*) â€” è¦ç¼–ç çš„æç¤º

+   `prompt_2` (`str` æˆ– `List[str]`, *å¯é€‰*) â€” å‘é€åˆ° `tokenizer_2` å’Œ `text_encoder_2` çš„æç¤ºæˆ–æç¤ºã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™åœ¨ä¸¤ä¸ªæ–‡æœ¬ç¼–ç å™¨è®¾å¤‡ä¸­ä½¿ç”¨ `prompt` â€” (`torch.device`): torch è®¾å¤‡

+   `num_images_per_prompt` (`int`) â€” æ¯ä¸ªæç¤ºåº”ç”Ÿæˆçš„å›¾åƒæ•°é‡

+   `do_classifier_free_guidance` (`bool`) â€” æ˜¯å¦ä½¿ç”¨åˆ†ç±»å™¨è‡ªç”±æŒ‡å¯¼

+   `negative_prompt` (`str` æˆ– `List[str]`, *å¯é€‰*) â€” ä¸ç”¨æ¥æŒ‡å¯¼å›¾åƒç”Ÿæˆçš„æç¤ºæˆ–æç¤ºã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™å¿…é¡»ä¼ é€’ `negative_prompt_embeds`ã€‚å½“ä¸ä½¿ç”¨æŒ‡å¯¼æ—¶è¢«å¿½ç•¥ï¼ˆå³å¦‚æœ `guidance_scale` å°äº `1`ï¼Œåˆ™è¢«å¿½ç•¥ï¼‰ã€‚

+   `negative_prompt_2` (`str` æˆ– `List[str]`, *å¯é€‰*) â€” ç”¨äºå‘é€åˆ° `tokenizer_2` å’Œ `text_encoder_2` çš„ä¸ç”¨æ¥æŒ‡å¯¼å›¾åƒç”Ÿæˆçš„æç¤ºæˆ–æç¤ºã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™åœ¨ä¸¤ä¸ªæ–‡æœ¬ç¼–ç å™¨ä¸­ä½¿ç”¨ `negative_prompt`

+   `prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„ç”Ÿæˆçš„æ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œä¾‹å¦‚æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œæ–‡æœ¬åµŒå…¥å°†ä» `prompt` è¾“å…¥å‚æ•°ç”Ÿæˆã€‚

+   `negative_prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„ç”Ÿæˆçš„è´Ÿæ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œä¾‹å¦‚æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä» `negative_prompt` è¾“å…¥å‚æ•°ç”Ÿæˆ `negative_prompt_embeds`ã€‚

+   `pooled_prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„ç”Ÿæˆçš„æ± åŒ–æ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œä¾‹å¦‚æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä» `prompt` è¾“å…¥å‚æ•°ç”Ÿæˆæ± åŒ–æ–‡æœ¬åµŒå…¥ã€‚

+   `negative_pooled_prompt_embeds` (`torch.FloatTensor`, *å¯é€‰*) â€” é¢„ç”Ÿæˆçš„è´Ÿæ± åŒ–æ–‡æœ¬åµŒå…¥ã€‚å¯ç”¨äºè½»æ¾è°ƒæ•´æ–‡æœ¬è¾“å…¥ï¼Œä¾‹å¦‚æç¤ºåŠ æƒã€‚å¦‚æœæœªæä¾›ï¼Œå°†ä» `negative_prompt` è¾“å…¥å‚æ•°ç”Ÿæˆæ± åŒ–è´Ÿæ–‡æœ¬åµŒå…¥ã€‚

+   `lora_scale` (`float`, *å¯é€‰*) â€” å°†åº”ç”¨äºæ–‡æœ¬ç¼–ç å™¨çš„æ‰€æœ‰ LoRA å±‚çš„ lora æ¯”ä¾‹ï¼Œå¦‚æœåŠ è½½äº† LoRA å±‚ã€‚

+   `clip_skip` (`int`, *å¯é€‰*) â€” åœ¨è®¡ç®—æç¤ºåµŒå…¥æ—¶è¦ä» CLIP è·³è¿‡çš„å±‚æ•°ã€‚å€¼ä¸º 1 è¡¨ç¤ºå°†ä½¿ç”¨å‰ä¸€å±‚çš„è¾“å‡ºæ¥è®¡ç®—æç¤ºåµŒå…¥ã€‚

å°†æç¤ºç¼–ç ä¸ºæ–‡æœ¬ç¼–ç å™¨éšè—çŠ¶æ€ã€‚

#### `fuse_qkv_projections`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_inpaint.py#L1134)

```py
( unet: bool = True vae: bool = True )
```

å‚æ•°

+   `unet` (`bool`, é»˜è®¤ä¸º `True`) â€” åœ¨ UNet ä¸Šåº”ç”¨èåˆã€‚

+   `vae` (`bool`, é»˜è®¤ä¸º `True`) â€” åœ¨ VAE ä¸Šåº”ç”¨èåˆã€‚

å¯ç”¨èåˆçš„ QKV æŠ•å½±ã€‚å¯¹äºè‡ªæ³¨æ„åŠ›æ¨¡å—ï¼Œæ‰€æœ‰æŠ•å½±çŸ©é˜µï¼ˆå³æŸ¥è¯¢ã€é”®ã€å€¼ï¼‰éƒ½è¢«èåˆã€‚å¯¹äºäº¤å‰æ³¨æ„åŠ›æ¨¡å—ï¼Œé”®å’Œå€¼æŠ•å½±çŸ©é˜µè¢«èåˆã€‚

æ­¤ API æ˜¯ ğŸ§ª å®éªŒæ€§çš„ã€‚

#### `get_guidance_scale_embedding`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_inpaint.py#L1195)

```py
( w embedding_dim = 512 dtype = torch.float32 ) â†’ export const metadata = 'undefined';torch.FloatTensor
```

å‚æ•°

+   `timesteps` (`torch.Tensor`) â€” åœ¨è¿™äº›æ—¶é—´æ­¥ç”ŸæˆåµŒå…¥å‘é‡

+   `embedding_dim` (`int`, *å¯é€‰*, é»˜è®¤ä¸º 512) â€” è¦ç”Ÿæˆçš„åµŒå…¥çš„ç»´åº¦ dtype â€” ç”Ÿæˆçš„åµŒå…¥çš„æ•°æ®ç±»å‹

è¿”å›

`torch.FloatTensor`

å½¢çŠ¶ä¸º `(len(timesteps), embedding_dim)` çš„åµŒå…¥å‘é‡

å‚è§ [`github.com/google-research/vdm/blob/dc27b98a554f65cdc654b800da5aa1846545d41b/model_vdm.py#L298`](https://github.com/google-research/vdm/blob/dc27b98a554f65cdc654b800da5aa1846545d41b/model_vdm.py#L298)

#### `unfuse_qkv_projections`

[<æ¥æº>](https://github.com/huggingface/diffusers/blob/v0.26.3/src/diffusers/pipelines/stable_diffusion_xl/pipeline_stable_diffusion_xl_inpaint.py#L1166)

```py
( unet: bool = True vae: bool = True )
```

å‚æ•°

+   `unet` (`bool`, é»˜è®¤ä¸º `True`) â€” åœ¨ UNet ä¸Šåº”ç”¨èåˆã€‚

+   `vae` (`bool`, é»˜è®¤ä¸º `True`) â€” åœ¨ VAE ä¸Šåº”ç”¨èåˆã€‚

å¦‚æœå¯ç”¨ï¼Œç¦ç”¨ QKV æŠ•å½±èåˆã€‚

æ­¤ API æ˜¯ ğŸ§ª å®éªŒæ€§çš„ã€‚
